var Px=Object.create;var ly=Object.defineProperty;var Cx=Object.getOwnPropertyDescriptor;var Ix=Object.getOwnPropertyNames;var Dx=Object.getPrototypeOf,Ox=Object.prototype.hasOwnProperty;var df=(S=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(S,{get:(G,ae)=>(typeof require<"u"?require:G)[ae]}):S)(function(S){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+S+'" is not supported')});var Gx=(S,G)=>()=>(G||S((G={exports:{}}).exports,G),G.exports);var Bx=(S,G,ae,O)=>{if(G&&typeof G=="object"||typeof G=="function")for(let q of Ix(G))!Ox.call(S,q)&&q!==ae&&ly(S,q,{get:()=>G[q],enumerable:!(O=Cx(G,q))||O.enumerable});return S};var Ux=(S,G,ae)=>(ae=S!=null?Px(Dx(S)):{},Bx(G||!S||!S.__esModule?ly(ae,"default",{value:S,enumerable:!0}):ae,S));var Ly=Gx((gf,Jm)=>{"use strict";(function(S){if(typeof gf=="object"&&typeof Jm<"u")Jm.exports=S();else if(typeof define=="function"&&define.amd)define([],S);else{var G;typeof window<"u"?G=window:typeof global<"u"?G=global:typeof self<"u"?G=self:G=this,G.dagre=S()}})(function(){var S,G,ae;return function(){function O(q,ge,oe){function se(W,H){if(!ge[W]){if(!q[W]){var k=typeof df=="function"&&df;if(!H&&k)return k(W,!0);if(le)return le(W,!0);var $=new Error("Cannot find module '"+W+"'");throw $.code="MODULE_NOT_FOUND",$}var X=ge[W]={exports:{}};q[W][0].call(X.exports,function(ne){var j=q[W][1][ne];return se(j||ne)},X,X.exports,O,q,ge,oe)}return ge[W].exports}for(var le=typeof df=="function"&&df,Q=0;Q<oe.length;Q++)se(oe[Q]);return se}return O}()({1:[function(O,q,ge){q.exports={graphlib:O("@dagrejs/graphlib"),layout:O("./lib/layout"),debug:O("./lib/debug"),util:{time:O("./lib/util").time,notime:O("./lib/util").notime},version:O("./lib/version")},globalThis.dagre=q.exports},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(O,q,ge){"use strict";let oe=O("./greedy-fas"),se=O("./util").uniqueId;q.exports={run:le,undo:W};function le(H){(H.graph().acyclicer==="greedy"?oe(H,$(H)):Q(H)).forEach(X=>{let ne=H.edge(X);H.removeEdge(X),ne.forwardName=X.name,ne.reversed=!0,H.setEdge(X.w,X.v,ne,se("rev"))});function $(X){return ne=>X.edge(ne).weight}}function Q(H){let k=[],$={},X={};function ne(j){X.hasOwnProperty(j)||(X[j]=!0,$[j]=!0,H.outEdges(j).forEach(z=>{$.hasOwnProperty(z.w)?k.push(z):ne(z.w)}),delete $[j])}return H.nodes().forEach(ne),k}function W(H){H.edges().forEach(k=>{let $=H.edge(k);if($.reversed){H.removeEdge(k);let X=$.forwardName;delete $.reversed,delete $.forwardName,H.setEdge(k.w,k.v,$,X)}})}},{"./greedy-fas":7,"./util":27}],3:[function(O,q,ge){let oe=O("./util");q.exports=se;function se(Q){function W(H){let k=Q.children(H),$=Q.node(H);if(k.length&&k.forEach(W),$.hasOwnProperty("minRank")){$.borderLeft=[],$.borderRight=[];for(let X=$.minRank,ne=$.maxRank+1;X<ne;++X)le(Q,"borderLeft","_bl",H,$,X),le(Q,"borderRight","_br",H,$,X)}}Q.children().forEach(W)}function le(Q,W,H,k,$,X){let ne={width:0,height:0,rank:X,borderType:W},j=$[W][X-1],z=oe.addDummyNode(Q,"border",ne,H);$[W][X]=z,Q.setParent(z,k),j&&Q.setEdge(j,z,{weight:1})}},{"./util":27}],4:[function(O,q,ge){"use strict";q.exports={adjust:oe,undo:se};function oe(X){let ne=X.graph().rankdir.toLowerCase();(ne==="lr"||ne==="rl")&&le(X)}function se(X){let ne=X.graph().rankdir.toLowerCase();(ne==="bt"||ne==="rl")&&W(X),(ne==="lr"||ne==="rl")&&(k(X),le(X))}function le(X){X.nodes().forEach(ne=>Q(X.node(ne))),X.edges().forEach(ne=>Q(X.edge(ne)))}function Q(X){let ne=X.width;X.width=X.height,X.height=ne}function W(X){X.nodes().forEach(ne=>H(X.node(ne))),X.edges().forEach(ne=>{let j=X.edge(ne);j.points.forEach(H),j.hasOwnProperty("y")&&H(j)})}function H(X){X.y=-X.y}function k(X){X.nodes().forEach(ne=>$(X.node(ne))),X.edges().forEach(ne=>{let j=X.edge(ne);j.points.forEach($),j.hasOwnProperty("x")&&$(j)})}function $(X){let ne=X.x;X.x=X.y,X.y=ne}},{}],5:[function(O,q,ge){class oe{constructor(){let W={};W._next=W._prev=W,this._sentinel=W}dequeue(){let W=this._sentinel,H=W._prev;if(H!==W)return se(H),H}enqueue(W){let H=this._sentinel;W._prev&&W._next&&se(W),W._next=H._next,H._next._prev=W,H._next=W,W._prev=H}toString(){let W=[],H=this._sentinel,k=H._prev;for(;k!==H;)W.push(JSON.stringify(k,le)),k=k._prev;return"["+W.join(", ")+"]"}}function se(Q){Q._prev._next=Q._next,Q._next._prev=Q._prev,delete Q._next,delete Q._prev}function le(Q,W){if(Q!=="_next"&&Q!=="_prev")return W}q.exports=oe},{}],6:[function(O,q,ge){let oe=O("./util"),se=O("@dagrejs/graphlib").Graph;q.exports={debugOrdering:le};function le(Q){let W=oe.buildLayerMatrix(Q),H=new se({compound:!0,multigraph:!0}).setGraph({});return Q.nodes().forEach(k=>{H.setNode(k,{label:k}),H.setParent(k,"layer"+Q.node(k).rank)}),Q.edges().forEach(k=>H.setEdge(k.v,k.w,{},k.name)),W.forEach((k,$)=>{let X="layer"+$;H.setNode(X,{rank:"same"}),k.reduce((ne,j)=>(H.setEdge(ne,j,{style:"invis"}),j))}),H}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(O,q,ge){let oe=O("@dagrejs/graphlib").Graph,se=O("./data/list");q.exports=Q;let le=()=>1;function Q(ne,j){if(ne.nodeCount()<=1)return[];let z=k(ne,j||le);return W(z.graph,z.buckets,z.zeroIdx).flatMap(Re=>ne.outEdges(Re.v,Re.w))}function W(ne,j,z){let me=[],Re=j[j.length-1],Xe=j[0],ze;for(;ne.nodeCount();){for(;ze=Xe.dequeue();)H(ne,j,z,ze);for(;ze=Re.dequeue();)H(ne,j,z,ze);if(ne.nodeCount()){for(let Ge=j.length-2;Ge>0;--Ge)if(ze=j[Ge].dequeue(),ze){me=me.concat(H(ne,j,z,ze,!0));break}}}return me}function H(ne,j,z,me,Re){let Xe=Re?[]:void 0;return ne.inEdges(me.v).forEach(ze=>{let Ge=ne.edge(ze),tt=ne.node(ze.v);Re&&Xe.push({v:ze.v,w:ze.w}),tt.out-=Ge,$(j,z,tt)}),ne.outEdges(me.v).forEach(ze=>{let Ge=ne.edge(ze),tt=ze.w,ft=ne.node(tt);ft.in-=Ge,$(j,z,ft)}),ne.removeNode(me.v),Xe}function k(ne,j){let z=new oe,me=0,Re=0;ne.nodes().forEach(Ge=>{z.setNode(Ge,{v:Ge,in:0,out:0})}),ne.edges().forEach(Ge=>{let tt=z.edge(Ge.v,Ge.w)||0,ft=j(Ge),je=tt+ft;z.setEdge(Ge.v,Ge.w,je),Re=Math.max(Re,z.node(Ge.v).out+=ft),me=Math.max(me,z.node(Ge.w).in+=ft)});let Xe=X(Re+me+3).map(()=>new se),ze=me+1;return z.nodes().forEach(Ge=>{$(Xe,ze,z.node(Ge))}),{graph:z,buckets:Xe,zeroIdx:ze}}function $(ne,j,z){z.out?z.in?ne[z.out-z.in+j].enqueue(z):ne[ne.length-1].enqueue(z):ne[0].enqueue(z)}function X(ne){let j=[];for(let z=0;z<ne;z++)j.push(z);return j}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(O,q,ge){"use strict";let oe=O("./acyclic"),se=O("./normalize"),le=O("./rank"),Q=O("./util").normalizeRanks,W=O("./parent-dummy-chains"),H=O("./util").removeEmptyRanks,k=O("./nesting-graph"),$=O("./add-border-segments"),X=O("./coordinate-system"),ne=O("./order"),j=O("./position"),z=O("./util"),me=O("@dagrejs/graphlib").Graph;q.exports=Re;function Re(Ye,it){let st=it&&it.debugTiming?z.time:z.notime;st("layout",()=>{let St=st("  buildLayoutGraph",()=>He(Ye));st("  runLayout",()=>Xe(St,st)),st("  updateInputGraph",()=>ze(Ye,St))})}function Xe(Ye,it){it("    makeSpaceForEdgeLabels",()=>Qe(Ye)),it("    removeSelfEdges",()=>ac(Ye)),it("    acyclic",()=>oe.run(Ye)),it("    nestingGraph.run",()=>k.run(Ye)),it("    rank",()=>le(z.asNonCompoundGraph(Ye))),it("    injectEdgeLabelProxies",()=>gt(Ye)),it("    removeEmptyRanks",()=>H(Ye)),it("    nestingGraph.cleanup",()=>k.cleanup(Ye)),it("    normalizeRanks",()=>Q(Ye)),it("    assignRankMinMax",()=>bt(Ye)),it("    removeEdgeLabelProxies",()=>Bt(Ye)),it("    normalize.run",()=>se.run(Ye)),it("    parentDummyChains",()=>W(Ye)),it("    addBorderSegments",()=>$(Ye)),it("    order",()=>ne(Ye)),it("    insertSelfEdges",()=>Yu(Ye)),it("    adjustCoordinateSystem",()=>X.adjust(Ye)),it("    position",()=>j(Ye)),it("    positionSelfEdges",()=>sl(Ye)),it("    removeBorderNodes",()=>vo(Ye)),it("    normalize.undo",()=>se.undo(Ye)),it("    fixupEdgeLabelCoords",()=>Cn(Ye)),it("    undoCoordinateSystem",()=>X.undo(Ye)),it("    translateGraph",()=>Ut(Ye)),it("    assignNodeIntersects",()=>Vt(Ye)),it("    reversePoints",()=>$n(Ye)),it("    acyclic.undo",()=>oe.undo(Ye))}function ze(Ye,it){Ye.nodes().forEach(st=>{let St=Ye.node(st),Qt=it.node(st);St&&(St.x=Qt.x,St.y=Qt.y,St.rank=Qt.rank,it.children(st).length&&(St.width=Qt.width,St.height=Qt.height))}),Ye.edges().forEach(st=>{let St=Ye.edge(st),Qt=it.edge(st);St.points=Qt.points,Qt.hasOwnProperty("x")&&(St.x=Qt.x,St.y=Qt.y)}),Ye.graph().width=it.graph().width,Ye.graph().height=it.graph().height}let Ge=["nodesep","edgesep","ranksep","marginx","marginy"],tt={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},ft=["acyclicer","ranker","rankdir","align"],je=["width","height"],rt={width:0,height:0},Me=["minlen","weight","width","height","labeloffset"],Ie={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ke=["labelpos"];function He(Ye){let it=new me({multigraph:!0,compound:!0}),st=cc(Ye.graph());return it.setGraph(Object.assign({},tt,lc(st,Ge),z.pick(st,ft))),Ye.nodes().forEach(St=>{let Qt=cc(Ye.node(St)),dn=lc(Qt,je);Object.keys(rt).forEach(yn=>{dn[yn]===void 0&&(dn[yn]=rt[yn])}),it.setNode(St,dn),it.setParent(St,Ye.parent(St))}),Ye.edges().forEach(St=>{let Qt=cc(Ye.edge(St));it.setEdge(St,Object.assign({},Ie,lc(Qt,Me),z.pick(Qt,ke)))}),it}function Qe(Ye){let it=Ye.graph();it.ranksep/=2,Ye.edges().forEach(st=>{let St=Ye.edge(st);St.minlen*=2,St.labelpos.toLowerCase()!=="c"&&(it.rankdir==="TB"||it.rankdir==="BT"?St.width+=St.labeloffset:St.height+=St.labeloffset)})}function gt(Ye){Ye.edges().forEach(it=>{let st=Ye.edge(it);if(st.width&&st.height){let St=Ye.node(it.v),dn={rank:(Ye.node(it.w).rank-St.rank)/2+St.rank,e:it};z.addDummyNode(Ye,"edge-proxy",dn,"_ep")}})}function bt(Ye){let it=0;Ye.nodes().forEach(st=>{let St=Ye.node(st);St.borderTop&&(St.minRank=Ye.node(St.borderTop).rank,St.maxRank=Ye.node(St.borderBottom).rank,it=Math.max(it,St.maxRank))}),Ye.graph().maxRank=it}function Bt(Ye){Ye.nodes().forEach(it=>{let st=Ye.node(it);st.dummy==="edge-proxy"&&(Ye.edge(st.e).labelRank=st.rank,Ye.removeNode(it))})}function Ut(Ye){let it=Number.POSITIVE_INFINITY,st=0,St=Number.POSITIVE_INFINITY,Qt=0,dn=Ye.graph(),yn=dn.marginx||0,br=dn.marginy||0;function al(Mr){let ar=Mr.x,Hs=Mr.y,zr=Mr.width,Qr=Mr.height;it=Math.min(it,ar-zr/2),st=Math.max(st,ar+zr/2),St=Math.min(St,Hs-Qr/2),Qt=Math.max(Qt,Hs+Qr/2)}Ye.nodes().forEach(Mr=>al(Ye.node(Mr))),Ye.edges().forEach(Mr=>{let ar=Ye.edge(Mr);ar.hasOwnProperty("x")&&al(ar)}),it-=yn,St-=br,Ye.nodes().forEach(Mr=>{let ar=Ye.node(Mr);ar.x-=it,ar.y-=St}),Ye.edges().forEach(Mr=>{let ar=Ye.edge(Mr);ar.points.forEach(Hs=>{Hs.x-=it,Hs.y-=St}),ar.hasOwnProperty("x")&&(ar.x-=it),ar.hasOwnProperty("y")&&(ar.y-=St)}),dn.width=st-it+yn,dn.height=Qt-St+br}function Vt(Ye){Ye.edges().forEach(it=>{let st=Ye.edge(it),St=Ye.node(it.v),Qt=Ye.node(it.w),dn,yn;st.points?(dn=st.points[0],yn=st.points[st.points.length-1]):(st.points=[],dn=Qt,yn=St),st.points.unshift(z.intersectRect(St,dn)),st.points.push(z.intersectRect(Qt,yn))})}function Cn(Ye){Ye.edges().forEach(it=>{let st=Ye.edge(it);if(st.hasOwnProperty("x"))switch((st.labelpos==="l"||st.labelpos==="r")&&(st.width-=st.labeloffset),st.labelpos){case"l":st.x-=st.width/2+st.labeloffset;break;case"r":st.x+=st.width/2+st.labeloffset;break}})}function $n(Ye){Ye.edges().forEach(it=>{let st=Ye.edge(it);st.reversed&&st.points.reverse()})}function vo(Ye){Ye.nodes().forEach(it=>{if(Ye.children(it).length){let st=Ye.node(it),St=Ye.node(st.borderTop),Qt=Ye.node(st.borderBottom),dn=Ye.node(st.borderLeft[st.borderLeft.length-1]),yn=Ye.node(st.borderRight[st.borderRight.length-1]);st.width=Math.abs(yn.x-dn.x),st.height=Math.abs(Qt.y-St.y),st.x=dn.x+st.width/2,st.y=St.y+st.height/2}}),Ye.nodes().forEach(it=>{Ye.node(it).dummy==="border"&&Ye.removeNode(it)})}function ac(Ye){Ye.edges().forEach(it=>{if(it.v===it.w){var st=Ye.node(it.v);st.selfEdges||(st.selfEdges=[]),st.selfEdges.push({e:it,label:Ye.edge(it)}),Ye.removeEdge(it)}})}function Yu(Ye){var it=z.buildLayerMatrix(Ye);it.forEach(st=>{var St=0;st.forEach((Qt,dn)=>{var yn=Ye.node(Qt);yn.order=dn+St,(yn.selfEdges||[]).forEach(br=>{z.addDummyNode(Ye,"selfedge",{width:br.label.width,height:br.label.height,rank:yn.rank,order:dn+ ++St,e:br.e,label:br.label},"_se")}),delete yn.selfEdges})})}function sl(Ye){Ye.nodes().forEach(it=>{var st=Ye.node(it);if(st.dummy==="selfedge"){var St=Ye.node(st.e.v),Qt=St.x+St.width/2,dn=St.y,yn=st.x-Qt,br=St.height/2;Ye.setEdge(st.e,st.label),Ye.removeNode(it),st.label.points=[{x:Qt+2*yn/3,y:dn-br},{x:Qt+5*yn/6,y:dn-br},{x:Qt+yn,y:dn},{x:Qt+5*yn/6,y:dn+br},{x:Qt+2*yn/3,y:dn+br}],st.label.x=st.x,st.label.y=st.y}})}function lc(Ye,it){return z.mapValues(z.pick(Ye,it),Number)}function cc(Ye){var it={};return Ye&&Object.entries(Ye).forEach(([st,St])=>{typeof st=="string"&&(st=st.toLowerCase()),it[st]=St}),it}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(O,q,ge){let oe=O("./util");q.exports={run:se,cleanup:H};function se(k){let $=oe.addDummyNode(k,"root",{},"_root"),X=Q(k),ne=Math.max(...Object.values(X))-1,j=2*ne+1;k.graph().nestingRoot=$,k.edges().forEach(me=>k.edge(me).minlen*=j);let z=W(k)+1;k.children().forEach(me=>le(k,$,j,z,ne,X,me)),k.graph().nodeRankFactor=j}function le(k,$,X,ne,j,z,me){let Re=k.children(me);if(!Re.length){me!==$&&k.setEdge($,me,{weight:0,minlen:X});return}let Xe=oe.addBorderNode(k,"_bt"),ze=oe.addBorderNode(k,"_bb"),Ge=k.node(me);k.setParent(Xe,me),Ge.borderTop=Xe,k.setParent(ze,me),Ge.borderBottom=ze,Re.forEach(tt=>{le(k,$,X,ne,j,z,tt);let ft=k.node(tt),je=ft.borderTop?ft.borderTop:tt,rt=ft.borderBottom?ft.borderBottom:tt,Me=ft.borderTop?ne:2*ne,Ie=je!==rt?1:j-z[me]+1;k.setEdge(Xe,je,{weight:Me,minlen:Ie,nestingEdge:!0}),k.setEdge(rt,ze,{weight:Me,minlen:Ie,nestingEdge:!0})}),k.parent(me)||k.setEdge($,Xe,{weight:0,minlen:j+z[me]})}function Q(k){var $={};function X(ne,j){var z=k.children(ne);z&&z.length&&z.forEach(me=>X(me,j+1)),$[ne]=j}return k.children().forEach(ne=>X(ne,1)),$}function W(k){return k.edges().reduce(($,X)=>$+k.edge(X).weight,0)}function H(k){var $=k.graph();k.removeNode($.nestingRoot),delete $.nestingRoot,k.edges().forEach(X=>{var ne=k.edge(X);ne.nestingEdge&&k.removeEdge(X)})}},{"./util":27}],10:[function(O,q,ge){"use strict";let oe=O("./util");q.exports={run:se,undo:Q};function se(W){W.graph().dummyChains=[],W.edges().forEach(H=>le(W,H))}function le(W,H){let k=H.v,$=W.node(k).rank,X=H.w,ne=W.node(X).rank,j=H.name,z=W.edge(H),me=z.labelRank;if(ne===$+1)return;W.removeEdge(H);let Re,Xe,ze;for(ze=0,++$;$<ne;++ze,++$)z.points=[],Xe={width:0,height:0,edgeLabel:z,edgeObj:H,rank:$},Re=oe.addDummyNode(W,"edge",Xe,"_d"),$===me&&(Xe.width=z.width,Xe.height=z.height,Xe.dummy="edge-label",Xe.labelpos=z.labelpos),W.setEdge(k,Re,{weight:z.weight},j),ze===0&&W.graph().dummyChains.push(Re),k=Re;W.setEdge(k,X,{weight:z.weight},j)}function Q(W){W.graph().dummyChains.forEach(H=>{let k=W.node(H),$=k.edgeLabel,X;for(W.setEdge(k.edgeObj,$);k.dummy;)X=W.successors(H)[0],W.removeNode(H),$.points.push({x:k.x,y:k.y}),k.dummy==="edge-label"&&($.x=k.x,$.y=k.y,$.width=k.width,$.height=k.height),H=X,k=W.node(H)})}},{"./util":27}],11:[function(O,q,ge){q.exports=oe;function oe(se,le,Q){let W={},H;Q.forEach(k=>{let $=se.parent(k),X,ne;for(;$;){if(X=se.parent($),X?(ne=W[X],W[X]=$):(ne=H,H=$),ne&&ne!==$){le.setEdge(ne,$);return}$=X}})}},{}],12:[function(O,q,ge){q.exports=oe;function oe(se,le=[]){return le.map(Q=>{let W=se.inEdges(Q);if(W.length){let H=W.reduce((k,$)=>{let X=se.edge($),ne=se.node($.v);return{sum:k.sum+X.weight*ne.order,weight:k.weight+X.weight}},{sum:0,weight:0});return{v:Q,barycenter:H.sum/H.weight,weight:H.weight}}else return{v:Q}})}},{}],13:[function(O,q,ge){let oe=O("@dagrejs/graphlib").Graph,se=O("../util");q.exports=le;function le(W,H,k){let $=Q(W),X=new oe({compound:!0}).setGraph({root:$}).setDefaultNodeLabel(ne=>W.node(ne));return W.nodes().forEach(ne=>{let j=W.node(ne),z=W.parent(ne);(j.rank===H||j.minRank<=H&&H<=j.maxRank)&&(X.setNode(ne),X.setParent(ne,z||$),W[k](ne).forEach(me=>{let Re=me.v===ne?me.w:me.v,Xe=X.edge(Re,ne),ze=Xe!==void 0?Xe.weight:0;X.setEdge(Re,ne,{weight:W.edge(me).weight+ze})}),j.hasOwnProperty("minRank")&&X.setNode(ne,{borderLeft:j.borderLeft[H],borderRight:j.borderRight[H]}))}),X}function Q(W){for(var H;W.hasNode(H=se.uniqueId("_root")););return H}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(O,q,ge){"use strict";let oe=O("../util").zipObject;q.exports=se;function se(Q,W){let H=0;for(let k=1;k<W.length;++k)H+=le(Q,W[k-1],W[k]);return H}function le(Q,W,H){let k=oe(H,H.map((me,Re)=>Re)),$=W.flatMap(me=>Q.outEdges(me).map(Re=>({pos:k[Re.w],weight:Q.edge(Re).weight})).sort((Re,Xe)=>Re.pos-Xe.pos)),X=1;for(;X<H.length;)X<<=1;let ne=2*X-1;X-=1;let j=new Array(ne).fill(0),z=0;return $.forEach(me=>{let Re=me.pos+X;j[Re]+=me.weight;let Xe=0;for(;Re>0;)Re%2&&(Xe+=j[Re+1]),Re=Re-1>>1,j[Re]+=me.weight;z+=me.weight*Xe}),z}},{"../util":27}],15:[function(O,q,ge){"use strict";let oe=O("./init-order"),se=O("./cross-count"),le=O("./sort-subgraph"),Q=O("./build-layer-graph"),W=O("./add-subgraph-constraints"),H=O("@dagrejs/graphlib").Graph,k=O("../util");q.exports=$;function $(z,me){if(me&&typeof me.customOrder=="function"){me.customOrder(z,$);return}let Re=k.maxRank(z),Xe=X(z,k.range(1,Re+1),"inEdges"),ze=X(z,k.range(Re-1,-1,-1),"outEdges"),Ge=oe(z);if(j(z,Ge),me&&me.disableOptimalOrderHeuristic)return;let tt=Number.POSITIVE_INFINITY,ft;for(let je=0,rt=0;rt<4;++je,++rt){ne(je%2?Xe:ze,je%4>=2),Ge=k.buildLayerMatrix(z);let Me=se(z,Ge);Me<tt&&(rt=0,ft=Object.assign({},Ge),tt=Me)}j(z,ft)}function X(z,me,Re){return me.map(function(Xe){return Q(z,Xe,Re)})}function ne(z,me){let Re=new H;z.forEach(function(Xe){let ze=Xe.graph().root,Ge=le(Xe,ze,Re,me);Ge.vs.forEach((tt,ft)=>Xe.node(tt).order=ft),W(Xe,Re,Ge.vs)})}function j(z,me){Object.values(me).forEach(Re=>Re.forEach((Xe,ze)=>z.node(Xe).order=ze))}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(O,q,ge){"use strict";let oe=O("../util");q.exports=se;function se(le){let Q={},W=le.nodes().filter(ne=>!le.children(ne).length),H=-1/0;for(let ne=0;ne<W.length;ne++){let j=le.node(W[ne]).rank;j>H&&(H=j)}let k=oe.range(H+1).map(()=>[]);function $(ne){let j=[ne];for(;j.length>0;){let z=j.shift();if(Q[z])continue;Q[z]=!0;let me=le.node(z);k[me.rank].push(z),le.successors(z).forEach(Re=>j.push(Re))}}return W.sort((ne,j)=>le.node(ne).rank-le.node(j).rank).forEach($),k}},{"../util":27}],17:[function(O,q,ge){"use strict";let oe=O("../util");q.exports=se;function se(W,H){let k={};W.forEach((X,ne)=>{let j=k[X.v]={indegree:0,in:[],out:[],vs:[X.v],i:ne};X.barycenter!==void 0&&(j.barycenter=X.barycenter,j.weight=X.weight)}),H.edges().forEach(X=>{let ne=k[X.v],j=k[X.w];ne!==void 0&&j!==void 0&&(j.indegree++,ne.out.push(k[X.w]))});let $=Object.values(k).filter(X=>!X.indegree);return le($)}function le(W){let H=[];function k(X){return ne=>{ne.merged||(ne.barycenter===void 0||X.barycenter===void 0||ne.barycenter>=X.barycenter)&&Q(X,ne)}}function $(X){return ne=>{ne.in.push(X),--ne.indegree===0&&W.push(ne)}}for(;W.length;){let X=W.pop();H.push(X),X.in.reverse().forEach(k(X)),X.out.forEach($(X))}return H.filter(X=>!X.merged).map(X=>oe.pick(X,["vs","i","barycenter","weight"]))}function Q(W,H){let k=0,$=0;W.weight&&(k+=W.barycenter*W.weight,$+=W.weight),H.weight&&(k+=H.barycenter*H.weight,$+=H.weight),W.vs=H.vs.concat(W.vs),W.barycenter=k/$,W.weight=$,W.i=Math.min(H.i,W.i),H.merged=!0}},{"../util":27}],18:[function(O,q,ge){let oe=O("./barycenter"),se=O("./resolve-conflicts"),le=O("./sort");q.exports=Q;function Q(k,$,X,ne){let j=k.children($),z=k.node($),me=z?z.borderLeft:void 0,Re=z?z.borderRight:void 0,Xe={};me&&(j=j.filter(ft=>ft!==me&&ft!==Re));let ze=oe(k,j);ze.forEach(ft=>{if(k.children(ft.v).length){let je=Q(k,ft.v,X,ne);Xe[ft.v]=je,je.hasOwnProperty("barycenter")&&H(ft,je)}});let Ge=se(ze,X);W(Ge,Xe);let tt=le(Ge,ne);if(me&&(tt.vs=[me,tt.vs,Re].flat(!0),k.predecessors(me).length)){let ft=k.node(k.predecessors(me)[0]),je=k.node(k.predecessors(Re)[0]);tt.hasOwnProperty("barycenter")||(tt.barycenter=0,tt.weight=0),tt.barycenter=(tt.barycenter*tt.weight+ft.order+je.order)/(tt.weight+2),tt.weight+=2}return tt}function W(k,$){k.forEach(X=>{X.vs=X.vs.flatMap(ne=>$[ne]?$[ne].vs:ne)})}function H(k,$){k.barycenter!==void 0?(k.barycenter=(k.barycenter*k.weight+$.barycenter*$.weight)/(k.weight+$.weight),k.weight+=$.weight):(k.barycenter=$.barycenter,k.weight=$.weight)}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(O,q,ge){let oe=O("../util");q.exports=se;function se(W,H){let k=oe.partition(W,Xe=>Xe.hasOwnProperty("barycenter")),$=k.lhs,X=k.rhs.sort((Xe,ze)=>ze.i-Xe.i),ne=[],j=0,z=0,me=0;$.sort(Q(!!H)),me=le(ne,X,me),$.forEach(Xe=>{me+=Xe.vs.length,ne.push(Xe.vs),j+=Xe.barycenter*Xe.weight,z+=Xe.weight,me=le(ne,X,me)});let Re={vs:ne.flat(!0)};return z&&(Re.barycenter=j/z,Re.weight=z),Re}function le(W,H,k){let $;for(;H.length&&($=H[H.length-1]).i<=k;)H.pop(),W.push($.vs),k++;return k}function Q(W){return(H,k)=>H.barycenter<k.barycenter?-1:H.barycenter>k.barycenter?1:W?k.i-H.i:H.i-k.i}},{"../util":27}],20:[function(O,q,ge){q.exports=oe;function oe(Q){let W=le(Q);Q.graph().dummyChains.forEach(H=>{let k=Q.node(H),$=k.edgeObj,X=se(Q,W,$.v,$.w),ne=X.path,j=X.lca,z=0,me=ne[z],Re=!0;for(;H!==$.w;){if(k=Q.node(H),Re){for(;(me=ne[z])!==j&&Q.node(me).maxRank<k.rank;)z++;me===j&&(Re=!1)}if(!Re){for(;z<ne.length-1&&Q.node(me=ne[z+1]).minRank<=k.rank;)z++;me=ne[z]}Q.setParent(H,me),H=Q.successors(H)[0]}})}function se(Q,W,H,k){let $=[],X=[],ne=Math.min(W[H].low,W[k].low),j=Math.max(W[H].lim,W[k].lim),z,me;z=H;do z=Q.parent(z),$.push(z);while(z&&(W[z].low>ne||j>W[z].lim));for(me=z,z=k;(z=Q.parent(z))!==me;)X.push(z);return{path:$.concat(X.reverse()),lca:me}}function le(Q){let W={},H=0;function k($){let X=H;Q.children($).forEach(k),W[$]={low:X,lim:H++}}return Q.children().forEach(k),W}},{}],21:[function(O,q,ge){"use strict";let oe=O("@dagrejs/graphlib").Graph,se=O("../util");q.exports={positionX:Re,findType1Conflicts:le,findType2Conflicts:Q,addConflict:H,hasConflict:k,verticalAlignment:$,horizontalCompaction:X,alignCoordinates:z,findSmallestWidthAlignment:j,balance:me};function le(Ge,tt){let ft={};function je(rt,Me){let Ie=0,ke=0,He=rt.length,Qe=Me[Me.length-1];return Me.forEach((gt,bt)=>{let Bt=W(Ge,gt),Ut=Bt?Ge.node(Bt).order:He;(Bt||gt===Qe)&&(Me.slice(ke,bt+1).forEach(Vt=>{Ge.predecessors(Vt).forEach(Cn=>{let $n=Ge.node(Cn),vo=$n.order;(vo<Ie||Ut<vo)&&!($n.dummy&&Ge.node(Vt).dummy)&&H(ft,Cn,Vt)})}),ke=bt+1,Ie=Ut)}),Me}return tt.length&&tt.reduce(je),ft}function Q(Ge,tt){let ft={};function je(Me,Ie,ke,He,Qe){let gt;se.range(Ie,ke).forEach(bt=>{gt=Me[bt],Ge.node(gt).dummy&&Ge.predecessors(gt).forEach(Bt=>{let Ut=Ge.node(Bt);Ut.dummy&&(Ut.order<He||Ut.order>Qe)&&H(ft,Bt,gt)})})}function rt(Me,Ie){let ke=-1,He,Qe=0;return Ie.forEach((gt,bt)=>{if(Ge.node(gt).dummy==="border"){let Bt=Ge.predecessors(gt);Bt.length&&(He=Ge.node(Bt[0]).order,je(Ie,Qe,bt,ke,He),Qe=bt,ke=He)}je(Ie,Qe,Ie.length,He,Me.length)}),Ie}return tt.length&&tt.reduce(rt),ft}function W(Ge,tt){if(Ge.node(tt).dummy)return Ge.predecessors(tt).find(ft=>Ge.node(ft).dummy)}function H(Ge,tt,ft){if(tt>ft){let rt=tt;tt=ft,ft=rt}let je=Ge[tt];je||(Ge[tt]=je={}),je[ft]=!0}function k(Ge,tt,ft){if(tt>ft){let je=tt;tt=ft,ft=je}return!!Ge[tt]&&Ge[tt].hasOwnProperty(ft)}function $(Ge,tt,ft,je){let rt={},Me={},Ie={};return tt.forEach(ke=>{ke.forEach((He,Qe)=>{rt[He]=He,Me[He]=He,Ie[He]=Qe})}),tt.forEach(ke=>{let He=-1;ke.forEach(Qe=>{let gt=je(Qe);if(gt.length){gt=gt.sort((Bt,Ut)=>Ie[Bt]-Ie[Ut]);let bt=(gt.length-1)/2;for(let Bt=Math.floor(bt),Ut=Math.ceil(bt);Bt<=Ut;++Bt){let Vt=gt[Bt];Me[Qe]===Qe&&He<Ie[Vt]&&!k(ft,Qe,Vt)&&(Me[Vt]=Qe,Me[Qe]=rt[Qe]=rt[Vt],He=Ie[Vt])}}})}),{root:rt,align:Me}}function X(Ge,tt,ft,je,rt){let Me={},Ie=ne(Ge,tt,ft,rt),ke=rt?"borderLeft":"borderRight";function He(bt,Bt){let Ut=Ie.nodes(),Vt=Ut.pop(),Cn={};for(;Vt;)Cn[Vt]?bt(Vt):(Cn[Vt]=!0,Ut.push(Vt),Ut=Ut.concat(Bt(Vt))),Vt=Ut.pop()}function Qe(bt){Me[bt]=Ie.inEdges(bt).reduce((Bt,Ut)=>Math.max(Bt,Me[Ut.v]+Ie.edge(Ut)),0)}function gt(bt){let Bt=Ie.outEdges(bt).reduce((Vt,Cn)=>Math.min(Vt,Me[Cn.w]-Ie.edge(Cn)),Number.POSITIVE_INFINITY),Ut=Ge.node(bt);Bt!==Number.POSITIVE_INFINITY&&Ut.borderType!==ke&&(Me[bt]=Math.max(Me[bt],Bt))}return He(Qe,Ie.predecessors.bind(Ie)),He(gt,Ie.successors.bind(Ie)),Object.keys(je).forEach(bt=>Me[bt]=Me[ft[bt]]),Me}function ne(Ge,tt,ft,je){let rt=new oe,Me=Ge.graph(),Ie=Xe(Me.nodesep,Me.edgesep,je);return tt.forEach(ke=>{let He;ke.forEach(Qe=>{let gt=ft[Qe];if(rt.setNode(gt),He){var bt=ft[He],Bt=rt.edge(bt,gt);rt.setEdge(bt,gt,Math.max(Ie(Ge,Qe,He),Bt||0))}He=Qe})}),rt}function j(Ge,tt){return Object.values(tt).reduce((ft,je)=>{let rt=Number.NEGATIVE_INFINITY,Me=Number.POSITIVE_INFINITY;Object.entries(je).forEach(([ke,He])=>{let Qe=ze(Ge,ke)/2;rt=Math.max(He+Qe,rt),Me=Math.min(He-Qe,Me)});let Ie=rt-Me;return Ie<ft[0]&&(ft=[Ie,je]),ft},[Number.POSITIVE_INFINITY,null])[1]}function z(Ge,tt){let ft=Object.values(tt),je=1/0,rt=-1/0;for(let Me of ft)Me<je&&(je=Me),Me>rt&&(rt=Me);["u","d"].forEach(Me=>{["l","r"].forEach(Ie=>{let ke=Me+Ie,He=Ge[ke];if(He===tt)return;let Qe=Object.values(He),gt=1/0,bt=-1/0;for(let Ut of Qe)Ut<gt&&(gt=Ut),Ut>bt&&(bt=Ut);let Bt=je-gt;Ie!=="l"&&(Bt=rt-bt),Bt&&(Ge[ke]=se.mapValues(He,Ut=>Ut+Bt))})})}function me(Ge,tt){return se.mapValues(Ge.ul,(ft,je)=>{if(tt)return Ge[tt.toLowerCase()][je];{let rt=Object.values(Ge).map(Me=>Me[je]).sort((Me,Ie)=>Me-Ie);return(rt[1]+rt[2])/2}})}function Re(Ge){let tt=se.buildLayerMatrix(Ge),ft=Object.assign(le(Ge,tt),Q(Ge,tt)),je={},rt;["u","d"].forEach(Ie=>{rt=Ie==="u"?tt:Object.values(tt).reverse(),["l","r"].forEach(ke=>{ke==="r"&&(rt=rt.map(bt=>Object.values(bt).reverse()));let He=(Ie==="u"?Ge.predecessors:Ge.successors).bind(Ge),Qe=$(Ge,rt,ft,He),gt=X(Ge,rt,Qe.root,Qe.align,ke==="r");ke==="r"&&(gt=se.mapValues(gt,bt=>-bt)),je[Ie+ke]=gt})});let Me=j(Ge,je);return z(je,Me),me(je,Ge.graph().align)}function Xe(Ge,tt,ft){return(je,rt,Me)=>{let Ie=je.node(rt),ke=je.node(Me),He=0,Qe;if(He+=Ie.width/2,Ie.hasOwnProperty("labelpos"))switch(Ie.labelpos.toLowerCase()){case"l":Qe=-Ie.width/2;break;case"r":Qe=Ie.width/2;break}if(Qe&&(He+=ft?Qe:-Qe),Qe=0,He+=(Ie.dummy?tt:Ge)/2,He+=(ke.dummy?tt:Ge)/2,He+=ke.width/2,ke.hasOwnProperty("labelpos"))switch(ke.labelpos.toLowerCase()){case"l":Qe=ke.width/2;break;case"r":Qe=-ke.width/2;break}return Qe&&(He+=ft?Qe:-Qe),Qe=0,He}}function ze(Ge,tt){return Ge.node(tt).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(O,q,ge){"use strict";let oe=O("../util"),se=O("./bk").positionX;q.exports=le;function le(W){W=oe.asNonCompoundGraph(W),Q(W),Object.entries(se(W)).forEach(([H,k])=>W.node(H).x=k)}function Q(W){let H=oe.buildLayerMatrix(W),k=W.graph().ranksep,$=0;H.forEach(X=>{let ne=X.reduce((j,z)=>{let me=W.node(z).height;return j>me?j:me},0);X.forEach(j=>W.node(j).y=$+ne/2),$+=ne+k})}},{"../util":27,"./bk":21}],23:[function(O,q,ge){"use strict";var oe=O("@dagrejs/graphlib").Graph,se=O("./util").slack;q.exports=le;function le(k){var $=new oe({directed:!1}),X=k.nodes()[0],ne=k.nodeCount();$.setNode(X,{});for(var j,z;Q($,k)<ne;)j=W($,k),z=$.hasNode(j.v)?se(k,j):-se(k,j),H($,k,z);return $}function Q(k,$){function X(ne){$.nodeEdges(ne).forEach(j=>{var z=j.v,me=ne===z?j.w:z;!k.hasNode(me)&&!se($,j)&&(k.setNode(me,{}),k.setEdge(ne,me,{}),X(me))})}return k.nodes().forEach(X),k.nodeCount()}function W(k,$){return $.edges().reduce((ne,j)=>{let z=Number.POSITIVE_INFINITY;return k.hasNode(j.v)!==k.hasNode(j.w)&&(z=se($,j)),z<ne[0]?[z,j]:ne},[Number.POSITIVE_INFINITY,null])[1]}function H(k,$,X){k.nodes().forEach(ne=>$.node(ne).rank+=X)}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(O,q,ge){"use strict";var oe=O("./util"),se=oe.longestPath,le=O("./feasible-tree"),Q=O("./network-simplex");q.exports=W;function W(X){switch(X.graph().ranker){case"network-simplex":$(X);break;case"tight-tree":k(X);break;case"longest-path":H(X);break;default:$(X)}}var H=se;function k(X){se(X),le(X)}function $(X){Q(X)}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(O,q,ge){"use strict";var oe=O("./feasible-tree"),se=O("./util").slack,le=O("./util").longestPath,Q=O("@dagrejs/graphlib").alg.preorder,W=O("@dagrejs/graphlib").alg.postorder,H=O("../util").simplify;q.exports=k,k.initLowLimValues=j,k.initCutValues=$,k.calcCutValue=ne,k.leaveEdge=Re,k.enterEdge=Xe,k.exchangeEdges=ze;function k(je){je=H(je),le(je);var rt=oe(je);j(rt),$(rt,je);for(var Me,Ie;Me=Re(rt);)Ie=Xe(rt,je,Me),ze(rt,je,Me,Ie)}function $(je,rt){var Me=W(je,je.nodes());Me=Me.slice(0,Me.length-1),Me.forEach(Ie=>X(je,rt,Ie))}function X(je,rt,Me){var Ie=je.node(Me),ke=Ie.parent;je.edge(Me,ke).cutvalue=ne(je,rt,Me)}function ne(je,rt,Me){var Ie=je.node(Me),ke=Ie.parent,He=!0,Qe=rt.edge(Me,ke),gt=0;return Qe||(He=!1,Qe=rt.edge(ke,Me)),gt=Qe.weight,rt.nodeEdges(Me).forEach(bt=>{var Bt=bt.v===Me,Ut=Bt?bt.w:bt.v;if(Ut!==ke){var Vt=Bt===He,Cn=rt.edge(bt).weight;if(gt+=Vt?Cn:-Cn,tt(je,Me,Ut)){var $n=je.edge(Me,Ut).cutvalue;gt+=Vt?-$n:$n}}}),gt}function j(je,rt){arguments.length<2&&(rt=je.nodes()[0]),me(je,{},1,rt)}function z(je,rt,Me,Ie,ke){var He=Me,Qe=je.node(Ie);return rt[Ie]=!0,je.neighbors(Ie).forEach(gt=>{rt.hasOwnProperty(gt)||(Me=z(je,rt,Me,gt,Ie))}),Qe.low=He,Qe.lim=Me++,ke?Qe.parent=ke:delete Qe.parent,Me}function me(je,rt,Me,Ie,ke=null){let He=[],Qe=[];for(He.push({v:Ie,parent:ke,stage:0});He.length>0;){let{v:bt,parent:Bt,stage:Ut}=He.pop(),Vt=je.node(bt);if(Ut===0){rt[bt]=!0;var gt=Me;Vt.low=gt,Qe.push({node:bt,low:gt}),He.push({v:bt,parent:Bt,stage:1});let Cn=je.neighbors(bt);for(let $n=Cn.length-1;$n>=0;$n--){let vo=Cn[$n];rt.hasOwnProperty(vo)||He.push({v:vo,parent:bt,stage:0})}}else if(Ut===1){let Cn=Me++;Vt.lim=Cn,Bt?Vt.parent=Bt:delete Vt.parent;let $n=Qe.pop();Vt.low=$n.low}}return Me}function Re(je){return je.edges().find(rt=>je.edge(rt).cutvalue<0)}function Xe(je,rt,Me){var Ie=Me.v,ke=Me.w;rt.hasEdge(Ie,ke)||(Ie=Me.w,ke=Me.v);var He=je.node(Ie),Qe=je.node(ke),gt=He,bt=!1;He.lim>Qe.lim&&(gt=Qe,bt=!0);var Bt=rt.edges().filter(Ut=>bt===ft(je,je.node(Ut.v),gt)&&bt!==ft(je,je.node(Ut.w),gt));return Bt.reduce((Ut,Vt)=>se(rt,Vt)<se(rt,Ut)?Vt:Ut)}function ze(je,rt,Me,Ie){var ke=Me.v,He=Me.w;je.removeEdge(ke,He),je.setEdge(Ie.v,Ie.w,{}),j(je),$(je,rt),Ge(je,rt)}function Ge(je,rt){var Me=je.nodes().find(ke=>!rt.node(ke).parent),Ie=Q(je,Me);Ie=Ie.slice(1),Ie.forEach(ke=>{var He=je.node(ke).parent,Qe=rt.edge(ke,He),gt=!1;Qe||(Qe=rt.edge(He,ke),gt=!0),rt.node(ke).rank=rt.node(He).rank+(gt?Qe.minlen:-Qe.minlen)})}function tt(je,rt,Me){return je.hasEdge(rt,Me)}function ft(je,rt,Me){return Me.low<=rt.lim&&rt.lim<=Me.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(O,q,ge){"use strict";q.exports={longestPath:oe,slack:se};function oe(le){var Q={};function W(H){var k=le.node(H);if(Q.hasOwnProperty(H))return k.rank;Q[H]=!0;var $=Math.min(...le.outEdges(H).map(X=>X==null?Number.POSITIVE_INFINITY:W(X.w)-le.edge(X).minlen));return $===Number.POSITIVE_INFINITY&&($=0),k.rank=$}le.sources().forEach(W)}function se(le,Q){return le.node(Q.w).rank-le.node(Q.v).rank-le.edge(Q).minlen}},{}],27:[function(O,q,ge){"use strict";let oe=O("@dagrejs/graphlib").Graph;q.exports={addBorderNode:j,addDummyNode:se,asNonCompoundGraph:Q,buildLayerMatrix:$,intersectRect:k,mapValues:je,maxRank:z,normalizeRanks:X,notime:Xe,partition:me,pick:ft,predecessorWeights:H,range:tt,removeEmptyRanks:ne,simplify:le,successorWeights:W,time:Re,uniqueId:Ge,zipObject:rt};function se(Me,Ie,ke,He){let Qe;do Qe=Ge(He);while(Me.hasNode(Qe));return ke.dummy=Ie,Me.setNode(Qe,ke),Qe}function le(Me){let Ie=new oe().setGraph(Me.graph());return Me.nodes().forEach(ke=>Ie.setNode(ke,Me.node(ke))),Me.edges().forEach(ke=>{let He=Ie.edge(ke.v,ke.w)||{weight:0,minlen:1},Qe=Me.edge(ke);Ie.setEdge(ke.v,ke.w,{weight:He.weight+Qe.weight,minlen:Math.max(He.minlen,Qe.minlen)})}),Ie}function Q(Me){let Ie=new oe({multigraph:Me.isMultigraph()}).setGraph(Me.graph());return Me.nodes().forEach(ke=>{Me.children(ke).length||Ie.setNode(ke,Me.node(ke))}),Me.edges().forEach(ke=>{Ie.setEdge(ke,Me.edge(ke))}),Ie}function W(Me){let Ie=Me.nodes().map(ke=>{let He={};return Me.outEdges(ke).forEach(Qe=>{He[Qe.w]=(He[Qe.w]||0)+Me.edge(Qe).weight}),He});return rt(Me.nodes(),Ie)}function H(Me){let Ie=Me.nodes().map(ke=>{let He={};return Me.inEdges(ke).forEach(Qe=>{He[Qe.v]=(He[Qe.v]||0)+Me.edge(Qe).weight}),He});return rt(Me.nodes(),Ie)}function k(Me,Ie){let ke=Me.x,He=Me.y,Qe=Ie.x-ke,gt=Ie.y-He,bt=Me.width/2,Bt=Me.height/2;if(!Qe&&!gt)throw new Error("Not possible to find intersection inside of the rectangle");let Ut,Vt;return Math.abs(gt)*bt>Math.abs(Qe)*Bt?(gt<0&&(Bt=-Bt),Ut=Bt*Qe/gt,Vt=Bt):(Qe<0&&(bt=-bt),Ut=bt,Vt=bt*gt/Qe),{x:ke+Ut,y:He+Vt}}function $(Me){let Ie=tt(z(Me)+1).map(()=>[]);return Me.nodes().forEach(ke=>{let He=Me.node(ke),Qe=He.rank;Qe!==void 0&&(Ie[Qe][He.order]=ke)}),Ie}function X(Me){let Ie=Math.min(...Me.nodes().map(ke=>{let He=Me.node(ke).rank;return He===void 0?Number.MAX_VALUE:He}));Me.nodes().forEach(ke=>{let He=Me.node(ke);He.hasOwnProperty("rank")&&(He.rank-=Ie)})}function ne(Me){let Ie=Math.min(...Me.nodes().map(gt=>Me.node(gt).rank)),ke=[];Me.nodes().forEach(gt=>{let bt=Me.node(gt).rank-Ie;ke[bt]||(ke[bt]=[]),ke[bt].push(gt)});let He=0,Qe=Me.graph().nodeRankFactor;Array.from(ke).forEach((gt,bt)=>{gt===void 0&&bt%Qe!==0?--He:gt!==void 0&&He&&gt.forEach(Bt=>Me.node(Bt).rank+=He)})}function j(Me,Ie,ke,He){let Qe={width:0,height:0};return arguments.length>=4&&(Qe.rank=ke,Qe.order=He),se(Me,"border",Qe,Ie)}function z(Me){let Ie=Number.MIN_VALUE;for(let ke of Me.nodes()){let He=Me.node(ke).rank;He!==void 0&&He>Ie&&(Ie=He)}return Ie}function me(Me,Ie){let ke={lhs:[],rhs:[]};return Me.forEach(He=>{Ie(He)?ke.lhs.push(He):ke.rhs.push(He)}),ke}function Re(Me,Ie){let ke=Date.now();try{return Ie()}finally{console.log(Me+" time: "+(Date.now()-ke)+"ms")}}function Xe(Me,Ie){return Ie()}let ze=0;function Ge(Me){var Ie=++ze;return toString(Me)+Ie}function tt(Me,Ie,ke=1){Ie==null&&(Ie=Me,Me=0);let He=gt=>gt<Ie;ke<0&&(He=gt=>Ie<gt);let Qe=[];for(let gt=Me;He(gt);gt+=ke)Qe.push(gt);return Qe}function ft(Me,Ie){let ke={};for(let He of Ie)Me[He]!==void 0&&(ke[He]=Me[He]);return ke}function je(Me,Ie){let ke=Ie;return typeof Ie=="string"&&(ke=He=>He[Ie]),Object.entries(Me).reduce((He,[Qe,gt])=>(He[Qe]=ke(gt,Qe),He),{})}function rt(Me,Ie){return Me.reduce((ke,He,Qe)=>(ke[He]=Ie[Qe],ke),{})}},{"@dagrejs/graphlib":29}],28:[function(O,q,ge){q.exports="1.1.1"},{}],29:[function(O,q,ge){var oe=O("./lib");q.exports={Graph:oe.Graph,json:O("./lib/json"),alg:O("./lib/alg"),version:oe.version}},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(O,q,ge){q.exports=oe;function oe(se){var le={},Q=[],W;function H(k){le.hasOwnProperty(k)||(le[k]=!0,W.push(k),se.successors(k).forEach(H),se.predecessors(k).forEach(H))}return se.nodes().forEach(function(k){W=[],H(k),W.length&&Q.push(W)}),Q}},{}],31:[function(O,q,ge){q.exports=oe;function oe(W,H,k){Array.isArray(H)||(H=[H]);var $=W.isDirected()?z=>W.successors(z):z=>W.neighbors(z),X=k==="post"?se:le,ne=[],j={};return H.forEach(z=>{if(!W.hasNode(z))throw new Error("Graph does not have node: "+z);X(z,$,j,ne)}),ne}function se(W,H,k,$){for(var X=[[W,!1]];X.length>0;){var ne=X.pop();ne[1]?$.push(ne[0]):k.hasOwnProperty(ne[0])||(k[ne[0]]=!0,X.push([ne[0],!0]),Q(H(ne[0]),j=>X.push([j,!1])))}}function le(W,H,k,$){for(var X=[W];X.length>0;){var ne=X.pop();k.hasOwnProperty(ne)||(k[ne]=!0,$.push(ne),Q(H(ne),j=>X.push(j)))}}function Q(W,H){for(var k=W.length;k--;)H(W[k],k,W);return W}},{}],32:[function(O,q,ge){var oe=O("./dijkstra");q.exports=se;function se(le,Q,W){return le.nodes().reduce(function(H,k){return H[k]=oe(le,k,Q,W),H},{})}},{"./dijkstra":33}],33:[function(O,q,ge){var oe=O("../data/priority-queue");q.exports=le;var se=()=>1;function le(W,H,k,$){return Q(W,String(H),k||se,$||function(X){return W.outEdges(X)})}function Q(W,H,k,$){var X={},ne=new oe,j,z,me=function(Re){var Xe=Re.v!==j?Re.v:Re.w,ze=X[Xe],Ge=k(Re),tt=z.distance+Ge;if(Ge<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+Re+" Weight: "+Ge);tt<ze.distance&&(ze.distance=tt,ze.predecessor=j,ne.decrease(Xe,tt))};for(W.nodes().forEach(function(Re){var Xe=Re===H?0:Number.POSITIVE_INFINITY;X[Re]={distance:Xe},ne.add(Re,Xe)});ne.size()>0&&(j=ne.removeMin(),z=X[j],z.distance!==Number.POSITIVE_INFINITY);)$(j).forEach(me);return X}},{"../data/priority-queue":43}],34:[function(O,q,ge){var oe=O("./tarjan");q.exports=se;function se(le){return oe(le).filter(function(Q){return Q.length>1||Q.length===1&&le.hasEdge(Q[0],Q[0])})}},{"./tarjan":41}],35:[function(O,q,ge){q.exports=se;var oe=()=>1;function se(Q,W,H){return le(Q,W||oe,H||function(k){return Q.outEdges(k)})}function le(Q,W,H){var k={},$=Q.nodes();return $.forEach(function(X){k[X]={},k[X][X]={distance:0},$.forEach(function(ne){X!==ne&&(k[X][ne]={distance:Number.POSITIVE_INFINITY})}),H(X).forEach(function(ne){var j=ne.v===X?ne.w:ne.v,z=W(ne);k[X][j]={distance:z,predecessor:X}})}),$.forEach(function(X){var ne=k[X];$.forEach(function(j){var z=k[j];$.forEach(function(me){var Re=z[X],Xe=ne[me],ze=z[me],Ge=Re.distance+Xe.distance;Ge<ze.distance&&(ze.distance=Ge,ze.predecessor=Xe.predecessor)})})}),k}},{}],36:[function(O,q,ge){q.exports={components:O("./components"),dijkstra:O("./dijkstra"),dijkstraAll:O("./dijkstra-all"),findCycles:O("./find-cycles"),floydWarshall:O("./floyd-warshall"),isAcyclic:O("./is-acyclic"),postorder:O("./postorder"),preorder:O("./preorder"),prim:O("./prim"),tarjan:O("./tarjan"),topsort:O("./topsort")}},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(O,q,ge){var oe=O("./topsort");q.exports=se;function se(le){try{oe(le)}catch(Q){if(Q instanceof oe.CycleException)return!1;throw Q}return!0}},{"./topsort":42}],38:[function(O,q,ge){var oe=O("./dfs");q.exports=se;function se(le,Q){return oe(le,Q,"post")}},{"./dfs":31}],39:[function(O,q,ge){var oe=O("./dfs");q.exports=se;function se(le,Q){return oe(le,Q,"pre")}},{"./dfs":31}],40:[function(O,q,ge){var oe=O("../graph"),se=O("../data/priority-queue");q.exports=le;function le(Q,W){var H=new oe,k={},$=new se,X;function ne(z){var me=z.v===X?z.w:z.v,Re=$.priority(me);if(Re!==void 0){var Xe=W(z);Xe<Re&&(k[me]=X,$.decrease(me,Xe))}}if(Q.nodeCount()===0)return H;Q.nodes().forEach(function(z){$.add(z,Number.POSITIVE_INFINITY),H.setNode(z)}),$.decrease(Q.nodes()[0],0);for(var j=!1;$.size()>0;){if(X=$.removeMin(),k.hasOwnProperty(X))H.setEdge(X,k[X]);else{if(j)throw new Error("Input graph is not connected: "+Q);j=!0}Q.nodeEdges(X).forEach(ne)}return H}},{"../data/priority-queue":43,"../graph":44}],41:[function(O,q,ge){q.exports=oe;function oe(se){var le=0,Q=[],W={},H=[];function k($){var X=W[$]={onStack:!0,lowlink:le,index:le++};if(Q.push($),se.successors($).forEach(function(z){W.hasOwnProperty(z)?W[z].onStack&&(X.lowlink=Math.min(X.lowlink,W[z].index)):(k(z),X.lowlink=Math.min(X.lowlink,W[z].lowlink))}),X.lowlink===X.index){var ne=[],j;do j=Q.pop(),W[j].onStack=!1,ne.push(j);while($!==j);H.push(ne)}}return se.nodes().forEach(function($){W.hasOwnProperty($)||k($)}),H}},{}],42:[function(O,q,ge){function oe(le){var Q={},W={},H=[];function k($){if(W.hasOwnProperty($))throw new se;Q.hasOwnProperty($)||(W[$]=!0,Q[$]=!0,le.predecessors($).forEach(k),delete W[$],H.push($))}if(le.sinks().forEach(k),Object.keys(Q).length!==le.nodeCount())throw new se;return H}class se extends Error{constructor(){super(...arguments)}}q.exports=oe,oe.CycleException=se},{}],43:[function(O,q,ge){class oe{#e=[];#n={};size(){return this.#e.length}keys(){return this.#e.map(function(le){return le.key})}has(le){return this.#n.hasOwnProperty(le)}priority(le){var Q=this.#n[le];if(Q!==void 0)return this.#e[Q].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this.#e[0].key}add(le,Q){var W=this.#n;if(le=String(le),!W.hasOwnProperty(le)){var H=this.#e,k=H.length;return W[le]=k,H.push({key:le,priority:Q}),this.#h(k),!0}return!1}removeMin(){this.#o(0,this.#e.length-1);var le=this.#e.pop();return delete this.#n[le.key],this.#t(0),le.key}decrease(le,Q){var W=this.#n[le];if(Q>this.#e[W].priority)throw new Error("New priority is greater than current priority. Key: "+le+" Old: "+this.#e[W].priority+" New: "+Q);this.#e[W].priority=Q,this.#h(W)}#t(le){var Q=this.#e,W=2*le,H=W+1,k=le;W<Q.length&&(k=Q[W].priority<Q[k].priority?W:k,H<Q.length&&(k=Q[H].priority<Q[k].priority?H:k),k!==le&&(this.#o(le,k),this.#t(k)))}#h(le){for(var Q=this.#e,W=Q[le].priority,H;le!==0&&(H=le>>1,!(Q[H].priority<W));)this.#o(le,H),le=H}#o(le,Q){var W=this.#e,H=this.#n,k=W[le],$=W[Q];W[le]=$,W[Q]=k,H[$.key]=le,H[k.key]=Q}}q.exports=oe},{}],44:[function(O,q,ge){"use strict";var oe="\0",se="\0",le="";class Q{#e=!0;#n=!1;#t=!1;#h;#o=()=>{};#p=()=>{};#r={};#s={};#d={};#a={};#f={};#l={};#c={};#m=0;#g=0;#u;#i;constructor(j){j&&(this.#e=j.hasOwnProperty("directed")?j.directed:!0,this.#n=j.hasOwnProperty("multigraph")?j.multigraph:!1,this.#t=j.hasOwnProperty("compound")?j.compound:!1),this.#t&&(this.#u={},this.#i={},this.#i[se]={})}isDirected(){return this.#e}isMultigraph(){return this.#n}isCompound(){return this.#t}setGraph(j){return this.#h=j,this}graph(){return this.#h}setDefaultNodeLabel(j){return this.#o=j,typeof j!="function"&&(this.#o=()=>j),this}nodeCount(){return this.#m}nodes(){return Object.keys(this.#r)}sources(){var j=this;return this.nodes().filter(z=>Object.keys(j.#s[z]).length===0)}sinks(){var j=this;return this.nodes().filter(z=>Object.keys(j.#a[z]).length===0)}setNodes(j,z){var me=arguments,Re=this;return j.forEach(function(Xe){me.length>1?Re.setNode(Xe,z):Re.setNode(Xe)}),this}setNode(j,z){return this.#r.hasOwnProperty(j)?(arguments.length>1&&(this.#r[j]=z),this):(this.#r[j]=arguments.length>1?z:this.#o(j),this.#t&&(this.#u[j]=se,this.#i[j]={},this.#i[se][j]=!0),this.#s[j]={},this.#d[j]={},this.#a[j]={},this.#f[j]={},++this.#m,this)}node(j){return this.#r[j]}hasNode(j){return this.#r.hasOwnProperty(j)}removeNode(j){var z=this;if(this.#r.hasOwnProperty(j)){var me=Re=>z.removeEdge(z.#l[Re]);delete this.#r[j],this.#t&&(this.#v(j),delete this.#u[j],this.children(j).forEach(function(Re){z.setParent(Re)}),delete this.#i[j]),Object.keys(this.#s[j]).forEach(me),delete this.#s[j],delete this.#d[j],Object.keys(this.#a[j]).forEach(me),delete this.#a[j],delete this.#f[j],--this.#m}return this}setParent(j,z){if(!this.#t)throw new Error("Cannot set parent in a non-compound graph");if(z===void 0)z=se;else{z+="";for(var me=z;me!==void 0;me=this.parent(me))if(me===j)throw new Error("Setting "+z+" as parent of "+j+" would create a cycle");this.setNode(z)}return this.setNode(j),this.#v(j),this.#u[j]=z,this.#i[z][j]=!0,this}#v(j){delete this.#i[this.#u[j]][j]}parent(j){if(this.#t){var z=this.#u[j];if(z!==se)return z}}children(j=se){if(this.#t){var z=this.#i[j];if(z)return Object.keys(z)}else{if(j===se)return this.nodes();if(this.hasNode(j))return[]}}predecessors(j){var z=this.#d[j];if(z)return Object.keys(z)}successors(j){var z=this.#f[j];if(z)return Object.keys(z)}neighbors(j){var z=this.predecessors(j);if(z){let Re=new Set(z);for(var me of this.successors(j))Re.add(me);return Array.from(Re.values())}}isLeaf(j){var z;return this.isDirected()?z=this.successors(j):z=this.neighbors(j),z.length===0}filterNodes(j){var z=new this.constructor({directed:this.#e,multigraph:this.#n,compound:this.#t});z.setGraph(this.graph());var me=this;Object.entries(this.#r).forEach(function([ze,Ge]){j(ze)&&z.setNode(ze,Ge)}),Object.values(this.#l).forEach(function(ze){z.hasNode(ze.v)&&z.hasNode(ze.w)&&z.setEdge(ze,me.edge(ze))});var Re={};function Xe(ze){var Ge=me.parent(ze);return Ge===void 0||z.hasNode(Ge)?(Re[ze]=Ge,Ge):Ge in Re?Re[Ge]:Xe(Ge)}return this.#t&&z.nodes().forEach(ze=>z.setParent(ze,Xe(ze))),z}setDefaultEdgeLabel(j){return this.#p=j,typeof j!="function"&&(this.#p=()=>j),this}edgeCount(){return this.#g}edges(){return Object.values(this.#l)}setPath(j,z){var me=this,Re=arguments;return j.reduce(function(Xe,ze){return Re.length>1?me.setEdge(Xe,ze,z):me.setEdge(Xe,ze),ze}),this}setEdge(){var j,z,me,Re,Xe=!1,ze=arguments[0];typeof ze=="object"&&ze!==null&&"v"in ze?(j=ze.v,z=ze.w,me=ze.name,arguments.length===2&&(Re=arguments[1],Xe=!0)):(j=ze,z=arguments[1],me=arguments[3],arguments.length>2&&(Re=arguments[2],Xe=!0)),j=""+j,z=""+z,me!==void 0&&(me=""+me);var Ge=k(this.#e,j,z,me);if(this.#c.hasOwnProperty(Ge))return Xe&&(this.#c[Ge]=Re),this;if(me!==void 0&&!this.#n)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(j),this.setNode(z),this.#c[Ge]=Xe?Re:this.#p(j,z,me);var tt=$(this.#e,j,z,me);return j=tt.v,z=tt.w,Object.freeze(tt),this.#l[Ge]=tt,W(this.#d[z],j),W(this.#f[j],z),this.#s[z][Ge]=tt,this.#a[j][Ge]=tt,this.#g++,this}edge(j,z,me){var Re=arguments.length===1?X(this.#e,arguments[0]):k(this.#e,j,z,me);return this.#c[Re]}edgeAsObj(){let j=this.edge(...arguments);return typeof j!="object"?{label:j}:j}hasEdge(j,z,me){var Re=arguments.length===1?X(this.#e,arguments[0]):k(this.#e,j,z,me);return this.#c.hasOwnProperty(Re)}removeEdge(j,z,me){var Re=arguments.length===1?X(this.#e,arguments[0]):k(this.#e,j,z,me),Xe=this.#l[Re];return Xe&&(j=Xe.v,z=Xe.w,delete this.#c[Re],delete this.#l[Re],H(this.#d[z],j),H(this.#f[j],z),delete this.#s[z][Re],delete this.#a[j][Re],this.#g--),this}inEdges(j,z){var me=this.#s[j];if(me){var Re=Object.values(me);return z?Re.filter(Xe=>Xe.v===z):Re}}outEdges(j,z){var me=this.#a[j];if(me){var Re=Object.values(me);return z?Re.filter(Xe=>Xe.w===z):Re}}nodeEdges(j,z){var me=this.inEdges(j,z);if(me)return me.concat(this.outEdges(j,z))}}function W(ne,j){ne[j]?ne[j]++:ne[j]=1}function H(ne,j){--ne[j]||delete ne[j]}function k(ne,j,z,me){var Re=""+j,Xe=""+z;if(!ne&&Re>Xe){var ze=Re;Re=Xe,Xe=ze}return Re+le+Xe+le+(me===void 0?oe:me)}function $(ne,j,z,me){var Re=""+j,Xe=""+z;if(!ne&&Re>Xe){var ze=Re;Re=Xe,Xe=ze}var Ge={v:Re,w:Xe};return me&&(Ge.name=me),Ge}function X(ne,j){return k(ne,j.v,j.w,j.name)}q.exports=Q},{}],45:[function(O,q,ge){q.exports={Graph:O("./graph"),version:O("./version")}},{"./graph":44,"./version":47}],46:[function(O,q,ge){var oe=O("./graph");q.exports={write:se,read:W};function se(H){var k={options:{directed:H.isDirected(),multigraph:H.isMultigraph(),compound:H.isCompound()},nodes:le(H),edges:Q(H)};return H.graph()!==void 0&&(k.value=structuredClone(H.graph())),k}function le(H){return H.nodes().map(function(k){var $=H.node(k),X=H.parent(k),ne={v:k};return $!==void 0&&(ne.value=$),X!==void 0&&(ne.parent=X),ne})}function Q(H){return H.edges().map(function(k){var $=H.edge(k),X={v:k.v,w:k.w};return k.name!==void 0&&(X.name=k.name),$!==void 0&&(X.value=$),X})}function W(H){var k=new oe(H.options).setGraph(H.value);return H.nodes.forEach(function($){k.setNode($.v,$.value),$.parent&&k.setParent($.v,$.parent)}),H.edges.forEach(function($){k.setEdge({v:$.v,w:$.w,name:$.name},$.value)}),k}},{"./graph":44}],47:[function(O,q,ge){q.exports="2.2.1"},{}]},{},[1])(1)});(function(S,G){typeof gf=="object"&&typeof Jm<"u"?G(gf):typeof define=="function"&&define.amd?define(["exports"],G):G((S=typeof globalThis<"u"?globalThis:S||self).THREE={})})(gf,function(S){"use strict";let G="134",zr="300 es";class Qr{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let o=i.indexOf(n);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let n=this._listeners[e.type];if(n!==void 0){e.target=this;let i=n.slice(0);for(let o=0,l=i.length;o<l;o++)i[o].call(this,e);e.target=null}}}let uc=1234567,qo=Math.PI/180,Xo=180/Math.PI,Wn=[];for(let c=0;c<256;c++)Wn[c]=(c<16?"0":"")+c.toString(16);let xf=typeof crypto<"u"&&"randomUUID"in crypto;function mr(){if(xf)return crypto.randomUUID().toUpperCase();let c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Wn[255&c]+Wn[c>>8&255]+Wn[c>>16&255]+Wn[c>>24&255]+"-"+Wn[255&e]+Wn[e>>8&255]+"-"+Wn[e>>16&15|64]+Wn[e>>24&255]+"-"+Wn[63&n|128]+Wn[n>>8&255]+"-"+Wn[n>>16&255]+Wn[n>>24&255]+Wn[255&i]+Wn[i>>8&255]+Wn[i>>16&255]+Wn[i>>24&255]).toUpperCase()}function Qn(c,e,n){return Math.max(e,Math.min(n,c))}function qu(c,e){return(c%e+e)%e}function ll(c,e,n){return(1-n)*c+n*e}function Xu(c){return(c&c-1)==0&&c!==0}function _f(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function bf(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}var Mf=Object.freeze({__proto__:null,DEG2RAD:qo,RAD2DEG:Xo,generateUUID:mr,clamp:Qn,euclideanModulo:qu,mapLinear:function(c,e,n,i,o){return i+(c-e)*(o-i)/(n-e)},inverseLerp:function(c,e,n){return c!==e?(n-c)/(e-c):0},lerp:ll,damp:function(c,e,n,i){return ll(c,e,1-Math.exp(-n*i))},pingpong:function(c,e=1){return e-Math.abs(qu(c,2*e)-e)},smoothstep:function(c,e,n){return c<=e?0:c>=n?1:(c=(c-e)/(n-e))*c*(3-2*c)},smootherstep:function(c,e,n){return c<=e?0:c>=n?1:(c=(c-e)/(n-e))*c*c*(c*(6*c-15)+10)},randInt:function(c,e){return c+Math.floor(Math.random()*(e-c+1))},randFloat:function(c,e){return c+Math.random()*(e-c)},randFloatSpread:function(c){return c*(.5-Math.random())},seededRandom:function(c){return c!==void 0&&(uc=c%2147483647),uc=16807*uc%2147483647,(uc-1)/2147483646},degToRad:function(c){return c*qo},radToDeg:function(c){return c*Xo},isPowerOfTwo:Xu,ceilPowerOfTwo:_f,floorPowerOfTwo:bf,setQuaternionFromProperEuler:function(c,e,n,i,o){let l=Math.cos,h=Math.sin,f=l(n/2),p=h(n/2),g=l((e+i)/2),x=h((e+i)/2),_=l((e-i)/2),M=h((e-i)/2),T=l((i-e)/2),N=h((i-e)/2);switch(o){case"XYX":c.set(f*x,p*_,p*M,f*g);break;case"YZY":c.set(p*M,f*x,p*_,f*g);break;case"ZXZ":c.set(p*_,p*M,f*x,f*g);break;case"XZX":c.set(f*x,p*N,p*T,f*g);break;case"YXY":c.set(p*T,f*x,p*N,f*g);break;case"ZYZ":c.set(p*N,p*T,f*x,f*g);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}});class Ke{constructor(e=0,n=0){this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,n){return n!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e,n){return n!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let n=this.x,i=this.y,o=e.elements;return this.x=o[0]*n+o[3]*i+o[6],this.y=o[1]*n+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){let i=Math.cos(n),o=Math.sin(n),l=this.x-e.x,h=this.y-e.y;return this.x=l*i-h*o+e.x,this.y=l*o+h*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Ke.prototype.isVector2=!0;class In{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,n,i,o,l,h,f,p,g){let x=this.elements;return x[0]=e,x[1]=o,x[2]=f,x[3]=n,x[4]=l,x[5]=p,x[6]=i,x[7]=h,x[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){let i=e.elements,o=n.elements,l=this.elements,h=i[0],f=i[3],p=i[6],g=i[1],x=i[4],_=i[7],M=i[2],T=i[5],N=i[8],I=o[0],D=o[3],L=o[6],F=o[1],U=o[4],V=o[7],K=o[2],re=o[5],ve=o[8];return l[0]=h*I+f*F+p*K,l[3]=h*D+f*U+p*re,l[6]=h*L+f*V+p*ve,l[1]=g*I+x*F+_*K,l[4]=g*D+x*U+_*re,l[7]=g*L+x*V+_*ve,l[2]=M*I+T*F+N*K,l[5]=M*D+T*U+N*re,l[8]=M*L+T*V+N*ve,this}multiplyScalar(e){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){let e=this.elements,n=e[0],i=e[1],o=e[2],l=e[3],h=e[4],f=e[5],p=e[6],g=e[7],x=e[8];return n*h*x-n*f*g-i*l*x+i*f*p+o*l*g-o*h*p}invert(){let e=this.elements,n=e[0],i=e[1],o=e[2],l=e[3],h=e[4],f=e[5],p=e[6],g=e[7],x=e[8],_=x*h-f*g,M=f*p-x*l,T=g*l-h*p,N=n*_+i*M+o*T;if(N===0)return this.set(0,0,0,0,0,0,0,0,0);let I=1/N;return e[0]=_*I,e[1]=(o*g-x*i)*I,e[2]=(f*i-o*h)*I,e[3]=M*I,e[4]=(x*n-o*p)*I,e[5]=(o*l-f*n)*I,e[6]=T*I,e[7]=(i*p-g*n)*I,e[8]=(h*n-i*l)*I,this}transpose(){let e,n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,o,l,h,f){let p=Math.cos(l),g=Math.sin(l);return this.set(i*p,i*g,-i*(p*h+g*f)+h+e,-o*g,o*p,-o*(-g*h+p*f)+f+n,0,0,1),this}scale(e,n){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=n,i[4]*=n,i[7]*=n,this}rotate(e){let n=Math.cos(e),i=Math.sin(e),o=this.elements,l=o[0],h=o[3],f=o[6],p=o[1],g=o[4],x=o[7];return o[0]=n*l+i*p,o[3]=n*h+i*g,o[6]=n*f+i*x,o[1]=-i*l+n*p,o[4]=-i*h+n*g,o[7]=-i*f+n*x,this}translate(e,n){let i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=n*i[2],i[4]+=n*i[5],i[7]+=n*i[8],this}equals(e){let n=this.elements,i=e.elements;for(let o=0;o<9;o++)if(n[o]!==i[o])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){let i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function wf(c){if(c.length===0)return-1/0;let e=c[0];for(let n=1,i=c.length;n<i;++n)c[n]>e&&(e=c[n]);return e}In.prototype.isMatrix3=!0;let Zm={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Vs(c,e){return new Zm[c](e)}function hc(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}function Ef(c,e=0){let n=3735928559^e,i=1103547991^e;for(let o,l=0;l<c.length;l++)o=c.charCodeAt(l),n=Math.imul(n^o,2654435761),i=Math.imul(i^o,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}let Ws;class Jo{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Ws===void 0&&(Ws=hc("canvas")),Ws.width=e.width,Ws.height=e.height;let i=Ws.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=Ws}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}}let Sf=0;class Dn extends Qr{constructor(e=Dn.DEFAULT_IMAGE,n=Dn.DEFAULT_MAPPING,i=1001,o=1001,l=1006,h=1008,f=1023,p=1009,g=1,x=3e3){super(),Object.defineProperty(this,"id",{value:Sf++}),this.uuid=mr(),this.name="",this.image=e,this.mipmaps=[],this.mapping=n,this.wrapS=i,this.wrapT=o,this.magFilter=l,this.minFilter=h,this.anisotropy=g,this.format=f,this.internalFormat=null,this.type=p,this.offset=new Ke(0,0),this.repeat=new Ke(1,1),this.center=new Ke(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new In,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){let n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let o=this.image;if(o.uuid===void 0&&(o.uuid=mr()),!n&&e.images[o.uuid]===void 0){let l;if(Array.isArray(o)){l=[];for(let h=0,f=o.length;h<f;h++)o[h].isDataTexture?l.push(Ju(o[h].image)):l.push(Ju(o[h]))}else l=Ju(o);e.images[o.uuid]={uuid:o.uuid,url:l}}i.image=o.uuid}return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}function Ju(c){return typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap?Jo.getDataURL(c):c.data?{data:Array.prototype.slice.call(c.data),width:c.width,height:c.height,type:c.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Dn.DEFAULT_IMAGE=void 0,Dn.DEFAULT_MAPPING=300,Dn.prototype.isTexture=!0;class on{constructor(e=0,n=0,i=0,o=1){this.x=e,this.y=n,this.z=i,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,o){return this.x=e,this.y=n,this.z=i,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,n){return n!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e,n){return n!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let n=this.x,i=this.y,o=this.z,l=this.w,h=e.elements;return this.x=h[0]*n+h[4]*i+h[8]*o+h[12]*l,this.y=h[1]*n+h[5]*i+h[9]*o+h[13]*l,this.z=h[2]*n+h[6]*i+h[10]*o+h[14]*l,this.w=h[3]*n+h[7]*i+h[11]*o+h[15]*l,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,o,l,p=e.elements,g=p[0],x=p[4],_=p[8],M=p[1],T=p[5],N=p[9],I=p[2],D=p[6],L=p[10];if(Math.abs(x-M)<.01&&Math.abs(_-I)<.01&&Math.abs(N-D)<.01){if(Math.abs(x+M)<.1&&Math.abs(_+I)<.1&&Math.abs(N+D)<.1&&Math.abs(g+T+L-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;let U=(g+1)/2,V=(T+1)/2,K=(L+1)/2,re=(x+M)/4,ve=(_+I)/4,_e=(N+D)/4;return U>V&&U>K?U<.01?(i=0,o=.707106781,l=.707106781):(i=Math.sqrt(U),o=re/i,l=ve/i):V>K?V<.01?(i=.707106781,o=0,l=.707106781):(o=Math.sqrt(V),i=re/o,l=_e/o):K<.01?(i=.707106781,o=.707106781,l=0):(l=Math.sqrt(K),i=ve/l,o=_e/l),this.set(i,o,l,n),this}let F=Math.sqrt((D-N)*(D-N)+(_-I)*(_-I)+(M-x)*(M-x));return Math.abs(F)<.001&&(F=1),this.x=(D-N)/F,this.y=(_-I)/F,this.z=(M-x)/F,this.w=Math.acos((g+T+L-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}on.prototype.isVector4=!0;class lr extends Qr{constructor(e,n,i={}){super(),this.width=e,this.height=n,this.depth=1,this.scissor=new on(0,0,e,n),this.scissorTest=!1,this.viewport=new on(0,0,e,n),this.texture=new Dn(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:n,depth:1},this.texture.generateMipmaps=i.generateMipmaps!==void 0&&i.generateMipmaps,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:1006,this.depthBuffer=i.depthBuffer===void 0||i.depthBuffer,this.stencilBuffer=i.stencilBuffer!==void 0&&i.stencilBuffer,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,n,i=1){this.width===e&&this.height===n&&this.depth===i||(this.width=e,this.height=n,this.depth=i,this.texture.image.width=e,this.texture.image.height=n,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}lr.prototype.isWebGLRenderTarget=!0;class Zu extends lr{constructor(e,n,i){super(e,n);let o=this.texture;this.texture=[];for(let l=0;l<i;l++)this.texture[l]=o.clone()}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let o=0,l=this.texture.length;o<l;o++)this.texture[o].image.width=e,this.texture[o].image.height=n,this.texture[o].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let n=0,i=e.texture.length;n<i;n++)this.texture[n]=e.texture[n].clone();return this}}Zu.prototype.isWebGLMultipleRenderTargets=!0;class $u extends lr{constructor(e,n,i){super(e,n,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}$u.prototype.isWebGLMultisampleRenderTarget=!0;class Kn{constructor(e=0,n=0,i=0,o=1){this._x=e,this._y=n,this._z=i,this._w=o}static slerp(e,n,i,o){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,n,o)}static slerpFlat(e,n,i,o,l,h,f){let p=i[o+0],g=i[o+1],x=i[o+2],_=i[o+3],M=l[h+0],T=l[h+1],N=l[h+2],I=l[h+3];if(f===0)return e[n+0]=p,e[n+1]=g,e[n+2]=x,void(e[n+3]=_);if(f===1)return e[n+0]=M,e[n+1]=T,e[n+2]=N,void(e[n+3]=I);if(_!==I||p!==M||g!==T||x!==N){let D=1-f,L=p*M+g*T+x*N+_*I,F=L>=0?1:-1,U=1-L*L;if(U>Number.EPSILON){let K=Math.sqrt(U),re=Math.atan2(K,L*F);D=Math.sin(D*re)/K,f=Math.sin(f*re)/K}let V=f*F;if(p=p*D+M*V,g=g*D+T*V,x=x*D+N*V,_=_*D+I*V,D===1-f){let K=1/Math.sqrt(p*p+g*g+x*x+_*_);p*=K,g*=K,x*=K,_*=K}}e[n]=p,e[n+1]=g,e[n+2]=x,e[n+3]=_}static multiplyQuaternionsFlat(e,n,i,o,l,h){let f=i[o],p=i[o+1],g=i[o+2],x=i[o+3],_=l[h],M=l[h+1],T=l[h+2],N=l[h+3];return e[n]=f*N+x*_+p*T-g*M,e[n+1]=p*N+x*M+g*_-f*T,e[n+2]=g*N+x*T+f*M-p*_,e[n+3]=x*N-f*_-p*M-g*T,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,o){return this._x=e,this._y=n,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=e._x,o=e._y,l=e._z,h=e._order,f=Math.cos,p=Math.sin,g=f(i/2),x=f(o/2),_=f(l/2),M=p(i/2),T=p(o/2),N=p(l/2);switch(h){case"XYZ":this._x=M*x*_+g*T*N,this._y=g*T*_-M*x*N,this._z=g*x*N+M*T*_,this._w=g*x*_-M*T*N;break;case"YXZ":this._x=M*x*_+g*T*N,this._y=g*T*_-M*x*N,this._z=g*x*N-M*T*_,this._w=g*x*_+M*T*N;break;case"ZXY":this._x=M*x*_-g*T*N,this._y=g*T*_+M*x*N,this._z=g*x*N+M*T*_,this._w=g*x*_-M*T*N;break;case"ZYX":this._x=M*x*_-g*T*N,this._y=g*T*_+M*x*N,this._z=g*x*N-M*T*_,this._w=g*x*_+M*T*N;break;case"YZX":this._x=M*x*_+g*T*N,this._y=g*T*_+M*x*N,this._z=g*x*N-M*T*_,this._w=g*x*_-M*T*N;break;case"XZY":this._x=M*x*_-g*T*N,this._y=g*T*_-M*x*N,this._z=g*x*N+M*T*_,this._w=g*x*_+M*T*N;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,n){let i=n/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let n=e.elements,i=n[0],o=n[4],l=n[8],h=n[1],f=n[5],p=n[9],g=n[2],x=n[6],_=n[10],M=i+f+_;if(M>0){let T=.5/Math.sqrt(M+1);this._w=.25/T,this._x=(x-p)*T,this._y=(l-g)*T,this._z=(h-o)*T}else if(i>f&&i>_){let T=2*Math.sqrt(1+i-f-_);this._w=(x-p)/T,this._x=.25*T,this._y=(o+h)/T,this._z=(l+g)/T}else if(f>_){let T=2*Math.sqrt(1+f-i-_);this._w=(l-g)/T,this._x=(o+h)/T,this._y=.25*T,this._z=(p+x)/T}else{let T=2*Math.sqrt(1+_-i-f);this._w=(h-o)/T,this._x=(l+g)/T,this._y=(p+x)/T,this._z=.25*T}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Qn(this.dot(e),-1,1)))}rotateTowards(e,n){let i=this.angleTo(e);if(i===0)return this;let o=Math.min(1,n/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,n){return n!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,n)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){let i=e._x,o=e._y,l=e._z,h=e._w,f=n._x,p=n._y,g=n._z,x=n._w;return this._x=i*x+h*f+o*g-l*p,this._y=o*x+h*p+l*f-i*g,this._z=l*x+h*g+i*p-o*f,this._w=h*x-i*f-o*p-l*g,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);let i=this._x,o=this._y,l=this._z,h=this._w,f=h*e._w+i*e._x+o*e._y+l*e._z;if(f<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,f=-f):this.copy(e),f>=1)return this._w=h,this._x=i,this._y=o,this._z=l,this;let p=1-f*f;if(p<=Number.EPSILON){let T=1-n;return this._w=T*h+n*this._w,this._x=T*i+n*this._x,this._y=T*o+n*this._y,this._z=T*l+n*this._z,this.normalize(),this._onChangeCallback(),this}let g=Math.sqrt(p),x=Math.atan2(g,f),_=Math.sin((1-n)*x)/g,M=Math.sin(n*x)/g;return this._w=h*_+this._w*M,this._x=i*_+this._x*M,this._y=o*_+this._y*M,this._z=l*_+this._z*M,this._onChangeCallback(),this}slerpQuaternions(e,n,i){this.copy(e).slerp(n,i)}random(){let e=Math.random(),n=Math.sqrt(1-e),i=Math.sqrt(e),o=2*Math.PI*Math.random(),l=2*Math.PI*Math.random();return this.set(n*Math.cos(o),i*Math.sin(l),i*Math.cos(l),n*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Kn.prototype.isQuaternion=!0;class J{constructor(e=0,n=0,i=0){this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,n){return n!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e,n){return n!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e,n){return n!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,n)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cr.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(cr.setFromAxisAngle(e,n))}applyMatrix3(e){let n=this.x,i=this.y,o=this.z,l=e.elements;return this.x=l[0]*n+l[3]*i+l[6]*o,this.y=l[1]*n+l[4]*i+l[7]*o,this.z=l[2]*n+l[5]*i+l[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let n=this.x,i=this.y,o=this.z,l=e.elements,h=1/(l[3]*n+l[7]*i+l[11]*o+l[15]);return this.x=(l[0]*n+l[4]*i+l[8]*o+l[12])*h,this.y=(l[1]*n+l[5]*i+l[9]*o+l[13])*h,this.z=(l[2]*n+l[6]*i+l[10]*o+l[14])*h,this}applyQuaternion(e){let n=this.x,i=this.y,o=this.z,l=e.x,h=e.y,f=e.z,p=e.w,g=p*n+h*o-f*i,x=p*i+f*n-l*o,_=p*o+l*i-h*n,M=-l*n-h*i-f*o;return this.x=g*p+M*-l+x*-f-_*-h,this.y=x*p+M*-h+_*-l-g*-f,this.z=_*p+M*-f+g*-h-x*-l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let n=this.x,i=this.y,o=this.z,l=e.elements;return this.x=l[0]*n+l[4]*i+l[8]*o,this.y=l[1]*n+l[5]*i+l[9]*o,this.z=l[2]*n+l[6]*i+l[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e,n){return n!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,n)):this.crossVectors(this,e)}crossVectors(e,n){let i=e.x,o=e.y,l=e.z,h=n.x,f=n.y,p=n.z;return this.x=o*p-l*f,this.y=l*h-i*p,this.z=i*f-o*h,this}projectOnVector(e){let n=e.lengthSq();if(n===0)return this.set(0,0,0);let i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ji.copy(this).projectOnVector(e),this.sub(ji)}reflect(e){return this.sub(ji.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;let i=this.dot(e)/n;return Math.acos(Qn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let n=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return n*n+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){let o=Math.sin(n)*e;return this.x=o*Math.sin(i),this.y=Math.cos(n)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){let n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){let n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=o,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,4*n)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,3*n)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),n=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(n),this.y=i*Math.sin(n),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}J.prototype.isVector3=!0;let ji=new J,cr=new Kn;class gr{constructor(e=new J(1/0,1/0,1/0),n=new J(-1/0,-1/0,-1/0)){this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){let n=1/0,i=1/0,o=1/0,l=-1/0,h=-1/0,f=-1/0;for(let p=0,g=e.length;p<g;p+=3){let x=e[p],_=e[p+1],M=e[p+2];x<n&&(n=x),_<i&&(i=_),M<o&&(o=M),x>l&&(l=x),_>h&&(h=_),M>f&&(f=M)}return this.min.set(n,i,o),this.max.set(l,h,f),this}setFromBufferAttribute(e){let n=1/0,i=1/0,o=1/0,l=-1/0,h=-1/0,f=-1/0;for(let p=0,g=e.count;p<g;p++){let x=e.getX(p),_=e.getY(p),M=e.getZ(p);x<n&&(n=x),_<i&&(i=_),M<o&&(o=M),x>l&&(l=x),_>h&&(h=_),M>f&&(f=M)}return this.min.set(n,i,o),this.max.set(l,h,f),this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){let i=Zo.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let n=e.geometry;n!==void 0&&(n.boundingBox===null&&n.computeBoundingBox(),js.copy(n.boundingBox),js.applyMatrix4(e.matrixWorld),this.union(js));let i=e.children;for(let o=0,l=i.length;o<l;o++)this.expandByObject(i[o]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Zo),Zo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter($o),dc.subVectors(this.max,$o),wr.subVectors(e.a,$o),Yi.subVectors(e.b,$o),ei.subVectors(e.c,$o),ti.subVectors(Yi,wr),ni.subVectors(ei,Yi),bi.subVectors(wr,ei);let n=[0,-ti.z,ti.y,0,-ni.z,ni.y,0,-bi.z,bi.y,ti.z,0,-ti.x,ni.z,0,-ni.x,bi.z,0,-bi.x,-ti.y,ti.x,0,-ni.y,ni.x,0,-bi.y,bi.x,0];return!!Qu(n,wr,Yi,ei,dc)&&(n=[1,0,0,0,1,0,0,0,1],!!Qu(n,wr,Yi,ei,dc)&&(fc.crossVectors(ti,ni),n=[fc.x,fc.y,fc.z],Qu(n,wr,Yi,ei,dc)))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Zo.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Zo).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Kr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Kr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Kr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Kr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Kr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Kr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Kr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Kr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Kr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}gr.prototype.isBox3=!0;let Kr=[new J,new J,new J,new J,new J,new J,new J,new J],Zo=new J,js=new gr,wr=new J,Yi=new J,ei=new J,ti=new J,ni=new J,bi=new J,$o=new J,dc=new J,fc=new J,Qo=new J;function Qu(c,e,n,i,o){for(let l=0,h=c.length-3;l<=h;l+=3){Qo.fromArray(c,l);let f=o.x*Math.abs(Qo.x)+o.y*Math.abs(Qo.y)+o.z*Math.abs(Qo.z),p=e.dot(Qo),g=n.dot(Qo),x=i.dot(Qo);if(Math.max(-Math.max(p,g,x),Math.min(p,g,x))>f)return!1}return!0}let Ys=new gr,qs=new J,Mi=new J,wi=new J;class qi{constructor(e=new J,n=-1){this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){let i=this.center;n!==void 0?i.copy(n):Ys.setFromPoints(e).getCenter(i);let o=0;for(let l=0,h=e.length;l<h;l++)o=Math.max(o,i.distanceToSquared(e[l]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){let i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){wi.subVectors(e,this.center);let n=wi.lengthSq();if(n>this.radius*this.radius){let i=Math.sqrt(n),o=.5*(i-this.radius);this.center.add(wi.multiplyScalar(o/i)),this.radius+=o}return this}union(e){return Mi.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(qs.copy(e.center).add(Mi)),this.expandByPoint(qs.copy(e.center).sub(Mi)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let Ei=new J,cl=new J,Xi=new J,xn=new J,ul=new J,hl=new J,Ku=new J;class ri{constructor(e=new J,n=new J(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ei)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);let i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let n=Ei.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Ei.copy(this.direction).multiplyScalar(n).add(this.origin),Ei.distanceToSquared(e))}distanceSqToSegment(e,n,i,o){cl.copy(e).add(n).multiplyScalar(.5),Xi.copy(n).sub(e).normalize(),xn.copy(this.origin).sub(cl);let l=.5*e.distanceTo(n),h=-this.direction.dot(Xi),f=xn.dot(this.direction),p=-xn.dot(Xi),g=xn.lengthSq(),x=Math.abs(1-h*h),_,M,T,N;if(x>0)if(_=h*p-f,M=h*f-p,N=l*x,_>=0)if(M>=-N)if(M<=N){let I=1/x;_*=I,M*=I,T=_*(_+h*M+2*f)+M*(h*_+M+2*p)+g}else M=l,_=Math.max(0,-(h*M+f)),T=-_*_+M*(M+2*p)+g;else M=-l,_=Math.max(0,-(h*M+f)),T=-_*_+M*(M+2*p)+g;else M<=-N?(_=Math.max(0,-(-h*l+f)),M=_>0?-l:Math.min(Math.max(-l,-p),l),T=-_*_+M*(M+2*p)+g):M<=N?(_=0,M=Math.min(Math.max(-l,-p),l),T=M*(M+2*p)+g):(_=Math.max(0,-(h*l+f)),M=_>0?l:Math.min(Math.max(-l,-p),l),T=-_*_+M*(M+2*p)+g);else M=h>0?-l:l,_=Math.max(0,-(h*M+f)),T=-_*_+M*(M+2*p)+g;return i&&i.copy(this.direction).multiplyScalar(_).add(this.origin),o&&o.copy(Xi).multiplyScalar(M).add(cl),T}intersectSphere(e,n){Ei.subVectors(e.center,this.origin);let i=Ei.dot(this.direction),o=Ei.dot(Ei)-i*i,l=e.radius*e.radius;if(o>l)return null;let h=Math.sqrt(l-o),f=i-h,p=i+h;return f<0&&p<0?null:f<0?this.at(p,n):this.at(f,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){let i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){let n=e.distanceToPoint(this.origin);return n===0?!0:e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,o,l,h,f,p,g=1/this.direction.x,x=1/this.direction.y,_=1/this.direction.z,M=this.origin;return g>=0?(i=(e.min.x-M.x)*g,o=(e.max.x-M.x)*g):(i=(e.max.x-M.x)*g,o=(e.min.x-M.x)*g),x>=0?(l=(e.min.y-M.y)*x,h=(e.max.y-M.y)*x):(l=(e.max.y-M.y)*x,h=(e.min.y-M.y)*x),i>h||l>o?null:((l>i||i!=i)&&(i=l),(h<o||o!=o)&&(o=h),_>=0?(f=(e.min.z-M.z)*_,p=(e.max.z-M.z)*_):(f=(e.max.z-M.z)*_,p=(e.min.z-M.z)*_),i>p||f>o?null:((f>i||i!=i)&&(i=f),(p<o||o!=o)&&(o=p),o<0?null:this.at(i>=0?i:o,n)))}intersectsBox(e){return this.intersectBox(e,Ei)!==null}intersectTriangle(e,n,i,o,l){ul.subVectors(n,e),hl.subVectors(i,e),Ku.crossVectors(ul,hl);let h,f=this.direction.dot(Ku);if(f>0){if(o)return null;h=1}else{if(!(f<0))return null;h=-1,f=-f}xn.subVectors(this.origin,e);let p=h*this.direction.dot(hl.crossVectors(xn,hl));if(p<0)return null;let g=h*this.direction.dot(ul.cross(xn));if(g<0||p+g>f)return null;let x=-h*xn.dot(Ku);return x<0?null:this.at(x/f,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Mt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,n,i,o,l,h,f,p,g,x,_,M,T,N,I,D){let L=this.elements;return L[0]=e,L[4]=n,L[8]=i,L[12]=o,L[1]=l,L[5]=h,L[9]=f,L[13]=p,L[2]=g,L[6]=x,L[10]=_,L[14]=M,L[3]=T,L[7]=N,L[11]=I,L[15]=D,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Mt().fromArray(this.elements)}copy(e){let n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){let n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){let n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){let n=this.elements,i=e.elements,o=1/yo.setFromMatrixColumn(e,0).length(),l=1/yo.setFromMatrixColumn(e,1).length(),h=1/yo.setFromMatrixColumn(e,2).length();return n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o,n[3]=0,n[4]=i[4]*l,n[5]=i[5]*l,n[6]=i[6]*l,n[7]=0,n[8]=i[8]*h,n[9]=i[9]*h,n[10]=i[10]*h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let n=this.elements,i=e.x,o=e.y,l=e.z,h=Math.cos(i),f=Math.sin(i),p=Math.cos(o),g=Math.sin(o),x=Math.cos(l),_=Math.sin(l);if(e.order==="XYZ"){let M=h*x,T=h*_,N=f*x,I=f*_;n[0]=p*x,n[4]=-p*_,n[8]=g,n[1]=T+N*g,n[5]=M-I*g,n[9]=-f*p,n[2]=I-M*g,n[6]=N+T*g,n[10]=h*p}else if(e.order==="YXZ"){let M=p*x,T=p*_,N=g*x,I=g*_;n[0]=M+I*f,n[4]=N*f-T,n[8]=h*g,n[1]=h*_,n[5]=h*x,n[9]=-f,n[2]=T*f-N,n[6]=I+M*f,n[10]=h*p}else if(e.order==="ZXY"){let M=p*x,T=p*_,N=g*x,I=g*_;n[0]=M-I*f,n[4]=-h*_,n[8]=N+T*f,n[1]=T+N*f,n[5]=h*x,n[9]=I-M*f,n[2]=-h*g,n[6]=f,n[10]=h*p}else if(e.order==="ZYX"){let M=h*x,T=h*_,N=f*x,I=f*_;n[0]=p*x,n[4]=N*g-T,n[8]=M*g+I,n[1]=p*_,n[5]=I*g+M,n[9]=T*g-N,n[2]=-g,n[6]=f*p,n[10]=h*p}else if(e.order==="YZX"){let M=h*p,T=h*g,N=f*p,I=f*g;n[0]=p*x,n[4]=I-M*_,n[8]=N*_+T,n[1]=_,n[5]=h*x,n[9]=-f*x,n[2]=-g*x,n[6]=T*_+N,n[10]=M-I*_}else if(e.order==="XZY"){let M=h*p,T=h*g,N=f*p,I=f*g;n[0]=p*x,n[4]=-_,n[8]=g*x,n[1]=M*_+I,n[5]=h*x,n[9]=T*_-N,n[2]=N*_-T,n[6]=f*x,n[10]=I*_+M}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(pc,e,ii)}lookAt(e,n,i){let o=this.elements;return ur.subVectors(e,n),ur.lengthSq()===0&&(ur.z=1),ur.normalize(),Si.crossVectors(i,ur),Si.lengthSq()===0&&(Math.abs(i.z)===1?ur.x+=1e-4:ur.z+=1e-4,ur.normalize(),Si.crossVectors(i,ur)),Si.normalize(),Xs.crossVectors(ur,Si),o[0]=Si.x,o[4]=Xs.x,o[8]=ur.x,o[1]=Si.y,o[5]=Xs.y,o[9]=ur.y,o[2]=Si.z,o[6]=Xs.z,o[10]=ur.z,this}multiply(e,n){return n!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,n)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){let i=e.elements,o=n.elements,l=this.elements,h=i[0],f=i[4],p=i[8],g=i[12],x=i[1],_=i[5],M=i[9],T=i[13],N=i[2],I=i[6],D=i[10],L=i[14],F=i[3],U=i[7],V=i[11],K=i[15],re=o[0],ve=o[4],_e=o[8],Te=o[12],Ee=o[1],Ne=o[5],ct=o[9],Je=o[13],De=o[2],Ze=o[6],vt=o[10],xt=o[14],Tt=o[3],Pt=o[7],Ct=o[11],nt=o[15];return l[0]=h*re+f*Ee+p*De+g*Tt,l[4]=h*ve+f*Ne+p*Ze+g*Pt,l[8]=h*_e+f*ct+p*vt+g*Ct,l[12]=h*Te+f*Je+p*xt+g*nt,l[1]=x*re+_*Ee+M*De+T*Tt,l[5]=x*ve+_*Ne+M*Ze+T*Pt,l[9]=x*_e+_*ct+M*vt+T*Ct,l[13]=x*Te+_*Je+M*xt+T*nt,l[2]=N*re+I*Ee+D*De+L*Tt,l[6]=N*ve+I*Ne+D*Ze+L*Pt,l[10]=N*_e+I*ct+D*vt+L*Ct,l[14]=N*Te+I*Je+D*xt+L*nt,l[3]=F*re+U*Ee+V*De+K*Tt,l[7]=F*ve+U*Ne+V*Ze+K*Pt,l[11]=F*_e+U*ct+V*vt+K*Ct,l[15]=F*Te+U*Je+V*xt+K*nt,this}multiplyScalar(e){let n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){let e=this.elements,n=e[0],i=e[4],o=e[8],l=e[12],h=e[1],f=e[5],p=e[9],g=e[13],x=e[2],_=e[6],M=e[10],T=e[14];return e[3]*(+l*p*_-o*g*_-l*f*M+i*g*M+o*f*T-i*p*T)+e[7]*(+n*p*T-n*g*M+l*h*M-o*h*T+o*g*x-l*p*x)+e[11]*(+n*g*_-n*f*T-l*h*_+i*h*T+l*f*x-i*g*x)+e[15]*(-o*f*x-n*p*_+n*f*M+o*h*_-i*h*M+i*p*x)}transpose(){let e=this.elements,n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){let o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=n,o[14]=i),this}invert(){let e=this.elements,n=e[0],i=e[1],o=e[2],l=e[3],h=e[4],f=e[5],p=e[6],g=e[7],x=e[8],_=e[9],M=e[10],T=e[11],N=e[12],I=e[13],D=e[14],L=e[15],F=_*D*g-I*M*g+I*p*T-f*D*T-_*p*L+f*M*L,U=N*M*g-x*D*g-N*p*T+h*D*T+x*p*L-h*M*L,V=x*I*g-N*_*g+N*f*T-h*I*T-x*f*L+h*_*L,K=N*_*p-x*I*p-N*f*M+h*I*M+x*f*D-h*_*D,re=n*F+i*U+o*V+l*K;if(re===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let ve=1/re;return e[0]=F*ve,e[1]=(I*M*l-_*D*l-I*o*T+i*D*T+_*o*L-i*M*L)*ve,e[2]=(f*D*l-I*p*l+I*o*g-i*D*g-f*o*L+i*p*L)*ve,e[3]=(_*p*l-f*M*l-_*o*g+i*M*g+f*o*T-i*p*T)*ve,e[4]=U*ve,e[5]=(x*D*l-N*M*l+N*o*T-n*D*T-x*o*L+n*M*L)*ve,e[6]=(N*p*l-h*D*l-N*o*g+n*D*g+h*o*L-n*p*L)*ve,e[7]=(h*M*l-x*p*l+x*o*g-n*M*g-h*o*T+n*p*T)*ve,e[8]=V*ve,e[9]=(N*_*l-x*I*l-N*i*T+n*I*T+x*i*L-n*_*L)*ve,e[10]=(h*I*l-N*f*l+N*i*g-n*I*g-h*i*L+n*f*L)*ve,e[11]=(x*f*l-h*_*l-x*i*g+n*_*g+h*i*T-n*f*T)*ve,e[12]=K*ve,e[13]=(x*I*o-N*_*o+N*i*M-n*I*M-x*i*D+n*_*D)*ve,e[14]=(N*f*o-h*I*o-N*i*p+n*I*p+h*i*D-n*f*D)*ve,e[15]=(h*_*o-x*f*o+x*i*p-n*_*p-h*i*M+n*f*M)*ve,this}scale(e){let n=this.elements,i=e.x,o=e.y,l=e.z;return n[0]*=i,n[4]*=o,n[8]*=l,n[1]*=i,n[5]*=o,n[9]*=l,n[2]*=i,n[6]*=o,n[10]*=l,n[3]*=i,n[7]*=o,n[11]*=l,this}getMaxScaleOnAxis(){let e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,o))}makeTranslation(e,n,i){return this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){let n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){let n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){let n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){let i=Math.cos(n),o=Math.sin(n),l=1-i,h=e.x,f=e.y,p=e.z,g=l*h,x=l*f;return this.set(g*h+i,g*f-o*p,g*p+o*f,0,g*f+o*p,x*f+i,x*p-o*h,0,g*p-o*f,x*p+o*h,l*p*p+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,o,l,h){return this.set(1,i,l,0,e,1,h,0,n,o,1,0,0,0,0,1),this}compose(e,n,i){let o=this.elements,l=n._x,h=n._y,f=n._z,p=n._w,g=l+l,x=h+h,_=f+f,M=l*g,T=l*x,N=l*_,I=h*x,D=h*_,L=f*_,F=p*g,U=p*x,V=p*_,K=i.x,re=i.y,ve=i.z;return o[0]=(1-(I+L))*K,o[1]=(T+V)*K,o[2]=(N-U)*K,o[3]=0,o[4]=(T-V)*re,o[5]=(1-(M+L))*re,o[6]=(D+F)*re,o[7]=0,o[8]=(N+U)*ve,o[9]=(D-F)*ve,o[10]=(1-(M+I))*ve,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,n,i){let o=this.elements,l=yo.set(o[0],o[1],o[2]).length(),h=yo.set(o[4],o[5],o[6]).length(),f=yo.set(o[8],o[9],o[10]).length();this.determinant()<0&&(l=-l),e.x=o[12],e.y=o[13],e.z=o[14],Er.copy(this);let p=1/l,g=1/h,x=1/f;return Er.elements[0]*=p,Er.elements[1]*=p,Er.elements[2]*=p,Er.elements[4]*=g,Er.elements[5]*=g,Er.elements[6]*=g,Er.elements[8]*=x,Er.elements[9]*=x,Er.elements[10]*=x,n.setFromRotationMatrix(Er),i.x=l,i.y=h,i.z=f,this}makePerspective(e,n,i,o,l,h){h===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let f=this.elements,p=2*l/(n-e),g=2*l/(i-o),x=(n+e)/(n-e),_=(i+o)/(i-o),M=-(h+l)/(h-l),T=-2*h*l/(h-l);return f[0]=p,f[4]=0,f[8]=x,f[12]=0,f[1]=0,f[5]=g,f[9]=_,f[13]=0,f[2]=0,f[6]=0,f[10]=M,f[14]=T,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makeOrthographic(e,n,i,o,l,h){let f=this.elements,p=1/(n-e),g=1/(i-o),x=1/(h-l),_=(n+e)*p,M=(i+o)*g,T=(h+l)*x;return f[0]=2*p,f[4]=0,f[8]=0,f[12]=-_,f[1]=0,f[5]=2*g,f[9]=0,f[13]=-M,f[2]=0,f[6]=0,f[10]=-2*x,f[14]=-T,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}equals(e){let n=this.elements,i=e.elements;for(let o=0;o<16;o++)if(n[o]!==i[o])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){let i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}Mt.prototype.isMatrix4=!0;let yo=new J,Er=new Mt,pc=new J(0,0,0),ii=new J(1,1,1),Si=new J,Xs=new J,ur=new J,mc=new Mt,eh=new Kn;class Ti{constructor(e=0,n=0,i=0,o=Ti.DefaultOrder){this._x=e,this._y=n,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,o=this._order){return this._x=e,this._y=n,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){let o=e.elements,l=o[0],h=o[4],f=o[8],p=o[1],g=o[5],x=o[9],_=o[2],M=o[6],T=o[10];switch(n){case"XYZ":this._y=Math.asin(Qn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-x,T),this._z=Math.atan2(-h,l)):(this._x=Math.atan2(M,g),this._z=0);break;case"YXZ":this._x=Math.asin(-Qn(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(f,T),this._z=Math.atan2(p,g)):(this._y=Math.atan2(-_,l),this._z=0);break;case"ZXY":this._x=Math.asin(Qn(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-_,T),this._z=Math.atan2(-h,g)):(this._y=0,this._z=Math.atan2(p,l));break;case"ZYX":this._y=Math.asin(-Qn(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(M,T),this._z=Math.atan2(p,l)):(this._x=0,this._z=Math.atan2(-h,g));break;case"YZX":this._z=Math.asin(Qn(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,g),this._y=Math.atan2(-_,l)):(this._x=0,this._y=Math.atan2(f,T));break;case"XZY":this._z=Math.asin(-Qn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(M,g),this._y=Math.atan2(f,l)):(this._x=Math.atan2(-x,T),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return mc.makeRotationFromQuaternion(e),this.setFromRotationMatrix(mc,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return eh.setFromEuler(this),this.setFromQuaternion(eh,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new J(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Ti.prototype.isEuler=!0,Ti.DefaultOrder="XYZ",Ti.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Hr{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}}let oi=0,xo=new J,Ko=new Kn,Ai=new Mt,dl=new J,_o=new J,Tf=new J,$m=new Kn,fl=new J(1,0,0),Af=new J(0,1,0),On=new J(0,0,1),Nf={type:"added"},th={type:"removed"};class Xt extends Qr{constructor(){super(),Object.defineProperty(this,"id",{value:oi++}),this.uuid=mr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xt.DefaultUp.clone();let e=new J,n=new Ti,i=new Kn,o=new J(1,1,1);n._onChange(function(){i.setFromEuler(n,!1)}),i._onChange(function(){n.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Mt},normalMatrix:{value:new In}}),this.matrix=new Mt,this.matrixWorld=new Mt,this.matrixAutoUpdate=Xt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Hr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Ko.setFromAxisAngle(e,n),this.quaternion.multiply(Ko),this}rotateOnWorldAxis(e,n){return Ko.setFromAxisAngle(e,n),this.quaternion.premultiply(Ko),this}rotateX(e){return this.rotateOnAxis(fl,e)}rotateY(e){return this.rotateOnAxis(Af,e)}rotateZ(e){return this.rotateOnAxis(On,e)}translateOnAxis(e,n){return xo.copy(e).applyQuaternion(this.quaternion),this.position.add(xo.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(fl,e)}translateY(e){return this.translateOnAxis(Af,e)}translateZ(e){return this.translateOnAxis(On,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ai.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?dl.copy(e):dl.set(e,n,i);let o=this.parent;this.updateWorldMatrix(!0,!1),_o.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ai.lookAt(_o,dl,this.up):Ai.lookAt(dl,_o,this.up),this.quaternion.setFromRotationMatrix(Ai),o&&(Ai.extractRotation(o.matrixWorld),Ko.setFromRotationMatrix(Ai),this.quaternion.premultiply(Ko.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Nf)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(th)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let n=this.children[e];n.parent=null,n.dispatchEvent(th)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ai.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ai.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ai),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,o=this.children.length;i<o;i++){let l=this.children[i].getObjectByProperty(e,n);if(l!==void 0)return l}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_o,e,Tf),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_o,$m,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);let n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverseVisible(e)}traverseAncestors(e){let n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].updateMatrixWorld(e)}updateWorldMatrix(e,n){let i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){let o=this.children;for(let l=0,h=o.length;l<h;l++)o[l].updateWorldMatrix(!1,!0)}}toJSON(e){let n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let o={};function l(f,p){return f[p.uuid]===void 0&&(f[p.uuid]=p.toJSON(e)),p.uuid}if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=l(e.geometries,this.geometry);let f=this.geometry.parameters;if(f!==void 0&&f.shapes!==void 0){let p=f.shapes;if(Array.isArray(p))for(let g=0,x=p.length;g<x;g++){let _=p[g];l(e.shapes,_)}else l(e.shapes,p)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let f=[];for(let p=0,g=this.material.length;p<g;p++)f.push(l(e.materials,this.material[p]));o.material=f}else o.material=l(e.materials,this.material);if(this.children.length>0){o.children=[];for(let f=0;f<this.children.length;f++)o.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let f=0;f<this.animations.length;f++){let p=this.animations[f];o.animations.push(l(e.animations,p))}}if(n){let f=h(e.geometries),p=h(e.materials),g=h(e.textures),x=h(e.images),_=h(e.shapes),M=h(e.skeletons),T=h(e.animations);f.length>0&&(i.geometries=f),p.length>0&&(i.materials=p),g.length>0&&(i.textures=g),x.length>0&&(i.images=x),_.length>0&&(i.shapes=_),M.length>0&&(i.skeletons=M),T.length>0&&(i.animations=T)}return i.object=o,i;function h(f){let p=[];for(let g in f){let x=f[g];delete x.metadata,p.push(x)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){let o=e.children[i];this.add(o.clone())}return this}}Xt.DefaultUp=new J(0,1,0),Xt.DefaultMatrixAutoUpdate=!0,Xt.prototype.isObject3D=!0;let bn=new J,Ni=new J,nh=new J,Ji=new J,bo=new J,Ri=new J,rh=new J,gc=new J,vc=new J,yc=new J;class Sn{constructor(e=new J,n=new J,i=new J){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,o){o.subVectors(i,n),bn.subVectors(e,n),o.cross(bn);let l=o.lengthSq();return l>0?o.multiplyScalar(1/Math.sqrt(l)):o.set(0,0,0)}static getBarycoord(e,n,i,o,l){bn.subVectors(o,n),Ni.subVectors(i,n),nh.subVectors(e,n);let h=bn.dot(bn),f=bn.dot(Ni),p=bn.dot(nh),g=Ni.dot(Ni),x=Ni.dot(nh),_=h*g-f*f;if(_===0)return l.set(-2,-1,-1);let M=1/_,T=(g*p-f*x)*M,N=(h*x-f*p)*M;return l.set(1-T-N,N,T)}static containsPoint(e,n,i,o){return this.getBarycoord(e,n,i,o,Ji),Ji.x>=0&&Ji.y>=0&&Ji.x+Ji.y<=1}static getUV(e,n,i,o,l,h,f,p){return this.getBarycoord(e,n,i,o,Ji),p.set(0,0),p.addScaledVector(l,Ji.x),p.addScaledVector(h,Ji.y),p.addScaledVector(f,Ji.z),p}static isFrontFacing(e,n,i,o){return bn.subVectors(i,n),Ni.subVectors(e,n),bn.cross(Ni).dot(o)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,o){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,n,i,o){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return bn.subVectors(this.c,this.b),Ni.subVectors(this.a,this.b),.5*bn.cross(Ni).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Sn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Sn.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,i,o,l){return Sn.getUV(e,this.a,this.b,this.c,n,i,o,l)}containsPoint(e){return Sn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Sn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){let i=this.a,o=this.b,l=this.c,h,f;bo.subVectors(o,i),Ri.subVectors(l,i),gc.subVectors(e,i);let p=bo.dot(gc),g=Ri.dot(gc);if(p<=0&&g<=0)return n.copy(i);vc.subVectors(e,o);let x=bo.dot(vc),_=Ri.dot(vc);if(x>=0&&_<=x)return n.copy(o);let M=p*_-x*g;if(M<=0&&p>=0&&x<=0)return h=p/(p-x),n.copy(i).addScaledVector(bo,h);yc.subVectors(e,l);let T=bo.dot(yc),N=Ri.dot(yc);if(N>=0&&T<=N)return n.copy(l);let I=T*g-p*N;if(I<=0&&g>=0&&N<=0)return f=g/(g-N),n.copy(i).addScaledVector(Ri,f);let D=x*N-T*_;if(D<=0&&_-x>=0&&T-N>=0)return rh.subVectors(l,o),f=(_-x)/(_-x+(T-N)),n.copy(o).addScaledVector(rh,f);let L=1/(D+I+M);return h=I*L,f=M*L,n.copy(i).addScaledVector(bo,h).addScaledVector(Ri,f)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Rf=0;class Gn extends Qr{constructor(){super(),Object.defineProperty(this,"id",{value:Rf++}),this.uuid=mr(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=1023,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let n in e){let i=e[n];if(i===void 0){console.warn("THREE.Material: '"+n+"' parameter is undefined.");continue}if(n==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===1;continue}let o=this[n];o!==void 0?o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[n]=i:console.warn("THREE."+this.type+": '"+n+"' is not a property of this material.")}}toJSON(e){let n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function o(l){let h=[];for(let f in l){let p=l[f];delete p.metadata,h.push(p)}return h}if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(i.blending=this.blending),this.side!==0&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==1023&&(i.format=this.format),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),n){let l=o(e.textures),h=o(e.images);l.length>0&&(i.textures=l),h.length>0&&(i.images=h)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let n=e.clippingPlanes,i=null;if(n!==null){let o=n.length;i=new Array(o);for(let l=0;l!==o;++l)i[l]=n[l].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Gn.prototype.isMaterial=!0;let ih={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},tr={h:0,s:0,l:0},xc={h:0,s:0,l:0};function es(c,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?c+6*(e-c)*n:n<.5?e:n<2/3?c+6*(e-c)*(2/3-n):c}function Js(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function _c(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}class yt{constructor(e,n,i){return n===void 0&&i===void 0?this.set(e):this.setRGB(e,n,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,n,i){return this.r=e,this.g=n,this.b=i,this}setHSL(e,n,i){if(e=qu(e,1),n=Qn(n,0,1),i=Qn(i,0,1),n===0)this.r=this.g=this.b=i;else{let o=i<=.5?i*(1+n):i+n-i*n,l=2*i-o;this.r=es(l,o,e+1/3),this.g=es(l,o,e),this.b=es(l,o,e-1/3)}return this}setStyle(e){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o,l=i[1],h=i[2];switch(l){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,n(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,n(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h)){let f=parseFloat(o[1])/360,p=parseInt(o[2],10)/100,g=parseInt(o[3],10)/100;return n(o[4]),this.setHSL(f,p,g)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let o=i[1],l=o.length;if(l===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,this;if(l===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let n=ih[e.toLowerCase()];return n!==void 0?this.setHex(n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,n=2){return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}copyLinearToGamma(e,n=2){let i=n>0?1/n:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Js(e.r),this.g=Js(e.g),this.b=Js(e.b),this}copyLinearToSRGB(e){return this.r=_c(e.r),this.g=_c(e.g),this.b=_c(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){let n=this.r,i=this.g,o=this.b,l=Math.max(n,i,o),h=Math.min(n,i,o),f,p,g=(h+l)/2;if(h===l)f=0,p=0;else{let x=l-h;switch(p=g<=.5?x/(l+h):x/(2-l-h),l){case n:f=(i-o)/x+(i<o?6:0);break;case i:f=(o-n)/x+2;break;case o:f=(n-i)/x+4}f/=6}return e.h=f,e.s=p,e.l=g,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,n,i){return this.getHSL(tr),tr.h+=e,tr.s+=n,tr.l+=i,this.setHSL(tr.h,tr.s,tr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(tr),e.getHSL(xc);let i=ll(tr.h,xc.h,n),o=ll(tr.s,xc.s,n),l=ll(tr.l,xc.l,n);return this.setHSL(i,o,l),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}yt.NAMES=ih,yt.prototype.isColor=!0,yt.prototype.r=1,yt.prototype.g=1,yt.prototype.b=1;class Zi extends Gn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Zi.prototype.isMeshBasicMaterial=!0;let cn=new J,Zs=new Ke;class Jt{constructor(e,n,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i===!0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let o=0,l=this.itemSize;o<l;o++)this.array[e+o]=n.array[i+o];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let n=this.array,i=0;for(let o=0,l=e.length;o<l;o++){let h=e[o];h===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",o),h=new yt),n[i++]=h.r,n[i++]=h.g,n[i++]=h.b}return this}copyVector2sArray(e){let n=this.array,i=0;for(let o=0,l=e.length;o<l;o++){let h=e[o];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",o),h=new Ke),n[i++]=h.x,n[i++]=h.y}return this}copyVector3sArray(e){let n=this.array,i=0;for(let o=0,l=e.length;o<l;o++){let h=e[o];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",o),h=new J),n[i++]=h.x,n[i++]=h.y,n[i++]=h.z}return this}copyVector4sArray(e){let n=this.array,i=0;for(let o=0,l=e.length;o<l;o++){let h=e[o];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",o),h=new on),n[i++]=h.x,n[i++]=h.y,n[i++]=h.z,n[i++]=h.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)Zs.fromBufferAttribute(this,n),Zs.applyMatrix3(e),this.setXY(n,Zs.x,Zs.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)cn.fromBufferAttribute(this,n),cn.applyMatrix3(e),this.setXYZ(n,cn.x,cn.y,cn.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)cn.x=this.getX(n),cn.y=this.getY(n),cn.z=this.getZ(n),cn.applyMatrix4(e),this.setXYZ(n,cn.x,cn.y,cn.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)cn.x=this.getX(n),cn.y=this.getY(n),cn.z=this.getZ(n),cn.applyNormalMatrix(e),this.setXYZ(n,cn.x,cn.y,cn.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)cn.x=this.getX(n),cn.y=this.getY(n),cn.z=this.getZ(n),cn.transformDirection(e),this.setXYZ(n,cn.x,cn.y,cn.z);return this}set(e,n=0){return this.array.set(e,n),this}getX(e){return this.array[e*this.itemSize]}setX(e,n){return this.array[e*this.itemSize]=n,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,n){return this.array[e*this.itemSize+1]=n,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,n){return this.array[e*this.itemSize+2]=n,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,n){return this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,o){return e*=this.itemSize,this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=o,this}setXYZW(e,n,i,o,l){return e*=this.itemSize,this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=o,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==35044&&(e.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(e.updateRange=this.updateRange),e}}Jt.prototype.isBufferAttribute=!0;class bc extends Jt{constructor(e,n,i){super(new Int8Array(e),n,i)}}class Mo extends Jt{constructor(e,n,i){super(new Uint8Array(e),n,i)}}class Vr extends Jt{constructor(e,n,i){super(new Uint8ClampedArray(e),n,i)}}class Lf extends Jt{constructor(e,n,i){super(new Int16Array(e),n,i)}}class Li extends Jt{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class Pf extends Jt{constructor(e,n,i){super(new Int32Array(e),n,i)}}class Mc extends Jt{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class wc extends Jt{constructor(e,n,i){super(new Uint16Array(e),n,i)}}wc.prototype.isFloat16BufferAttribute=!0;class At extends Jt{constructor(e,n,i){super(new Float32Array(e),n,i)}}class Cf extends Jt{constructor(e,n,i){super(new Float64Array(e),n,i)}}let Qm=0,Wr=new Mt,oh=new Xt,$s=new J,Sr=new gr,pl=new gr,jn=new J;class Dt extends Qr{constructor(){super(),Object.defineProperty(this,"id",{value:Qm++}),this.uuid=mr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(wf(e)>65535?Mc:Li)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){let n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let l=new In().getNormalMatrix(e);i.applyNormalMatrix(l),i.needsUpdate=!0}let o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Wr.makeRotationFromQuaternion(e),this.applyMatrix4(Wr),this}rotateX(e){return Wr.makeRotationX(e),this.applyMatrix4(Wr),this}rotateY(e){return Wr.makeRotationY(e),this.applyMatrix4(Wr),this}rotateZ(e){return Wr.makeRotationZ(e),this.applyMatrix4(Wr),this}translate(e,n,i){return Wr.makeTranslation(e,n,i),this.applyMatrix4(Wr),this}scale(e,n,i){return Wr.makeScale(e,n,i),this.applyMatrix4(Wr),this}lookAt(e){return oh.lookAt(e),oh.updateMatrix(),this.applyMatrix4(oh.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($s).negate(),this.translate($s.x,$s.y,$s.z),this}setFromPoints(e){let n=[];for(let i=0,o=e.length;i<o;i++){let l=e[i];n.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new At(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gr);let e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new J(-1/0,-1/0,-1/0),new J(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,o=n.length;i<o;i++){let l=n[i];Sr.setFromBufferAttribute(l),this.morphTargetsRelative?(jn.addVectors(this.boundingBox.min,Sr.min),this.boundingBox.expandByPoint(jn),jn.addVectors(this.boundingBox.max,Sr.max),this.boundingBox.expandByPoint(jn)):(this.boundingBox.expandByPoint(Sr.min),this.boundingBox.expandByPoint(Sr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi);let e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new J,1/0);if(e){let i=this.boundingSphere.center;if(Sr.setFromBufferAttribute(e),n)for(let l=0,h=n.length;l<h;l++){let f=n[l];pl.setFromBufferAttribute(f),this.morphTargetsRelative?(jn.addVectors(Sr.min,pl.min),Sr.expandByPoint(jn),jn.addVectors(Sr.max,pl.max),Sr.expandByPoint(jn)):(Sr.expandByPoint(pl.min),Sr.expandByPoint(pl.max))}Sr.getCenter(i);let o=0;for(let l=0,h=e.count;l<h;l++)jn.fromBufferAttribute(e,l),o=Math.max(o,i.distanceToSquared(jn));if(n)for(let l=0,h=n.length;l<h;l++){let f=n[l],p=this.morphTargetsRelative;for(let g=0,x=f.count;g<x;g++)jn.fromBufferAttribute(f,g),p&&($s.fromBufferAttribute(e,g),jn.add($s)),o=Math.max(o,i.distanceToSquared(jn))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let i=e.array,o=n.position.array,l=n.normal.array,h=n.uv.array,f=o.length/3;n.tangent===void 0&&this.setAttribute("tangent",new Jt(new Float32Array(4*f),4));let p=n.tangent.array,g=[],x=[];for(let Ee=0;Ee<f;Ee++)g[Ee]=new J,x[Ee]=new J;let _=new J,M=new J,T=new J,N=new Ke,I=new Ke,D=new Ke,L=new J,F=new J;function U(Ee,Ne,ct){_.fromArray(o,3*Ee),M.fromArray(o,3*Ne),T.fromArray(o,3*ct),N.fromArray(h,2*Ee),I.fromArray(h,2*Ne),D.fromArray(h,2*ct),M.sub(_),T.sub(_),I.sub(N),D.sub(N);let Je=1/(I.x*D.y-D.x*I.y);isFinite(Je)&&(L.copy(M).multiplyScalar(D.y).addScaledVector(T,-I.y).multiplyScalar(Je),F.copy(T).multiplyScalar(I.x).addScaledVector(M,-D.x).multiplyScalar(Je),g[Ee].add(L),g[Ne].add(L),g[ct].add(L),x[Ee].add(F),x[Ne].add(F),x[ct].add(F))}let V=this.groups;V.length===0&&(V=[{start:0,count:i.length}]);for(let Ee=0,Ne=V.length;Ee<Ne;++Ee){let ct=V[Ee],Je=ct.start;for(let De=Je,Ze=Je+ct.count;De<Ze;De+=3)U(i[De+0],i[De+1],i[De+2])}let K=new J,re=new J,ve=new J,_e=new J;function Te(Ee){ve.fromArray(l,3*Ee),_e.copy(ve);let Ne=g[Ee];K.copy(Ne),K.sub(ve.multiplyScalar(ve.dot(Ne))).normalize(),re.crossVectors(_e,Ne);let ct=re.dot(x[Ee])<0?-1:1;p[4*Ee]=K.x,p[4*Ee+1]=K.y,p[4*Ee+2]=K.z,p[4*Ee+3]=ct}for(let Ee=0,Ne=V.length;Ee<Ne;++Ee){let ct=V[Ee],Je=ct.start;for(let De=Je,Ze=Je+ct.count;De<Ze;De+=3)Te(i[De+0]),Te(i[De+1]),Te(i[De+2])}}computeVertexNormals(){let e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Jt(new Float32Array(3*n.count),3),this.setAttribute("normal",i);else for(let M=0,T=i.count;M<T;M++)i.setXYZ(M,0,0,0);let o=new J,l=new J,h=new J,f=new J,p=new J,g=new J,x=new J,_=new J;if(e)for(let M=0,T=e.count;M<T;M+=3){let N=e.getX(M+0),I=e.getX(M+1),D=e.getX(M+2);o.fromBufferAttribute(n,N),l.fromBufferAttribute(n,I),h.fromBufferAttribute(n,D),x.subVectors(h,l),_.subVectors(o,l),x.cross(_),f.fromBufferAttribute(i,N),p.fromBufferAttribute(i,I),g.fromBufferAttribute(i,D),f.add(x),p.add(x),g.add(x),i.setXYZ(N,f.x,f.y,f.z),i.setXYZ(I,p.x,p.y,p.z),i.setXYZ(D,g.x,g.y,g.z)}else for(let M=0,T=n.count;M<T;M+=3)o.fromBufferAttribute(n,M+0),l.fromBufferAttribute(n,M+1),h.fromBufferAttribute(n,M+2),x.subVectors(h,l),_.subVectors(o,l),x.cross(_),i.setXYZ(M+0,x.x,x.y,x.z),i.setXYZ(M+1,x.x,x.y,x.z),i.setXYZ(M+2,x.x,x.y,x.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,n){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);n===void 0&&(n=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let i=this.attributes;for(let o in i){if(e.attributes[o]===void 0)continue;let l=i[o].array,h=e.attributes[o],f=h.array,p=h.itemSize*n,g=Math.min(f.length,l.length-p);for(let x=0,_=p;x<g;x++,_++)l[_]=f[x]}return this}normalizeNormals(){let e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)jn.fromBufferAttribute(e,n),jn.normalize(),e.setXYZ(n,jn.x,jn.y,jn.z)}toNonIndexed(){function e(f,p){let g=f.array,x=f.itemSize,_=f.normalized,M=new g.constructor(p.length*x),T=0,N=0;for(let I=0,D=p.length;I<D;I++){T=f.isInterleavedBufferAttribute?p[I]*f.data.stride+f.offset:p[I]*x;for(let L=0;L<x;L++)M[N++]=g[T++]}return new Jt(M,x,_)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let n=new Dt,i=this.index.array,o=this.attributes;for(let f in o){let p=e(o[f],i);n.setAttribute(f,p)}let l=this.morphAttributes;for(let f in l){let p=[],g=l[f];for(let x=0,_=g.length;x<_;x++){let M=e(g[x],i);p.push(M)}n.morphAttributes[f]=p}n.morphTargetsRelative=this.morphTargetsRelative;let h=this.groups;for(let f=0,p=h.length;f<p;f++){let g=h[f];n.addGroup(g.start,g.count,g.materialIndex)}return n}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let p=this.parameters;for(let g in p)p[g]!==void 0&&(e[g]=p[g]);return e}e.data={attributes:{}};let n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});let i=this.attributes;for(let p in i){let g=i[p];e.data.attributes[p]=g.toJSON(e.data)}let o={},l=!1;for(let p in this.morphAttributes){let g=this.morphAttributes[p],x=[];for(let _=0,M=g.length;_<M;_++){let T=g[_];x.push(T.toJSON(e.data))}x.length>0&&(o[p]=x,l=!0)}l&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);let h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));let f=this.boundingSphere;return f!==null&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let n={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(n));let o=e.attributes;for(let g in o){let x=o[g];this.setAttribute(g,x.clone(n))}let l=e.morphAttributes;for(let g in l){let x=[],_=l[g];for(let M=0,T=_.length;M<T;M++)x.push(_[M].clone(n));this.morphAttributes[g]=x}this.morphTargetsRelative=e.morphTargetsRelative;let h=e.groups;for(let g=0,x=h.length;g<x;g++){let _=h[g];this.addGroup(_.start,_.count,_.materialIndex)}let f=e.boundingBox;f!==null&&(this.boundingBox=f.clone());let p=e.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Dt.prototype.isBufferGeometry=!0;let If=new Mt,Qs=new ri,sh=new qi,wo=new J,Eo=new J,So=new J,ah=new J,lh=new J,ch=new J,Ec=new J,Sc=new J,Tc=new J,Ac=new Ke,Nc=new Ke,Tr=new Ke,Rc=new J,ml=new J;class Tn extends Xt{constructor(e=new Dt,n=new Zi){super(),this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let n=e.morphAttributes,i=Object.keys(n);if(i.length>0){let o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=o.length;l<h;l++){let f=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=l}}}}else{let n=e.morphTargets;n!==void 0&&n.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,n){let i=this.geometry,o=this.material,l=this.matrixWorld;if(o===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),sh.copy(i.boundingSphere),sh.applyMatrix4(l),e.ray.intersectsSphere(sh)===!1)||(If.copy(l).invert(),Qs.copy(e.ray).applyMatrix4(If),i.boundingBox!==null&&Qs.intersectsBox(i.boundingBox)===!1))return;let h;if(i.isBufferGeometry){let f=i.index,p=i.attributes.position,g=i.morphAttributes.position,x=i.morphTargetsRelative,_=i.attributes.uv,M=i.attributes.uv2,T=i.groups,N=i.drawRange;if(f!==null)if(Array.isArray(o))for(let I=0,D=T.length;I<D;I++){let L=T[I],F=o[L.materialIndex];for(let U=Math.max(L.start,N.start),V=Math.min(f.count,Math.min(L.start+L.count,N.start+N.count));U<V;U+=3){let K=f.getX(U),re=f.getX(U+1),ve=f.getX(U+2);h=gl(this,F,e,Qs,p,g,x,_,M,K,re,ve),h&&(h.faceIndex=Math.floor(U/3),h.face.materialIndex=L.materialIndex,n.push(h))}}else for(let I=Math.max(0,N.start),D=Math.min(f.count,N.start+N.count);I<D;I+=3){let L=f.getX(I),F=f.getX(I+1),U=f.getX(I+2);h=gl(this,o,e,Qs,p,g,x,_,M,L,F,U),h&&(h.faceIndex=Math.floor(I/3),n.push(h))}else if(p!==void 0)if(Array.isArray(o))for(let I=0,D=T.length;I<D;I++){let L=T[I],F=o[L.materialIndex];for(let U=Math.max(L.start,N.start),V=Math.min(p.count,Math.min(L.start+L.count,N.start+N.count));U<V;U+=3)h=gl(this,F,e,Qs,p,g,x,_,M,U,U+1,U+2),h&&(h.faceIndex=Math.floor(U/3),h.face.materialIndex=L.materialIndex,n.push(h))}else for(let I=Math.max(0,N.start),D=Math.min(p.count,N.start+N.count);I<D;I+=3)h=gl(this,o,e,Qs,p,g,x,_,M,I,I+1,I+2),h&&(h.faceIndex=Math.floor(I/3),n.push(h))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function gl(c,e,n,i,o,l,h,f,p,g,x,_){wo.fromBufferAttribute(o,g),Eo.fromBufferAttribute(o,x),So.fromBufferAttribute(o,_);let M=c.morphTargetInfluences;if(l&&M){Ec.set(0,0,0),Sc.set(0,0,0),Tc.set(0,0,0);for(let N=0,I=l.length;N<I;N++){let D=M[N],L=l[N];D!==0&&(ah.fromBufferAttribute(L,g),lh.fromBufferAttribute(L,x),ch.fromBufferAttribute(L,_),h?(Ec.addScaledVector(ah,D),Sc.addScaledVector(lh,D),Tc.addScaledVector(ch,D)):(Ec.addScaledVector(ah.sub(wo),D),Sc.addScaledVector(lh.sub(Eo),D),Tc.addScaledVector(ch.sub(So),D)))}wo.add(Ec),Eo.add(Sc),So.add(Tc)}c.isSkinnedMesh&&(c.boneTransform(g,wo),c.boneTransform(x,Eo),c.boneTransform(_,So));let T=function(N,I,D,L,F,U,V,K){let re;if(re=I.side===1?L.intersectTriangle(V,U,F,!0,K):L.intersectTriangle(F,U,V,I.side!==2,K),re===null)return null;ml.copy(K),ml.applyMatrix4(N.matrixWorld);let ve=D.ray.origin.distanceTo(ml);return ve<D.near||ve>D.far?null:{distance:ve,point:ml.clone(),object:N}}(c,e,n,i,wo,Eo,So,Rc);if(T){f&&(Ac.fromBufferAttribute(f,g),Nc.fromBufferAttribute(f,x),Tr.fromBufferAttribute(f,_),T.uv=Sn.getUV(Rc,wo,Eo,So,Ac,Nc,Tr,new Ke)),p&&(Ac.fromBufferAttribute(p,g),Nc.fromBufferAttribute(p,x),Tr.fromBufferAttribute(p,_),T.uv2=Sn.getUV(Rc,wo,Eo,So,Ac,Nc,Tr,new Ke));let N={a:g,b:x,c:_,normal:new J,materialIndex:0};Sn.getNormal(wo,Eo,So,N.normal),T.face=N}return T}Tn.prototype.isMesh=!0;class Pi extends Dt{constructor(e=1,n=1,i=1,o=1,l=1,h=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:o,heightSegments:l,depthSegments:h};let f=this;o=Math.floor(o),l=Math.floor(l),h=Math.floor(h);let p=[],g=[],x=[],_=[],M=0,T=0;function N(I,D,L,F,U,V,K,re,ve,_e,Te){let Ee=V/ve,Ne=K/_e,ct=V/2,Je=K/2,De=re/2,Ze=ve+1,vt=_e+1,xt=0,Tt=0,Pt=new J;for(let Ct=0;Ct<vt;Ct++){let nt=Ct*Ne-Je;for(let ie=0;ie<Ze;ie++){let he=ie*Ee-ct;Pt[I]=he*F,Pt[D]=nt*U,Pt[L]=De,g.push(Pt.x,Pt.y,Pt.z),Pt[I]=0,Pt[D]=0,Pt[L]=re>0?1:-1,x.push(Pt.x,Pt.y,Pt.z),_.push(ie/ve),_.push(1-Ct/_e),xt+=1}}for(let Ct=0;Ct<_e;Ct++)for(let nt=0;nt<ve;nt++){let ie=M+nt+Ze*Ct,he=M+nt+Ze*(Ct+1),Ue=M+(nt+1)+Ze*(Ct+1),Be=M+(nt+1)+Ze*Ct;p.push(ie,he,Be),p.push(he,Ue,Be),Tt+=6}f.addGroup(T,Tt,Te),T+=Tt,M+=xt}N("z","y","x",-1,-1,i,n,e,h,l,0),N("z","y","x",1,-1,i,n,-e,h,l,1),N("x","z","y",1,1,e,i,n,o,h,2),N("x","z","y",1,-1,e,i,-n,o,h,3),N("x","y","z",1,-1,e,n,i,o,l,4),N("x","y","z",-1,-1,e,n,-i,o,l,5),this.setIndex(p),this.setAttribute("position",new At(g,3)),this.setAttribute("normal",new At(x,3)),this.setAttribute("uv",new At(_,2))}static fromJSON(e){return new Pi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ts(c){let e={};for(let n in c){e[n]={};for(let i in c[n]){let o=c[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?e[n][i]=o.clone():Array.isArray(o)?e[n][i]=o.slice():e[n][i]=o}}return e}function Rn(c){let e={};for(let n=0;n<c.length;n++){let i=ts(c[n]);for(let o in i)e[o]=i[o]}return e}let uh={clone:ts,merge:Rn};class $i extends Gn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ts(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(let o in this.uniforms){let l=this.uniforms[o].value;l&&l.isTexture?n.uniforms[o]={type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?n.uniforms[o]={type:"c",value:l.getHex()}:l&&l.isVector2?n.uniforms[o]={type:"v2",value:l.toArray()}:l&&l.isVector3?n.uniforms[o]={type:"v3",value:l.toArray()}:l&&l.isVector4?n.uniforms[o]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?n.uniforms[o]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?n.uniforms[o]={type:"m4",value:l.toArray()}:n.uniforms[o]={value:l}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;let i={};for(let o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}$i.prototype.isShaderMaterial=!0;class To extends Xt{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Mt,this.projectionMatrix=new Mt,this.projectionMatrixInverse=new Mt}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let n=this.matrixWorld.elements;return e.set(-n[8],-n[9],-n[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}To.prototype.isCamera=!0;class An extends To{constructor(e=50,n=1,i=.1,o=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let n=.5*this.getFilmHeight()/e;this.fov=2*Xo*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*qo*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Xo*Math.atan(Math.tan(.5*qo*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,n,i,o,l,h){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=l,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,n=e*Math.tan(.5*qo*this.fov)/this.zoom,i=2*n,o=this.aspect*i,l=-.5*o,h=this.view;if(this.view!==null&&this.view.enabled){let p=h.fullWidth,g=h.fullHeight;l+=h.offsetX*o/p,n-=h.offsetY*i/g,o*=h.width/p,i*=h.height/g}let f=this.filmOffset;f!==0&&(l+=e*f/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+o,n,n-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}An.prototype.isPerspectiveCamera=!0;let Ks=90;class Lc extends Xt{constructor(e,n,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;let o=new An(Ks,1,e,n);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new J(1,0,0)),this.add(o);let l=new An(Ks,1,e,n);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new J(-1,0,0)),this.add(l);let h=new An(Ks,1,e,n);h.layers=this.layers,h.up.set(0,0,1),h.lookAt(new J(0,1,0)),this.add(h);let f=new An(Ks,1,e,n);f.layers=this.layers,f.up.set(0,0,-1),f.lookAt(new J(0,-1,0)),this.add(f);let p=new An(Ks,1,e,n);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new J(0,0,1)),this.add(p);let g=new An(Ks,1,e,n);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new J(0,0,-1)),this.add(g)}update(e,n){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[o,l,h,f,p,g]=this.children,x=e.xr.enabled,_=e.getRenderTarget();e.xr.enabled=!1;let M=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(n,o),e.setRenderTarget(i,1),e.render(n,l),e.setRenderTarget(i,2),e.render(n,h),e.setRenderTarget(i,3),e.render(n,f),e.setRenderTarget(i,4),e.render(n,p),i.texture.generateMipmaps=M,e.setRenderTarget(i,5),e.render(n,g),e.setRenderTarget(_),e.xr.enabled=x}}class Ao extends Dn{constructor(e,n,i,o,l,h,f,p,g,x){super(e=e!==void 0?e:[],n=n!==void 0?n:301,i,o,l,h,f,p,g,x),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ao.prototype.isCubeTexture=!0;class ea extends lr{constructor(e,n,i){Number.isInteger(n)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),n=i),super(e,e,n),n=n||{},this.texture=new Ao(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0&&n.generateMipmaps,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.format=1023,this.texture.encoding=n.encoding,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new Pi(5,5,5),l=new $i({name:"CubemapFromEquirect",uniforms:ts(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});l.uniforms.tEquirect.value=n;let h=new Tn(o,l),f=n.minFilter;return n.minFilter===1008&&(n.minFilter=1006),new Lc(1,10,this).update(e,h),n.minFilter=f,h.geometry.dispose(),h.material.dispose(),this}clear(e,n,i,o){let l=e.getRenderTarget();for(let h=0;h<6;h++)e.setRenderTarget(this,h),e.clear(n,i,o);e.setRenderTarget(l)}}ea.prototype.isWebGLCubeRenderTarget=!0;let vl=new J,Km=new J,hh=new In;class jr{constructor(e=new J(1,0,0),n=0){this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,o){return this.normal.set(e,n,i),this.constant=o,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){let o=vl.subVectors(i,n).cross(Km.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,n){let i=e.delta(vl),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;let l=-(e.start.dot(this.normal)+this.constant)/o;return l<0||l>1?null:n.copy(i).multiplyScalar(l).add(e.start)}intersectsLine(e){let n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){let i=n||hh.getNormalMatrix(e),o=this.coplanarPoint(vl).applyMatrix4(e),l=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}jr.prototype.isPlane=!0;let Ar=new qi,Pc=new J;class yl{constructor(e=new jr,n=new jr,i=new jr,o=new jr,l=new jr,h=new jr){this.planes=[e,n,i,o,l,h]}set(e,n,i,o,l,h){let f=this.planes;return f[0].copy(e),f[1].copy(n),f[2].copy(i),f[3].copy(o),f[4].copy(l),f[5].copy(h),this}copy(e){let n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let n=this.planes,i=e.elements,o=i[0],l=i[1],h=i[2],f=i[3],p=i[4],g=i[5],x=i[6],_=i[7],M=i[8],T=i[9],N=i[10],I=i[11],D=i[12],L=i[13],F=i[14],U=i[15];return n[0].setComponents(f-o,_-p,I-M,U-D).normalize(),n[1].setComponents(f+o,_+p,I+M,U+D).normalize(),n[2].setComponents(f+l,_+g,I+T,U+L).normalize(),n[3].setComponents(f-l,_-g,I-T,U-L).normalize(),n[4].setComponents(f-h,_-x,I-N,U-F).normalize(),n[5].setComponents(f+h,_+x,I+N,U+F).normalize(),this}intersectsObject(e){let n=e.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),Ar.copy(n.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ar)}intersectsSprite(e){return Ar.center.set(0,0,0),Ar.radius=.7071067811865476,Ar.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ar)}intersectsSphere(e){let n=this.planes,i=e.center,o=-e.radius;for(let l=0;l<6;l++)if(n[l].distanceToPoint(i)<o)return!1;return!0}intersectsBox(e){let n=this.planes;for(let i=0;i<6;i++){let o=n[i];if(Pc.x=o.normal.x>0?e.max.x:e.min.x,Pc.y=o.normal.y>0?e.max.y:e.min.y,Pc.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(Pc)<0)return!1}return!0}containsPoint(e){let n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Df(){let c=null,e=!1,n=null,i=null;function o(l,h){n(l,h),i=c.requestAnimationFrame(o)}return{start:function(){e!==!0&&n!==null&&(i=c.requestAnimationFrame(o),e=!0)},stop:function(){c.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(l){n=l},setContext:function(l){c=l}}}function eg(c,e){let n=e.isWebGL2,i=new WeakMap;return{get:function(o){return o.isInterleavedBufferAttribute&&(o=o.data),i.get(o)},remove:function(o){o.isInterleavedBufferAttribute&&(o=o.data);let l=i.get(o);l&&(c.deleteBuffer(l.buffer),i.delete(o))},update:function(o,l){if(o.isGLBufferAttribute){let f=i.get(o);return void((!f||f.version<o.version)&&i.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version}))}o.isInterleavedBufferAttribute&&(o=o.data);let h=i.get(o);h===void 0?i.set(o,function(f,p){let g=f.array,x=f.usage,_=c.createBuffer();c.bindBuffer(p,_),c.bufferData(p,g,x),f.onUploadCallback();let M=5126;return g instanceof Float32Array?M=5126:g instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):g instanceof Uint16Array?f.isFloat16BufferAttribute?n?M=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):M=5123:g instanceof Int16Array?M=5122:g instanceof Uint32Array?M=5125:g instanceof Int32Array?M=5124:g instanceof Int8Array?M=5120:(g instanceof Uint8Array||g instanceof Uint8ClampedArray)&&(M=5121),{buffer:_,type:M,bytesPerElement:g.BYTES_PER_ELEMENT,version:f.version}}(o,l)):h.version<o.version&&(function(f,p,g){let x=p.array,_=p.updateRange;c.bindBuffer(g,f),_.count===-1?c.bufferSubData(g,0,x):(n?c.bufferSubData(g,_.offset*x.BYTES_PER_ELEMENT,x,_.offset,_.count):c.bufferSubData(g,_.offset*x.BYTES_PER_ELEMENT,x.subarray(_.offset,_.offset+_.count)),_.count=-1)}(h.buffer,o,l),h.version=o.version)}}}class ns extends Dt{constructor(e=1,n=1,i=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:o};let l=e/2,h=n/2,f=Math.floor(i),p=Math.floor(o),g=f+1,x=p+1,_=e/f,M=n/p,T=[],N=[],I=[],D=[];for(let L=0;L<x;L++){let F=L*M-h;for(let U=0;U<g;U++){let V=U*_-l;N.push(V,-F,0),I.push(0,0,1),D.push(U/f),D.push(1-L/p)}}for(let L=0;L<p;L++)for(let F=0;F<f;F++){let U=F+g*L,V=F+g*(L+1),K=F+1+g*(L+1),re=F+1+g*L;T.push(U,V,re),T.push(V,K,re)}this.setIndex(T),this.setAttribute("position",new At(N,3)),this.setAttribute("normal",new At(I,3)),this.setAttribute("uv",new At(D,2))}static fromJSON(e){return new ns(e.width,e.height,e.widthSegments,e.heightSegments)}}let Wt={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},dt={common:{diffuse:{value:new yt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new In},uv2Transform:{value:new In},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ke(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new yt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new yt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new In}},sprite:{diffuse:{value:new yt(16777215)},opacity:{value:1},center:{value:new Ke(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new In}}},si={basic:{uniforms:Rn([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.fog]),vertexShader:Wt.meshbasic_vert,fragmentShader:Wt.meshbasic_frag},lambert:{uniforms:Rn([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.fog,dt.lights,{emissive:{value:new yt(0)}}]),vertexShader:Wt.meshlambert_vert,fragmentShader:Wt.meshlambert_frag},phong:{uniforms:Rn([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,dt.lights,{emissive:{value:new yt(0)},specular:{value:new yt(1118481)},shininess:{value:30}}]),vertexShader:Wt.meshphong_vert,fragmentShader:Wt.meshphong_frag},standard:{uniforms:Rn([dt.common,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.roughnessmap,dt.metalnessmap,dt.fog,dt.lights,{emissive:{value:new yt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wt.meshphysical_vert,fragmentShader:Wt.meshphysical_frag},toon:{uniforms:Rn([dt.common,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.gradientmap,dt.fog,dt.lights,{emissive:{value:new yt(0)}}]),vertexShader:Wt.meshtoon_vert,fragmentShader:Wt.meshtoon_frag},matcap:{uniforms:Rn([dt.common,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,{matcap:{value:null}}]),vertexShader:Wt.meshmatcap_vert,fragmentShader:Wt.meshmatcap_frag},points:{uniforms:Rn([dt.points,dt.fog]),vertexShader:Wt.points_vert,fragmentShader:Wt.points_frag},dashed:{uniforms:Rn([dt.common,dt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wt.linedashed_vert,fragmentShader:Wt.linedashed_frag},depth:{uniforms:Rn([dt.common,dt.displacementmap]),vertexShader:Wt.depth_vert,fragmentShader:Wt.depth_frag},normal:{uniforms:Rn([dt.common,dt.bumpmap,dt.normalmap,dt.displacementmap,{opacity:{value:1}}]),vertexShader:Wt.meshnormal_vert,fragmentShader:Wt.meshnormal_frag},sprite:{uniforms:Rn([dt.sprite,dt.fog]),vertexShader:Wt.sprite_vert,fragmentShader:Wt.sprite_frag},background:{uniforms:{uvTransform:{value:new In},t2D:{value:null}},vertexShader:Wt.background_vert,fragmentShader:Wt.background_frag},cube:{uniforms:Rn([dt.envmap,{opacity:{value:1}}]),vertexShader:Wt.cube_vert,fragmentShader:Wt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Wt.equirect_vert,fragmentShader:Wt.equirect_frag},distanceRGBA:{uniforms:Rn([dt.common,dt.displacementmap,{referencePosition:{value:new J},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Wt.distanceRGBA_vert,fragmentShader:Wt.distanceRGBA_frag},shadow:{uniforms:Rn([dt.lights,dt.fog,{color:{value:new yt(0)},opacity:{value:1}}]),vertexShader:Wt.shadow_vert,fragmentShader:Wt.shadow_frag}};function tg(c,e,n,i,o){let l=new yt(0),h,f,p=0,g=null,x=0,_=null;function M(T,N){n.buffers.color.setClear(T.r,T.g,T.b,N,o)}return{getClearColor:function(){return l},setClearColor:function(T,N=1){l.set(T),p=N,M(l,p)},getClearAlpha:function(){return p},setClearAlpha:function(T){p=T,M(l,p)},render:function(T,N){let I=!1,D=N.isScene===!0?N.background:null;D&&D.isTexture&&(D=e.get(D));let L=c.xr,F=L.getSession&&L.getSession();F&&F.environmentBlendMode==="additive"&&(D=null),D===null?M(l,p):D&&D.isColor&&(M(D,1),I=!0),(c.autoClear||I)&&c.clear(c.autoClearColor,c.autoClearDepth,c.autoClearStencil),D&&(D.isCubeTexture||D.mapping===306)?(f===void 0&&(f=new Tn(new Pi(1,1,1),new $i({name:"BackgroundCubeMaterial",uniforms:ts(si.cube.uniforms),vertexShader:si.cube.vertexShader,fragmentShader:si.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(U,V,K){this.matrixWorld.copyPosition(K.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(f)),f.material.uniforms.envMap.value=D,f.material.uniforms.flipEnvMap.value=D.isCubeTexture&&D.isRenderTargetTexture===!1?-1:1,g===D&&x===D.version&&_===c.toneMapping||(f.material.needsUpdate=!0,g=D,x=D.version,_=c.toneMapping),T.unshift(f,f.geometry,f.material,0,0,null)):D&&D.isTexture&&(h===void 0&&(h=new Tn(new ns(2,2),new $i({name:"BackgroundMaterial",uniforms:ts(si.background.uniforms),vertexShader:si.background.vertexShader,fragmentShader:si.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(h)),h.material.uniforms.t2D.value=D,D.matrixAutoUpdate===!0&&D.updateMatrix(),h.material.uniforms.uvTransform.value.copy(D.matrix),g===D&&x===D.version&&_===c.toneMapping||(h.material.needsUpdate=!0,g=D,x=D.version,_=c.toneMapping),T.unshift(h,h.geometry,h.material,0,0,null))}}}function Of(c,e,n,i){let o=c.getParameter(34921),l=i.isWebGL2?null:e.get("OES_vertex_array_object"),h=i.isWebGL2||l!==null,f={},p=M(null),g=p;function x(V){return i.isWebGL2?c.bindVertexArray(V):l.bindVertexArrayOES(V)}function _(V){return i.isWebGL2?c.deleteVertexArray(V):l.deleteVertexArrayOES(V)}function M(V){let K=[],re=[],ve=[];for(let _e=0;_e<o;_e++)K[_e]=0,re[_e]=0,ve[_e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:K,enabledAttributes:re,attributeDivisors:ve,object:V,attributes:{},index:null}}function T(){let V=g.newAttributes;for(let K=0,re=V.length;K<re;K++)V[K]=0}function N(V){I(V,0)}function I(V,K){let re=g.newAttributes,ve=g.enabledAttributes,_e=g.attributeDivisors;re[V]=1,ve[V]===0&&(c.enableVertexAttribArray(V),ve[V]=1),_e[V]!==K&&((i.isWebGL2?c:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](V,K),_e[V]=K)}function D(){let V=g.newAttributes,K=g.enabledAttributes;for(let re=0,ve=K.length;re<ve;re++)K[re]!==V[re]&&(c.disableVertexAttribArray(re),K[re]=0)}function L(V,K,re,ve,_e,Te){i.isWebGL2!==!0||re!==5124&&re!==5125?c.vertexAttribPointer(V,K,re,ve,_e,Te):c.vertexAttribIPointer(V,K,re,_e,Te)}function F(){U(),g!==p&&(g=p,x(g.object))}function U(){p.geometry=null,p.program=null,p.wireframe=!1}return{setup:function(V,K,re,ve,_e){let Te=!1;if(h){let Ee=function(Ne,ct,Je){let De=Je.wireframe===!0,Ze=f[Ne.id];Ze===void 0&&(Ze={},f[Ne.id]=Ze);let vt=Ze[ct.id];vt===void 0&&(vt={},Ze[ct.id]=vt);let xt=vt[De];return xt===void 0&&(xt=M(i.isWebGL2?c.createVertexArray():l.createVertexArrayOES()),vt[De]=xt),xt}(ve,re,K);g!==Ee&&(g=Ee,x(g.object)),Te=function(Ne,ct){let Je=g.attributes,De=Ne.attributes,Ze=0;for(let vt in De){let xt=Je[vt],Tt=De[vt];if(xt===void 0||xt.attribute!==Tt||xt.data!==Tt.data)return!0;Ze++}return g.attributesNum!==Ze||g.index!==ct}(ve,_e),Te&&function(Ne,ct){let Je={},De=Ne.attributes,Ze=0;for(let vt in De){let xt=De[vt],Tt={};Tt.attribute=xt,xt.data&&(Tt.data=xt.data),Je[vt]=Tt,Ze++}g.attributes=Je,g.attributesNum=Ze,g.index=ct}(ve,_e)}else{let Ee=K.wireframe===!0;g.geometry===ve.id&&g.program===re.id&&g.wireframe===Ee||(g.geometry=ve.id,g.program=re.id,g.wireframe=Ee,Te=!0)}V.isInstancedMesh===!0&&(Te=!0),_e!==null&&n.update(_e,34963),Te&&(function(Ee,Ne,ct,Je){if(i.isWebGL2===!1&&(Ee.isInstancedMesh||Je.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;T();let De=Je.attributes,Ze=ct.getAttributes(),vt=Ne.defaultAttributeValues;for(let xt in Ze){let Tt=Ze[xt];if(Tt.location>=0){let Pt=De[xt];if(Pt===void 0&&(xt==="instanceMatrix"&&Ee.instanceMatrix&&(Pt=Ee.instanceMatrix),xt==="instanceColor"&&Ee.instanceColor&&(Pt=Ee.instanceColor)),Pt!==void 0){let Ct=Pt.normalized,nt=Pt.itemSize,ie=n.get(Pt);if(ie===void 0)continue;let he=ie.buffer,Ue=ie.type,Be=ie.bytesPerElement;if(Pt.isInterleavedBufferAttribute){let we=Pt.data,ot=we.stride,ut=Pt.offset;if(we&&we.isInstancedInterleavedBuffer){for(let Le=0;Le<Tt.locationSize;Le++)I(Tt.location+Le,we.meshPerAttribute);Ee.isInstancedMesh!==!0&&Je._maxInstanceCount===void 0&&(Je._maxInstanceCount=we.meshPerAttribute*we.count)}else for(let Le=0;Le<Tt.locationSize;Le++)N(Tt.location+Le);c.bindBuffer(34962,he);for(let Le=0;Le<Tt.locationSize;Le++)L(Tt.location+Le,nt/Tt.locationSize,Ue,Ct,ot*Be,(ut+nt/Tt.locationSize*Le)*Be)}else{if(Pt.isInstancedBufferAttribute){for(let we=0;we<Tt.locationSize;we++)I(Tt.location+we,Pt.meshPerAttribute);Ee.isInstancedMesh!==!0&&Je._maxInstanceCount===void 0&&(Je._maxInstanceCount=Pt.meshPerAttribute*Pt.count)}else for(let we=0;we<Tt.locationSize;we++)N(Tt.location+we);c.bindBuffer(34962,he);for(let we=0;we<Tt.locationSize;we++)L(Tt.location+we,nt/Tt.locationSize,Ue,Ct,nt*Be,nt/Tt.locationSize*we*Be)}}else if(vt!==void 0){let Ct=vt[xt];if(Ct!==void 0)switch(Ct.length){case 2:c.vertexAttrib2fv(Tt.location,Ct);break;case 3:c.vertexAttrib3fv(Tt.location,Ct);break;case 4:c.vertexAttrib4fv(Tt.location,Ct);break;default:c.vertexAttrib1fv(Tt.location,Ct)}}}}D()}(V,K,re,ve),_e!==null&&c.bindBuffer(34963,n.get(_e).buffer))},reset:F,resetDefaultState:U,dispose:function(){F();for(let V in f){let K=f[V];for(let re in K){let ve=K[re];for(let _e in ve)_(ve[_e].object),delete ve[_e];delete K[re]}delete f[V]}},releaseStatesOfGeometry:function(V){if(f[V.id]===void 0)return;let K=f[V.id];for(let re in K){let ve=K[re];for(let _e in ve)_(ve[_e].object),delete ve[_e];delete K[re]}delete f[V.id]},releaseStatesOfProgram:function(V){for(let K in f){let re=f[K];if(re[V.id]===void 0)continue;let ve=re[V.id];for(let _e in ve)_(ve[_e].object),delete ve[_e];delete re[V.id]}},initAttributes:T,enableAttribute:N,disableUnusedAttributes:D}}function Gf(c,e,n,i){let o=i.isWebGL2,l;this.setMode=function(h){l=h},this.render=function(h,f){c.drawArrays(l,h,f),n.update(f,l,1)},this.renderInstances=function(h,f,p){if(p===0)return;let g,x;if(o)g=c,x="drawArraysInstanced";else if(g=e.get("ANGLE_instanced_arrays"),x="drawArraysInstancedANGLE",g===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[x](l,h,f,p),n.update(f,l,p)}}function Cc(c,e,n){let i;function o(V){if(V==="highp"){if(c.getShaderPrecisionFormat(35633,36338).precision>0&&c.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";V="mediump"}return V==="mediump"&&c.getShaderPrecisionFormat(35633,36337).precision>0&&c.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let l=typeof WebGL2RenderingContext<"u"&&c instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&c instanceof WebGL2ComputeRenderingContext,h=n.precision!==void 0?n.precision:"highp",f=o(h);f!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",f,"instead."),h=f);let p=l||e.has("WEBGL_draw_buffers"),g=n.logarithmicDepthBuffer===!0,x=c.getParameter(34930),_=c.getParameter(35660),M=c.getParameter(3379),T=c.getParameter(34076),N=c.getParameter(34921),I=c.getParameter(36347),D=c.getParameter(36348),L=c.getParameter(36349),F=_>0,U=l||e.has("OES_texture_float");return{isWebGL2:l,drawBuffers:p,getMaxAnisotropy:function(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){let V=e.get("EXT_texture_filter_anisotropic");i=c.getParameter(V.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,precision:h,logarithmicDepthBuffer:g,maxTextures:x,maxVertexTextures:_,maxTextureSize:M,maxCubemapSize:T,maxAttributes:N,maxVertexUniforms:I,maxVaryings:D,maxFragmentUniforms:L,vertexTextures:F,floatFragmentTextures:U,floatVertexTextures:F&&U,maxSamples:l?c.getParameter(36183):0}}function Bf(c){let e=this,n=null,i=0,o=!1,l=!1,h=new jr,f=new In,p={value:null,needsUpdate:!1};function g(){p.value!==n&&(p.value=n,p.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function x(_,M,T,N){let I=_!==null?_.length:0,D=null;if(I!==0){if(D=p.value,N!==!0||D===null){let L=T+4*I,F=M.matrixWorldInverse;f.getNormalMatrix(F),(D===null||D.length<L)&&(D=new Float32Array(L));for(let U=0,V=T;U!==I;++U,V+=4)h.copy(_[U]).applyMatrix4(F,f),h.normal.toArray(D,V),D[V+3]=h.constant}p.value=D,p.needsUpdate=!0}return e.numPlanes=I,e.numIntersection=0,D}this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(_,M,T){let N=_.length!==0||M||i!==0||o;return o=M,n=x(_,T,0),i=_.length,N},this.beginShadows=function(){l=!0,x(null)},this.endShadows=function(){l=!1,g()},this.setState=function(_,M,T){let N=_.clippingPlanes,I=_.clipIntersection,D=_.clipShadows,L=c.get(_);if(!o||N===null||N.length===0||l&&!D)l?x(null):g();else{let F=l?0:i,U=4*F,V=L.clippingState||null;p.value=V,V=x(N,M,U,T);for(let K=0;K!==U;++K)V[K]=n[K];L.clippingState=V,this.numIntersection=I?this.numPlanes:0,this.numPlanes+=F}}}function ng(c){let e=new WeakMap;function n(o,l){return l===303?o.mapping=301:l===304&&(o.mapping=302),o}function i(o){let l=o.target;l.removeEventListener("dispose",i);let h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}return{get:function(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){let l=o.mapping;if(l===303||l===304){if(e.has(o))return n(e.get(o).texture,o.mapping);{let h=o.image;if(h&&h.height>0){let f=c.getRenderTarget(),p=new ea(h.height/2);return p.fromEquirectangularTexture(c,o),e.set(o,p),c.setRenderTarget(f),o.addEventListener("dispose",i),n(p.texture,o.mapping)}return null}}}return o},dispose:function(){e=new WeakMap}}}si.physical={uniforms:Rn([si.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ke(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new yt(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ke},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new yt(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new yt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Wt.meshphysical_vert,fragmentShader:Wt.meshphysical_frag};class Yr extends To{constructor(e=-1,n=1,i=1,o=-1,l=.1,h=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=o,this.near=l,this.far=h,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,o,l,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=l,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2,l=i-e,h=i+e,f=o+n,p=o-n;if(this.view!==null&&this.view.enabled){let g=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=g*this.view.offsetX,h=l+g*this.view.width,f-=x*this.view.offsetY,p=f-x*this.view.height}this.projectionMatrix.makeOrthographic(l,h,f,p,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}Yr.prototype.isOrthographicCamera=!0;class ta extends $i{constructor(e){super(e),this.type="RawShaderMaterial"}}ta.prototype.isRawShaderMaterial=!0;let ai=Math.pow(2,8),Ic=[.125,.215,.35,.446,.526,.582],Dc=5+Ic.length,Oc=20,No={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},dh=new Yr,{_lodPlanes:na,_sizeLods:Uf,_sigmas:Gc}=Bn(),xl=new yt,fh=null,rs=(1+Math.sqrt(5))/2,ra=1/rs,Bc=[new J(1,1,1),new J(-1,1,1),new J(1,1,-1),new J(-1,1,-1),new J(0,rs,ra),new J(0,rs,-ra),new J(ra,0,rs),new J(-ra,0,rs),new J(rs,ra,0),new J(-rs,ra,0)];class ph{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(n){let i=new Float32Array(n),o=new J(0,1,0);return new ta({name:"SphericalGaussianBlur",defines:{n},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o},inputEncoding:{value:No[3e3]},outputEncoding:{value:No[3e3]}},vertexShader:mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${ia()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(Oc),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,i=.1,o=100){fh=this._renderer.getRenderTarget();let l=this._allocateTargets();return this._sceneToCubeUV(e,i,o,l),n>0&&this._blur(l,0,0,n),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=kf(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=nr(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<na.length;e++)na[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(fh),e.scissorTest=!1,_l(e,0,0,e.width,e.height)}_fromTexture(e){fh=this._renderer.getRenderTarget();let n=this._allocateTargets(e);return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(e){let n={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:rg(e)?e.encoding:3002,depthBuffer:!1},i=Qi(n);return i.depthBuffer=!e,this._pingPongRenderTarget=Qi(n),i}_compileMaterial(e){let n=new Tn(na[0],e);this._renderer.compile(n,dh)}_sceneToCubeUV(e,n,i,o){let l=new An(90,1,n,i),h=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],p=this._renderer,g=p.autoClear,x=p.outputEncoding,_=p.toneMapping;p.getClearColor(xl),p.toneMapping=0,p.outputEncoding=3e3,p.autoClear=!1;let M=new Zi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),T=new Tn(new Pi,M),N=!1,I=e.background;I?I.isColor&&(M.color.copy(I),e.background=null,N=!0):(M.color.copy(xl),N=!0);for(let D=0;D<6;D++){let L=D%3;L==0?(l.up.set(0,h[D],0),l.lookAt(f[D],0,0)):L==1?(l.up.set(0,0,h[D]),l.lookAt(0,f[D],0)):(l.up.set(0,h[D],0),l.lookAt(0,0,f[D])),_l(o,L*ai,D>2?ai:0,ai,ai),p.setRenderTarget(o),N&&p.render(T,l),p.render(e,l)}T.geometry.dispose(),T.material.dispose(),p.toneMapping=_,p.outputEncoding=x,p.autoClear=g,e.background=I}_setEncoding(e,n){this._renderer.capabilities.isWebGL2===!0&&n.format===1023&&n.type===1009&&n.encoding===3001?e.value=No[3e3]:e.value=No[n.encoding]}_textureToCubeUV(e,n){let i=this._renderer,o=e.mapping===301||e.mapping===302;o?this._cubemapShader==null&&(this._cubemapShader=kf()):this._equirectShader==null&&(this._equirectShader=nr());let l=o?this._cubemapShader:this._equirectShader,h=new Tn(na[0],l),f=l.uniforms;f.envMap.value=e,o||f.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(f.inputEncoding,e),this._setEncoding(f.outputEncoding,n.texture),_l(n,0,0,3*ai,2*ai),i.setRenderTarget(n),i.render(h,dh)}_applyPMREM(e){let n=this._renderer,i=n.autoClear;n.autoClear=!1;for(let o=1;o<Dc;o++){let l=Math.sqrt(Gc[o]*Gc[o]-Gc[o-1]*Gc[o-1]),h=Bc[(o-1)%Bc.length];this._blur(e,o-1,o,l,h)}n.autoClear=i}_blur(e,n,i,o,l){let h=this._pingPongRenderTarget;this._halfBlur(e,h,n,i,o,"latitudinal",l),this._halfBlur(h,e,i,i,o,"longitudinal",l)}_halfBlur(e,n,i,o,l,h,f){let p=this._renderer,g=this._blurMaterial;h!=="latitudinal"&&h!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let x=new Tn(na[o],g),_=g.uniforms,M=Uf[i]-1,T=isFinite(l)?Math.PI/(2*M):2*Math.PI/39,N=l/T,I=isFinite(l)?1+Math.floor(3*N):Oc;I>Oc&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${I} samples when the maximum is set to 20`);let D=[],L=0;for(let U=0;U<Oc;++U){let V=U/N,K=Math.exp(-V*V/2);D.push(K),U==0?L+=K:U<I&&(L+=2*K)}for(let U=0;U<D.length;U++)D[U]=D[U]/L;_.envMap.value=e.texture,_.samples.value=I,_.weights.value=D,_.latitudinal.value=h==="latitudinal",f&&(_.poleAxis.value=f),_.dTheta.value=T,_.mipInt.value=8-i,this._setEncoding(_.inputEncoding,e.texture),this._setEncoding(_.outputEncoding,e.texture);let F=Uf[o];_l(n,3*Math.max(0,ai-2*F),(o===0?0:2*ai)+2*F*(o>4?o-8+4:0),3*F,2*F),p.setRenderTarget(n),p.render(x,dh)}}function rg(c){return c!==void 0&&c.type===1009&&(c.encoding===3e3||c.encoding===3001||c.encoding===3007)}function Bn(){let c=[],e=[],n=[],i=8;for(let o=0;o<Dc;o++){let l=Math.pow(2,i);e.push(l);let h=1/l;o>4?h=Ic[o-8+4-1]:o==0&&(h=0),n.push(h);let f=1/(l-1),p=-f/2,g=1+f/2,x=[p,p,g,p,g,g,p,p,g,g,p,g],_=6,M=6,T=3,N=2,I=1,D=new Float32Array(T*M*_),L=new Float32Array(N*M*_),F=new Float32Array(I*M*_);for(let V=0;V<_;V++){let K=V%3*2/3-1,re=V>2?0:-1,ve=[K,re,0,K+2/3,re,0,K+2/3,re+1,0,K,re,0,K+2/3,re+1,0,K,re+1,0];D.set(ve,T*M*V),L.set(x,N*M*V);let _e=[V,V,V,V,V,V];F.set(_e,I*M*V)}let U=new Dt;U.setAttribute("position",new Jt(D,T)),U.setAttribute("uv",new Jt(L,N)),U.setAttribute("faceIndex",new Jt(F,I)),c.push(U),i>4&&i--}return{_lodPlanes:c,_sizeLods:e,_sigmas:n}}function Qi(c){let e=new lr(3*ai,3*ai,c);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _l(c,e,n,i,o){c.viewport.set(e,n,i,o),c.scissor.set(e,n,i,o)}function nr(){let c=new Ke(1,1);return new ta({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:c},inputEncoding:{value:No[3e3]},outputEncoding:{value:No[3e3]}},vertexShader:mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${ia()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function kf(){return new ta({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:No[3e3]},outputEncoding:{value:No[3e3]}},vertexShader:mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${ia()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function mh(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ia(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function gh(c){let e=new WeakMap,n=null;function i(o){let l=o.target;l.removeEventListener("dispose",i);let h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}return{get:function(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){let l=o.mapping,h=l===303||l===304,f=l===301||l===302;if(h||f){if(e.has(o))return e.get(o).texture;{let p=o.image;if(h&&p&&p.height>0||f&&p&&function(g){let x=0,_=6;for(let M=0;M<_;M++)g[M]!==void 0&&x++;return x===_}(p)){let g=c.getRenderTarget();n===null&&(n=new ph(c));let x=h?n.fromEquirectangular(o):n.fromCubemap(o);return e.set(o,x),c.setRenderTarget(g),o.addEventListener("dispose",i),x.texture}return null}}}return o},dispose:function(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}}}function Ff(c){let e={};function n(i){if(e[i]!==void 0)return e[i];let o;switch(i){case"WEBGL_depth_texture":o=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=c.getExtension("WEBGL_compressed_texture_pvrtc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=c.getExtension(i)}return e[i]=o,o}return{has:function(i){return n(i)!==null},init:function(i){i.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(i){let o=n(i);return o===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function ig(c,e,n,i){let o={},l=new WeakMap;function h(p){let g=p.target;g.index!==null&&e.remove(g.index);for(let _ in g.attributes)e.remove(g.attributes[_]);g.removeEventListener("dispose",h),delete o[g.id];let x=l.get(g);x&&(e.remove(x),l.delete(g)),i.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,n.memory.geometries--}function f(p){let g=[],x=p.index,_=p.attributes.position,M=0;if(x!==null){let I=x.array;M=x.version;for(let D=0,L=I.length;D<L;D+=3){let F=I[D+0],U=I[D+1],V=I[D+2];g.push(F,U,U,V,V,F)}}else{let I=_.array;M=_.version;for(let D=0,L=I.length/3-1;D<L;D+=3){let F=D+0,U=D+1,V=D+2;g.push(F,U,U,V,V,F)}}let T=new(wf(g)>65535?Mc:Li)(g,1);T.version=M;let N=l.get(p);N&&e.remove(N),l.set(p,T)}return{get:function(p,g){return o[g.id]===!0||(g.addEventListener("dispose",h),o[g.id]=!0,n.memory.geometries++),g},update:function(p){let g=p.attributes;for(let _ in g)e.update(g[_],34962);let x=p.morphAttributes;for(let _ in x){let M=x[_];for(let T=0,N=M.length;T<N;T++)e.update(M[T],34962)}},getWireframeAttribute:function(p){let g=l.get(p);if(g){let x=p.index;x!==null&&g.version<x.version&&f(p)}else f(p);return l.get(p)}}}function og(c,e,n,i){let o=i.isWebGL2,l,h,f;this.setMode=function(p){l=p},this.setIndex=function(p){h=p.type,f=p.bytesPerElement},this.render=function(p,g){c.drawElements(l,g,h,p*f),n.update(g,l,1)},this.renderInstances=function(p,g,x){if(x===0)return;let _,M;if(o)_=c,M="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),M="drawElementsInstancedANGLE",_===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");_[M](l,g,h,p*f,x),n.update(g,l,x)}}function sg(c){let e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,o){switch(e.calls++,i){case 4:e.triangles+=o*(n/3);break;case 1:e.lines+=o*(n/2);break;case 3:e.lines+=o*(n-1);break;case 2:e.lines+=o*n;break;case 0:e.points+=o*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class bl extends Dn{constructor(e=null,n=1,i=1,o=1){super(null),this.image={data:e,width:n,height:i,depth:o},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function ag(c,e){return c[0]-e[0]}function lg(c,e){return Math.abs(e[1])-Math.abs(c[1])}function Ml(c,e){let n=1,i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),c.divideScalar(n)}function oa(c,e,n){let i={},o=new Float32Array(8),l=new WeakMap,h=new J,f=[];for(let p=0;p<8;p++)f[p]=[p,0];return{update:function(p,g,x,_){let M=p.morphTargetInfluences;if(e.isWebGL2===!0){let T=g.morphAttributes.position.length,N=l.get(g);if(N===void 0||N.count!==T){N!==void 0&&N.texture.dispose();let L=g.morphAttributes.normal!==void 0,F=g.morphAttributes.position,U=g.morphAttributes.normal||[],V=L===!0?2:1,K=g.attributes.position.count*V,re=1;K>e.maxTextureSize&&(re=Math.ceil(K/e.maxTextureSize),K=e.maxTextureSize);let ve=new Float32Array(K*re*4*T),_e=new bl(ve,K,re,T);_e.format=1023,_e.type=1015;let Te=4*V;for(let Ee=0;Ee<T;Ee++){let Ne=F[Ee],ct=U[Ee],Je=K*re*4*Ee;for(let De=0;De<Ne.count;De++){h.fromBufferAttribute(Ne,De),Ne.normalized===!0&&Ml(h,Ne);let Ze=De*Te;ve[Je+Ze+0]=h.x,ve[Je+Ze+1]=h.y,ve[Je+Ze+2]=h.z,ve[Je+Ze+3]=0,L===!0&&(h.fromBufferAttribute(ct,De),ct.normalized===!0&&Ml(h,ct),ve[Je+Ze+4]=h.x,ve[Je+Ze+5]=h.y,ve[Je+Ze+6]=h.z,ve[Je+Ze+7]=0)}}N={count:T,texture:_e,size:new Ke(K,re)},l.set(g,N)}let I=0;for(let L=0;L<M.length;L++)I+=M[L];let D=g.morphTargetsRelative?1:1-I;_.getUniforms().setValue(c,"morphTargetBaseInfluence",D),_.getUniforms().setValue(c,"morphTargetInfluences",M),_.getUniforms().setValue(c,"morphTargetsTexture",N.texture,n),_.getUniforms().setValue(c,"morphTargetsTextureSize",N.size)}else{let T=M===void 0?0:M.length,N=i[g.id];if(N===void 0||N.length!==T){N=[];for(let U=0;U<T;U++)N[U]=[U,0];i[g.id]=N}for(let U=0;U<T;U++){let V=N[U];V[0]=U,V[1]=M[U]}N.sort(lg);for(let U=0;U<8;U++)U<T&&N[U][1]?(f[U][0]=N[U][0],f[U][1]=N[U][1]):(f[U][0]=Number.MAX_SAFE_INTEGER,f[U][1]=0);f.sort(ag);let I=g.morphAttributes.position,D=g.morphAttributes.normal,L=0;for(let U=0;U<8;U++){let V=f[U],K=V[0],re=V[1];K!==Number.MAX_SAFE_INTEGER&&re?(I&&g.getAttribute("morphTarget"+U)!==I[K]&&g.setAttribute("morphTarget"+U,I[K]),D&&g.getAttribute("morphNormal"+U)!==D[K]&&g.setAttribute("morphNormal"+U,D[K]),o[U]=re,L+=re):(I&&g.hasAttribute("morphTarget"+U)===!0&&g.deleteAttribute("morphTarget"+U),D&&g.hasAttribute("morphNormal"+U)===!0&&g.deleteAttribute("morphNormal"+U),o[U]=0)}let F=g.morphTargetsRelative?1:1-L;_.getUniforms().setValue(c,"morphTargetBaseInfluence",F),_.getUniforms().setValue(c,"morphTargetInfluences",o)}}}}function cg(c,e,n,i){let o=new WeakMap;function l(h){let f=h.target;f.removeEventListener("dispose",l),n.remove(f.instanceMatrix),f.instanceColor!==null&&n.remove(f.instanceColor)}return{update:function(h){let f=i.render.frame,p=h.geometry,g=e.get(h,p);return o.get(g)!==f&&(e.update(g),o.set(g,f)),h.isInstancedMesh&&(h.hasEventListener("dispose",l)===!1&&h.addEventListener("dispose",l),n.update(h.instanceMatrix,34962),h.instanceColor!==null&&n.update(h.instanceColor,34962)),g},dispose:function(){o=new WeakMap}}}bl.prototype.isDataTexture2DArray=!0;class vh extends Dn{constructor(e=null,n=1,i=1,o=1){super(null),this.image={data:e,width:n,height:i,depth:o},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}vh.prototype.isDataTexture3D=!0;let sa=new Dn,yh=new bl,zf=new vh,xh=new Ao,_h=[],bh=[],Mh=new Float32Array(16),wh=new Float32Array(9),Eh=new Float32Array(4);function rr(c,e,n){let i=c[0];if(i<=0||i>0)return c;let o=e*n,l=_h[o];if(l===void 0&&(l=new Float32Array(o),_h[o]=l),e!==0){i.toArray(l,0);for(let h=1,f=0;h!==e;++h)f+=n,c[h].toArray(l,f)}return l}function ir(c,e){if(c.length!==e.length)return!1;for(let n=0,i=c.length;n<i;n++)if(c[n]!==e[n])return!1;return!0}function er(c,e){for(let n=0,i=e.length;n<i;n++)c[n]=e[n]}function or(c,e){let n=bh[e];n===void 0&&(n=new Int32Array(e),bh[e]=n);for(let i=0;i!==e;++i)n[i]=c.allocateTextureUnit();return n}function Hf(c,e){let n=this.cache;n[0]!==e&&(c.uniform1f(this.addr,e),n[0]=e)}function Mn(c,e){let n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y||(c.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ir(n,e))return;c.uniform2fv(this.addr,e),er(n,e)}}function Uc(c,e){let n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(c.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(c.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ir(n,e))return;c.uniform3fv(this.addr,e),er(n,e)}}function Sh(c,e){let n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(c.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ir(n,e))return;c.uniform4fv(this.addr,e),er(n,e)}}function Vf(c,e){let n=this.cache,i=e.elements;if(i===void 0){if(ir(n,e))return;c.uniformMatrix2fv(this.addr,!1,e),er(n,e)}else{if(ir(n,i))return;Eh.set(i),c.uniformMatrix2fv(this.addr,!1,Eh),er(n,i)}}function li(c,e){let n=this.cache,i=e.elements;if(i===void 0){if(ir(n,e))return;c.uniformMatrix3fv(this.addr,!1,e),er(n,e)}else{if(ir(n,i))return;wh.set(i),c.uniformMatrix3fv(this.addr,!1,wh),er(n,i)}}function ug(c,e){let n=this.cache,i=e.elements;if(i===void 0){if(ir(n,e))return;c.uniformMatrix4fv(this.addr,!1,e),er(n,e)}else{if(ir(n,i))return;Mh.set(i),c.uniformMatrix4fv(this.addr,!1,Mh),er(n,i)}}function hg(c,e){let n=this.cache;n[0]!==e&&(c.uniform1i(this.addr,e),n[0]=e)}function dg(c,e){let n=this.cache;ir(n,e)||(c.uniform2iv(this.addr,e),er(n,e))}function Wf(c,e){let n=this.cache;ir(n,e)||(c.uniform3iv(this.addr,e),er(n,e))}function kc(c,e){let n=this.cache;ir(n,e)||(c.uniform4iv(this.addr,e),er(n,e))}function is(c,e){let n=this.cache;n[0]!==e&&(c.uniform1ui(this.addr,e),n[0]=e)}function Fc(c,e){let n=this.cache;ir(n,e)||(c.uniform2uiv(this.addr,e),er(n,e))}function aa(c,e){let n=this.cache;ir(n,e)||(c.uniform3uiv(this.addr,e),er(n,e))}function Th(c,e){let n=this.cache;ir(n,e)||(c.uniform4uiv(this.addr,e),er(n,e))}function zc(c,e,n){let i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(c.uniform1i(this.addr,o),i[0]=o),n.safeSetTexture2D(e||sa,o)}function Hc(c,e,n){let i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(c.uniform1i(this.addr,o),i[0]=o),n.setTexture3D(e||zf,o)}function Ah(c,e,n){let i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(c.uniform1i(this.addr,o),i[0]=o),n.safeSetTextureCube(e||xh,o)}function jf(c,e,n){let i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(c.uniform1i(this.addr,o),i[0]=o),n.setTexture2DArray(e||yh,o)}function Yf(c,e){c.uniform1fv(this.addr,e)}function qf(c,e){let n=rr(e,this.size,2);c.uniform2fv(this.addr,n)}function Xf(c,e){let n=rr(e,this.size,3);c.uniform3fv(this.addr,n)}function fg(c,e){let n=rr(e,this.size,4);c.uniform4fv(this.addr,n)}function pg(c,e){let n=rr(e,this.size,4);c.uniformMatrix2fv(this.addr,!1,n)}function Nr(c,e){let n=rr(e,this.size,9);c.uniformMatrix3fv(this.addr,!1,n)}function mg(c,e){let n=rr(e,this.size,16);c.uniformMatrix4fv(this.addr,!1,n)}function Jf(c,e){c.uniform1iv(this.addr,e)}function Nh(c,e){c.uniform2iv(this.addr,e)}function wl(c,e){c.uniform3iv(this.addr,e)}function Zf(c,e){c.uniform4iv(this.addr,e)}function gg(c,e){c.uniform1uiv(this.addr,e)}function vg(c,e){c.uniform2uiv(this.addr,e)}function $f(c,e){c.uniform3uiv(this.addr,e)}function yg(c,e){c.uniform4uiv(this.addr,e)}function xg(c,e,n){let i=e.length,o=or(n,i);c.uniform1iv(this.addr,o);for(let l=0;l!==i;++l)n.safeSetTexture2D(e[l]||sa,o[l])}function _g(c,e,n){let i=e.length,o=or(n,i);c.uniform1iv(this.addr,o);for(let l=0;l!==i;++l)n.safeSetTextureCube(e[l]||xh,o[l])}function Qf(c,e,n){this.id=c,this.addr=n,this.cache=[],this.setValue=function(i){switch(i){case 5126:return Hf;case 35664:return Mn;case 35665:return Uc;case 35666:return Sh;case 35674:return Vf;case 35675:return li;case 35676:return ug;case 5124:case 35670:return hg;case 35667:case 35671:return dg;case 35668:case 35672:return Wf;case 35669:case 35673:return kc;case 5125:return is;case 36294:return Fc;case 36295:return aa;case 36296:return Th;case 35678:case 36198:case 36298:case 36306:case 35682:return zc;case 35679:case 36299:case 36307:return Hc;case 35680:case 36300:case 36308:case 36293:return Ah;case 36289:case 36303:case 36311:case 36292:return jf}}(e.type)}function os(c,e,n){this.id=c,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(i){switch(i){case 5126:return Yf;case 35664:return qf;case 35665:return Xf;case 35666:return fg;case 35674:return pg;case 35675:return Nr;case 35676:return mg;case 5124:case 35670:return Jf;case 35667:case 35671:return Nh;case 35668:case 35672:return wl;case 35669:case 35673:return Zf;case 5125:return gg;case 36294:return vg;case 36295:return $f;case 36296:return yg;case 35678:case 36198:case 36298:case 36306:case 35682:return xg;case 35680:case 36300:case 36308:case 36293:return _g}}(e.type)}function Vc(c){this.id=c,this.seq=[],this.map={}}os.prototype.updateCache=function(c){let e=this.cache;c instanceof Float32Array&&e.length!==c.length&&(this.cache=new Float32Array(c.length)),er(e,c)},Vc.prototype.setValue=function(c,e,n){let i=this.seq;for(let o=0,l=i.length;o!==l;++o){let h=i[o];h.setValue(c,e[h.id],n)}};let El=/(\w+)(\])?(\[|\.)?/g;function Wc(c,e){c.seq.push(e),c.map[e.id]=e}function Kf(c,e,n){let i=c.name,o=i.length;for(El.lastIndex=0;;){let l=El.exec(i),h=El.lastIndex,f=l[1],p=l[2]==="]",g=l[3];if(p&&(f|=0),g===void 0||g==="["&&h+2===o){Wc(n,g===void 0?new Qf(f,c,e):new os(f,c,e));break}{let x=n.map[f];x===void 0&&(x=new Vc(f),Wc(n,x)),n=x}}}function Ki(c,e){this.seq=[],this.map={};let n=c.getProgramParameter(e,35718);for(let i=0;i<n;++i){let o=c.getActiveUniform(e,i);Kf(o,c.getUniformLocation(e,o.name),this)}}function Rh(c,e,n){let i=c.createShader(e);return c.shaderSource(i,n),c.compileShader(i),i}Ki.prototype.setValue=function(c,e,n,i){let o=this.map[e];o!==void 0&&o.setValue(c,n,i)},Ki.prototype.setOptional=function(c,e,n){let i=e[n];i!==void 0&&this.setValue(c,n,i)},Ki.upload=function(c,e,n,i){for(let o=0,l=e.length;o!==l;++o){let h=e[o],f=n[h.id];f.needsUpdate!==!1&&h.setValue(c,f.value,i)}},Ki.seqWithValue=function(c,e){let n=[];for(let i=0,o=c.length;i!==o;++i){let l=c[i];l.id in e&&n.push(l)}return n};let ep=0;function Lh(c){switch(c){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",c),["Linear","( value )"]}}function Ph(c,e,n){let i=c.getShaderParameter(e,35713),o=c.getShaderInfoLog(e).trim();return i&&o===""?"":n.toUpperCase()+`

`+o+`

`+function(l){let h=l.split(`
`);for(let f=0;f<h.length;f++)h[f]=f+1+": "+h[f];return h.join(`
`)}(c.getShaderSource(e))}function Ro(c,e){let n=Lh(e);return"vec4 "+c+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function jc(c,e){let n=Lh(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Yc(c,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+c+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function la(c){return c!==""}function Ch(c,e){return c.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ih(c,e){return c.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}let tp=/^[ \t]*#include +<([\w\d./]+)>/gm;function Dh(c){return c.replace(tp,bg)}function bg(c,e){let n=Wt[e];if(n===void 0)throw new Error("Can not resolve #include <"+e+">");return Dh(n)}let np=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Mg=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Sl(c){return c.replace(Mg,rp).replace(np,wg)}function wg(c,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),rp(c,e,n,i)}function rp(c,e,n,i){let o="";for(let l=parseInt(e);l<parseInt(n);l++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return o}function ip(c){let e="precision "+c.precision+` float;
precision `+c.precision+" int;";return c.precision==="highp"?e+=`
#define HIGH_PRECISION`:c.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:c.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function op(c,e,n,i){let o=c.getContext(),l=n.defines,h=n.vertexShader,f=n.fragmentShader,p=function(_e){let Te="SHADOWMAP_TYPE_BASIC";return _e.shadowMapType===1?Te="SHADOWMAP_TYPE_PCF":_e.shadowMapType===2?Te="SHADOWMAP_TYPE_PCF_SOFT":_e.shadowMapType===3&&(Te="SHADOWMAP_TYPE_VSM"),Te}(n),g=function(_e){let Te="ENVMAP_TYPE_CUBE";if(_e.envMap)switch(_e.envMapMode){case 301:case 302:Te="ENVMAP_TYPE_CUBE";break;case 306:case 307:Te="ENVMAP_TYPE_CUBE_UV"}return Te}(n),x=function(_e){let Te="ENVMAP_MODE_REFLECTION";if(_e.envMap)switch(_e.envMapMode){case 302:case 307:Te="ENVMAP_MODE_REFRACTION"}return Te}(n),_=function(_e){let Te="ENVMAP_BLENDING_NONE";if(_e.envMap)switch(_e.combine){case 0:Te="ENVMAP_BLENDING_MULTIPLY";break;case 1:Te="ENVMAP_BLENDING_MIX";break;case 2:Te="ENVMAP_BLENDING_ADD"}return Te}(n),M=c.gammaFactor>0?c.gammaFactor:1,T=n.isWebGL2?"":function(_e){return[_e.extensionDerivatives||_e.envMapCubeUV||_e.bumpMap||_e.tangentSpaceNormalMap||_e.clearcoatNormalMap||_e.flatShading||_e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(_e.extensionFragDepth||_e.logarithmicDepthBuffer)&&_e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",_e.extensionDrawBuffers&&_e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(_e.extensionShaderTextureLOD||_e.envMap||_e.transmission)&&_e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(la).join(`
`)}(n),N=function(_e){let Te=[];for(let Ee in _e){let Ne=_e[Ee];Ne!==!1&&Te.push("#define "+Ee+" "+Ne)}return Te.join(`
`)}(l),I=o.createProgram(),D,L,F=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(D=[N].filter(la).join(`
`),D.length>0&&(D+=`
`),L=[T,N].filter(la).join(`
`),L.length>0&&(L+=`
`)):(D=[ip(n),"#define SHADER_NAME "+n.shaderName,N,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+M,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+x:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+p:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(la).join(`
`),L=[T,ip(n),"#define SHADER_NAME "+n.shaderName,N,"#define GAMMA_FACTOR "+M,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.envMap?"#define "+x:"",n.envMap?"#define "+_:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+p:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==0?"#define TONE_MAPPING":"",n.toneMapping!==0?Wt.tonemapping_pars_fragment:"",n.toneMapping!==0?Yc("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===1022?"#define OPAQUE":"",Wt.encodings_pars_fragment,n.map?Ro("mapTexelToLinear",n.mapEncoding):"",n.matcap?Ro("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Ro("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Ro("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularColorMap?Ro("specularColorMapTexelToLinear",n.specularColorMapEncoding):"",n.sheenColorMap?Ro("sheenColorMapTexelToLinear",n.sheenColorMapEncoding):"",n.lightMap?Ro("lightMapTexelToLinear",n.lightMapEncoding):"",jc("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(la).join(`
`)),h=Dh(h),h=Ch(h,n),h=Ih(h,n),f=Dh(f),f=Ch(f,n),f=Ih(f,n),h=Sl(h),f=Sl(f),n.isWebGL2&&n.isRawShaderMaterial!==!0&&(F=`#version 300 es
`,D=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+D,L=["#define varying in",n.glslVersion===zr?"":"out highp vec4 pc_fragColor;",n.glslVersion===zr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+L);let U=F+L+f,V=Rh(o,35633,F+D+h),K=Rh(o,35632,U);if(o.attachShader(I,V),o.attachShader(I,K),n.index0AttributeName!==void 0?o.bindAttribLocation(I,0,n.index0AttributeName):n.morphTargets===!0&&o.bindAttribLocation(I,0,"position"),o.linkProgram(I),c.debug.checkShaderErrors){let _e=o.getProgramInfoLog(I).trim(),Te=o.getShaderInfoLog(V).trim(),Ee=o.getShaderInfoLog(K).trim(),Ne=!0,ct=!0;if(o.getProgramParameter(I,35714)===!1){Ne=!1;let Je=Ph(o,V,"vertex"),De=Ph(o,K,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(I,35715)+`

Program Info Log: `+_e+`
`+Je+`
`+De)}else _e!==""?console.warn("THREE.WebGLProgram: Program Info Log:",_e):Te!==""&&Ee!==""||(ct=!1);ct&&(this.diagnostics={runnable:Ne,programLog:_e,vertexShader:{log:Te,prefix:D},fragmentShader:{log:Ee,prefix:L}})}let re,ve;return o.deleteShader(V),o.deleteShader(K),this.getUniforms=function(){return re===void 0&&(re=new Ki(o,I)),re},this.getAttributes=function(){return ve===void 0&&(ve=function(_e,Te){let Ee={},Ne=_e.getProgramParameter(Te,35721);for(let ct=0;ct<Ne;ct++){let Je=_e.getActiveAttrib(Te,ct),De=Je.name,Ze=1;Je.type===35674&&(Ze=2),Je.type===35675&&(Ze=3),Je.type===35676&&(Ze=4),Ee[De]={type:Je.type,location:_e.getAttribLocation(Te,De),locationSize:Ze}}return Ee}(o,I)),ve},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(I),this.program=void 0},this.name=n.shaderName,this.id=ep++,this.cacheKey=e,this.usedTimes=1,this.program=I,this.vertexShader=V,this.fragmentShader=K,this}function ca(c,e,n,i,o,l,h){let f=[],p=o.isWebGL2,g=o.logarithmicDepthBuffer,x=o.floatVertexTextures,_=o.maxVertexUniforms,M=o.vertexTextures,T=o.precision,N={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},I=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function D(L){let F;return L&&L.isTexture?F=L.encoding:L&&L.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),F=L.texture.encoding):F=3e3,p&&L&&L.isTexture&&L.format===1023&&L.type===1009&&L.encoding===3001&&(F=3e3),F}return{getParameters:function(L,F,U,V,K){let re=V.fog,ve=L.isMeshStandardMaterial?V.environment:null,_e=(L.isMeshStandardMaterial?n:e).get(L.envMap||ve),Te=N[L.type],Ee=K.isSkinnedMesh?function(vt){let xt=vt.skeleton.bones;if(x)return 1024;{let Tt=_,Pt=Math.floor((Tt-20)/4),Ct=Math.min(Pt,xt.length);return Ct<xt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+xt.length+" bones. This GPU supports "+Ct+"."),0):Ct}}(K):0,Ne,ct;if(L.precision!==null&&(T=o.getMaxPrecision(L.precision),T!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",T,"instead.")),Te){let vt=si[Te];Ne=vt.vertexShader,ct=vt.fragmentShader}else Ne=L.vertexShader,ct=L.fragmentShader;let Je=c.getRenderTarget(),De=L.alphaTest>0,Ze=L.clearcoat>0;return{isWebGL2:p,shaderID:Te,shaderName:L.type,vertexShader:Ne,fragmentShader:ct,defines:L.defines,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:T,instancing:K.isInstancedMesh===!0,instancingColor:K.isInstancedMesh===!0&&K.instanceColor!==null,supportsVertexTextures:M,outputEncoding:Je!==null?D(Je.texture):c.outputEncoding,map:!!L.map,mapEncoding:D(L.map),matcap:!!L.matcap,matcapEncoding:D(L.matcap),envMap:!!_e,envMapMode:_e&&_e.mapping,envMapEncoding:D(_e),envMapCubeUV:!!_e&&(_e.mapping===306||_e.mapping===307),lightMap:!!L.lightMap,lightMapEncoding:D(L.lightMap),aoMap:!!L.aoMap,emissiveMap:!!L.emissiveMap,emissiveMapEncoding:D(L.emissiveMap),bumpMap:!!L.bumpMap,normalMap:!!L.normalMap,objectSpaceNormalMap:L.normalMapType===1,tangentSpaceNormalMap:L.normalMapType===0,clearcoat:Ze,clearcoatMap:Ze&&!!L.clearcoatMap,clearcoatRoughnessMap:Ze&&!!L.clearcoatRoughnessMap,clearcoatNormalMap:Ze&&!!L.clearcoatNormalMap,displacementMap:!!L.displacementMap,roughnessMap:!!L.roughnessMap,metalnessMap:!!L.metalnessMap,specularMap:!!L.specularMap,specularIntensityMap:!!L.specularIntensityMap,specularColorMap:!!L.specularColorMap,specularColorMapEncoding:D(L.specularColorMap),alphaMap:!!L.alphaMap,alphaTest:De,gradientMap:!!L.gradientMap,sheen:L.sheen>0,sheenColorMap:!!L.sheenColorMap,sheenColorMapEncoding:D(L.sheenColorMap),sheenRoughnessMap:!!L.sheenRoughnessMap,transmission:L.transmission>0,transmissionMap:!!L.transmissionMap,thicknessMap:!!L.thicknessMap,combine:L.combine,vertexTangents:!!L.normalMap&&!!K.geometry&&!!K.geometry.attributes.tangent,vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!K.geometry&&!!K.geometry.attributes.color&&K.geometry.attributes.color.itemSize===4,vertexUvs:!!L.map||!!L.bumpMap||!!L.normalMap||!!L.specularMap||!!L.alphaMap||!!L.emissiveMap||!!L.roughnessMap||!!L.metalnessMap||!!L.clearcoatMap||!!L.clearcoatRoughnessMap||!!L.clearcoatNormalMap||!!L.displacementMap||!!L.transmissionMap||!!L.thicknessMap||!!L.specularIntensityMap||!!L.specularColorMap||!!L.sheenColorMap||L.sheenRoughnessMap,uvsVertexOnly:!(L.map||L.bumpMap||L.normalMap||L.specularMap||L.alphaMap||L.emissiveMap||L.roughnessMap||L.metalnessMap||L.clearcoatNormalMap||L.transmission>0||L.transmissionMap||L.thicknessMap||L.specularIntensityMap||L.specularColorMap||!!L.sheen>0||L.sheenColorMap||L.sheenRoughnessMap||!L.displacementMap),fog:!!re,useFog:L.fog,fogExp2:re&&re.isFogExp2,flatShading:!!L.flatShading,sizeAttenuation:L.sizeAttenuation,logarithmicDepthBuffer:g,skinning:K.isSkinnedMesh===!0&&Ee>0,maxBones:Ee,useVertexTexture:x,morphTargets:!!K.geometry&&!!K.geometry.morphAttributes.position,morphNormals:!!K.geometry&&!!K.geometry.morphAttributes.normal,morphTargetsCount:K.geometry&&K.geometry.morphAttributes.position?K.geometry.morphAttributes.position.length:0,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numDirLightShadows:F.directionalShadowMap.length,numPointLightShadows:F.pointShadowMap.length,numSpotLightShadows:F.spotShadowMap.length,numClippingPlanes:h.numPlanes,numClipIntersection:h.numIntersection,format:L.format,dithering:L.dithering,shadowMapEnabled:c.shadowMap.enabled&&U.length>0,shadowMapType:c.shadowMap.type,toneMapping:L.toneMapped?c.toneMapping:0,physicallyCorrectLights:c.physicallyCorrectLights,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===2,flipSided:L.side===1,depthPacking:L.depthPacking!==void 0&&L.depthPacking,index0AttributeName:L.index0AttributeName,extensionDerivatives:L.extensions&&L.extensions.derivatives,extensionFragDepth:L.extensions&&L.extensions.fragDepth,extensionDrawBuffers:L.extensions&&L.extensions.drawBuffers,extensionShaderTextureLOD:L.extensions&&L.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||i.has("EXT_shader_texture_lod"),customProgramCacheKey:L.customProgramCacheKey()}},getProgramCacheKey:function(L){let F=[];if(L.shaderID?F.push(L.shaderID):(F.push(Ef(L.fragmentShader)),F.push(Ef(L.vertexShader))),L.defines!==void 0)for(let U in L.defines)F.push(U),F.push(L.defines[U]);if(L.isRawShaderMaterial===!1){for(let U=0;U<I.length;U++)F.push(L[I[U]]);F.push(c.outputEncoding),F.push(c.gammaFactor)}return F.push(L.customProgramCacheKey),F.join()},getUniforms:function(L){let F=N[L.type],U;if(F){let V=si[F];U=uh.clone(V.uniforms)}else U=L.uniforms;return U},acquireProgram:function(L,F){let U;for(let V=0,K=f.length;V<K;V++){let re=f[V];if(re.cacheKey===F){U=re,++U.usedTimes;break}}return U===void 0&&(U=new op(c,F,L,l),f.push(U)),U},releaseProgram:function(L){if(--L.usedTimes==0){let F=f.indexOf(L);f[F]=f[f.length-1],f.pop(),L.destroy()}},programs:f}}function qc(){let c=new WeakMap;return{get:function(e){let n=c.get(e);return n===void 0&&(n={},c.set(e,n)),n},remove:function(e){c.delete(e)},update:function(e,n,i){c.get(e)[n]=i},dispose:function(){c=new WeakMap}}}function sp(c,e){return c.groupOrder!==e.groupOrder?c.groupOrder-e.groupOrder:c.renderOrder!==e.renderOrder?c.renderOrder-e.renderOrder:c.program!==e.program?c.program.id-e.program.id:c.material.id!==e.material.id?c.material.id-e.material.id:c.z!==e.z?c.z-e.z:c.id-e.id}function Oh(c,e){return c.groupOrder!==e.groupOrder?c.groupOrder-e.groupOrder:c.renderOrder!==e.renderOrder?c.renderOrder-e.renderOrder:c.z!==e.z?e.z-c.z:c.id-e.id}function ap(c){let e=[],n=0,i=[],o=[],l=[],h={id:-1};function f(p,g,x,_,M,T){let N=e[n],I=c.get(x);return N===void 0?(N={id:p.id,object:p,geometry:g,material:x,program:I.program||h,groupOrder:_,renderOrder:p.renderOrder,z:M,group:T},e[n]=N):(N.id=p.id,N.object=p,N.geometry=g,N.material=x,N.program=I.program||h,N.groupOrder=_,N.renderOrder=p.renderOrder,N.z=M,N.group=T),n++,N}return{opaque:i,transmissive:o,transparent:l,init:function(){n=0,i.length=0,o.length=0,l.length=0},push:function(p,g,x,_,M,T){let N=f(p,g,x,_,M,T);x.transmission>0?o.push(N):x.transparent===!0?l.push(N):i.push(N)},unshift:function(p,g,x,_,M,T){let N=f(p,g,x,_,M,T);x.transmission>0?o.unshift(N):x.transparent===!0?l.unshift(N):i.unshift(N)},finish:function(){for(let p=n,g=e.length;p<g;p++){let x=e[p];if(x.id===null)break;x.id=null,x.object=null,x.geometry=null,x.material=null,x.program=null,x.group=null}},sort:function(p,g){i.length>1&&i.sort(p||sp),o.length>1&&o.sort(g||Oh),l.length>1&&l.sort(g||Oh)}}}function lp(c){let e=new WeakMap;return{get:function(n,i){let o;return e.has(n)===!1?(o=new ap(c),e.set(n,[o])):i>=e.get(n).length?(o=new ap(c),e.get(n).push(o)):o=e.get(n)[i],o},dispose:function(){e=new WeakMap}}}function cp(){let c={};return{get:function(e){if(c[e.id]!==void 0)return c[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new J,color:new yt};break;case"SpotLight":n={position:new J,direction:new J,color:new yt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new J,color:new yt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new J,skyColor:new yt,groundColor:new yt};break;case"RectAreaLight":n={color:new yt,position:new J,halfWidth:new J,halfHeight:new J}}return c[e.id]=n,n}}}let up=0;function hp(c,e){return(e.castShadow?1:0)-(c.castShadow?1:0)}function ss(c,e){let n=new cp,i=function(){let p={};return{get:function(g){if(p[g.id]!==void 0)return p[g.id];let x;switch(g.type){case"DirectionalLight":case"SpotLight":x={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ke};break;case"PointLight":x={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ke,shadowCameraNear:1,shadowCameraFar:1e3}}return p[g.id]=x,x}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let p=0;p<9;p++)o.probe.push(new J);let l=new J,h=new Mt,f=new Mt;return{setup:function(p,g){let x=0,_=0,M=0;for(let ve=0;ve<9;ve++)o.probe[ve].set(0,0,0);let T=0,N=0,I=0,D=0,L=0,F=0,U=0,V=0;p.sort(hp);let K=g!==!0?Math.PI:1;for(let ve=0,_e=p.length;ve<_e;ve++){let Te=p[ve],Ee=Te.color,Ne=Te.intensity,ct=Te.distance,Je=Te.shadow&&Te.shadow.map?Te.shadow.map.texture:null;if(Te.isAmbientLight)x+=Ee.r*Ne*K,_+=Ee.g*Ne*K,M+=Ee.b*Ne*K;else if(Te.isLightProbe)for(let De=0;De<9;De++)o.probe[De].addScaledVector(Te.sh.coefficients[De],Ne);else if(Te.isDirectionalLight){let De=n.get(Te);if(De.color.copy(Te.color).multiplyScalar(Te.intensity*K),Te.castShadow){let Ze=Te.shadow,vt=i.get(Te);vt.shadowBias=Ze.bias,vt.shadowNormalBias=Ze.normalBias,vt.shadowRadius=Ze.radius,vt.shadowMapSize=Ze.mapSize,o.directionalShadow[T]=vt,o.directionalShadowMap[T]=Je,o.directionalShadowMatrix[T]=Te.shadow.matrix,F++}o.directional[T]=De,T++}else if(Te.isSpotLight){let De=n.get(Te);if(De.position.setFromMatrixPosition(Te.matrixWorld),De.color.copy(Ee).multiplyScalar(Ne*K),De.distance=ct,De.coneCos=Math.cos(Te.angle),De.penumbraCos=Math.cos(Te.angle*(1-Te.penumbra)),De.decay=Te.decay,Te.castShadow){let Ze=Te.shadow,vt=i.get(Te);vt.shadowBias=Ze.bias,vt.shadowNormalBias=Ze.normalBias,vt.shadowRadius=Ze.radius,vt.shadowMapSize=Ze.mapSize,o.spotShadow[I]=vt,o.spotShadowMap[I]=Je,o.spotShadowMatrix[I]=Te.shadow.matrix,V++}o.spot[I]=De,I++}else if(Te.isRectAreaLight){let De=n.get(Te);De.color.copy(Ee).multiplyScalar(Ne),De.halfWidth.set(.5*Te.width,0,0),De.halfHeight.set(0,.5*Te.height,0),o.rectArea[D]=De,D++}else if(Te.isPointLight){let De=n.get(Te);if(De.color.copy(Te.color).multiplyScalar(Te.intensity*K),De.distance=Te.distance,De.decay=Te.decay,Te.castShadow){let Ze=Te.shadow,vt=i.get(Te);vt.shadowBias=Ze.bias,vt.shadowNormalBias=Ze.normalBias,vt.shadowRadius=Ze.radius,vt.shadowMapSize=Ze.mapSize,vt.shadowCameraNear=Ze.camera.near,vt.shadowCameraFar=Ze.camera.far,o.pointShadow[N]=vt,o.pointShadowMap[N]=Je,o.pointShadowMatrix[N]=Te.shadow.matrix,U++}o.point[N]=De,N++}else if(Te.isHemisphereLight){let De=n.get(Te);De.skyColor.copy(Te.color).multiplyScalar(Ne*K),De.groundColor.copy(Te.groundColor).multiplyScalar(Ne*K),o.hemi[L]=De,L++}}D>0&&(e.isWebGL2||c.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=dt.LTC_FLOAT_1,o.rectAreaLTC2=dt.LTC_FLOAT_2):c.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=dt.LTC_HALF_1,o.rectAreaLTC2=dt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=x,o.ambient[1]=_,o.ambient[2]=M;let re=o.hash;re.directionalLength===T&&re.pointLength===N&&re.spotLength===I&&re.rectAreaLength===D&&re.hemiLength===L&&re.numDirectionalShadows===F&&re.numPointShadows===U&&re.numSpotShadows===V||(o.directional.length=T,o.spot.length=I,o.rectArea.length=D,o.point.length=N,o.hemi.length=L,o.directionalShadow.length=F,o.directionalShadowMap.length=F,o.pointShadow.length=U,o.pointShadowMap.length=U,o.spotShadow.length=V,o.spotShadowMap.length=V,o.directionalShadowMatrix.length=F,o.pointShadowMatrix.length=U,o.spotShadowMatrix.length=V,re.directionalLength=T,re.pointLength=N,re.spotLength=I,re.rectAreaLength=D,re.hemiLength=L,re.numDirectionalShadows=F,re.numPointShadows=U,re.numSpotShadows=V,o.version=up++)},setupView:function(p,g){let x=0,_=0,M=0,T=0,N=0,I=g.matrixWorldInverse;for(let D=0,L=p.length;D<L;D++){let F=p[D];if(F.isDirectionalLight){let U=o.directional[x];U.direction.setFromMatrixPosition(F.matrixWorld),l.setFromMatrixPosition(F.target.matrixWorld),U.direction.sub(l),U.direction.transformDirection(I),x++}else if(F.isSpotLight){let U=o.spot[M];U.position.setFromMatrixPosition(F.matrixWorld),U.position.applyMatrix4(I),U.direction.setFromMatrixPosition(F.matrixWorld),l.setFromMatrixPosition(F.target.matrixWorld),U.direction.sub(l),U.direction.transformDirection(I),M++}else if(F.isRectAreaLight){let U=o.rectArea[T];U.position.setFromMatrixPosition(F.matrixWorld),U.position.applyMatrix4(I),f.identity(),h.copy(F.matrixWorld),h.premultiply(I),f.extractRotation(h),U.halfWidth.set(.5*F.width,0,0),U.halfHeight.set(0,.5*F.height,0),U.halfWidth.applyMatrix4(f),U.halfHeight.applyMatrix4(f),T++}else if(F.isPointLight){let U=o.point[_];U.position.setFromMatrixPosition(F.matrixWorld),U.position.applyMatrix4(I),_++}else if(F.isHemisphereLight){let U=o.hemi[N];U.direction.setFromMatrixPosition(F.matrixWorld),U.direction.transformDirection(I),U.direction.normalize(),N++}}},state:o}}function dp(c,e){let n=new ss(c,e),i=[],o=[];return{init:function(){i.length=0,o.length=0},state:{lightsArray:i,shadowsArray:o,lights:n},setupLights:function(l){n.setup(i,l)},setupLightsView:function(l){n.setupView(i,l)},pushLight:function(l){i.push(l)},pushShadow:function(l){o.push(l)}}}function Eg(c,e){let n=new WeakMap;return{get:function(i,o=0){let l;return n.has(i)===!1?(l=new dp(c,e),n.set(i,[l])):o>=n.get(i).length?(l=new dp(c,e),n.get(i).push(l)):l=n.get(i)[o],l},dispose:function(){n=new WeakMap}}}class Tl extends Gn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Tl.prototype.isMeshDepthMaterial=!0;class Xc extends Gn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new J,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Xc.prototype.isMeshDistanceMaterial=!0;function Lo(c,e,n){let i=new yl,o=new Ke,l=new Ke,h=new on,f=new Tl({depthPacking:3201}),p=new Xc,g={},x=n.maxTextureSize,_={0:1,1:0,2:2},M=new $i({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ke},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),T=M.clone();T.defines.HORIZONTAL_PASS=1;let N=new Dt;N.setAttribute("position",new Jt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let I=new Tn(N,M),D=this;function L(V,K){let re=e.update(I);M.defines.VSM_SAMPLES!==V.blurSamples&&(M.defines.VSM_SAMPLES=V.blurSamples,T.defines.VSM_SAMPLES=V.blurSamples,M.needsUpdate=!0,T.needsUpdate=!0),M.uniforms.shadow_pass.value=V.map.texture,M.uniforms.resolution.value=V.mapSize,M.uniforms.radius.value=V.radius,c.setRenderTarget(V.mapPass),c.clear(),c.renderBufferDirect(K,null,re,M,I,null),T.uniforms.shadow_pass.value=V.mapPass.texture,T.uniforms.resolution.value=V.mapSize,T.uniforms.radius.value=V.radius,c.setRenderTarget(V.map),c.clear(),c.renderBufferDirect(K,null,re,T,I,null)}function F(V,K,re,ve,_e,Te,Ee){let Ne=null,ct=ve.isPointLight===!0?V.customDistanceMaterial:V.customDepthMaterial;if(Ne=ct!==void 0?ct:ve.isPointLight===!0?p:f,c.localClippingEnabled&&re.clipShadows===!0&&re.clippingPlanes.length!==0||re.displacementMap&&re.displacementScale!==0||re.alphaMap&&re.alphaTest>0){let Je=Ne.uuid,De=re.uuid,Ze=g[Je];Ze===void 0&&(Ze={},g[Je]=Ze);let vt=Ze[De];vt===void 0&&(vt=Ne.clone(),Ze[De]=vt),Ne=vt}return Ne.visible=re.visible,Ne.wireframe=re.wireframe,Ne.side=Ee===3?re.shadowSide!==null?re.shadowSide:re.side:re.shadowSide!==null?re.shadowSide:_[re.side],Ne.alphaMap=re.alphaMap,Ne.alphaTest=re.alphaTest,Ne.clipShadows=re.clipShadows,Ne.clippingPlanes=re.clippingPlanes,Ne.clipIntersection=re.clipIntersection,Ne.displacementMap=re.displacementMap,Ne.displacementScale=re.displacementScale,Ne.displacementBias=re.displacementBias,Ne.wireframeLinewidth=re.wireframeLinewidth,Ne.linewidth=re.linewidth,ve.isPointLight===!0&&Ne.isMeshDistanceMaterial===!0&&(Ne.referencePosition.setFromMatrixPosition(ve.matrixWorld),Ne.nearDistance=_e,Ne.farDistance=Te),Ne}function U(V,K,re,ve,_e){if(V.visible===!1)return;if(V.layers.test(K.layers)&&(V.isMesh||V.isLine||V.isPoints)&&(V.castShadow||V.receiveShadow&&_e===3)&&(!V.frustumCulled||i.intersectsObject(V))){V.modelViewMatrix.multiplyMatrices(re.matrixWorldInverse,V.matrixWorld);let Ee=e.update(V),Ne=V.material;if(Array.isArray(Ne)){let ct=Ee.groups;for(let Je=0,De=ct.length;Je<De;Je++){let Ze=ct[Je],vt=Ne[Ze.materialIndex];if(vt&&vt.visible){let xt=F(V,0,vt,ve,re.near,re.far,_e);c.renderBufferDirect(re,null,Ee,xt,V,Ze)}}}else if(Ne.visible){let ct=F(V,0,Ne,ve,re.near,re.far,_e);c.renderBufferDirect(re,null,Ee,ct,V,null)}}let Te=V.children;for(let Ee=0,Ne=Te.length;Ee<Ne;Ee++)U(Te[Ee],K,re,ve,_e)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(V,K,re){if(D.enabled===!1||D.autoUpdate===!1&&D.needsUpdate===!1||V.length===0)return;let ve=c.getRenderTarget(),_e=c.getActiveCubeFace(),Te=c.getActiveMipmapLevel(),Ee=c.state;Ee.setBlending(0),Ee.buffers.color.setClear(1,1,1,1),Ee.buffers.depth.setTest(!0),Ee.setScissorTest(!1);for(let Ne=0,ct=V.length;Ne<ct;Ne++){let Je=V[Ne],De=Je.shadow;if(De===void 0){console.warn("THREE.WebGLShadowMap:",Je,"has no shadow.");continue}if(De.autoUpdate===!1&&De.needsUpdate===!1)continue;o.copy(De.mapSize);let Ze=De.getFrameExtents();if(o.multiply(Ze),l.copy(De.mapSize),(o.x>x||o.y>x)&&(o.x>x&&(l.x=Math.floor(x/Ze.x),o.x=l.x*Ze.x,De.mapSize.x=l.x),o.y>x&&(l.y=Math.floor(x/Ze.y),o.y=l.y*Ze.y,De.mapSize.y=l.y)),De.map===null&&!De.isPointLightShadow&&this.type===3){let xt={minFilter:1006,magFilter:1006,format:1023};De.map=new lr(o.x,o.y,xt),De.map.texture.name=Je.name+".shadowMap",De.mapPass=new lr(o.x,o.y,xt),De.camera.updateProjectionMatrix()}if(De.map===null){let xt={minFilter:1003,magFilter:1003,format:1023};De.map=new lr(o.x,o.y,xt),De.map.texture.name=Je.name+".shadowMap",De.camera.updateProjectionMatrix()}c.setRenderTarget(De.map),c.clear();let vt=De.getViewportCount();for(let xt=0;xt<vt;xt++){let Tt=De.getViewport(xt);h.set(l.x*Tt.x,l.y*Tt.y,l.x*Tt.z,l.y*Tt.w),Ee.viewport(h),De.updateMatrices(Je,xt),i=De.getFrustum(),U(K,re,De.camera,Je,this.type)}De.isPointLightShadow||this.type!==3||L(De,re),De.needsUpdate=!1}D.needsUpdate=!1,c.setRenderTarget(ve,_e,Te)}}function fp(c,e,n){let i=n.isWebGL2,o=new function(){let te=!1,Se=new on,Ve=null,qe=new on(0,0,0,0);return{setMask:function(Fe){Ve===Fe||te||(c.colorMask(Fe,Fe,Fe,Fe),Ve=Fe)},setLocked:function(Fe){te=Fe},setClear:function(Fe,_t,Nt,wt,zt){zt===!0&&(Fe*=wt,_t*=wt,Nt*=wt),Se.set(Fe,_t,Nt,wt),qe.equals(Se)===!1&&(c.clearColor(Fe,_t,Nt,wt),qe.copy(Se))},reset:function(){te=!1,Ve=null,qe.set(-1,0,0,0)}}},l=new function(){let te=!1,Se=null,Ve=null,qe=null;return{setTest:function(Fe){Fe?nt(2929):ie(2929)},setMask:function(Fe){Se===Fe||te||(c.depthMask(Fe),Se=Fe)},setFunc:function(Fe){if(Ve!==Fe){if(Fe)switch(Fe){case 0:c.depthFunc(512);break;case 1:c.depthFunc(519);break;case 2:c.depthFunc(513);break;default:c.depthFunc(515);break;case 4:c.depthFunc(514);break;case 5:c.depthFunc(518);break;case 6:c.depthFunc(516);break;case 7:c.depthFunc(517)}else c.depthFunc(515);Ve=Fe}},setLocked:function(Fe){te=Fe},setClear:function(Fe){qe!==Fe&&(c.clearDepth(Fe),qe=Fe)},reset:function(){te=!1,Se=null,Ve=null,qe=null}}},h=new function(){let te=!1,Se=null,Ve=null,qe=null,Fe=null,_t=null,Nt=null,wt=null,zt=null;return{setTest:function(Ot){te||(Ot?nt(2960):ie(2960))},setMask:function(Ot){Se===Ot||te||(c.stencilMask(Ot),Se=Ot)},setFunc:function(Ot,qn,ln){Ve===Ot&&qe===qn&&Fe===ln||(c.stencilFunc(Ot,qn,ln),Ve=Ot,qe=qn,Fe=ln)},setOp:function(Ot,qn,ln){_t===Ot&&Nt===qn&&wt===ln||(c.stencilOp(Ot,qn,ln),_t=Ot,Nt=qn,wt=ln)},setLocked:function(Ot){te=Ot},setClear:function(Ot){zt!==Ot&&(c.clearStencil(Ot),zt=Ot)},reset:function(){te=!1,Se=null,Ve=null,qe=null,Fe=null,_t=null,Nt=null,wt=null,zt=null}}},f={},p=null,g={},x=null,_=!1,M=null,T=null,N=null,I=null,D=null,L=null,F=null,U=!1,V=null,K=null,re=null,ve=null,_e=null,Te=c.getParameter(35661),Ee=!1,Ne=0,ct=c.getParameter(7938);ct.indexOf("WebGL")!==-1?(Ne=parseFloat(/^WebGL (\d)/.exec(ct)[1]),Ee=Ne>=1):ct.indexOf("OpenGL ES")!==-1&&(Ne=parseFloat(/^OpenGL ES (\d)/.exec(ct)[1]),Ee=Ne>=2);let Je=null,De={},Ze=c.getParameter(3088),vt=c.getParameter(2978),xt=new on().fromArray(Ze),Tt=new on().fromArray(vt);function Pt(te,Se,Ve){let qe=new Uint8Array(4),Fe=c.createTexture();c.bindTexture(te,Fe),c.texParameteri(te,10241,9728),c.texParameteri(te,10240,9728);for(let _t=0;_t<Ve;_t++)c.texImage2D(Se+_t,0,6408,1,1,0,6408,5121,qe);return Fe}let Ct={};function nt(te){f[te]!==!0&&(c.enable(te),f[te]=!0)}function ie(te){f[te]!==!1&&(c.disable(te),f[te]=!1)}Ct[3553]=Pt(3553,3553,1),Ct[34067]=Pt(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),nt(2929),l.setFunc(3),we(!1),ot(1),nt(2884),Be(0);let he={100:32774,101:32778,102:32779};if(i)he[103]=32775,he[104]=32776;else{let te=e.get("EXT_blend_minmax");te!==null&&(he[103]=te.MIN_EXT,he[104]=te.MAX_EXT)}let Ue={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function Be(te,Se,Ve,qe,Fe,_t,Nt,wt){if(te!==0){if(_===!1&&(nt(3042),_=!0),te===5)Fe=Fe||Se,_t=_t||Ve,Nt=Nt||qe,Se===T&&Fe===D||(c.blendEquationSeparate(he[Se],he[Fe]),T=Se,D=Fe),Ve===N&&qe===I&&_t===L&&Nt===F||(c.blendFuncSeparate(Ue[Ve],Ue[qe],Ue[_t],Ue[Nt]),N=Ve,I=qe,L=_t,F=Nt),M=te,U=null;else if(te!==M||wt!==U){if(T===100&&D===100||(c.blendEquation(32774),T=100,D=100),wt)switch(te){case 1:c.blendFuncSeparate(1,771,1,771);break;case 2:c.blendFunc(1,1);break;case 3:c.blendFuncSeparate(0,0,769,771);break;case 4:c.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",te)}else switch(te){case 1:c.blendFuncSeparate(770,771,1,771);break;case 2:c.blendFunc(770,1);break;case 3:c.blendFunc(0,769);break;case 4:c.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",te)}N=null,I=null,L=null,F=null,M=te,U=wt}}else _===!0&&(ie(3042),_=!1)}function we(te){V!==te&&(te?c.frontFace(2304):c.frontFace(2305),V=te)}function ot(te){te!==0?(nt(2884),te!==K&&(te===1?c.cullFace(1029):te===2?c.cullFace(1028):c.cullFace(1032))):ie(2884),K=te}function ut(te,Se,Ve){te?(nt(32823),ve===Se&&_e===Ve||(c.polygonOffset(Se,Ve),ve=Se,_e=Ve)):ie(32823)}function Le(te){te===void 0&&(te=33984+Te-1),Je!==te&&(c.activeTexture(te),Je=te)}return{buffers:{color:o,depth:l,stencil:h},enable:nt,disable:ie,bindFramebuffer:function(te,Se){return Se===null&&p!==null&&(Se=p),g[te]!==Se&&(c.bindFramebuffer(te,Se),g[te]=Se,i&&(te===36009&&(g[36160]=Se),te===36160&&(g[36009]=Se)),!0)},bindXRFramebuffer:function(te){te!==p&&(c.bindFramebuffer(36160,te),p=te)},useProgram:function(te){return x!==te&&(c.useProgram(te),x=te,!0)},setBlending:Be,setMaterial:function(te,Se){te.side===2?ie(2884):nt(2884);let Ve=te.side===1;Se&&(Ve=!Ve),we(Ve),te.blending===1&&te.transparent===!1?Be(0):Be(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.premultipliedAlpha),l.setFunc(te.depthFunc),l.setTest(te.depthTest),l.setMask(te.depthWrite),o.setMask(te.colorWrite);let qe=te.stencilWrite;h.setTest(qe),qe&&(h.setMask(te.stencilWriteMask),h.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),h.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),ut(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),te.alphaToCoverage===!0?nt(32926):ie(32926)},setFlipSided:we,setCullFace:ot,setLineWidth:function(te){te!==re&&(Ee&&c.lineWidth(te),re=te)},setPolygonOffset:ut,setScissorTest:function(te){te?nt(3089):ie(3089)},activeTexture:Le,bindTexture:function(te,Se){Je===null&&Le();let Ve=De[Je];Ve===void 0&&(Ve={type:void 0,texture:void 0},De[Je]=Ve),Ve.type===te&&Ve.texture===Se||(c.bindTexture(te,Se||Ct[te]),Ve.type=te,Ve.texture=Se)},unbindTexture:function(){let te=De[Je];te!==void 0&&te.type!==void 0&&(c.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(te){console.error("THREE.WebGLState:",te)}},texImage2D:function(){try{c.texImage2D.apply(c,arguments)}catch(te){console.error("THREE.WebGLState:",te)}},texImage3D:function(){try{c.texImage3D.apply(c,arguments)}catch(te){console.error("THREE.WebGLState:",te)}},scissor:function(te){xt.equals(te)===!1&&(c.scissor(te.x,te.y,te.z,te.w),xt.copy(te))},viewport:function(te){Tt.equals(te)===!1&&(c.viewport(te.x,te.y,te.z,te.w),Tt.copy(te))},reset:function(){c.disable(3042),c.disable(2884),c.disable(2929),c.disable(32823),c.disable(3089),c.disable(2960),c.disable(32926),c.blendEquation(32774),c.blendFunc(1,0),c.blendFuncSeparate(1,0,1,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(513),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(519,0,4294967295),c.stencilOp(7680,7680,7680),c.clearStencil(0),c.cullFace(1029),c.frontFace(2305),c.polygonOffset(0,0),c.activeTexture(33984),c.bindFramebuffer(36160,null),i===!0&&(c.bindFramebuffer(36009,null),c.bindFramebuffer(36008,null)),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),f={},Je=null,De={},p=null,g={},x=null,_=!1,M=null,T=null,N=null,I=null,D=null,L=null,F=null,U=!1,V=null,K=null,re=null,ve=null,_e=null,xt.set(0,0,c.canvas.width,c.canvas.height),Tt.set(0,0,c.canvas.width,c.canvas.height),o.reset(),l.reset(),h.reset()}}}function Sg(c,e,n,i,o,l,h){let f=o.isWebGL2,p=o.maxTextures,g=o.maxCubemapSize,x=o.maxTextureSize,_=o.maxSamples,M=new WeakMap,T,N=!1;try{N=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function I(ie,he){return N?new OffscreenCanvas(ie,he):hc("canvas")}function D(ie,he,Ue,Be){let we=1;if((ie.width>Be||ie.height>Be)&&(we=Be/Math.max(ie.width,ie.height)),we<1||he===!0){if(typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ie instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ie instanceof ImageBitmap){let ot=he?bf:Math.floor,ut=ot(we*ie.width),Le=ot(we*ie.height);T===void 0&&(T=I(ut,Le));let te=Ue?I(ut,Le):T;return te.width=ut,te.height=Le,te.getContext("2d").drawImage(ie,0,0,ut,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ie.width+"x"+ie.height+") to ("+ut+"x"+Le+")."),te}return"data"in ie&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ie.width+"x"+ie.height+")."),ie}return ie}function L(ie){return Xu(ie.width)&&Xu(ie.height)}function F(ie,he){return ie.generateMipmaps&&he&&ie.minFilter!==1003&&ie.minFilter!==1006}function U(ie,he,Ue,Be,we=1){c.generateMipmap(ie),i.get(he).__maxMipLevel=Math.log2(Math.max(Ue,Be,we))}function V(ie,he,Ue,Be){if(f===!1)return he;if(ie!==null){if(c[ie]!==void 0)return c[ie];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ie+"'")}let we=he;return he===6403&&(Ue===5126&&(we=33326),Ue===5131&&(we=33325),Ue===5121&&(we=33321)),he===6407&&(Ue===5126&&(we=34837),Ue===5131&&(we=34843),Ue===5121&&(we=32849)),he===6408&&(Ue===5126&&(we=34836),Ue===5131&&(we=34842),Ue===5121&&(we=Be===3001?35907:32856)),we!==33325&&we!==33326&&we!==34842&&we!==34836||e.get("EXT_color_buffer_float"),we}function K(ie){return ie===1003||ie===1004||ie===1005?9728:9729}function re(ie){let he=ie.target;he.removeEventListener("dispose",re),function(Ue){let Be=i.get(Ue);Be.__webglInit!==void 0&&(c.deleteTexture(Be.__webglTexture),i.remove(Ue))}(he),he.isVideoTexture&&M.delete(he),h.memory.textures--}function ve(ie){let he=ie.target;he.removeEventListener("dispose",ve),function(Ue){let Be=Ue.texture,we=i.get(Ue),ot=i.get(Be);if(Ue){if(ot.__webglTexture!==void 0&&(c.deleteTexture(ot.__webglTexture),h.memory.textures--),Ue.depthTexture&&Ue.depthTexture.dispose(),Ue.isWebGLCubeRenderTarget)for(let ut=0;ut<6;ut++)c.deleteFramebuffer(we.__webglFramebuffer[ut]),we.__webglDepthbuffer&&c.deleteRenderbuffer(we.__webglDepthbuffer[ut]);else c.deleteFramebuffer(we.__webglFramebuffer),we.__webglDepthbuffer&&c.deleteRenderbuffer(we.__webglDepthbuffer),we.__webglMultisampledFramebuffer&&c.deleteFramebuffer(we.__webglMultisampledFramebuffer),we.__webglColorRenderbuffer&&c.deleteRenderbuffer(we.__webglColorRenderbuffer),we.__webglDepthRenderbuffer&&c.deleteRenderbuffer(we.__webglDepthRenderbuffer);if(Ue.isWebGLMultipleRenderTargets)for(let ut=0,Le=Be.length;ut<Le;ut++){let te=i.get(Be[ut]);te.__webglTexture&&(c.deleteTexture(te.__webglTexture),h.memory.textures--),i.remove(Be[ut])}i.remove(Be),i.remove(Ue)}}(he)}let _e=0;function Te(ie,he){let Ue=i.get(ie);if(ie.isVideoTexture&&function(Be){let we=h.render.frame;M.get(Be)!==we&&(M.set(Be,we),Be.update())}(ie),ie.version>0&&Ue.__version!==ie.version){let Be=ie.image;if(Be===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(Be.complete!==!1)return void Ze(Ue,ie,he);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+he),n.bindTexture(3553,Ue.__webglTexture)}function Ee(ie,he){let Ue=i.get(ie);ie.version>0&&Ue.__version!==ie.version?function(Be,we,ot){if(we.image.length!==6)return;De(Be,we),n.activeTexture(33984+ot),n.bindTexture(34067,Be.__webglTexture),c.pixelStorei(37440,we.flipY),c.pixelStorei(37441,we.premultiplyAlpha),c.pixelStorei(3317,we.unpackAlignment),c.pixelStorei(37443,0);let ut=we&&(we.isCompressedTexture||we.image[0].isCompressedTexture),Le=we.image[0]&&we.image[0].isDataTexture,te=[];for(let wt=0;wt<6;wt++)te[wt]=ut||Le?Le?we.image[wt].image:we.image[wt]:D(we.image[wt],!1,!0,g);let Se=te[0],Ve=L(Se)||f,qe=l.convert(we.format),Fe=l.convert(we.type),_t=V(we.internalFormat,qe,Fe,we.encoding),Nt;if(Je(34067,we,Ve),ut){for(let wt=0;wt<6;wt++){Nt=te[wt].mipmaps;for(let zt=0;zt<Nt.length;zt++){let Ot=Nt[zt];we.format!==1023&&we.format!==1022?qe!==null?n.compressedTexImage2D(34069+wt,zt,_t,Ot.width,Ot.height,0,Ot.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+wt,zt,_t,Ot.width,Ot.height,0,qe,Fe,Ot.data)}}Be.__maxMipLevel=Nt.length-1}else{Nt=we.mipmaps;for(let wt=0;wt<6;wt++)if(Le){n.texImage2D(34069+wt,0,_t,te[wt].width,te[wt].height,0,qe,Fe,te[wt].data);for(let zt=0;zt<Nt.length;zt++){let Ot=Nt[zt].image[wt].image;n.texImage2D(34069+wt,zt+1,_t,Ot.width,Ot.height,0,qe,Fe,Ot.data)}}else{n.texImage2D(34069+wt,0,_t,qe,Fe,te[wt]);for(let zt=0;zt<Nt.length;zt++){let Ot=Nt[zt];n.texImage2D(34069+wt,zt+1,_t,qe,Fe,Ot.image[wt])}}Be.__maxMipLevel=Nt.length}F(we,Ve)&&U(34067,we,Se.width,Se.height),Be.__version=we.version,we.onUpdate&&we.onUpdate(we)}(Ue,ie,he):(n.activeTexture(33984+he),n.bindTexture(34067,Ue.__webglTexture))}let Ne={1e3:10497,1001:33071,1002:33648},ct={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function Je(ie,he,Ue){if(Ue?(c.texParameteri(ie,10242,Ne[he.wrapS]),c.texParameteri(ie,10243,Ne[he.wrapT]),ie!==32879&&ie!==35866||c.texParameteri(ie,32882,Ne[he.wrapR]),c.texParameteri(ie,10240,ct[he.magFilter]),c.texParameteri(ie,10241,ct[he.minFilter])):(c.texParameteri(ie,10242,33071),c.texParameteri(ie,10243,33071),ie!==32879&&ie!==35866||c.texParameteri(ie,32882,33071),he.wrapS===1001&&he.wrapT===1001||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),c.texParameteri(ie,10240,K(he.magFilter)),c.texParameteri(ie,10241,K(he.minFilter)),he.minFilter!==1003&&he.minFilter!==1006&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Be=e.get("EXT_texture_filter_anisotropic");if(he.type===1015&&e.has("OES_texture_float_linear")===!1||f===!1&&he.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(he.anisotropy>1||i.get(he).__currentAnisotropy)&&(c.texParameterf(ie,Be.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(he.anisotropy,o.getMaxAnisotropy())),i.get(he).__currentAnisotropy=he.anisotropy)}}function De(ie,he){ie.__webglInit===void 0&&(ie.__webglInit=!0,he.addEventListener("dispose",re),ie.__webglTexture=c.createTexture(),h.memory.textures++)}function Ze(ie,he,Ue){let Be=3553;he.isDataTexture2DArray&&(Be=35866),he.isDataTexture3D&&(Be=32879),De(ie,he),n.activeTexture(33984+Ue),n.bindTexture(Be,ie.__webglTexture),c.pixelStorei(37440,he.flipY),c.pixelStorei(37441,he.premultiplyAlpha),c.pixelStorei(3317,he.unpackAlignment),c.pixelStorei(37443,0);let we=function(Fe){return!f&&(Fe.wrapS!==1001||Fe.wrapT!==1001||Fe.minFilter!==1003&&Fe.minFilter!==1006)}(he)&&L(he.image)===!1,ot=D(he.image,we,!1,x),ut=L(ot)||f,Le=l.convert(he.format),te,Se=l.convert(he.type),Ve=V(he.internalFormat,Le,Se,he.encoding);Je(Be,he,ut);let qe=he.mipmaps;if(he.isDepthTexture)Ve=6402,f?Ve=he.type===1015?36012:he.type===1014?33190:he.type===1020?35056:33189:he.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),he.format===1026&&Ve===6402&&he.type!==1012&&he.type!==1014&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),he.type=1012,Se=l.convert(he.type)),he.format===1027&&Ve===6402&&(Ve=34041,he.type!==1020&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),he.type=1020,Se=l.convert(he.type))),n.texImage2D(3553,0,Ve,ot.width,ot.height,0,Le,Se,null);else if(he.isDataTexture)if(qe.length>0&&ut){for(let Fe=0,_t=qe.length;Fe<_t;Fe++)te=qe[Fe],n.texImage2D(3553,Fe,Ve,te.width,te.height,0,Le,Se,te.data);he.generateMipmaps=!1,ie.__maxMipLevel=qe.length-1}else n.texImage2D(3553,0,Ve,ot.width,ot.height,0,Le,Se,ot.data),ie.__maxMipLevel=0;else if(he.isCompressedTexture){for(let Fe=0,_t=qe.length;Fe<_t;Fe++)te=qe[Fe],he.format!==1023&&he.format!==1022?Le!==null?n.compressedTexImage2D(3553,Fe,Ve,te.width,te.height,0,te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,Fe,Ve,te.width,te.height,0,Le,Se,te.data);ie.__maxMipLevel=qe.length-1}else if(he.isDataTexture2DArray)n.texImage3D(35866,0,Ve,ot.width,ot.height,ot.depth,0,Le,Se,ot.data),ie.__maxMipLevel=0;else if(he.isDataTexture3D)n.texImage3D(32879,0,Ve,ot.width,ot.height,ot.depth,0,Le,Se,ot.data),ie.__maxMipLevel=0;else if(qe.length>0&&ut){for(let Fe=0,_t=qe.length;Fe<_t;Fe++)te=qe[Fe],n.texImage2D(3553,Fe,Ve,Le,Se,te);he.generateMipmaps=!1,ie.__maxMipLevel=qe.length-1}else n.texImage2D(3553,0,Ve,Le,Se,ot),ie.__maxMipLevel=0;F(he,ut)&&U(Be,he,ot.width,ot.height),ie.__version=he.version,he.onUpdate&&he.onUpdate(he)}function vt(ie,he,Ue,Be,we){let ot=l.convert(Ue.format),ut=l.convert(Ue.type),Le=V(Ue.internalFormat,ot,ut,Ue.encoding);we===32879||we===35866?n.texImage3D(we,0,Le,he.width,he.height,he.depth,0,ot,ut,null):n.texImage2D(we,0,Le,he.width,he.height,0,ot,ut,null),n.bindFramebuffer(36160,ie),c.framebufferTexture2D(36160,Be,we,i.get(Ue).__webglTexture,0),n.bindFramebuffer(36160,null)}function xt(ie,he,Ue){if(c.bindRenderbuffer(36161,ie),he.depthBuffer&&!he.stencilBuffer){let Be=33189;if(Ue){let we=he.depthTexture;we&&we.isDepthTexture&&(we.type===1015?Be=36012:we.type===1014&&(Be=33190));let ot=Pt(he);c.renderbufferStorageMultisample(36161,ot,Be,he.width,he.height)}else c.renderbufferStorage(36161,Be,he.width,he.height);c.framebufferRenderbuffer(36160,36096,36161,ie)}else if(he.depthBuffer&&he.stencilBuffer){if(Ue){let Be=Pt(he);c.renderbufferStorageMultisample(36161,Be,35056,he.width,he.height)}else c.renderbufferStorage(36161,34041,he.width,he.height);c.framebufferRenderbuffer(36160,33306,36161,ie)}else{let Be=he.isWebGLMultipleRenderTargets===!0?he.texture[0]:he.texture,we=l.convert(Be.format),ot=l.convert(Be.type),ut=V(Be.internalFormat,we,ot,Be.encoding);if(Ue){let Le=Pt(he);c.renderbufferStorageMultisample(36161,Le,ut,he.width,he.height)}else c.renderbufferStorage(36161,ut,he.width,he.height)}c.bindRenderbuffer(36161,null)}function Tt(ie){let he=i.get(ie),Ue=ie.isWebGLCubeRenderTarget===!0;if(ie.depthTexture){if(Ue)throw new Error("target.depthTexture not supported in Cube render targets");(function(Be,we){if(we&&we.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,Be),!we.depthTexture||!we.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(we.depthTexture).__webglTexture&&we.depthTexture.image.width===we.width&&we.depthTexture.image.height===we.height||(we.depthTexture.image.width=we.width,we.depthTexture.image.height=we.height,we.depthTexture.needsUpdate=!0),Te(we.depthTexture,0);let ot=i.get(we.depthTexture).__webglTexture;if(we.depthTexture.format===1026)c.framebufferTexture2D(36160,36096,3553,ot,0);else{if(we.depthTexture.format!==1027)throw new Error("Unknown depthTexture format");c.framebufferTexture2D(36160,33306,3553,ot,0)}})(he.__webglFramebuffer,ie)}else if(Ue){he.__webglDepthbuffer=[];for(let Be=0;Be<6;Be++)n.bindFramebuffer(36160,he.__webglFramebuffer[Be]),he.__webglDepthbuffer[Be]=c.createRenderbuffer(),xt(he.__webglDepthbuffer[Be],ie,!1)}else n.bindFramebuffer(36160,he.__webglFramebuffer),he.__webglDepthbuffer=c.createRenderbuffer(),xt(he.__webglDepthbuffer,ie,!1);n.bindFramebuffer(36160,null)}function Pt(ie){return f&&ie.isWebGLMultisampleRenderTarget?Math.min(_,ie.samples):0}let Ct=!1,nt=!1;this.allocateTextureUnit=function(){let ie=_e;return ie>=p&&console.warn("THREE.WebGLTextures: Trying to use "+ie+" texture units while this GPU supports only "+p),_e+=1,ie},this.resetTextureUnits=function(){_e=0},this.setTexture2D=Te,this.setTexture2DArray=function(ie,he){let Ue=i.get(ie);ie.version>0&&Ue.__version!==ie.version?Ze(Ue,ie,he):(n.activeTexture(33984+he),n.bindTexture(35866,Ue.__webglTexture))},this.setTexture3D=function(ie,he){let Ue=i.get(ie);ie.version>0&&Ue.__version!==ie.version?Ze(Ue,ie,he):(n.activeTexture(33984+he),n.bindTexture(32879,Ue.__webglTexture))},this.setTextureCube=Ee,this.setupRenderTarget=function(ie){let he=ie.texture,Ue=i.get(ie),Be=i.get(he);ie.addEventListener("dispose",ve),ie.isWebGLMultipleRenderTargets!==!0&&(Be.__webglTexture=c.createTexture(),Be.__version=he.version,h.memory.textures++);let we=ie.isWebGLCubeRenderTarget===!0,ot=ie.isWebGLMultipleRenderTargets===!0,ut=ie.isWebGLMultisampleRenderTarget===!0,Le=he.isDataTexture3D||he.isDataTexture2DArray,te=L(ie)||f;if(!f||he.format!==1022||he.type!==1015&&he.type!==1016||(he.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),we){Ue.__webglFramebuffer=[];for(let Se=0;Se<6;Se++)Ue.__webglFramebuffer[Se]=c.createFramebuffer()}else if(Ue.__webglFramebuffer=c.createFramebuffer(),ot)if(o.drawBuffers){let Se=ie.texture;for(let Ve=0,qe=Se.length;Ve<qe;Ve++){let Fe=i.get(Se[Ve]);Fe.__webglTexture===void 0&&(Fe.__webglTexture=c.createTexture(),h.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(ut)if(f){Ue.__webglMultisampledFramebuffer=c.createFramebuffer(),Ue.__webglColorRenderbuffer=c.createRenderbuffer(),c.bindRenderbuffer(36161,Ue.__webglColorRenderbuffer);let Se=l.convert(he.format),Ve=l.convert(he.type),qe=V(he.internalFormat,Se,Ve,he.encoding),Fe=Pt(ie);c.renderbufferStorageMultisample(36161,Fe,qe,ie.width,ie.height),n.bindFramebuffer(36160,Ue.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(36160,36064,36161,Ue.__webglColorRenderbuffer),c.bindRenderbuffer(36161,null),ie.depthBuffer&&(Ue.__webglDepthRenderbuffer=c.createRenderbuffer(),xt(Ue.__webglDepthRenderbuffer,ie,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(we){n.bindTexture(34067,Be.__webglTexture),Je(34067,he,te);for(let Se=0;Se<6;Se++)vt(Ue.__webglFramebuffer[Se],ie,he,36064,34069+Se);F(he,te)&&U(34067,he,ie.width,ie.height),n.unbindTexture()}else if(ot){let Se=ie.texture;for(let Ve=0,qe=Se.length;Ve<qe;Ve++){let Fe=Se[Ve],_t=i.get(Fe);n.bindTexture(3553,_t.__webglTexture),Je(3553,Fe,te),vt(Ue.__webglFramebuffer,ie,Fe,36064+Ve,3553),F(Fe,te)&&U(3553,Fe,ie.width,ie.height)}n.unbindTexture()}else{let Se=3553;Le&&(f?Se=he.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(Se,Be.__webglTexture),Je(Se,he,te),vt(Ue.__webglFramebuffer,ie,he,36064,Se),F(he,te)&&U(Se,he,ie.width,ie.height,ie.depth),n.unbindTexture()}ie.depthBuffer&&Tt(ie)},this.updateRenderTargetMipmap=function(ie){let he=L(ie)||f,Ue=ie.isWebGLMultipleRenderTargets===!0?ie.texture:[ie.texture];for(let Be=0,we=Ue.length;Be<we;Be++){let ot=Ue[Be];if(F(ot,he)){let ut=ie.isWebGLCubeRenderTarget?34067:3553,Le=i.get(ot).__webglTexture;n.bindTexture(ut,Le),U(ut,ot,ie.width,ie.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(ie){if(ie.isWebGLMultisampleRenderTarget)if(f){let he=ie.width,Ue=ie.height,Be=16384;ie.depthBuffer&&(Be|=256),ie.stencilBuffer&&(Be|=1024);let we=i.get(ie);n.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,we.__webglFramebuffer),c.blitFramebuffer(0,0,he,Ue,0,0,he,Ue,Be,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,we.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(ie,he){ie&&ie.isWebGLRenderTarget&&(Ct===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Ct=!0),ie=ie.texture),Te(ie,he)},this.safeSetTextureCube=function(ie,he){ie&&ie.isWebGLCubeRenderTarget&&(nt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),nt=!0),ie=ie.texture),Ee(ie,he)}}function pp(c,e,n){let i=n.isWebGL2;return{convert:function(o){let l;if(o===1009)return 5121;if(o===1017)return 32819;if(o===1018)return 32820;if(o===1019)return 33635;if(o===1010)return 5120;if(o===1011)return 5122;if(o===1012)return 5123;if(o===1013)return 5124;if(o===1014)return 5125;if(o===1015)return 5126;if(o===1016)return i?5131:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(o===1021)return 6406;if(o===1022)return 6407;if(o===1023)return 6408;if(o===1024)return 6409;if(o===1025)return 6410;if(o===1026)return 6402;if(o===1027)return 34041;if(o===1028)return 6403;if(o===1029)return 36244;if(o===1030)return 33319;if(o===1031)return 33320;if(o===1032)return 36248;if(o===1033)return 36249;if(o===33776||o===33777||o===33778||o===33779){if(l=e.get("WEBGL_compressed_texture_s3tc"),l===null)return null;if(o===33776)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===33777)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===33778)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===33779)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(o===35840||o===35841||o===35842||o===35843){if(l=e.get("WEBGL_compressed_texture_pvrtc"),l===null)return null;if(o===35840)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===35841)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===35842)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===35843)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(o===36196)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if((o===37492||o===37496)&&(l=e.get("WEBGL_compressed_texture_etc"),l!==null)){if(o===37492)return l.COMPRESSED_RGB8_ETC2;if(o===37496)return l.COMPRESSED_RGBA8_ETC2_EAC}return o===37808||o===37809||o===37810||o===37811||o===37812||o===37813||o===37814||o===37815||o===37816||o===37817||o===37818||o===37819||o===37820||o===37821||o===37840||o===37841||o===37842||o===37843||o===37844||o===37845||o===37846||o===37847||o===37848||o===37849||o===37850||o===37851||o===37852||o===37853?(l=e.get("WEBGL_compressed_texture_astc"),l!==null?o:null):o===36492?(l=e.get("EXT_texture_compression_bptc"),l!==null?o:null):o===1020?i?34042:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Jc extends An{constructor(e=[]){super(),this.cameras=e}}Jc.prototype.isArrayCamera=!0;class as extends Xt{constructor(){super(),this.type="Group"}}as.prototype.isGroup=!0;let Tg={type:"move"};class Gh{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new as,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new as,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new J,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new J),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new as,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new J,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new J),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let o=null,l=null,h=null,f=this._targetRay,p=this._grip,g=this._hand;if(e&&n.session.visibilityState!=="visible-blurred")if(f!==null&&(o=n.getPose(e.targetRaySpace,i),o!==null&&(f.matrix.fromArray(o.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),o.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(o.linearVelocity)):f.hasLinearVelocity=!1,o.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(o.angularVelocity)):f.hasAngularVelocity=!1,this.dispatchEvent(Tg))),g&&e.hand){h=!0;for(let I of e.hand.values()){let D=n.getJointPose(I,i);if(g.joints[I.jointName]===void 0){let F=new as;F.matrixAutoUpdate=!1,F.visible=!1,g.joints[I.jointName]=F,g.add(F)}let L=g.joints[I.jointName];D!==null&&(L.matrix.fromArray(D.transform.matrix),L.matrix.decompose(L.position,L.rotation,L.scale),L.jointRadius=D.radius),L.visible=D!==null}let x=g.joints["index-finger-tip"],_=g.joints["thumb-tip"],M=x.position.distanceTo(_.position),T=.02,N=.005;g.inputState.pinching&&M>T+N?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&M<=T-N&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else p!==null&&e.gripSpace&&(l=n.getPose(e.gripSpace,i),l!==null&&(p.matrix.fromArray(l.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),l.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(l.linearVelocity)):p.hasLinearVelocity=!1,l.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(l.angularVelocity)):p.hasAngularVelocity=!1));return f!==null&&(f.visible=o!==null),p!==null&&(p.visible=l!==null),g!==null&&(g.visible=h!==null),this}}class mp extends Qr{constructor(e,n){super();let i=this,o=e.state,l=null,h=1,f=null,p="local-floor",g=null,x=null,_=null,M=null,T=null,N=!1,I=null,D=null,L=null,F=null,U=null,V=null,K=[],re=new Map,ve=new An;ve.layers.enable(1),ve.viewport=new on;let _e=new An;_e.layers.enable(2),_e.viewport=new on;let Te=[ve,_e],Ee=new Jc;Ee.layers.enable(1),Ee.layers.enable(2);let Ne=null,ct=null;function Je(nt){let ie=re.get(nt.inputSource);ie&&ie.dispatchEvent({type:nt.type,data:nt.inputSource})}function De(){re.forEach(function(nt,ie){nt.disconnect(ie)}),re.clear(),Ne=null,ct=null,o.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_&&n.deleteFramebuffer(_),I&&n.deleteFramebuffer(I),D&&n.deleteRenderbuffer(D),L&&n.deleteRenderbuffer(L),_=null,I=null,D=null,L=null,T=null,M=null,x=null,l=null,Ct.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function Ze(nt){let ie=l.inputSources;for(let he=0;he<K.length;he++)re.set(ie[he],K[he]);for(let he=0;he<nt.removed.length;he++){let Ue=nt.removed[he],Be=re.get(Ue);Be&&(Be.dispatchEvent({type:"disconnected",data:Ue}),re.delete(Ue))}for(let he=0;he<nt.added.length;he++){let Ue=nt.added[he],Be=re.get(Ue);Be&&Be.dispatchEvent({type:"connected",data:Ue})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(nt){let ie=K[nt];return ie===void 0&&(ie=new Gh,K[nt]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(nt){let ie=K[nt];return ie===void 0&&(ie=new Gh,K[nt]=ie),ie.getGripSpace()},this.getHand=function(nt){let ie=K[nt];return ie===void 0&&(ie=new Gh,K[nt]=ie),ie.getHandSpace()},this.setFramebufferScaleFactor=function(nt){h=nt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(nt){p=nt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return f},this.getBaseLayer=function(){return M!==null?M:T},this.getBinding=function(){return x},this.getFrame=function(){return F},this.getSession=function(){return l},this.setSession=async function(nt){if(l=nt,l!==null){l.addEventListener("select",Je),l.addEventListener("selectstart",Je),l.addEventListener("selectend",Je),l.addEventListener("squeeze",Je),l.addEventListener("squeezestart",Je),l.addEventListener("squeezeend",Je),l.addEventListener("end",De),l.addEventListener("inputsourceschange",Ze);let ie=n.getContextAttributes();if(ie.xrCompatible!==!0&&await n.makeXRCompatible(),l.renderState.layers===void 0){let he={antialias:ie.antialias,alpha:ie.alpha,depth:ie.depth,stencil:ie.stencil,framebufferScaleFactor:h};T=new XRWebGLLayer(l,n,he),l.updateRenderState({baseLayer:T})}else if(n instanceof WebGLRenderingContext){let he={antialias:!0,alpha:ie.alpha,depth:ie.depth,stencil:ie.stencil,framebufferScaleFactor:h};T=new XRWebGLLayer(l,n,he),l.updateRenderState({layers:[T]})}else{N=ie.antialias;let he=null;ie.depth&&(V=256,ie.stencil&&(V|=1024),U=ie.stencil?33306:36096,he=ie.stencil?35056:33190);let Ue={colorFormat:ie.alpha?32856:32849,depthFormat:he,scaleFactor:h};x=new XRWebGLBinding(l,n),M=x.createProjectionLayer(Ue),_=n.createFramebuffer(),l.updateRenderState({layers:[M]}),N&&(I=n.createFramebuffer(),D=n.createRenderbuffer(),n.bindRenderbuffer(36161,D),n.renderbufferStorageMultisample(36161,4,32856,M.textureWidth,M.textureHeight),o.bindFramebuffer(36160,I),n.framebufferRenderbuffer(36160,36064,36161,D),n.bindRenderbuffer(36161,null),he!==null&&(L=n.createRenderbuffer(),n.bindRenderbuffer(36161,L),n.renderbufferStorageMultisample(36161,4,he,M.textureWidth,M.textureHeight),n.framebufferRenderbuffer(36160,U,36161,L),n.bindRenderbuffer(36161,null)),o.bindFramebuffer(36160,null))}f=await l.requestReferenceSpace(p),Ct.setContext(l),Ct.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};let vt=new J,xt=new J;function Tt(nt,ie){ie===null?nt.matrixWorld.copy(nt.matrix):nt.matrixWorld.multiplyMatrices(ie.matrixWorld,nt.matrix),nt.matrixWorldInverse.copy(nt.matrixWorld).invert()}this.updateCamera=function(nt){if(l===null)return;Ee.near=_e.near=ve.near=nt.near,Ee.far=_e.far=ve.far=nt.far,Ne===Ee.near&&ct===Ee.far||(l.updateRenderState({depthNear:Ee.near,depthFar:Ee.far}),Ne=Ee.near,ct=Ee.far);let ie=nt.parent,he=Ee.cameras;Tt(Ee,ie);for(let Be=0;Be<he.length;Be++)Tt(he[Be],ie);Ee.matrixWorld.decompose(Ee.position,Ee.quaternion,Ee.scale),nt.position.copy(Ee.position),nt.quaternion.copy(Ee.quaternion),nt.scale.copy(Ee.scale),nt.matrix.copy(Ee.matrix),nt.matrixWorld.copy(Ee.matrixWorld);let Ue=nt.children;for(let Be=0,we=Ue.length;Be<we;Be++)Ue[Be].updateMatrixWorld(!0);he.length===2?function(Be,we,ot){vt.setFromMatrixPosition(we.matrixWorld),xt.setFromMatrixPosition(ot.matrixWorld);let ut=vt.distanceTo(xt),Le=we.projectionMatrix.elements,te=ot.projectionMatrix.elements,Se=Le[14]/(Le[10]-1),Ve=Le[14]/(Le[10]+1),qe=(Le[9]+1)/Le[5],Fe=(Le[9]-1)/Le[5],_t=(Le[8]-1)/Le[0],Nt=(te[8]+1)/te[0],wt=Se*_t,zt=Se*Nt,Ot=ut/(-_t+Nt),qn=Ot*-_t;we.matrixWorld.decompose(Be.position,Be.quaternion,Be.scale),Be.translateX(qn),Be.translateZ(Ot),Be.matrixWorld.compose(Be.position,Be.quaternion,Be.scale),Be.matrixWorldInverse.copy(Be.matrixWorld).invert();let ln=Se+Ot,Xn=Ve+Ot,Lr=wt-qn,Cs=zt+(ut-qn),Fi=qe*Ve/Xn*ln,Jr=Fe*Ve/Xn*ln;Be.projectionMatrix.makePerspective(Lr,Cs,Fi,Jr,ln,Xn)}(Ee,ve,_e):Ee.projectionMatrix.copy(ve.projectionMatrix)},this.getCamera=function(){return Ee},this.getFoveation=function(){return M!==null?M.fixedFoveation:T!==null?T.fixedFoveation:void 0},this.setFoveation=function(nt){M!==null&&(M.fixedFoveation=nt),T!==null&&T.fixedFoveation!==void 0&&(T.fixedFoveation=nt)};let Pt=null,Ct=new Df;Ct.setAnimationLoop(function(nt,ie){if(g=ie.getViewerPose(f),F=ie,g!==null){let Ue=g.views;T!==null&&o.bindXRFramebuffer(T.framebuffer);let Be=!1;Ue.length!==Ee.cameras.length&&(Ee.cameras.length=0,Be=!0);for(let we=0;we<Ue.length;we++){let ot=Ue[we],ut=null;if(T!==null)ut=T.getViewport(ot);else{let te=x.getViewSubImage(M,ot);o.bindXRFramebuffer(_),te.depthStencilTexture!==void 0&&n.framebufferTexture2D(36160,U,3553,te.depthStencilTexture,0),n.framebufferTexture2D(36160,36064,3553,te.colorTexture,0),ut=te.viewport}let Le=Te[we];Le.matrix.fromArray(ot.transform.matrix),Le.projectionMatrix.fromArray(ot.projectionMatrix),Le.viewport.set(ut.x,ut.y,ut.width,ut.height),we===0&&Ee.matrix.copy(Le.matrix),Be===!0&&Ee.cameras.push(Le)}N&&(o.bindXRFramebuffer(I),V!==null&&n.clear(V))}let he=l.inputSources;for(let Ue=0;Ue<K.length;Ue++){let Be=K[Ue],we=he[Ue];Be.update(we,ie,f)}if(Pt&&Pt(nt,ie),N){let Ue=M.textureWidth,Be=M.textureHeight;o.bindFramebuffer(36008,I),o.bindFramebuffer(36009,_),n.invalidateFramebuffer(36008,[U]),n.invalidateFramebuffer(36009,[U]),n.blitFramebuffer(0,0,Ue,Be,0,0,Ue,Be,16384,9728),n.invalidateFramebuffer(36008,[36064]),o.bindFramebuffer(36008,null),o.bindFramebuffer(36009,null),o.bindFramebuffer(36160,I)}F=null}),this.setAnimationLoop=function(nt){Pt=nt},this.dispose=function(){}}}function gp(c){function e(i,o){i.opacity.value=o.opacity,o.color&&i.diffuse.value.copy(o.color),o.emissive&&i.emissive.value.copy(o.emissive).multiplyScalar(o.emissiveIntensity),o.map&&(i.map.value=o.map),o.alphaMap&&(i.alphaMap.value=o.alphaMap),o.specularMap&&(i.specularMap.value=o.specularMap),o.alphaTest>0&&(i.alphaTest.value=o.alphaTest);let l=c.get(o).envMap;if(l){i.envMap.value=l,i.flipEnvMap.value=l.isCubeTexture&&l.isRenderTargetTexture===!1?-1:1,i.reflectivity.value=o.reflectivity,i.ior.value=o.ior,i.refractionRatio.value=o.refractionRatio;let p=c.get(l).__maxMipLevel;p!==void 0&&(i.maxMipLevel.value=p)}let h,f;o.lightMap&&(i.lightMap.value=o.lightMap,i.lightMapIntensity.value=o.lightMapIntensity),o.aoMap&&(i.aoMap.value=o.aoMap,i.aoMapIntensity.value=o.aoMapIntensity),o.map?h=o.map:o.specularMap?h=o.specularMap:o.displacementMap?h=o.displacementMap:o.normalMap?h=o.normalMap:o.bumpMap?h=o.bumpMap:o.roughnessMap?h=o.roughnessMap:o.metalnessMap?h=o.metalnessMap:o.alphaMap?h=o.alphaMap:o.emissiveMap?h=o.emissiveMap:o.clearcoatMap?h=o.clearcoatMap:o.clearcoatNormalMap?h=o.clearcoatNormalMap:o.clearcoatRoughnessMap?h=o.clearcoatRoughnessMap:o.specularIntensityMap?h=o.specularIntensityMap:o.specularColorMap?h=o.specularColorMap:o.transmissionMap?h=o.transmissionMap:o.thicknessMap?h=o.thicknessMap:o.sheenColorMap?h=o.sheenColorMap:o.sheenRoughnessMap&&(h=o.sheenRoughnessMap),h!==void 0&&(h.isWebGLRenderTarget&&(h=h.texture),h.matrixAutoUpdate===!0&&h.updateMatrix(),i.uvTransform.value.copy(h.matrix)),o.aoMap?f=o.aoMap:o.lightMap&&(f=o.lightMap),f!==void 0&&(f.isWebGLRenderTarget&&(f=f.texture),f.matrixAutoUpdate===!0&&f.updateMatrix(),i.uv2Transform.value.copy(f.matrix))}function n(i,o){i.roughness.value=o.roughness,i.metalness.value=o.metalness,o.roughnessMap&&(i.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(i.metalnessMap.value=o.metalnessMap),o.emissiveMap&&(i.emissiveMap.value=o.emissiveMap),o.bumpMap&&(i.bumpMap.value=o.bumpMap,i.bumpScale.value=o.bumpScale,o.side===1&&(i.bumpScale.value*=-1)),o.normalMap&&(i.normalMap.value=o.normalMap,i.normalScale.value.copy(o.normalScale),o.side===1&&i.normalScale.value.negate()),o.displacementMap&&(i.displacementMap.value=o.displacementMap,i.displacementScale.value=o.displacementScale,i.displacementBias.value=o.displacementBias),c.get(o).envMap&&(i.envMapIntensity.value=o.envMapIntensity)}return{refreshFogUniforms:function(i,o){i.fogColor.value.copy(o.color),o.isFog?(i.fogNear.value=o.near,i.fogFar.value=o.far):o.isFogExp2&&(i.fogDensity.value=o.density)},refreshMaterialUniforms:function(i,o,l,h,f){o.isMeshBasicMaterial?e(i,o):o.isMeshLambertMaterial?(e(i,o),function(p,g){g.emissiveMap&&(p.emissiveMap.value=g.emissiveMap)}(i,o)):o.isMeshToonMaterial?(e(i,o),function(p,g){g.gradientMap&&(p.gradientMap.value=g.gradientMap),g.emissiveMap&&(p.emissiveMap.value=g.emissiveMap),g.bumpMap&&(p.bumpMap.value=g.bumpMap,p.bumpScale.value=g.bumpScale,g.side===1&&(p.bumpScale.value*=-1)),g.normalMap&&(p.normalMap.value=g.normalMap,p.normalScale.value.copy(g.normalScale),g.side===1&&p.normalScale.value.negate()),g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias)}(i,o)):o.isMeshPhongMaterial?(e(i,o),function(p,g){p.specular.value.copy(g.specular),p.shininess.value=Math.max(g.shininess,1e-4),g.emissiveMap&&(p.emissiveMap.value=g.emissiveMap),g.bumpMap&&(p.bumpMap.value=g.bumpMap,p.bumpScale.value=g.bumpScale,g.side===1&&(p.bumpScale.value*=-1)),g.normalMap&&(p.normalMap.value=g.normalMap,p.normalScale.value.copy(g.normalScale),g.side===1&&p.normalScale.value.negate()),g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias)}(i,o)):o.isMeshStandardMaterial?(e(i,o),o.isMeshPhysicalMaterial?function(p,g,x){n(p,g),p.ior.value=g.ior,g.sheen>0&&(p.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),p.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(p.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(p.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(p.clearcoat.value=g.clearcoat,p.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(p.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(p.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(p.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),p.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===1&&p.clearcoatNormalScale.value.negate())),g.transmission>0&&(p.transmission.value=g.transmission,p.transmissionSamplerMap.value=x.texture,p.transmissionSamplerSize.value.set(x.width,x.height),g.transmissionMap&&(p.transmissionMap.value=g.transmissionMap),p.thickness.value=g.thickness,g.thicknessMap&&(p.thicknessMap.value=g.thicknessMap),p.attenuationDistance.value=g.attenuationDistance,p.attenuationColor.value.copy(g.attenuationColor)),p.specularIntensity.value=g.specularIntensity,p.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(p.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(p.specularColorMap.value=g.specularColorMap)}(i,o,f):n(i,o)):o.isMeshMatcapMaterial?(e(i,o),function(p,g){g.matcap&&(p.matcap.value=g.matcap),g.bumpMap&&(p.bumpMap.value=g.bumpMap,p.bumpScale.value=g.bumpScale,g.side===1&&(p.bumpScale.value*=-1)),g.normalMap&&(p.normalMap.value=g.normalMap,p.normalScale.value.copy(g.normalScale),g.side===1&&p.normalScale.value.negate()),g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias)}(i,o)):o.isMeshDepthMaterial?(e(i,o),function(p,g){g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias)}(i,o)):o.isMeshDistanceMaterial?(e(i,o),function(p,g){g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias),p.referencePosition.value.copy(g.referencePosition),p.nearDistance.value=g.nearDistance,p.farDistance.value=g.farDistance}(i,o)):o.isMeshNormalMaterial?(e(i,o),function(p,g){g.bumpMap&&(p.bumpMap.value=g.bumpMap,p.bumpScale.value=g.bumpScale,g.side===1&&(p.bumpScale.value*=-1)),g.normalMap&&(p.normalMap.value=g.normalMap,p.normalScale.value.copy(g.normalScale),g.side===1&&p.normalScale.value.negate()),g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias)}(i,o)):o.isLineBasicMaterial?(function(p,g){p.diffuse.value.copy(g.color),p.opacity.value=g.opacity}(i,o),o.isLineDashedMaterial&&function(p,g){p.dashSize.value=g.dashSize,p.totalSize.value=g.dashSize+g.gapSize,p.scale.value=g.scale}(i,o)):o.isPointsMaterial?function(p,g,x,_){p.diffuse.value.copy(g.color),p.opacity.value=g.opacity,p.size.value=g.size*x,p.scale.value=.5*_,g.map&&(p.map.value=g.map),g.alphaMap&&(p.alphaMap.value=g.alphaMap),g.alphaTest>0&&(p.alphaTest.value=g.alphaTest);let M;g.map?M=g.map:g.alphaMap&&(M=g.alphaMap),M!==void 0&&(M.matrixAutoUpdate===!0&&M.updateMatrix(),p.uvTransform.value.copy(M.matrix))}(i,o,l,h):o.isSpriteMaterial?function(p,g){p.diffuse.value.copy(g.color),p.opacity.value=g.opacity,p.rotation.value=g.rotation,g.map&&(p.map.value=g.map),g.alphaMap&&(p.alphaMap.value=g.alphaMap),g.alphaTest>0&&(p.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),p.uvTransform.value.copy(x.matrix))}(i,o):o.isShadowMaterial?(i.color.value.copy(o.color),i.opacity.value=o.opacity):o.isShaderMaterial&&(o.uniformsNeedUpdate=!1)}}}function sn(c={}){let e=c.canvas!==void 0?c.canvas:function(){let de=hc("canvas");return de.style.display="block",de}(),n=c.context!==void 0?c.context:null,i=c.alpha!==void 0&&c.alpha,o=c.depth===void 0||c.depth,l=c.stencil===void 0||c.stencil,h=c.antialias!==void 0&&c.antialias,f=c.premultipliedAlpha===void 0||c.premultipliedAlpha,p=c.preserveDrawingBuffer!==void 0&&c.preserveDrawingBuffer,g=c.powerPreference!==void 0?c.powerPreference:"default",x=c.failIfMajorPerformanceCaveat!==void 0&&c.failIfMajorPerformanceCaveat,_=null,M=null,T=[],N=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let I=this,D=!1,L=0,F=0,U=null,V=-1,K=null,re=new on,ve=new on,_e=null,Te=e.width,Ee=e.height,Ne=1,ct=null,Je=null,De=new on(0,0,Te,Ee),Ze=new on(0,0,Te,Ee),vt=!1,xt=[],Tt=new yl,Pt=!1,Ct=!1,nt=null,ie=new Mt,he=new J,Ue={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Be(){return U===null?Ne:1}let we,ot,ut,Le,te,Se,Ve,qe,Fe,_t,Nt,wt,zt,Ot,qn,ln,Xn,Lr,Cs,Fi,Jr,sr,fi,pt=n;function Za(de,We){for(let $e=0;$e<de.length;$e++){let at=de[$e],lt=e.getContext(at,We);if(lt!==null)return lt}return null}try{let de={alpha:i,depth:o,stencil:l,antialias:h,premultipliedAlpha:f,preserveDrawingBuffer:p,powerPreference:g,failIfMajorPerformanceCaveat:x};if(e.addEventListener("webglcontextlost",Kl,!1),e.addEventListener("webglcontextrestored",$a,!1),pt===null){let We=["webgl2","webgl","experimental-webgl"];if(I.isWebGL1Renderer===!0&&We.shift(),pt=Za(We,de),pt===null)throw Za(We)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}pt.getShaderPrecisionFormat===void 0&&(pt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(de){throw console.error("THREE.WebGLRenderer: "+de.message),de}function Ql(){we=new Ff(pt),ot=new Cc(pt,we,c),we.init(ot),sr=new pp(pt,we,ot),ut=new fp(pt,we,ot),xt[0]=1029,Le=new sg(pt),te=new qc,Se=new Sg(pt,we,ut,te,ot,sr,Le),Ve=new ng(I),qe=new gh(I),Fe=new eg(pt,ot),fi=new Of(pt,we,Fe,ot),_t=new ig(pt,Fe,Le,fi),Nt=new cg(pt,_t,Fe,Le),Cs=new oa(pt,ot,Se),ln=new Bf(te),wt=new ca(I,Ve,qe,we,ot,fi,ln),zt=new gp(te),Ot=new lp(te),qn=new Eg(we,ot),Lr=new tg(I,Ve,ut,Nt,f),Xn=new Lo(I,Nt,ot),Fi=new Gf(pt,we,Le,ot),Jr=new og(pt,we,Le,ot),Le.programs=wt.programs,I.capabilities=ot,I.extensions=we,I.properties=te,I.renderLists=Ot,I.shadowMap=Xn,I.state=ut,I.info=Le}Ql();let kn=new mp(I,pt);function Kl(de){de.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function $a(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1;let de=Le.autoReset,We=Xn.enabled,$e=Xn.autoUpdate,at=Xn.needsUpdate,lt=Xn.type;Ql(),Le.autoReset=de,Xn.enabled=We,Xn.autoUpdate=$e,Xn.needsUpdate=at,Xn.type=lt}function Od(de){let We=de.target;We.removeEventListener("dispose",Od),function($e){(function(at){let lt=te.get(at).programs;lt!==void 0&&lt.forEach(function(kt){wt.releaseProgram(kt)})})($e),te.remove($e)}(We)}this.xr=kn,this.getContext=function(){return pt},this.getContextAttributes=function(){return pt.getContextAttributes()},this.forceContextLoss=function(){let de=we.get("WEBGL_lose_context");de&&de.loseContext()},this.forceContextRestore=function(){let de=we.get("WEBGL_lose_context");de&&de.restoreContext()},this.getPixelRatio=function(){return Ne},this.setPixelRatio=function(de){de!==void 0&&(Ne=de,this.setSize(Te,Ee,!1))},this.getSize=function(de){return de.set(Te,Ee)},this.setSize=function(de,We,$e){kn.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Te=de,Ee=We,e.width=Math.floor(de*Ne),e.height=Math.floor(We*Ne),$e!==!1&&(e.style.width=de+"px",e.style.height=We+"px"),this.setViewport(0,0,de,We))},this.getDrawingBufferSize=function(de){return de.set(Te*Ne,Ee*Ne).floor()},this.setDrawingBufferSize=function(de,We,$e){Te=de,Ee=We,Ne=$e,e.width=Math.floor(de*$e),e.height=Math.floor(We*$e),this.setViewport(0,0,de,We)},this.getCurrentViewport=function(de){return de.copy(re)},this.getViewport=function(de){return de.copy(De)},this.setViewport=function(de,We,$e,at){de.isVector4?De.set(de.x,de.y,de.z,de.w):De.set(de,We,$e,at),ut.viewport(re.copy(De).multiplyScalar(Ne).floor())},this.getScissor=function(de){return de.copy(Ze)},this.setScissor=function(de,We,$e,at){de.isVector4?Ze.set(de.x,de.y,de.z,de.w):Ze.set(de,We,$e,at),ut.scissor(ve.copy(Ze).multiplyScalar(Ne).floor())},this.getScissorTest=function(){return vt},this.setScissorTest=function(de){ut.setScissorTest(vt=de)},this.setOpaqueSort=function(de){ct=de},this.setTransparentSort=function(de){Je=de},this.getClearColor=function(de){return de.copy(Lr.getClearColor())},this.setClearColor=function(){Lr.setClearColor.apply(Lr,arguments)},this.getClearAlpha=function(){return Lr.getClearAlpha()},this.setClearAlpha=function(){Lr.setClearAlpha.apply(Lr,arguments)},this.clear=function(de,We,$e){let at=0;(de===void 0||de)&&(at|=16384),(We===void 0||We)&&(at|=256),($e===void 0||$e)&&(at|=1024),pt.clear(at)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Kl,!1),e.removeEventListener("webglcontextrestored",$a,!1),Ot.dispose(),qn.dispose(),te.dispose(),Ve.dispose(),qe.dispose(),Nt.dispose(),fi.dispose(),kn.dispose(),kn.removeEventListener("sessionstart",om),kn.removeEventListener("sessionend",sm),nt&&(nt.dispose(),nt=null),zo.stop()},this.renderBufferDirect=function(de,We,$e,at,lt,kt){We===null&&(We=Ue);let Rt=lt.isMesh&&lt.matrixWorld.determinant()<0,qt=function(Ln,tc,zn,Yt,Hn){tc.isScene!==!0&&(tc=Ue),Se.resetTextureUnits();let Fd=tc.fog,Pg=Yt.isMeshStandardMaterial?tc.environment:null,cm=U===null?I.outputEncoding:U.texture.encoding,um=(Yt.isMeshStandardMaterial?qe:Ve).get(Yt.envMap||Pg),hm=Yt.vertexColors===!0&&!!zn.attributes.color&&zn.attributes.color.itemSize===4,Cu=!!Yt.normalMap&&!!zn.attributes.tangent,dm=!!zn.morphAttributes.position,fm=!!zn.morphAttributes.normal,Cg=zn.morphAttributes.position?zn.morphAttributes.position.length:0,hn=te.get(Yt),zd=M.state.lights;if(Pt===!0&&(Ct===!0||Ln!==K)){let vi=Ln===K&&Yt.id===V;ln.setState(Yt,Ln,vi)}let po=!1;Yt.version===hn.__version?hn.needsLights&&hn.lightsStateVersion!==zd.state.version||hn.outputEncoding!==cm||Hn.isInstancedMesh&&hn.instancing===!1?po=!0:Hn.isInstancedMesh||hn.instancing!==!0?Hn.isSkinnedMesh&&hn.skinning===!1?po=!0:Hn.isSkinnedMesh||hn.skinning!==!0?hn.envMap!==um||Yt.fog&&hn.fog!==Fd?po=!0:hn.numClippingPlanes===void 0||hn.numClippingPlanes===ln.numPlanes&&hn.numIntersection===ln.numIntersection?(hn.vertexAlphas!==hm||hn.vertexTangents!==Cu||hn.morphTargets!==dm||hn.morphNormals!==fm||ot.isWebGL2===!0&&hn.morphTargetsCount!==Cg)&&(po=!0):po=!0:po=!0:po=!0:(po=!0,hn.__version=Yt.version);let pi=hn.currentProgram;po===!0&&(pi=Pu(Yt,tc,Hn));let Hd=!1,Pr=!1,Iu=!1,Jn=pi.getUniforms(),Ho=hn.uniforms;if(ut.useProgram(pi.program)&&(Hd=!0,Pr=!0,Iu=!0),Yt.id!==V&&(V=Yt.id,Pr=!0),Hd||K!==Ln){if(Jn.setValue(pt,"projectionMatrix",Ln.projectionMatrix),ot.logarithmicDepthBuffer&&Jn.setValue(pt,"logDepthBufFC",2/(Math.log(Ln.far+1)/Math.LN2)),K!==Ln&&(K=Ln,Pr=!0,Iu=!0),Yt.isShaderMaterial||Yt.isMeshPhongMaterial||Yt.isMeshToonMaterial||Yt.isMeshStandardMaterial||Yt.envMap){let vi=Jn.map.cameraPosition;vi!==void 0&&vi.setValue(pt,he.setFromMatrixPosition(Ln.matrixWorld))}(Yt.isMeshPhongMaterial||Yt.isMeshToonMaterial||Yt.isMeshLambertMaterial||Yt.isMeshBasicMaterial||Yt.isMeshStandardMaterial||Yt.isShaderMaterial)&&Jn.setValue(pt,"isOrthographic",Ln.isOrthographicCamera===!0),(Yt.isMeshPhongMaterial||Yt.isMeshToonMaterial||Yt.isMeshLambertMaterial||Yt.isMeshBasicMaterial||Yt.isMeshStandardMaterial||Yt.isShaderMaterial||Yt.isShadowMaterial||Hn.isSkinnedMesh)&&Jn.setValue(pt,"viewMatrix",Ln.matrixWorldInverse)}if(Hn.isSkinnedMesh){Jn.setOptional(pt,Hn,"bindMatrix"),Jn.setOptional(pt,Hn,"bindMatrixInverse");let vi=Hn.skeleton;vi&&(ot.floatVertexTextures?(vi.boneTexture===null&&vi.computeBoneTexture(),Jn.setValue(pt,"boneTexture",vi.boneTexture,Se),Jn.setValue(pt,"boneTextureSize",vi.boneTextureSize)):Jn.setOptional(pt,vi,"boneMatrices"))}!zn||zn.morphAttributes.position===void 0&&zn.morphAttributes.normal===void 0||Cs.update(Hn,zn,Yt,pi),(Pr||hn.receiveShadow!==Hn.receiveShadow)&&(hn.receiveShadow=Hn.receiveShadow,Jn.setValue(pt,"receiveShadow",Hn.receiveShadow)),Pr&&(Jn.setValue(pt,"toneMappingExposure",I.toneMappingExposure),hn.needsLights&&(gi=Iu,(mi=Ho).ambientLightColor.needsUpdate=gi,mi.lightProbe.needsUpdate=gi,mi.directionalLights.needsUpdate=gi,mi.directionalLightShadows.needsUpdate=gi,mi.pointLights.needsUpdate=gi,mi.pointLightShadows.needsUpdate=gi,mi.spotLights.needsUpdate=gi,mi.spotLightShadows.needsUpdate=gi,mi.rectAreaLights.needsUpdate=gi,mi.hemisphereLights.needsUpdate=gi),Fd&&Yt.fog&&zt.refreshFogUniforms(Ho,Fd),zt.refreshMaterialUniforms(Ho,Yt,Ne,Ee,nt),Ki.upload(pt,hn.uniformsList,Ho,Se));var mi,gi;return Yt.isShaderMaterial&&Yt.uniformsNeedUpdate===!0&&(Ki.upload(pt,hn.uniformsList,Ho,Se),Yt.uniformsNeedUpdate=!1),Yt.isSpriteMaterial&&Jn.setValue(pt,"center",Hn.center),Jn.setValue(pt,"modelViewMatrix",Hn.modelViewMatrix),Jn.setValue(pt,"normalMatrix",Hn.normalMatrix),Jn.setValue(pt,"modelMatrix",Hn.matrixWorld),pi}(de,We,$e,at,lt);ut.setMaterial(at,Rt);let en=$e.index,vn=$e.attributes.position;if(en===null){if(vn===void 0||vn.count===0)return}else if(en.count===0)return;let Zt,$t=1;at.wireframe===!0&&(en=_t.getWireframeAttribute($e),$t=2),fi.setup(lt,at,qt,$e,en);let Fn=Fi;en!==null&&(Zt=Fe.get(en),Fn=Jr,Fn.setIndex(Zt));let ec=en!==null?en.count:vn.count,yr=$e.drawRange.start*$t,Ud=$e.drawRange.count*$t,ho=kt!==null?kt.start*$t:0,kd=kt!==null?kt.count*$t:1/0,fo=Math.max(yr,ho),Qa=Math.min(ec,yr+Ud,ho+kd)-1,Ds=Math.max(0,Qa-fo+1);if(Ds!==0){if(lt.isMesh)at.wireframe===!0?(ut.setLineWidth(at.wireframeLinewidth*Be()),Fn.setMode(1)):Fn.setMode(4);else if(lt.isLine){let Ln=at.linewidth;Ln===void 0&&(Ln=1),ut.setLineWidth(Ln*Be()),lt.isLineSegments?Fn.setMode(1):lt.isLineLoop?Fn.setMode(2):Fn.setMode(3)}else lt.isPoints?Fn.setMode(0):lt.isSprite&&Fn.setMode(4);if(lt.isInstancedMesh)Fn.renderInstances(fo,Ds,lt.count);else if($e.isInstancedBufferGeometry){let Ln=Math.min($e.instanceCount,$e._maxInstanceCount);Fn.renderInstances(fo,Ds,Ln)}else Fn.render(fo,Ds)}},this.compile=function(de,We){M=qn.get(de),M.init(),N.push(M),de.traverseVisible(function($e){$e.isLight&&$e.layers.test(We.layers)&&(M.pushLight($e),$e.castShadow&&M.pushShadow($e))}),M.setupLights(I.physicallyCorrectLights),de.traverse(function($e){let at=$e.material;if(at)if(Array.isArray(at))for(let lt=0;lt<at.length;lt++)Pu(at[lt],de,$e);else Pu(at,de,$e)}),N.pop(),M=null};let Gd=null;function om(){zo.stop()}function sm(){zo.start()}let zo=new Df;function Is(de,We,$e,at){if(de.visible===!1)return;if(de.layers.test(We.layers)){if(de.isGroup)$e=de.renderOrder;else if(de.isLOD)de.autoUpdate===!0&&de.update(We);else if(de.isLight)M.pushLight(de),de.castShadow&&M.pushShadow(de);else if(de.isSprite){if(!de.frustumCulled||Tt.intersectsSprite(de)){at&&he.setFromMatrixPosition(de.matrixWorld).applyMatrix4(ie);let kt=Nt.update(de),Rt=de.material;Rt.visible&&_.push(de,kt,Rt,$e,he.z,null)}}else if((de.isMesh||de.isLine||de.isPoints)&&(de.isSkinnedMesh&&de.skeleton.frame!==Le.render.frame&&(de.skeleton.update(),de.skeleton.frame=Le.render.frame),!de.frustumCulled||Tt.intersectsObject(de))){at&&he.setFromMatrixPosition(de.matrixWorld).applyMatrix4(ie);let kt=Nt.update(de),Rt=de.material;if(Array.isArray(Rt)){let qt=kt.groups;for(let en=0,vn=qt.length;en<vn;en++){let Zt=qt[en],$t=Rt[Zt.materialIndex];$t&&$t.visible&&_.push(de,kt,$t,$e,he.z,Zt)}}else Rt.visible&&_.push(de,kt,Rt,$e,he.z,null)}}let lt=de.children;for(let kt=0,Rt=lt.length;kt<Rt;kt++)Is(lt[kt],We,$e,at)}function am(de,We,$e,at){let lt=de.opaque,kt=de.transmissive,Rt=de.transparent;M.setupLightsView($e),kt.length>0&&function(qt,en,vn){if(nt===null){let Fn=h===!0&&ot.isWebGL2===!0;nt=new(Fn?$u:lr)(1024,1024,{generateMipmaps:!0,type:sr.convert(1016)!==null?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001})}let Zt=I.getRenderTarget();I.setRenderTarget(nt),I.clear();let $t=I.toneMapping;I.toneMapping=0,Lu(qt,en,vn),I.toneMapping=$t,Se.updateMultisampleRenderTarget(nt),Se.updateRenderTargetMipmap(nt),I.setRenderTarget(Zt)}(lt,We,$e),at&&ut.viewport(re.copy(at)),lt.length>0&&Lu(lt,We,$e),kt.length>0&&Lu(kt,We,$e),Rt.length>0&&Lu(Rt,We,$e)}function Lu(de,We,$e){let at=We.isScene===!0?We.overrideMaterial:null;for(let lt=0,kt=de.length;lt<kt;lt++){let Rt=de[lt],qt=Rt.object,en=Rt.geometry,vn=at===null?Rt.material:at,Zt=Rt.group;qt.layers.test($e.layers)&&lm(qt,We,$e,en,vn,Zt)}}function lm(de,We,$e,at,lt,kt){de.onBeforeRender(I,We,$e,at,lt,kt),de.modelViewMatrix.multiplyMatrices($e.matrixWorldInverse,de.matrixWorld),de.normalMatrix.getNormalMatrix(de.modelViewMatrix),lt.onBeforeRender(I,We,$e,at,de,kt),lt.transparent===!0&&lt.side===2?(lt.side=1,lt.needsUpdate=!0,I.renderBufferDirect($e,We,at,lt,de,kt),lt.side=0,lt.needsUpdate=!0,I.renderBufferDirect($e,We,at,lt,de,kt),lt.side=2):I.renderBufferDirect($e,We,at,lt,de,kt),de.onAfterRender(I,We,$e,at,lt,kt)}function Pu(de,We,$e){We.isScene!==!0&&(We=Ue);let at=te.get(de),lt=M.state.lights,kt=M.state.shadowsArray,Rt=lt.state.version,qt=wt.getParameters(de,lt.state,kt,We,$e),en=wt.getProgramCacheKey(qt),vn=at.programs;at.environment=de.isMeshStandardMaterial?We.environment:null,at.fog=We.fog,at.envMap=(de.isMeshStandardMaterial?qe:Ve).get(de.envMap||at.environment),vn===void 0&&(de.addEventListener("dispose",Od),vn=new Map,at.programs=vn);let Zt=vn.get(en);if(Zt!==void 0){if(at.currentProgram===Zt&&at.lightsStateVersion===Rt)return Bd(de,qt),Zt}else qt.uniforms=wt.getUniforms(de),de.onBuild($e,qt,I),de.onBeforeCompile(qt,I),Zt=wt.acquireProgram(qt,en),vn.set(en,Zt),at.uniforms=qt.uniforms;let $t=at.uniforms;(de.isShaderMaterial||de.isRawShaderMaterial)&&de.clipping!==!0||($t.clippingPlanes=ln.uniform),Bd(de,qt),at.needsLights=function(yr){return yr.isMeshLambertMaterial||yr.isMeshToonMaterial||yr.isMeshPhongMaterial||yr.isMeshStandardMaterial||yr.isShadowMaterial||yr.isShaderMaterial&&yr.lights===!0}(de),at.lightsStateVersion=Rt,at.needsLights&&($t.ambientLightColor.value=lt.state.ambient,$t.lightProbe.value=lt.state.probe,$t.directionalLights.value=lt.state.directional,$t.directionalLightShadows.value=lt.state.directionalShadow,$t.spotLights.value=lt.state.spot,$t.spotLightShadows.value=lt.state.spotShadow,$t.rectAreaLights.value=lt.state.rectArea,$t.ltc_1.value=lt.state.rectAreaLTC1,$t.ltc_2.value=lt.state.rectAreaLTC2,$t.pointLights.value=lt.state.point,$t.pointLightShadows.value=lt.state.pointShadow,$t.hemisphereLights.value=lt.state.hemi,$t.directionalShadowMap.value=lt.state.directionalShadowMap,$t.directionalShadowMatrix.value=lt.state.directionalShadowMatrix,$t.spotShadowMap.value=lt.state.spotShadowMap,$t.spotShadowMatrix.value=lt.state.spotShadowMatrix,$t.pointShadowMap.value=lt.state.pointShadowMap,$t.pointShadowMatrix.value=lt.state.pointShadowMatrix);let Fn=Zt.getUniforms(),ec=Ki.seqWithValue(Fn.seq,$t);return at.currentProgram=Zt,at.uniformsList=ec,Zt}function Bd(de,We){let $e=te.get(de);$e.outputEncoding=We.outputEncoding,$e.instancing=We.instancing,$e.skinning=We.skinning,$e.morphTargets=We.morphTargets,$e.morphNormals=We.morphNormals,$e.morphTargetsCount=We.morphTargetsCount,$e.numClippingPlanes=We.numClippingPlanes,$e.numIntersection=We.numClipIntersection,$e.vertexAlphas=We.vertexAlphas,$e.vertexTangents=We.vertexTangents}zo.setAnimationLoop(function(de){Gd&&Gd(de)}),typeof window<"u"&&zo.setContext(window),this.setAnimationLoop=function(de){Gd=de,kn.setAnimationLoop(de),de===null?zo.stop():zo.start()},kn.addEventListener("sessionstart",om),kn.addEventListener("sessionend",sm),this.render=function(de,We){if(We!==void 0&&We.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(D===!0)return;de.autoUpdate===!0&&de.updateMatrixWorld(),We.parent===null&&We.updateMatrixWorld(),kn.enabled===!0&&kn.isPresenting===!0&&(kn.cameraAutoUpdate===!0&&kn.updateCamera(We),We=kn.getCamera()),de.isScene===!0&&de.onBeforeRender(I,de,We,U),M=qn.get(de,N.length),M.init(),N.push(M),ie.multiplyMatrices(We.projectionMatrix,We.matrixWorldInverse),Tt.setFromProjectionMatrix(ie),Ct=this.localClippingEnabled,Pt=ln.init(this.clippingPlanes,Ct,We),_=Ot.get(de,T.length),_.init(),T.push(_),Is(de,We,0,I.sortObjects),_.finish(),I.sortObjects===!0&&_.sort(ct,Je),Pt===!0&&ln.beginShadows();let $e=M.state.shadowsArray;if(Xn.render($e,de,We),Pt===!0&&ln.endShadows(),this.info.autoReset===!0&&this.info.reset(),Lr.render(_,de),M.setupLights(I.physicallyCorrectLights),We.isArrayCamera){let at=We.cameras;for(let lt=0,kt=at.length;lt<kt;lt++){let Rt=at[lt];am(_,de,Rt,Rt.viewport)}}else am(_,de,We);U!==null&&(Se.updateMultisampleRenderTarget(U),Se.updateRenderTargetMipmap(U)),de.isScene===!0&&de.onAfterRender(I,de,We),ut.buffers.depth.setTest(!0),ut.buffers.depth.setMask(!0),ut.buffers.color.setMask(!0),ut.setPolygonOffset(!1),fi.resetDefaultState(),V=-1,K=null,N.pop(),M=N.length>0?N[N.length-1]:null,T.pop(),_=T.length>0?T[T.length-1]:null},this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return U},this.setRenderTarget=function(de,We=0,$e=0){U=de,L=We,F=$e,de&&te.get(de).__webglFramebuffer===void 0&&Se.setupRenderTarget(de);let at=null,lt=!1,kt=!1;if(de){let Rt=de.texture;(Rt.isDataTexture3D||Rt.isDataTexture2DArray)&&(kt=!0);let qt=te.get(de).__webglFramebuffer;de.isWebGLCubeRenderTarget?(at=qt[We],lt=!0):at=de.isWebGLMultisampleRenderTarget?te.get(de).__webglMultisampledFramebuffer:qt,re.copy(de.viewport),ve.copy(de.scissor),_e=de.scissorTest}else re.copy(De).multiplyScalar(Ne).floor(),ve.copy(Ze).multiplyScalar(Ne).floor(),_e=vt;if(ut.bindFramebuffer(36160,at)&&ot.drawBuffers){let Rt=!1;if(de)if(de.isWebGLMultipleRenderTargets){let qt=de.texture;if(xt.length!==qt.length||xt[0]!==36064){for(let en=0,vn=qt.length;en<vn;en++)xt[en]=36064+en;xt.length=qt.length,Rt=!0}}else xt.length===1&&xt[0]===36064||(xt[0]=36064,xt.length=1,Rt=!0);else xt.length===1&&xt[0]===1029||(xt[0]=1029,xt.length=1,Rt=!0);Rt&&(ot.isWebGL2?pt.drawBuffers(xt):we.get("WEBGL_draw_buffers").drawBuffersWEBGL(xt))}if(ut.viewport(re),ut.scissor(ve),ut.setScissorTest(_e),lt){let Rt=te.get(de.texture);pt.framebufferTexture2D(36160,36064,34069+We,Rt.__webglTexture,$e)}else if(kt){let Rt=te.get(de.texture),qt=We||0;pt.framebufferTextureLayer(36160,36064,Rt.__webglTexture,$e||0,qt)}V=-1},this.readRenderTargetPixels=function(de,We,$e,at,lt,kt,Rt){if(!de||!de.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let qt=te.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&Rt!==void 0&&(qt=qt[Rt]),qt){ut.bindFramebuffer(36160,qt);try{let en=de.texture,vn=en.format,Zt=en.type;if(vn!==1023&&sr.convert(vn)!==pt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let $t=Zt===1016&&(we.has("EXT_color_buffer_half_float")||ot.isWebGL2&&we.has("EXT_color_buffer_float"));if(!(Zt===1009||sr.convert(Zt)===pt.getParameter(35738)||Zt===1015&&(ot.isWebGL2||we.has("OES_texture_float")||we.has("WEBGL_color_buffer_float"))||$t))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");pt.checkFramebufferStatus(36160)===36053?We>=0&&We<=de.width-at&&$e>=0&&$e<=de.height-lt&&pt.readPixels(We,$e,at,lt,sr.convert(vn),sr.convert(Zt),kt):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let en=U!==null?te.get(U).__webglFramebuffer:null;ut.bindFramebuffer(36160,en)}}},this.copyFramebufferToTexture=function(de,We,$e=0){let at=Math.pow(2,-$e),lt=Math.floor(We.image.width*at),kt=Math.floor(We.image.height*at),Rt=sr.convert(We.format);ot.isWebGL2&&(Rt===6407&&(Rt=32849),Rt===6408&&(Rt=32856)),Se.setTexture2D(We,0),pt.copyTexImage2D(3553,$e,Rt,de.x,de.y,lt,kt,0),ut.unbindTexture()},this.copyTextureToTexture=function(de,We,$e,at=0){let lt=We.image.width,kt=We.image.height,Rt=sr.convert($e.format),qt=sr.convert($e.type);Se.setTexture2D($e,0),pt.pixelStorei(37440,$e.flipY),pt.pixelStorei(37441,$e.premultiplyAlpha),pt.pixelStorei(3317,$e.unpackAlignment),We.isDataTexture?pt.texSubImage2D(3553,at,de.x,de.y,lt,kt,Rt,qt,We.image.data):We.isCompressedTexture?pt.compressedTexSubImage2D(3553,at,de.x,de.y,We.mipmaps[0].width,We.mipmaps[0].height,Rt,We.mipmaps[0].data):pt.texSubImage2D(3553,at,de.x,de.y,Rt,qt,We.image),at===0&&$e.generateMipmaps&&pt.generateMipmap(3553),ut.unbindTexture()},this.copyTextureToTexture3D=function(de,We,$e,at,lt=0){if(I.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let kt=de.max.x-de.min.x+1,Rt=de.max.y-de.min.y+1,qt=de.max.z-de.min.z+1,en=sr.convert(at.format),vn=sr.convert(at.type),Zt;if(at.isDataTexture3D)Se.setTexture3D(at,0),Zt=32879;else{if(!at.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Se.setTexture2DArray(at,0),Zt=35866}pt.pixelStorei(37440,at.flipY),pt.pixelStorei(37441,at.premultiplyAlpha),pt.pixelStorei(3317,at.unpackAlignment);let $t=pt.getParameter(3314),Fn=pt.getParameter(32878),ec=pt.getParameter(3316),yr=pt.getParameter(3315),Ud=pt.getParameter(32877),ho=$e.isCompressedTexture?$e.mipmaps[0]:$e.image;pt.pixelStorei(3314,ho.width),pt.pixelStorei(32878,ho.height),pt.pixelStorei(3316,de.min.x),pt.pixelStorei(3315,de.min.y),pt.pixelStorei(32877,de.min.z),$e.isDataTexture||$e.isDataTexture3D?pt.texSubImage3D(Zt,lt,We.x,We.y,We.z,kt,Rt,qt,en,vn,ho.data):$e.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),pt.compressedTexSubImage3D(Zt,lt,We.x,We.y,We.z,kt,Rt,qt,en,ho.data)):pt.texSubImage3D(Zt,lt,We.x,We.y,We.z,kt,Rt,qt,en,vn,ho),pt.pixelStorei(3314,$t),pt.pixelStorei(32878,Fn),pt.pixelStorei(3316,ec),pt.pixelStorei(3315,yr),pt.pixelStorei(32877,Ud),lt===0&&at.generateMipmaps&&pt.generateMipmap(Zt),ut.unbindTexture()},this.initTexture=function(de){Se.setTexture2D(de,0),ut.unbindTexture()},this.resetState=function(){L=0,F=0,U=null,ut.reset(),fi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}sn.prototype.isWebGLRenderer=!0;class Bh extends sn{}Bh.prototype.isWebGL1Renderer=!0;class ua{constructor(e,n=25e-5){this.name="",this.color=new yt(e),this.density=n}clone(){return new ua(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ua.prototype.isFogExp2=!0;class ha{constructor(e,n=1,i=1e3){this.name="",this.color=new yt(e),this.near=n,this.far=i}clone(){return new ha(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ha.prototype.isFog=!0;class Po extends Xt{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),n}}Po.prototype.isScene=!0;class eo{constructor(e,n){this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=mr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,i){e*=this.stride,i*=n.stride;for(let o=0,l=this.stride;o<l;o++)this.array[e+o]=n.array[i+o];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=mr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=mr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}eo.prototype.isInterleavedBuffer=!0;let wn=new J;class Rr{constructor(e,n,i,o=!1){this.name="",this.data=e,this.itemSize=n,this.offset=i,this.normalized=o===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,i=this.data.count;n<i;n++)wn.x=this.getX(n),wn.y=this.getY(n),wn.z=this.getZ(n),wn.applyMatrix4(e),this.setXYZ(n,wn.x,wn.y,wn.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)wn.x=this.getX(n),wn.y=this.getY(n),wn.z=this.getZ(n),wn.applyNormalMatrix(e),this.setXYZ(n,wn.x,wn.y,wn.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)wn.x=this.getX(n),wn.y=this.getY(n),wn.z=this.getZ(n),wn.transformDirection(e),this.setXYZ(n,wn.x,wn.y,wn.z);return this}setX(e,n){return this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=n,this.data.array[e+1]=i,this}setXYZ(e,n,i,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=o,this}setXYZW(e,n,i,o,l){return e=e*this.data.stride+this.offset,this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=o,this.data.array[e+3]=l,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let n=[];for(let i=0;i<this.count;i++){let o=i*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)n.push(this.data.array[o+l])}return new Jt(new this.array.constructor(n),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Rr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let n=[];for(let i=0;i<this.count;i++){let o=i*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)n.push(this.data.array[o+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Rr.prototype.isInterleavedBufferAttribute=!0;class da extends Gn{constructor(e){super(),this.type="SpriteMaterial",this.color=new yt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Co;da.prototype.isSpriteMaterial=!0;let fa=new J,ls=new J,pa=new J,ma=new Ke,ga=new Ke,ci=new Mt,va=new J,cs=new J,Zc=new J,Uh=new Ke,ya=new Ke,kh=new Ke;class $c extends Xt{constructor(e){if(super(),this.type="Sprite",Co===void 0){Co=new Dt;let n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new eo(n,5);Co.setIndex([0,1,2,0,2,3]),Co.setAttribute("position",new Rr(i,3,0,!1)),Co.setAttribute("uv",new Rr(i,2,3,!1))}this.geometry=Co,this.material=e!==void 0?e:new da,this.center=new Ke(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ls.setFromMatrixScale(this.matrixWorld),ci.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),pa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ls.multiplyScalar(-pa.z);let i=this.material.rotation,o,l;i!==0&&(l=Math.cos(i),o=Math.sin(i));let h=this.center;Al(va.set(-.5,-.5,0),pa,h,ls,o,l),Al(cs.set(.5,-.5,0),pa,h,ls,o,l),Al(Zc.set(.5,.5,0),pa,h,ls,o,l),Uh.set(0,0),ya.set(1,0),kh.set(1,1);let f=e.ray.intersectTriangle(va,cs,Zc,!1,fa);if(f===null&&(Al(cs.set(-.5,.5,0),pa,h,ls,o,l),ya.set(0,1),f=e.ray.intersectTriangle(va,Zc,cs,!1,fa),f===null))return;let p=e.ray.origin.distanceTo(fa);p<e.near||p>e.far||n.push({distance:p,point:fa.clone(),uv:Sn.getUV(fa,va,cs,Zc,Uh,ya,kh,new Ke),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Al(c,e,n,i,o,l){ma.subVectors(c,n).addScalar(.5).multiply(i),o!==void 0?(ga.x=l*ma.x-o*ma.y,ga.y=o*ma.x+l*ma.y):ga.copy(ma),c.copy(e),c.x+=ga.x,c.y+=ga.y,c.applyMatrix4(ci)}$c.prototype.isSprite=!0;let Io=new J,xa=new J;class Fh extends Xt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let n=e.levels;for(let i=0,o=n.length;i<o;i++){let l=n[i];this.addLevel(l.object.clone(),l.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0){n=Math.abs(n);let i=this.levels,o;for(o=0;o<i.length&&!(n<i[o].distance);o++);return i.splice(o,0,{distance:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let n=this.levels;if(n.length>0){let i,o;for(i=1,o=n.length;i<o&&!(e<n[i].distance);i++);return n[i-1].object}return null}raycast(e,n){if(this.levels.length>0){Io.setFromMatrixPosition(this.matrixWorld);let i=e.ray.origin.distanceTo(Io);this.getObjectForDistance(i).raycast(e,n)}}update(e){let n=this.levels;if(n.length>1){Io.setFromMatrixPosition(e.matrixWorld),xa.setFromMatrixPosition(this.matrixWorld);let i=Io.distanceTo(xa)/e.zoom,o,l;for(n[0].object.visible=!0,o=1,l=n.length;o<l&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(this._currentLevel=o-1;o<l;o++)n[o].object.visible=!1}}toJSON(e){let n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];let i=this.levels;for(let o=0,l=i.length;o<l;o++){let h=i[o];n.object.levels.push({object:h.object.uuid,distance:h.distance})}return n}}let zh=new J,_a=new on,Hh=new on,Vh=new J,Qc=new Mt;class us extends Tn{constructor(e,n){super(e,n),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Mt,this.bindMatrixInverse=new Mt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new on,n=this.geometry.attributes.skinWeight;for(let i=0,o=n.count;i<o;i++){e.x=n.getX(i),e.y=n.getY(i),e.z=n.getZ(i),e.w=n.getW(i);let l=1/e.manhattanLength();l!==1/0?e.multiplyScalar(l):e.set(1,0,0,0),n.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,n){let i=this.skeleton,o=this.geometry;_a.fromBufferAttribute(o.attributes.skinIndex,e),Hh.fromBufferAttribute(o.attributes.skinWeight,e),zh.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let l=0;l<4;l++){let h=Hh.getComponent(l);if(h!==0){let f=_a.getComponent(l);Qc.multiplyMatrices(i.bones[f].matrixWorld,i.boneInverses[f]),n.addScaledVector(Vh.copy(zh).applyMatrix4(Qc),h)}}return n.applyMatrix4(this.bindMatrixInverse)}}us.prototype.isSkinnedMesh=!0;class ba extends Xt{constructor(){super(),this.type="Bone"}}ba.prototype.isBone=!0;class to extends Dn{constructor(e=null,n=1,i=1,o,l,h,f,p,g=1003,x=1003,_,M){super(null,h,f,p,g,x,o,l,_,M),this.image={data:e,width:n,height:i},this.magFilter=g,this.minFilter=x,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}to.prototype.isDataTexture=!0;let Kc=new Mt,Wh=new Mt;class eu{constructor(e=[],n=[]){this.uuid=mr(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new Mt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){let i=new Mt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture;for(let l=0,h=e.length;l<h;l++){let f=e[l]?e[l].matrixWorld:Wh;Kc.multiplyMatrices(f,n[l]),Kc.toArray(i,16*l)}o!==null&&(o.needsUpdate=!0)}clone(){return new eu(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=_f(e),e=Math.max(e,4);let n=new Float32Array(e*e*4);n.set(this.boneMatrices);let i=new to(n,e,e,1023,1015);return this.boneMatrices=n,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let n=0,i=this.bones.length;n<i;n++){let o=this.bones[n];if(o.name===e)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let i=0,o=e.bones.length;i<o;i++){let l=e.bones[i],h=n[l];h===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),h=new ba),this.bones.push(h),this.boneInverses.push(new Mt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let n=this.bones,i=this.boneInverses;for(let o=0,l=n.length;o<l;o++){let h=n[o];e.bones.push(h.uuid);let f=i[o];e.boneInverses.push(f.toArray())}return e}}class hs extends Jt{constructor(e,n,i,o=1){typeof i=="number"&&(o=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,n,i),this.meshPerAttribute=o}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}hs.prototype.isInstancedBufferAttribute=!0;let vp=new Mt,yp=new Mt,tu=[],Nl=new Tn;class Rl extends Tn{constructor(e,n,i){super(e,n),this.instanceMatrix=new hs(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,n){n.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,16*e)}raycast(e,n){let i=this.matrixWorld,o=this.count;if(Nl.geometry=this.geometry,Nl.material=this.material,Nl.material!==void 0)for(let l=0;l<o;l++){this.getMatrixAt(l,vp),yp.multiplyMatrices(i,vp),Nl.matrixWorld=yp,Nl.raycast(e,tu);for(let h=0,f=tu.length;h<f;h++){let p=tu[h];p.instanceId=l,p.object=this,n.push(p)}tu.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new hs(new Float32Array(3*this.instanceMatrix.count),3)),n.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Rl.prototype.isInstancedMesh=!0;class Yn extends Gn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new yt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Yn.prototype.isLineBasicMaterial=!0;let xp=new J,jh=new J,ds=new Mt,nu=new ri,fs=new qi;class Ci extends Xt{constructor(e=new Dt,n=new Yn){super(),this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let n=e.attributes.position,i=[0];for(let o=1,l=n.count;o<l;o++)xp.fromBufferAttribute(n,o-1),jh.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=xp.distanceTo(jh);e.setAttribute("lineDistance",new At(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,n){let i=this.geometry,o=this.matrixWorld,l=e.params.Line.threshold,h=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),fs.copy(i.boundingSphere),fs.applyMatrix4(o),fs.radius+=l,e.ray.intersectsSphere(fs)===!1)return;ds.copy(o).invert(),nu.copy(e.ray).applyMatrix4(ds);let f=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=f*f,g=new J,x=new J,_=new J,M=new J,T=this.isLineSegments?2:1;if(i.isBufferGeometry){let N=i.index,I=i.attributes.position;if(N!==null)for(let D=Math.max(0,h.start),L=Math.min(N.count,h.start+h.count)-1;D<L;D+=T){let F=N.getX(D),U=N.getX(D+1);if(g.fromBufferAttribute(I,F),x.fromBufferAttribute(I,U),nu.distanceSqToSegment(g,x,M,_)>p)continue;M.applyMatrix4(this.matrixWorld);let V=e.ray.origin.distanceTo(M);V<e.near||V>e.far||n.push({distance:V,point:_.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}else for(let D=Math.max(0,h.start),L=Math.min(I.count,h.start+h.count)-1;D<L;D+=T){if(g.fromBufferAttribute(I,D),x.fromBufferAttribute(I,D+1),nu.distanceSqToSegment(g,x,M,_)>p)continue;M.applyMatrix4(this.matrixWorld);let F=e.ray.origin.distanceTo(M);F<e.near||F>e.far||n.push({distance:F,point:_.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let n=e.morphAttributes,i=Object.keys(n);if(i.length>0){let o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=o.length;l<h;l++){let f=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=l}}}}else{let n=e.morphTargets;n!==void 0&&n.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ci.prototype.isLine=!0;let ru=new J,Ma=new J;class hr extends Ci{constructor(e,n){super(e,n),this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let n=e.attributes.position,i=[];for(let o=0,l=n.count;o<l;o+=2)ru.fromBufferAttribute(n,o),Ma.fromBufferAttribute(n,o+1),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+ru.distanceTo(Ma);e.setAttribute("lineDistance",new At(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}hr.prototype.isLineSegments=!0;class iu extends Ci{constructor(e,n){super(e,n),this.type="LineLoop"}}iu.prototype.isLineLoop=!0;class Do extends Gn{constructor(e){super(),this.type="PointsMaterial",this.color=new yt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Do.prototype.isPointsMaterial=!0;let Yh=new Mt,wa=new ri,Ll=new qi,ps=new J;class ui extends Xt{constructor(e=new Dt,n=new Do){super(),this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,n){let i=this.geometry,o=this.matrixWorld,l=e.params.Points.threshold,h=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ll.copy(i.boundingSphere),Ll.applyMatrix4(o),Ll.radius+=l,e.ray.intersectsSphere(Ll)===!1)return;Yh.copy(o).invert(),wa.copy(e.ray).applyMatrix4(Yh);let f=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=f*f;if(i.isBufferGeometry){let g=i.index,x=i.attributes.position;if(g!==null)for(let _=Math.max(0,h.start),M=Math.min(g.count,h.start+h.count);_<M;_++){let T=g.getX(_);ps.fromBufferAttribute(x,T),ms(ps,T,p,o,e,n,this)}else for(let _=Math.max(0,h.start),M=Math.min(x.count,h.start+h.count);_<M;_++)ps.fromBufferAttribute(x,_),ms(ps,_,p,o,e,n,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let n=e.morphAttributes,i=Object.keys(n);if(i.length>0){let o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=o.length;l<h;l++){let f=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=l}}}}else{let n=e.morphTargets;n!==void 0&&n.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ms(c,e,n,i,o,l,h){let f=wa.distanceSqToPoint(c);if(f<n){let p=new J;wa.closestPointToPoint(c,p),p.applyMatrix4(i);let g=o.ray.origin.distanceTo(p);if(g<o.near||g>o.far)return;l.push({distance:g,distanceToRay:Math.sqrt(f),point:p,index:e,face:null,object:h})}}ui.prototype.isPoints=!0;class _p extends Dn{constructor(e,n,i,o,l,h,f,p,g){super(e,n,i,o,l,h,f,p,g),this.format=f!==void 0?f:1022,this.minFilter=h!==void 0?h:1006,this.magFilter=l!==void 0?l:1006,this.generateMipmaps=!1;let x=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function _(){x.needsUpdate=!0,e.requestVideoFrameCallback(_)})}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}_p.prototype.isVideoTexture=!0;class ou extends Dn{constructor(e,n,i,o,l,h,f,p,g,x,_,M){super(null,h,f,p,g,x,o,l,_,M),this.image={width:n,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}ou.prototype.isCompressedTexture=!0;class su extends Dn{constructor(e,n,i,o,l,h,f,p,g){super(e,n,i,o,l,h,f,p,g),this.needsUpdate=!0}}su.prototype.isCanvasTexture=!0;class qh extends Dn{constructor(e,n,i,o,l,h,f,p,g,x){if((x=x!==void 0?x:1026)!==1026&&x!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&x===1026&&(i=1012),i===void 0&&x===1027&&(i=1020),super(null,o,l,h,f,p,x,i,g),this.image={width:e,height:n},this.magFilter=f!==void 0?f:1003,this.minFilter=p!==void 0?p:1003,this.flipY=!1,this.generateMipmaps=!1}}qh.prototype.isDepthTexture=!0;class gs extends Dt{constructor(e=1,n=8,i=0,o=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:i,thetaLength:o},n=Math.max(3,n);let l=[],h=[],f=[],p=[],g=new J,x=new Ke;h.push(0,0,0),f.push(0,0,1),p.push(.5,.5);for(let _=0,M=3;_<=n;_++,M+=3){let T=i+_/n*o;g.x=e*Math.cos(T),g.y=e*Math.sin(T),h.push(g.x,g.y,g.z),f.push(0,0,1),x.x=(h[M]/e+1)/2,x.y=(h[M+1]/e+1)/2,p.push(x.x,x.y)}for(let _=1;_<=n;_++)l.push(_,_+1,0);this.setIndex(l),this.setAttribute("position",new At(h,3)),this.setAttribute("normal",new At(f,3)),this.setAttribute("uv",new At(p,2))}static fromJSON(e){return new gs(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class qr extends Dt{constructor(e=1,n=1,i=1,o=8,l=1,h=!1,f=0,p=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:i,radialSegments:o,heightSegments:l,openEnded:h,thetaStart:f,thetaLength:p};let g=this;o=Math.floor(o),l=Math.floor(l);let x=[],_=[],M=[],T=[],N=0,I=[],D=i/2,L=0;function F(U){let V=N,K=new Ke,re=new J,ve=0,_e=U===!0?e:n,Te=U===!0?1:-1;for(let Ne=1;Ne<=o;Ne++)_.push(0,D*Te,0),M.push(0,Te,0),T.push(.5,.5),N++;let Ee=N;for(let Ne=0;Ne<=o;Ne++){let ct=Ne/o*p+f,Je=Math.cos(ct),De=Math.sin(ct);re.x=_e*De,re.y=D*Te,re.z=_e*Je,_.push(re.x,re.y,re.z),M.push(0,Te,0),K.x=.5*Je+.5,K.y=.5*De*Te+.5,T.push(K.x,K.y),N++}for(let Ne=0;Ne<o;Ne++){let ct=V+Ne,Je=Ee+Ne;U===!0?x.push(Je,Je+1,ct):x.push(Je+1,Je,ct),ve+=3}g.addGroup(L,ve,U===!0?1:2),L+=ve}(function(){let U=new J,V=new J,K=0,re=(n-e)/i;for(let ve=0;ve<=l;ve++){let _e=[],Te=ve/l,Ee=Te*(n-e)+e;for(let Ne=0;Ne<=o;Ne++){let ct=Ne/o,Je=ct*p+f,De=Math.sin(Je),Ze=Math.cos(Je);V.x=Ee*De,V.y=-Te*i+D,V.z=Ee*Ze,_.push(V.x,V.y,V.z),U.set(De,re,Ze).normalize(),M.push(U.x,U.y,U.z),T.push(ct,1-Te),_e.push(N++)}I.push(_e)}for(let ve=0;ve<o;ve++)for(let _e=0;_e<l;_e++){let Te=I[_e][ve],Ee=I[_e+1][ve],Ne=I[_e+1][ve+1],ct=I[_e][ve+1];x.push(Te,Ee,ct),x.push(Ee,Ne,ct),K+=6}g.addGroup(L,K,0),L+=K})(),h===!1&&(e>0&&F(!0),n>0&&F(!1)),this.setIndex(x),this.setAttribute("position",new At(_,3)),this.setAttribute("normal",new At(M,3)),this.setAttribute("uv",new At(T,2))}static fromJSON(e){return new qr(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ea extends qr{constructor(e=1,n=1,i=8,o=1,l=!1,h=0,f=2*Math.PI){super(0,e,n,i,o,l,h,f),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:i,heightSegments:o,openEnded:l,thetaStart:h,thetaLength:f}}static fromJSON(e){return new Ea(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ii extends Dt{constructor(e=[],n=[],i=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:i,detail:o};let l=[],h=[];function f(M,T,N,I){let D=I+1,L=[];for(let F=0;F<=D;F++){L[F]=[];let U=M.clone().lerp(N,F/D),V=T.clone().lerp(N,F/D),K=D-F;for(let re=0;re<=K;re++)L[F][re]=re===0&&F===D?U:U.clone().lerp(V,re/K)}for(let F=0;F<D;F++)for(let U=0;U<2*(D-F)-1;U++){let V=Math.floor(U/2);U%2==0?(p(L[F][V+1]),p(L[F+1][V]),p(L[F][V])):(p(L[F][V+1]),p(L[F+1][V+1]),p(L[F+1][V]))}}function p(M){l.push(M.x,M.y,M.z)}function g(M,T){let N=3*M;T.x=e[N+0],T.y=e[N+1],T.z=e[N+2]}function x(M,T,N,I){I<0&&M.x===1&&(h[T]=M.x-1),N.x===0&&N.z===0&&(h[T]=I/2/Math.PI+.5)}function _(M){return Math.atan2(M.z,-M.x)}(function(M){let T=new J,N=new J,I=new J;for(let D=0;D<n.length;D+=3)g(n[D+0],T),g(n[D+1],N),g(n[D+2],I),f(T,N,I,M)})(o),function(M){let T=new J;for(let N=0;N<l.length;N+=3)T.x=l[N+0],T.y=l[N+1],T.z=l[N+2],T.normalize().multiplyScalar(M),l[N+0]=T.x,l[N+1]=T.y,l[N+2]=T.z}(i),function(){let M=new J;for(let N=0;N<l.length;N+=3){M.x=l[N+0],M.y=l[N+1],M.z=l[N+2];let I=_(M)/2/Math.PI+.5,D=(T=M,Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))/Math.PI+.5);h.push(I,1-D)}var T;(function(){let N=new J,I=new J,D=new J,L=new J,F=new Ke,U=new Ke,V=new Ke;for(let K=0,re=0;K<l.length;K+=9,re+=6){N.set(l[K+0],l[K+1],l[K+2]),I.set(l[K+3],l[K+4],l[K+5]),D.set(l[K+6],l[K+7],l[K+8]),F.set(h[re+0],h[re+1]),U.set(h[re+2],h[re+3]),V.set(h[re+4],h[re+5]),L.copy(N).add(I).add(D).divideScalar(3);let ve=_(L);x(F,re+0,N,ve),x(U,re+2,I,ve),x(V,re+4,D,ve)}})(),function(){for(let N=0;N<h.length;N+=6){let I=h[N+0],D=h[N+2],L=h[N+4],F=Math.max(I,D,L),U=Math.min(I,D,L);F>.9&&U<.1&&(I<.2&&(h[N+0]+=1),D<.2&&(h[N+2]+=1),L<.2&&(h[N+4]+=1))}}()}(),this.setAttribute("position",new At(l,3)),this.setAttribute("normal",new At(l.slice(),3)),this.setAttribute("uv",new At(h,2)),o===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Ii(e.vertices,e.indices,e.radius,e.details)}}class Sa extends Ii{constructor(e=1,n=0){let i=(1+Math.sqrt(5))/2,o=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Sa(e.radius,e.detail)}}let Ta=new J,Aa=new J,Na=new J,au=new Sn;class Ra extends Dt{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){let o=Math.pow(10,4),l=Math.cos(qo*n),h=e.getIndex(),f=e.getAttribute("position"),p=h?h.count:f.count,g=[0,0,0],x=["a","b","c"],_=new Array(3),M={},T=[];for(let N=0;N<p;N+=3){h?(g[0]=h.getX(N),g[1]=h.getX(N+1),g[2]=h.getX(N+2)):(g[0]=N,g[1]=N+1,g[2]=N+2);let{a:I,b:D,c:L}=au;if(I.fromBufferAttribute(f,g[0]),D.fromBufferAttribute(f,g[1]),L.fromBufferAttribute(f,g[2]),au.getNormal(Na),_[0]=`${Math.round(I.x*o)},${Math.round(I.y*o)},${Math.round(I.z*o)}`,_[1]=`${Math.round(D.x*o)},${Math.round(D.y*o)},${Math.round(D.z*o)}`,_[2]=`${Math.round(L.x*o)},${Math.round(L.y*o)},${Math.round(L.z*o)}`,_[0]!==_[1]&&_[1]!==_[2]&&_[2]!==_[0])for(let F=0;F<3;F++){let U=(F+1)%3,V=_[F],K=_[U],re=au[x[F]],ve=au[x[U]],_e=`${V}_${K}`,Te=`${K}_${V}`;Te in M&&M[Te]?(Na.dot(M[Te].normal)<=l&&(T.push(re.x,re.y,re.z),T.push(ve.x,ve.y,ve.z)),M[Te]=null):_e in M||(M[_e]={index0:g[F],index1:g[U],normal:Na.clone()})}}for(let N in M)if(M[N]){let{index0:I,index1:D}=M[N];Ta.fromBufferAttribute(f,I),Aa.fromBufferAttribute(f,D),T.push(Ta.x,Ta.y,Ta.z),T.push(Aa.x,Aa.y,Aa.z)}this.setAttribute("position",new At(T,3))}}}class vr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){let i=this.getUtoTmapping(e);return this.getPoint(i,n)}getPoints(e=5){let n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return n}getSpacedPoints(e=5){let n=[];for(let i=0;i<=e;i++)n.push(this.getPointAt(i/e));return n}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let n=[],i,o=this.getPoint(0),l=0;n.push(0);for(let h=1;h<=e;h++)i=this.getPoint(h/e),l+=i.distanceTo(o),n.push(l),o=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){let i=this.getLengths(),o=0,l=i.length,h;h=n||e*i[l-1];let f,p=0,g=l-1;for(;p<=g;)if(o=Math.floor(p+(g-p)/2),f=i[o]-h,f<0)p=o+1;else{if(!(f>0)){g=o;break}g=o-1}if(o=g,i[o]===h)return o/(l-1);let x=i[o];return(o+(h-x)/(i[o+1]-x))/(l-1)}getTangent(e,n){let o=e-1e-4,l=e+1e-4;o<0&&(o=0),l>1&&(l=1);let h=this.getPoint(o),f=this.getPoint(l),p=n||(h.isVector2?new Ke:new J);return p.copy(f).sub(h).normalize(),p}getTangentAt(e,n){let i=this.getUtoTmapping(e);return this.getTangent(i,n)}computeFrenetFrames(e,n){let i=new J,o=[],l=[],h=[],f=new J,p=new Mt;for(let T=0;T<=e;T++){let N=T/e;o[T]=this.getTangentAt(N,new J)}l[0]=new J,h[0]=new J;let g=Number.MAX_VALUE,x=Math.abs(o[0].x),_=Math.abs(o[0].y),M=Math.abs(o[0].z);x<=g&&(g=x,i.set(1,0,0)),_<=g&&(g=_,i.set(0,1,0)),M<=g&&i.set(0,0,1),f.crossVectors(o[0],i).normalize(),l[0].crossVectors(o[0],f),h[0].crossVectors(o[0],l[0]);for(let T=1;T<=e;T++){if(l[T]=l[T-1].clone(),h[T]=h[T-1].clone(),f.crossVectors(o[T-1],o[T]),f.length()>Number.EPSILON){f.normalize();let N=Math.acos(Qn(o[T-1].dot(o[T]),-1,1));l[T].applyMatrix4(p.makeRotationAxis(f,N))}h[T].crossVectors(o[T],l[T])}if(n===!0){let T=Math.acos(Qn(l[0].dot(l[e]),-1,1));T/=e,o[0].dot(f.crossVectors(l[0],l[e]))>0&&(T=-T);for(let N=1;N<=e;N++)l[N].applyMatrix4(p.makeRotationAxis(o[N],T*N)),h[N].crossVectors(o[N],l[N])}return{tangents:o,normals:l,binormals:h}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Pl extends vr{constructor(e=0,n=0,i=1,o=1,l=0,h=2*Math.PI,f=!1,p=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=i,this.yRadius=o,this.aStartAngle=l,this.aEndAngle=h,this.aClockwise=f,this.aRotation=p}getPoint(e,n){let i=n||new Ke,o=2*Math.PI,l=this.aEndAngle-this.aStartAngle,h=Math.abs(l)<Number.EPSILON;for(;l<0;)l+=o;for(;l>o;)l-=o;l<Number.EPSILON&&(l=h?0:o),this.aClockwise!==!0||h||(l===o?l=-o:l-=o);let f=this.aStartAngle+e*l,p=this.aX+this.xRadius*Math.cos(f),g=this.aY+this.yRadius*Math.sin(f);if(this.aRotation!==0){let x=Math.cos(this.aRotation),_=Math.sin(this.aRotation),M=p-this.aX,T=g-this.aY;p=M*x-T*_+this.aX,g=M*_+T*x+this.aY}return i.set(p,g)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Pl.prototype.isEllipseCurve=!0;class Xh extends Pl{constructor(e,n,i,o,l,h){super(e,n,i,i,o,l,h),this.type="ArcCurve"}}function lu(){let c=0,e=0,n=0,i=0;function o(l,h,f,p){c=l,e=f,n=-3*l+3*h-2*f-p,i=2*l-2*h+f+p}return{initCatmullRom:function(l,h,f,p,g){o(h,f,g*(f-l),g*(p-h))},initNonuniformCatmullRom:function(l,h,f,p,g,x,_){let M=(h-l)/g-(f-l)/(g+x)+(f-h)/x,T=(f-h)/x-(p-h)/(x+_)+(p-f)/_;M*=x,T*=x,o(h,f,M,T)},calc:function(l){let h=l*l;return c+e*l+n*h+i*(h*l)}}}Xh.prototype.isArcCurve=!0;let no=new J,Cl=new lu,Il=new lu,cu=new lu;class Dl extends vr{constructor(e=[],n=!1,i="centripetal",o=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=i,this.tension=o}getPoint(e,n=new J){let i=n,o=this.points,l=o.length,h=(l-(this.closed?0:1))*e,f,p,g=Math.floor(h),x=h-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/l)+1)*l:x===0&&g===l-1&&(g=l-2,x=1),this.closed||g>0?f=o[(g-1)%l]:(no.subVectors(o[0],o[1]).add(o[0]),f=no);let _=o[g%l],M=o[(g+1)%l];if(this.closed||g+2<l?p=o[(g+2)%l]:(no.subVectors(o[l-1],o[l-2]).add(o[l-1]),p=no),this.curveType==="centripetal"||this.curveType==="chordal"){let T=this.curveType==="chordal"?.5:.25,N=Math.pow(f.distanceToSquared(_),T),I=Math.pow(_.distanceToSquared(M),T),D=Math.pow(M.distanceToSquared(p),T);I<1e-4&&(I=1),N<1e-4&&(N=I),D<1e-4&&(D=I),Cl.initNonuniformCatmullRom(f.x,_.x,M.x,p.x,N,I,D),Il.initNonuniformCatmullRom(f.y,_.y,M.y,p.y,N,I,D),cu.initNonuniformCatmullRom(f.z,_.z,M.z,p.z,N,I,D)}else this.curveType==="catmullrom"&&(Cl.initCatmullRom(f.x,_.x,M.x,p.x,this.tension),Il.initCatmullRom(f.y,_.y,M.y,p.y,this.tension),cu.initCatmullRom(f.z,_.z,M.z,p.z,this.tension));return i.set(Cl.calc(x),Il.calc(x),cu.calc(x)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){let o=e.points[n];this.points.push(o.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){let o=this.points[n];e.points.push(o.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){let o=e.points[n];this.points.push(new J().fromArray(o))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Jh(c,e,n,i,o){let l=.5*(i-e),h=.5*(o-n),f=c*c;return(2*n-2*i+l+h)*(c*f)+(-3*n+3*i-2*l-h)*f+l*c+n}function vs(c,e,n,i){return function(o,l){let h=1-o;return h*h*l}(c,e)+function(o,l){return 2*(1-o)*o*l}(c,n)+function(o,l){return o*o*l}(c,i)}function Ol(c,e,n,i,o){return function(l,h){let f=1-l;return f*f*f*h}(c,e)+function(l,h){let f=1-l;return 3*f*f*l*h}(c,n)+function(l,h){return 3*(1-l)*l*l*h}(c,i)+function(l,h){return l*l*l*h}(c,o)}Dl.prototype.isCatmullRomCurve3=!0;class uu extends vr{constructor(e=new Ke,n=new Ke,i=new Ke,o=new Ke){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=i,this.v3=o}getPoint(e,n=new Ke){let i=n,o=this.v0,l=this.v1,h=this.v2,f=this.v3;return i.set(Ol(e,o.x,l.x,h.x,f.x),Ol(e,o.y,l.y,h.y,f.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}uu.prototype.isCubicBezierCurve=!0;class Zh extends vr{constructor(e=new J,n=new J,i=new J,o=new J){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=i,this.v3=o}getPoint(e,n=new J){let i=n,o=this.v0,l=this.v1,h=this.v2,f=this.v3;return i.set(Ol(e,o.x,l.x,h.x,f.x),Ol(e,o.y,l.y,h.y,f.y),Ol(e,o.z,l.z,h.z,f.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Zh.prototype.isCubicBezierCurve3=!0;class Gl extends vr{constructor(e=new Ke,n=new Ke){super(),this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new Ke){let i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n){let i=n||new Ke;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Gl.prototype.isLineCurve=!0;class Bl extends vr{constructor(e=new J,n=new J){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=n}getPoint(e,n=new J){let i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ys extends vr{constructor(e=new Ke,n=new Ke,i=new Ke){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new Ke){let i=n,o=this.v0,l=this.v1,h=this.v2;return i.set(vs(e,o.x,l.x,h.x),vs(e,o.y,l.y,h.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ys.prototype.isQuadraticBezierCurve=!0;class ro extends vr{constructor(e=new J,n=new J,i=new J){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new J){let i=n,o=this.v0,l=this.v1,h=this.v2;return i.set(vs(e,o.x,l.x,h.x),vs(e,o.y,l.y,h.y),vs(e,o.z,l.z,h.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ro.prototype.isQuadraticBezierCurve3=!0;class Ul extends vr{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,n=new Ke){let i=n,o=this.points,l=(o.length-1)*e,h=Math.floor(l),f=l-h,p=o[h===0?h:h-1],g=o[h],x=o[h>o.length-2?o.length-1:h+1],_=o[h>o.length-3?o.length-1:h+2];return i.set(Jh(f,p.x,g.x,x.x,_.x),Jh(f,p.y,g.y,x.y,_.y)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){let o=e.points[n];this.points.push(o.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){let o=this.points[n];e.points.push(o.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){let o=e.points[n];this.points.push(new Ke().fromArray(o))}return this}}Ul.prototype.isSplineCurve=!0;var hu=Object.freeze({__proto__:null,ArcCurve:Xh,CatmullRomCurve3:Dl,CubicBezierCurve:uu,CubicBezierCurve3:Zh,EllipseCurve:Pl,LineCurve:Gl,LineCurve3:Bl,QuadraticBezierCurve:ys,QuadraticBezierCurve3:ro,SplineCurve:Ul});class $h extends vr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);e.equals(n)||this.curves.push(new Gl(n,e))}getPoint(e,n){let i=e*this.getLength(),o=this.getCurveLengths(),l=0;for(;l<o.length;){if(o[l]>=i){let h=o[l]-i,f=this.curves[l],p=f.getLength(),g=p===0?0:1-h/p;return f.getPointAt(g,n)}l++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],n=0;for(let i=0,o=this.curves.length;i<o;i++)n+=this.curves[i].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){let n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){let n=[],i;for(let o=0,l=this.curves;o<l.length;o++){let h=l[o],f=h&&h.isEllipseCurve?2*e:h&&(h.isLineCurve||h.isLineCurve3)?1:h&&h.isSplineCurve?e*h.points.length:e,p=h.getPoints(f);for(let g=0;g<p.length;g++){let x=p[g];i&&i.equals(x)||(n.push(x),i=x)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){let o=e.curves[n];this.curves.push(o.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,i=this.curves.length;n<i;n++){let o=this.curves[n];e.curves.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){let o=e.curves[n];this.curves.push(new hu[o.type]().fromJSON(o))}return this}}class kl extends $h{constructor(e){super(),this.type="Path",this.currentPoint=new Ke,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,i=e.length;n<i;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){let i=new Gl(this.currentPoint.clone(),new Ke(e,n));return this.curves.push(i),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,i,o){let l=new ys(this.currentPoint.clone(),new Ke(e,n),new Ke(i,o));return this.curves.push(l),this.currentPoint.set(i,o),this}bezierCurveTo(e,n,i,o,l,h){let f=new uu(this.currentPoint.clone(),new Ke(e,n),new Ke(i,o),new Ke(l,h));return this.curves.push(f),this.currentPoint.set(l,h),this}splineThru(e){let n=[this.currentPoint.clone()].concat(e),i=new Ul(n);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,i,o,l,h){let f=this.currentPoint.x,p=this.currentPoint.y;return this.absarc(e+f,n+p,i,o,l,h),this}absarc(e,n,i,o,l,h){return this.absellipse(e,n,i,i,o,l,h),this}ellipse(e,n,i,o,l,h,f,p){let g=this.currentPoint.x,x=this.currentPoint.y;return this.absellipse(e+g,n+x,i,o,l,h,f,p),this}absellipse(e,n,i,o,l,h,f,p){let g=new Pl(e,n,i,o,l,h,f,p);if(this.curves.length>0){let _=g.getPoint(0);_.equals(this.currentPoint)||this.lineTo(_.x,_.y)}this.curves.push(g);let x=g.getPoint(1);return this.currentPoint.copy(x),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Di extends kl{constructor(e){super(e),this.uuid=mr(),this.type="Shape",this.holes=[]}getPointsHoles(e){let n=[];for(let i=0,o=this.holes.length;i<o;i++)n[i]=this.holes[i].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){let o=e.holes[n];this.holes.push(o.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,i=this.holes.length;n<i;n++){let o=this.holes[n];e.holes.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){let o=e.holes[n];this.holes.push(new kl().fromJSON(o))}return this}}let Ag=function(c,e,n=2){let i=e&&e.length,o=i?e[0]*n:c.length,l=Qh(c,0,o,n,!0),h=[];if(!l||l.next===l.prev)return h;let f,p,g,x,_,M,T;if(i&&(l=function(N,I,D,L){let F=[],U,V,K,re,ve;for(U=0,V=I.length;U<V;U++)K=I[U]*L,re=U<V-1?I[U+1]*L:N.length,ve=Qh(N,K,re,L,!1),ve===ve.next&&(ve.steiner=!0),F.push(xs(ve));for(F.sort(wp),U=0;U<F.length;U++)Ep(F[U],D),D=io(D,D.next);return D}(c,e,l,n)),c.length>80*n){f=g=c[0],p=x=c[1];for(let N=n;N<o;N+=n)_=c[N],M=c[N+1],_<f&&(f=_),M<p&&(p=M),_>g&&(g=_),M>x&&(x=M);T=Math.max(g-f,x-p),T=T!==0?1/T:0}return La(l,h,n,f,p,T),h};function Qh(c,e,n,i,o){let l,h;if(o===function(f,p,g,x){let _=0;for(let M=p,T=g-x;M<g;M+=x)_+=(f[T]-f[M])*(f[M+1]+f[T+1]),T=M;return _}(c,e,n,i)>0)for(l=e;l<n;l+=i)h=Tp(l,c[l],c[l+1],h);else for(l=n-i;l>=e;l-=i)h=Tp(l,c[l],c[l+1],h);return h&&Fl(h,h.next)&&(zl(h),h=h.next),h}function io(c,e){if(!c)return c;e||(e=c);let n,i=c;do if(n=!1,i.steiner||!Fl(i,i.next)&&fn(i.prev,i,i.next)!==0)i=i.next;else{if(zl(i),i=e=i.prev,i===i.next)break;n=!0}while(n||i!==e);return e}function La(c,e,n,i,o,l,h){if(!c)return;!h&&l&&function(x,_,M,T){let N=x;do N.z===null&&(N.z=oo(N.x,N.y,_,M,T)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==x);N.prevZ.nextZ=null,N.prevZ=null,function(I){let D,L,F,U,V,K,re,ve,_e=1;do{for(L=I,I=null,V=null,K=0;L;){for(K++,F=L,re=0,D=0;D<_e&&(re++,F=F.nextZ,F);D++);for(ve=_e;re>0||ve>0&&F;)re!==0&&(ve===0||!F||L.z<=F.z)?(U=L,L=L.nextZ,re--):(U=F,F=F.nextZ,ve--),V?V.nextZ=U:I=U,U.prevZ=V,V=U;L=F}V.nextZ=null,_e*=2}while(K>1)}(N)}(c,i,o,l);let f,p,g=c;for(;c.prev!==c.next;)if(f=c.prev,p=c.next,l?Pa(c,i,o,l):bp(c))e.push(f.i/n),e.push(c.i/n),e.push(p.i/n),zl(c),c=p.next,g=p.next;else if((c=p)===g){h?h===1?La(c=Kh(io(c),e,n),e,n,i,o,l,2):h===2&&Mp(c,e,n,i,o,l):La(io(c),e,n,i,o,l,1);break}}function bp(c){let e=c.prev,n=c,i=c.next;if(fn(e,n,i)>=0)return!1;let o=c.next.next;for(;o!==c.prev;){if(Ca(e.x,e.y,n.x,n.y,i.x,i.y,o.x,o.y)&&fn(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function Pa(c,e,n,i){let o=c.prev,l=c,h=c.next;if(fn(o,l,h)>=0)return!1;let f=o.x<l.x?o.x<h.x?o.x:h.x:l.x<h.x?l.x:h.x,p=o.y<l.y?o.y<h.y?o.y:h.y:l.y<h.y?l.y:h.y,g=o.x>l.x?o.x>h.x?o.x:h.x:l.x>h.x?l.x:h.x,x=o.y>l.y?o.y>h.y?o.y:h.y:l.y>h.y?l.y:h.y,_=oo(f,p,e,n,i),M=oo(g,x,e,n,i),T=c.prevZ,N=c.nextZ;for(;T&&T.z>=_&&N&&N.z<=M;){if(T!==c.prev&&T!==c.next&&Ca(o.x,o.y,l.x,l.y,h.x,h.y,T.x,T.y)&&fn(T.prev,T,T.next)>=0||(T=T.prevZ,N!==c.prev&&N!==c.next&&Ca(o.x,o.y,l.x,l.y,h.x,h.y,N.x,N.y)&&fn(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;T&&T.z>=_;){if(T!==c.prev&&T!==c.next&&Ca(o.x,o.y,l.x,l.y,h.x,h.y,T.x,T.y)&&fn(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;N&&N.z<=M;){if(N!==c.prev&&N!==c.next&&Ca(o.x,o.y,l.x,l.y,h.x,h.y,N.x,N.y)&&fn(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function Kh(c,e,n){let i=c;do{let o=i.prev,l=i.next.next;!Fl(o,l)&&an(o,i,i.next,l)&&so(o,l)&&so(l,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(l.i/n),zl(i),zl(i.next),i=c=l),i=i.next}while(i!==c);return io(i)}function Mp(c,e,n,i,o,l){let h=c;do{let f=h.next.next;for(;f!==h.prev;){if(h.i!==f.i&&du(h,f)){let p=Sp(h,f);return h=io(h,h.next),p=io(p,p.next),La(h,e,n,i,o,l),void La(p,e,n,i,o,l)}f=f.next}h=h.next}while(h!==c)}function wp(c,e){return c.x-e.x}function Ep(c,e){if(e=function(n,i){let o=i,l=n.x,h=n.y,f,p=-1/0;do{if(h<=o.y&&h>=o.next.y&&o.next.y!==o.y){let N=o.x+(h-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(N<=l&&N>p){if(p=N,N===l){if(h===o.y)return o;if(h===o.next.y)return o.next}f=o.x<o.next.x?o:o.next}}o=o.next}while(o!==i);if(!f)return null;if(l===p)return f;let g=f,x=f.x,_=f.y,M,T=1/0;o=f;do l>=o.x&&o.x>=x&&l!==o.x&&Ca(h<_?l:p,h,x,_,h<_?p:l,h,o.x,o.y)&&(M=Math.abs(h-o.y)/(l-o.x),so(o,n)&&(M<T||M===T&&(o.x>f.x||o.x===f.x&&Un(f,o)))&&(f=o,T=M)),o=o.next;while(o!==g);return f}(c,e),e){let n=Sp(e,c);io(e,e.next),io(n,n.next)}}function Un(c,e){return fn(c.prev,c,e.prev)<0&&fn(e.next,c,c.next)<0}function oo(c,e,n,i,o){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=32767*(c-n)*o)|c<<8))|c<<4))|c<<2))|c<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xs(c){let e=c,n=c;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==c);return n}function Ca(c,e,n,i,o,l,h,f){return(o-h)*(e-f)-(c-h)*(l-f)>=0&&(c-h)*(i-f)-(n-h)*(e-f)>=0&&(n-h)*(l-f)-(o-h)*(i-f)>=0}function du(c,e){return c.next.i!==e.i&&c.prev.i!==e.i&&!function(n,i){let o=n;do{if(o.i!==n.i&&o.next.i!==n.i&&o.i!==i.i&&o.next.i!==i.i&&an(o,o.next,n,i))return!0;o=o.next}while(o!==n);return!1}(c,e)&&(so(c,e)&&so(e,c)&&function(n,i){let o=n,l=!1,h=(n.x+i.x)/2,f=(n.y+i.y)/2;do o.y>f!=o.next.y>f&&o.next.y!==o.y&&h<(o.next.x-o.x)*(f-o.y)/(o.next.y-o.y)+o.x&&(l=!l),o=o.next;while(o!==n);return l}(c,e)&&(fn(c.prev,c,e.prev)||fn(c,e.prev,e))||Fl(c,e)&&fn(c.prev,c,c.next)>0&&fn(e.prev,e,e.next)>0)}function fn(c,e,n){return(e.y-c.y)*(n.x-e.x)-(e.x-c.x)*(n.y-e.y)}function Fl(c,e){return c.x===e.x&&c.y===e.y}function an(c,e,n,i){let o=Oo(fn(c,e,n)),l=Oo(fn(c,e,i)),h=Oo(fn(n,i,c)),f=Oo(fn(n,i,e));return o!==l&&h!==f||!(o!==0||!fu(c,n,e))||!(l!==0||!fu(c,i,e))||!(h!==0||!fu(n,c,i))||!(f!==0||!fu(n,e,i))}function fu(c,e,n){return e.x<=Math.max(c.x,n.x)&&e.x>=Math.min(c.x,n.x)&&e.y<=Math.max(c.y,n.y)&&e.y>=Math.min(c.y,n.y)}function Oo(c){return c>0?1:c<0?-1:0}function so(c,e){return fn(c.prev,c,c.next)<0?fn(c,e,c.next)>=0&&fn(c,c.prev,e)>=0:fn(c,e,c.prev)<0||fn(c,c.next,e)<0}function Sp(c,e){let n=new ed(c.i,c.x,c.y),i=new ed(e.i,e.x,e.y),o=c.next,l=e.prev;return c.next=e,e.prev=c,n.next=o,o.prev=n,i.next=n,n.prev=i,l.next=i,i.prev=l,i}function Tp(c,e,n,i){let o=new ed(c,e,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function zl(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ed(c,e,n){this.i=c,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Oi{static area(e){let n=e.length,i=0;for(let o=n-1,l=0;l<n;o=l++)i+=e[o].x*e[l].y-e[l].x*e[o].y;return .5*i}static isClockWise(e){return Oi.area(e)<0}static triangulateShape(e,n){let i=[],o=[],l=[];Ap(e),Np(i,e);let h=e.length;n.forEach(Ap);for(let p=0;p<n.length;p++)o.push(h),h+=n[p].length,Np(i,n[p]);let f=Ag(i,o);for(let p=0;p<f.length;p+=3)l.push(f.slice(p,p+3));return l}}function Ap(c){let e=c.length;e>2&&c[e-1].equals(c[0])&&c.pop()}function Np(c,e){for(let n=0;n<e.length;n++)c.push(e[n].x),c.push(e[n].y)}class Gi extends Dt{constructor(e=new Di([new Ke(.5,.5),new Ke(-.5,.5),new Ke(-.5,-.5),new Ke(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];let i=this,o=[],l=[];for(let f=0,p=e.length;f<p;f++)h(e[f]);function h(f){let p=[],g=n.curveSegments!==void 0?n.curveSegments:12,x=n.steps!==void 0?n.steps:1,_=n.depth!==void 0?n.depth:1,M=n.bevelEnabled===void 0||n.bevelEnabled,T=n.bevelThickness!==void 0?n.bevelThickness:.2,N=n.bevelSize!==void 0?n.bevelSize:T-.1,I=n.bevelOffset!==void 0?n.bevelOffset:0,D=n.bevelSegments!==void 0?n.bevelSegments:3,L=n.extrudePath,F=n.UVGenerator!==void 0?n.UVGenerator:Ng;n.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),_=n.amount);let U,V,K,re,ve,_e=!1;L&&(U=L.getSpacedPoints(x),_e=!0,M=!1,V=L.computeFrenetFrames(x,!1),K=new J,re=new J,ve=new J),M||(D=0,T=0,N=0,I=0);let Te=f.extractPoints(g),Ee=Te.shape,Ne=Te.holes;if(!Oi.isClockWise(Ee)){Ee=Ee.reverse();for(let Le=0,te=Ne.length;Le<te;Le++){let Se=Ne[Le];Oi.isClockWise(Se)&&(Ne[Le]=Se.reverse())}}let ct=Oi.triangulateShape(Ee,Ne),Je=Ee;for(let Le=0,te=Ne.length;Le<te;Le++){let Se=Ne[Le];Ee=Ee.concat(Se)}function De(Le,te,Se){return te||console.error("THREE.ExtrudeGeometry: vec does not exist"),te.clone().multiplyScalar(Se).add(Le)}let Ze=Ee.length,vt=ct.length;function xt(Le,te,Se){let Ve,qe,Fe,_t=Le.x-te.x,Nt=Le.y-te.y,wt=Se.x-Le.x,zt=Se.y-Le.y,Ot=_t*_t+Nt*Nt,qn=_t*zt-Nt*wt;if(Math.abs(qn)>Number.EPSILON){let ln=Math.sqrt(Ot),Xn=Math.sqrt(wt*wt+zt*zt),Lr=te.x-Nt/ln,Cs=te.y+_t/ln,Fi=((Se.x-zt/Xn-Lr)*zt-(Se.y+wt/Xn-Cs)*wt)/(_t*zt-Nt*wt);Ve=Lr+_t*Fi-Le.x,qe=Cs+Nt*Fi-Le.y;let Jr=Ve*Ve+qe*qe;if(Jr<=2)return new Ke(Ve,qe);Fe=Math.sqrt(Jr/2)}else{let ln=!1;_t>Number.EPSILON?wt>Number.EPSILON&&(ln=!0):_t<-Number.EPSILON?wt<-Number.EPSILON&&(ln=!0):Math.sign(Nt)===Math.sign(zt)&&(ln=!0),ln?(Ve=-Nt,qe=_t,Fe=Math.sqrt(Ot)):(Ve=_t,qe=Nt,Fe=Math.sqrt(Ot/2))}return new Ke(Ve/Fe,qe/Fe)}let Tt=[];for(let Le=0,te=Je.length,Se=te-1,Ve=Le+1;Le<te;Le++,Se++,Ve++)Se===te&&(Se=0),Ve===te&&(Ve=0),Tt[Le]=xt(Je[Le],Je[Se],Je[Ve]);let Pt=[],Ct,nt=Tt.concat();for(let Le=0,te=Ne.length;Le<te;Le++){let Se=Ne[Le];Ct=[];for(let Ve=0,qe=Se.length,Fe=qe-1,_t=Ve+1;Ve<qe;Ve++,Fe++,_t++)Fe===qe&&(Fe=0),_t===qe&&(_t=0),Ct[Ve]=xt(Se[Ve],Se[Fe],Se[_t]);Pt.push(Ct),nt=nt.concat(Ct)}for(let Le=0;Le<D;Le++){let te=Le/D,Se=T*Math.cos(te*Math.PI/2),Ve=N*Math.sin(te*Math.PI/2)+I;for(let qe=0,Fe=Je.length;qe<Fe;qe++){let _t=De(Je[qe],Tt[qe],Ve);Ue(_t.x,_t.y,-Se)}for(let qe=0,Fe=Ne.length;qe<Fe;qe++){let _t=Ne[qe];Ct=Pt[qe];for(let Nt=0,wt=_t.length;Nt<wt;Nt++){let zt=De(_t[Nt],Ct[Nt],Ve);Ue(zt.x,zt.y,-Se)}}}let ie=N+I;for(let Le=0;Le<Ze;Le++){let te=M?De(Ee[Le],nt[Le],ie):Ee[Le];_e?(re.copy(V.normals[0]).multiplyScalar(te.x),K.copy(V.binormals[0]).multiplyScalar(te.y),ve.copy(U[0]).add(re).add(K),Ue(ve.x,ve.y,ve.z)):Ue(te.x,te.y,0)}for(let Le=1;Le<=x;Le++)for(let te=0;te<Ze;te++){let Se=M?De(Ee[te],nt[te],ie):Ee[te];_e?(re.copy(V.normals[Le]).multiplyScalar(Se.x),K.copy(V.binormals[Le]).multiplyScalar(Se.y),ve.copy(U[Le]).add(re).add(K),Ue(ve.x,ve.y,ve.z)):Ue(Se.x,Se.y,_/x*Le)}for(let Le=D-1;Le>=0;Le--){let te=Le/D,Se=T*Math.cos(te*Math.PI/2),Ve=N*Math.sin(te*Math.PI/2)+I;for(let qe=0,Fe=Je.length;qe<Fe;qe++){let _t=De(Je[qe],Tt[qe],Ve);Ue(_t.x,_t.y,_+Se)}for(let qe=0,Fe=Ne.length;qe<Fe;qe++){let _t=Ne[qe];Ct=Pt[qe];for(let Nt=0,wt=_t.length;Nt<wt;Nt++){let zt=De(_t[Nt],Ct[Nt],Ve);_e?Ue(zt.x,zt.y+U[x-1].y,U[x-1].x+Se):Ue(zt.x,zt.y,_+Se)}}}function he(Le,te){let Se=Le.length;for(;--Se>=0;){let Ve=Se,qe=Se-1;qe<0&&(qe=Le.length-1);for(let Fe=0,_t=x+2*D;Fe<_t;Fe++){let Nt=Ze*Fe,wt=Ze*(Fe+1);we(te+Ve+Nt,te+qe+Nt,te+qe+wt,te+Ve+wt)}}}function Ue(Le,te,Se){p.push(Le),p.push(te),p.push(Se)}function Be(Le,te,Se){ot(Le),ot(te),ot(Se);let Ve=o.length/3,qe=F.generateTopUV(i,o,Ve-3,Ve-2,Ve-1);ut(qe[0]),ut(qe[1]),ut(qe[2])}function we(Le,te,Se,Ve){ot(Le),ot(te),ot(Ve),ot(te),ot(Se),ot(Ve);let qe=o.length/3,Fe=F.generateSideWallUV(i,o,qe-6,qe-3,qe-2,qe-1);ut(Fe[0]),ut(Fe[1]),ut(Fe[3]),ut(Fe[1]),ut(Fe[2]),ut(Fe[3])}function ot(Le){o.push(p[3*Le+0]),o.push(p[3*Le+1]),o.push(p[3*Le+2])}function ut(Le){l.push(Le.x),l.push(Le.y)}(function(){let Le=o.length/3;if(M){let te=0,Se=Ze*te;for(let Ve=0;Ve<vt;Ve++){let qe=ct[Ve];Be(qe[2]+Se,qe[1]+Se,qe[0]+Se)}te=x+2*D,Se=Ze*te;for(let Ve=0;Ve<vt;Ve++){let qe=ct[Ve];Be(qe[0]+Se,qe[1]+Se,qe[2]+Se)}}else{for(let te=0;te<vt;te++){let Se=ct[te];Be(Se[2],Se[1],Se[0])}for(let te=0;te<vt;te++){let Se=ct[te];Be(Se[0]+Ze*x,Se[1]+Ze*x,Se[2]+Ze*x)}}i.addGroup(Le,o.length/3-Le,0)})(),function(){let Le=o.length/3,te=0;he(Je,te),te+=Je.length;for(let Se=0,Ve=Ne.length;Se<Ve;Se++){let qe=Ne[Se];he(qe,te),te+=qe.length}i.addGroup(Le,o.length/3-Le,1)}()}this.setAttribute("position",new At(o,3)),this.setAttribute("uv",new At(l,2)),this.computeVertexNormals()}toJSON(){let e=super.toJSON();return function(n,i,o){if(o.shapes=[],Array.isArray(n))for(let l=0,h=n.length;l<h;l++){let f=n[l];o.shapes.push(f.uuid)}else o.shapes.push(n.uuid);return i.extrudePath!==void 0&&(o.options.extrudePath=i.extrudePath.toJSON()),o}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,n){let i=[];for(let l=0,h=e.shapes.length;l<h;l++){let f=n[e.shapes[l]];i.push(f)}let o=e.options.extrudePath;return o!==void 0&&(e.options.extrudePath=new hu[o.type]().fromJSON(o)),new Gi(i,e.options)}}let Ng={generateTopUV:function(c,e,n,i,o){let l=e[3*n],h=e[3*n+1],f=e[3*i],p=e[3*i+1],g=e[3*o],x=e[3*o+1];return[new Ke(l,h),new Ke(f,p),new Ke(g,x)]},generateSideWallUV:function(c,e,n,i,o,l){let h=e[3*n],f=e[3*n+1],p=e[3*n+2],g=e[3*i],x=e[3*i+1],_=e[3*i+2],M=e[3*o],T=e[3*o+1],N=e[3*o+2],I=e[3*l],D=e[3*l+1],L=e[3*l+2];return Math.abs(f-x)<Math.abs(h-g)?[new Ke(h,1-p),new Ke(g,1-_),new Ke(M,1-N),new Ke(I,1-L)]:[new Ke(f,1-p),new Ke(x,1-_),new Ke(T,1-N),new Ke(D,1-L)]}};class _s extends Ii{constructor(e=1,n=0){let i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new _s(e.radius,e.detail)}}class Ia extends Dt{constructor(e=[new Ke(0,.5),new Ke(.5,0),new Ke(0,-.5)],n=12,i=0,o=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:i,phiLength:o},n=Math.floor(n),o=Qn(o,0,2*Math.PI);let l=[],h=[],f=[],p=1/n,g=new J,x=new Ke;for(let _=0;_<=n;_++){let M=i+_*p*o,T=Math.sin(M),N=Math.cos(M);for(let I=0;I<=e.length-1;I++)g.x=e[I].x*T,g.y=e[I].y,g.z=e[I].x*N,h.push(g.x,g.y,g.z),x.x=_/n,x.y=I/(e.length-1),f.push(x.x,x.y)}for(let _=0;_<n;_++)for(let M=0;M<e.length-1;M++){let T=M+_*e.length,N=T,I=T+e.length,D=T+e.length+1,L=T+1;l.push(N,I,L),l.push(I,D,L)}if(this.setIndex(l),this.setAttribute("position",new At(h,3)),this.setAttribute("uv",new At(f,2)),this.computeVertexNormals(),o===2*Math.PI){let _=this.attributes.normal.array,M=new J,T=new J,N=new J,I=n*e.length*3;for(let D=0,L=0;D<e.length;D++,L+=3)M.x=_[L+0],M.y=_[L+1],M.z=_[L+2],T.x=_[I+L+0],T.y=_[I+L+1],T.z=_[I+L+2],N.addVectors(M,T).normalize(),_[L+0]=_[I+L+0]=N.x,_[L+1]=_[I+L+1]=N.y,_[L+2]=_[I+L+2]=N.z}}static fromJSON(e){return new Ia(e.points,e.segments,e.phiStart,e.phiLength)}}class Go extends Ii{constructor(e=1,n=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Go(e.radius,e.detail)}}class Da extends Dt{constructor(e=.5,n=1,i=8,o=1,l=0,h=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:i,phiSegments:o,thetaStart:l,thetaLength:h},i=Math.max(3,i);let f=[],p=[],g=[],x=[],_=e,M=(n-e)/(o=Math.max(1,o)),T=new J,N=new Ke;for(let I=0;I<=o;I++){for(let D=0;D<=i;D++){let L=l+D/i*h;T.x=_*Math.cos(L),T.y=_*Math.sin(L),p.push(T.x,T.y,T.z),g.push(0,0,1),N.x=(T.x/n+1)/2,N.y=(T.y/n+1)/2,x.push(N.x,N.y)}_+=M}for(let I=0;I<o;I++){let D=I*(i+1);for(let L=0;L<i;L++){let F=L+D,U=F,V=F+i+1,K=F+i+2,re=F+1;f.push(U,V,re),f.push(V,K,re)}}this.setIndex(f),this.setAttribute("position",new At(p,3)),this.setAttribute("normal",new At(g,3)),this.setAttribute("uv",new At(x,2))}static fromJSON(e){return new Da(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class bs extends Dt{constructor(e=new Di([new Ke(0,.5),new Ke(-.5,-.5),new Ke(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};let i=[],o=[],l=[],h=[],f=0,p=0;if(Array.isArray(e)===!1)g(e);else for(let x=0;x<e.length;x++)g(e[x]),this.addGroup(f,p,x),f+=p,p=0;function g(x){let _=o.length/3,M=x.extractPoints(n),T=M.shape,N=M.holes;Oi.isClockWise(T)===!1&&(T=T.reverse());for(let D=0,L=N.length;D<L;D++){let F=N[D];Oi.isClockWise(F)===!0&&(N[D]=F.reverse())}let I=Oi.triangulateShape(T,N);for(let D=0,L=N.length;D<L;D++){let F=N[D];T=T.concat(F)}for(let D=0,L=T.length;D<L;D++){let F=T[D];o.push(F.x,F.y,0),l.push(0,0,1),h.push(F.x,F.y)}for(let D=0,L=I.length;D<L;D++){let F=I[D],U=F[0]+_,V=F[1]+_,K=F[2]+_;i.push(U,V,K),p+=3}}this.setIndex(i),this.setAttribute("position",new At(o,3)),this.setAttribute("normal",new At(l,3)),this.setAttribute("uv",new At(h,2))}toJSON(){let e=super.toJSON();return function(n,i){if(i.shapes=[],Array.isArray(n))for(let o=0,l=n.length;o<l;o++){let h=n[o];i.shapes.push(h.uuid)}else i.shapes.push(n.uuid);return i}(this.parameters.shapes,e)}static fromJSON(e,n){let i=[];for(let o=0,l=e.shapes.length;o<l;o++){let h=n[e.shapes[o]];i.push(h)}return new bs(i,e.curveSegments)}}class Ms extends Dt{constructor(e=1,n=32,i=16,o=0,l=2*Math.PI,h=0,f=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:i,phiStart:o,phiLength:l,thetaStart:h,thetaLength:f},n=Math.max(3,Math.floor(n)),i=Math.max(2,Math.floor(i));let p=Math.min(h+f,Math.PI),g=0,x=[],_=new J,M=new J,T=[],N=[],I=[],D=[];for(let L=0;L<=i;L++){let F=[],U=L/i,V=0;L==0&&h==0?V=.5/n:L==i&&p==Math.PI&&(V=-.5/n);for(let K=0;K<=n;K++){let re=K/n;_.x=-e*Math.cos(o+re*l)*Math.sin(h+U*f),_.y=e*Math.cos(h+U*f),_.z=e*Math.sin(o+re*l)*Math.sin(h+U*f),N.push(_.x,_.y,_.z),M.copy(_).normalize(),I.push(M.x,M.y,M.z),D.push(re+V,1-U),F.push(g++)}x.push(F)}for(let L=0;L<i;L++)for(let F=0;F<n;F++){let U=x[L][F+1],V=x[L][F],K=x[L+1][F],re=x[L+1][F+1];(L!==0||h>0)&&T.push(U,V,re),(L!==i-1||p<Math.PI)&&T.push(V,K,re)}this.setIndex(T),this.setAttribute("position",new At(N,3)),this.setAttribute("normal",new At(I,3)),this.setAttribute("uv",new At(D,2))}static fromJSON(e){return new Ms(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Oa extends Ii{constructor(e=1,n=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Oa(e.radius,e.detail)}}class Ga extends Dt{constructor(e=1,n=.4,i=8,o=6,l=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:i,tubularSegments:o,arc:l},i=Math.floor(i),o=Math.floor(o);let h=[],f=[],p=[],g=[],x=new J,_=new J,M=new J;for(let T=0;T<=i;T++)for(let N=0;N<=o;N++){let I=N/o*l,D=T/i*Math.PI*2;_.x=(e+n*Math.cos(D))*Math.cos(I),_.y=(e+n*Math.cos(D))*Math.sin(I),_.z=n*Math.sin(D),f.push(_.x,_.y,_.z),x.x=e*Math.cos(I),x.y=e*Math.sin(I),M.subVectors(_,x).normalize(),p.push(M.x,M.y,M.z),g.push(N/o),g.push(T/i)}for(let T=1;T<=i;T++)for(let N=1;N<=o;N++){let I=(o+1)*T+N-1,D=(o+1)*(T-1)+N-1,L=(o+1)*(T-1)+N,F=(o+1)*T+N;h.push(I,D,F),h.push(D,L,F)}this.setIndex(h),this.setAttribute("position",new At(f,3)),this.setAttribute("normal",new At(p,3)),this.setAttribute("uv",new At(g,2))}static fromJSON(e){return new Ga(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ba extends Dt{constructor(e=1,n=.4,i=64,o=8,l=2,h=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:i,radialSegments:o,p:l,q:h},i=Math.floor(i),o=Math.floor(o);let f=[],p=[],g=[],x=[],_=new J,M=new J,T=new J,N=new J,I=new J,D=new J,L=new J;for(let U=0;U<=i;++U){let V=U/i*l*Math.PI*2;F(V,l,h,e,T),F(V+.01,l,h,e,N),D.subVectors(N,T),L.addVectors(N,T),I.crossVectors(D,L),L.crossVectors(I,D),I.normalize(),L.normalize();for(let K=0;K<=o;++K){let re=K/o*Math.PI*2,ve=-n*Math.cos(re),_e=n*Math.sin(re);_.x=T.x+(ve*L.x+_e*I.x),_.y=T.y+(ve*L.y+_e*I.y),_.z=T.z+(ve*L.z+_e*I.z),p.push(_.x,_.y,_.z),M.subVectors(_,T).normalize(),g.push(M.x,M.y,M.z),x.push(U/i),x.push(K/o)}}for(let U=1;U<=i;U++)for(let V=1;V<=o;V++){let K=(o+1)*(U-1)+(V-1),re=(o+1)*U+(V-1),ve=(o+1)*U+V,_e=(o+1)*(U-1)+V;f.push(K,re,_e),f.push(re,ve,_e)}function F(U,V,K,re,ve){let _e=Math.cos(U),Te=Math.sin(U),Ee=K/V*U,Ne=Math.cos(Ee);ve.x=re*(2+Ne)*.5*_e,ve.y=re*(2+Ne)*Te*.5,ve.z=re*Math.sin(Ee)*.5}this.setIndex(f),this.setAttribute("position",new At(p,3)),this.setAttribute("normal",new At(g,3)),this.setAttribute("uv",new At(x,2))}static fromJSON(e){return new Ba(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ua extends Dt{constructor(e=new ro(new J(-1,-1,0),new J(-1,1,0),new J(1,1,0)),n=64,i=1,o=8,l=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:i,radialSegments:o,closed:l};let h=e.computeFrenetFrames(n,l);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals;let f=new J,p=new J,g=new Ke,x=new J,_=[],M=[],T=[],N=[];function I(D){x=e.getPointAt(D/n,x);let L=h.normals[D],F=h.binormals[D];for(let U=0;U<=o;U++){let V=U/o*Math.PI*2,K=Math.sin(V),re=-Math.cos(V);p.x=re*L.x+K*F.x,p.y=re*L.y+K*F.y,p.z=re*L.z+K*F.z,p.normalize(),M.push(p.x,p.y,p.z),f.x=x.x+i*p.x,f.y=x.y+i*p.y,f.z=x.z+i*p.z,_.push(f.x,f.y,f.z)}}(function(){for(let D=0;D<n;D++)I(D);I(l===!1?n:0),function(){for(let D=0;D<=n;D++)for(let L=0;L<=o;L++)g.x=D/n,g.y=L/o,T.push(g.x,g.y)}(),function(){for(let D=1;D<=n;D++)for(let L=1;L<=o;L++){let F=(o+1)*(D-1)+(L-1),U=(o+1)*D+(L-1),V=(o+1)*D+L,K=(o+1)*(D-1)+L;N.push(F,U,K),N.push(U,V,K)}}()})(),this.setIndex(N),this.setAttribute("position",new At(_,3)),this.setAttribute("normal",new At(M,3)),this.setAttribute("uv",new At(T,2))}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ua(new hu[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class pu extends Dt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){let n=[],i=new Set,o=new J,l=new J;if(e.index!==null){let h=e.attributes.position,f=e.index,p=e.groups;p.length===0&&(p=[{start:0,count:f.count,materialIndex:0}]);for(let g=0,x=p.length;g<x;++g){let _=p[g],M=_.start;for(let T=M,N=M+_.count;T<N;T+=3)for(let I=0;I<3;I++){let D=f.getX(T+I),L=f.getX(T+(I+1)%3);o.fromBufferAttribute(h,D),l.fromBufferAttribute(h,L),Rp(o,l,i)===!0&&(n.push(o.x,o.y,o.z),n.push(l.x,l.y,l.z))}}}else{let h=e.attributes.position;for(let f=0,p=h.count/3;f<p;f++)for(let g=0;g<3;g++){let x=3*f+g,_=3*f+(g+1)%3;o.fromBufferAttribute(h,x),l.fromBufferAttribute(h,_),Rp(o,l,i)===!0&&(n.push(o.x,o.y,o.z),n.push(l.x,l.y,l.z))}}this.setAttribute("position",new At(n,3))}}}function Rp(c,e,n){let i=`${c.x},${c.y},${c.z}-${e.x},${e.y},${e.z}`,o=`${e.x},${e.y},${e.z}-${c.x},${c.y},${c.z}`;return n.has(i)!==!0&&n.has(o)!==!0&&(n.add(i,o),!0)}var Lp=Object.freeze({__proto__:null,BoxGeometry:Pi,BoxBufferGeometry:Pi,CircleGeometry:gs,CircleBufferGeometry:gs,ConeGeometry:Ea,ConeBufferGeometry:Ea,CylinderGeometry:qr,CylinderBufferGeometry:qr,DodecahedronGeometry:Sa,DodecahedronBufferGeometry:Sa,EdgesGeometry:Ra,ExtrudeGeometry:Gi,ExtrudeBufferGeometry:Gi,IcosahedronGeometry:_s,IcosahedronBufferGeometry:_s,LatheGeometry:Ia,LatheBufferGeometry:Ia,OctahedronGeometry:Go,OctahedronBufferGeometry:Go,PlaneGeometry:ns,PlaneBufferGeometry:ns,PolyhedronGeometry:Ii,PolyhedronBufferGeometry:Ii,RingGeometry:Da,RingBufferGeometry:Da,ShapeGeometry:bs,ShapeBufferGeometry:bs,SphereGeometry:Ms,SphereBufferGeometry:Ms,TetrahedronGeometry:Oa,TetrahedronBufferGeometry:Oa,TorusGeometry:Ga,TorusBufferGeometry:Ga,TorusKnotGeometry:Ba,TorusKnotBufferGeometry:Ba,TubeGeometry:Ua,TubeBufferGeometry:Ua,WireframeGeometry:pu});class td extends Gn{constructor(e){super(),this.type="ShadowMaterial",this.color=new yt(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}td.prototype.isShadowMaterial=!0;class Hl extends Gn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new yt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Hl.prototype.isMeshStandardMaterial=!0;class nd extends Hl{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ke(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Qn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.sheenColor=new yt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new yt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new yt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}nd.prototype.isMeshPhysicalMaterial=!0;class rd extends Gn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new yt(16777215),this.specular=new yt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}rd.prototype.isMeshPhongMaterial=!0;class id extends Gn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new yt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}id.prototype.isMeshToonMaterial=!0;class od extends Gn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}od.prototype.isMeshNormalMaterial=!0;class sd extends Gn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}sd.prototype.isMeshLambertMaterial=!0;class ad extends Gn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new yt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}ad.prototype.isMeshMatcapMaterial=!0;class ld extends Yn{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}ld.prototype.isLineDashedMaterial=!0;var Rg=Object.freeze({__proto__:null,ShadowMaterial:td,SpriteMaterial:da,RawShaderMaterial:ta,ShaderMaterial:$i,PointsMaterial:Do,MeshPhysicalMaterial:nd,MeshStandardMaterial:Hl,MeshPhongMaterial:rd,MeshToonMaterial:id,MeshNormalMaterial:od,MeshLambertMaterial:sd,MeshDepthMaterial:Tl,MeshDistanceMaterial:Xc,MeshBasicMaterial:Zi,MeshMatcapMaterial:ad,LineDashedMaterial:ld,LineBasicMaterial:Yn,Material:Gn});let gn={arraySlice:function(c,e,n){return gn.isTypedArray(c)?new c.constructor(c.subarray(e,n!==void 0?n:c.length)):c.slice(e,n)},convertArray:function(c,e,n){return!c||!n&&c.constructor===e?c:typeof e.BYTES_PER_ELEMENT=="number"?new e(c):Array.prototype.slice.call(c)},isTypedArray:function(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)},getKeyframeOrder:function(c){let e=c.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(function(i,o){return c[i]-c[o]}),n},sortedArray:function(c,e,n){let i=c.length,o=new c.constructor(i);for(let l=0,h=0;h!==i;++l){let f=n[l]*e;for(let p=0;p!==e;++p)o[h++]=c[f+p]}return o},flattenJSON:function(c,e,n,i){let o=1,l=c[0];for(;l!==void 0&&l[i]===void 0;)l=c[o++];if(l===void 0)return;let h=l[i];if(h!==void 0)if(Array.isArray(h))do h=l[i],h!==void 0&&(e.push(l.time),n.push.apply(n,h)),l=c[o++];while(l!==void 0);else if(h.toArray!==void 0)do h=l[i],h!==void 0&&(e.push(l.time),h.toArray(n,n.length)),l=c[o++];while(l!==void 0);else do h=l[i],h!==void 0&&(e.push(l.time),n.push(h)),l=c[o++];while(l!==void 0)},subclip:function(c,e,n,i,o=30){let l=c.clone();l.name=e;let h=[];for(let p=0;p<l.tracks.length;++p){let g=l.tracks[p],x=g.getValueSize(),_=[],M=[];for(let T=0;T<g.times.length;++T){let N=g.times[T]*o;if(!(N<n||N>=i)){_.push(g.times[T]);for(let I=0;I<x;++I)M.push(g.values[T*x+I])}}_.length!==0&&(g.times=gn.convertArray(_,g.times.constructor),g.values=gn.convertArray(M,g.values.constructor),h.push(g))}l.tracks=h;let f=1/0;for(let p=0;p<l.tracks.length;++p)f>l.tracks[p].times[0]&&(f=l.tracks[p].times[0]);for(let p=0;p<l.tracks.length;++p)l.tracks[p].shift(-1*f);return l.resetDuration(),l},makeClipAdditive:function(c,e=0,n=c,i=30){i<=0&&(i=30);let o=n.tracks.length,l=e/i;for(let h=0;h<o;++h){let f=n.tracks[h],p=f.ValueTypeName;if(p==="bool"||p==="string")continue;let g=c.tracks.find(function(L){return L.name===f.name&&L.ValueTypeName===p});if(g===void 0)continue;let x=0,_=f.getValueSize();f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=_/3);let M=0,T=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(M=T/3);let N=f.times.length-1,I;if(l<=f.times[0]){let L=x,F=_-x;I=gn.arraySlice(f.values,L,F)}else if(l>=f.times[N]){let L=N*_+x,F=L+_-x;I=gn.arraySlice(f.values,L,F)}else{let L=f.createInterpolant(),F=x,U=_-x;L.evaluate(l),I=gn.arraySlice(L.resultBuffer,F,U)}p==="quaternion"&&new Kn().fromArray(I).normalize().conjugate().toArray(I);let D=g.times.length;for(let L=0;L<D;++L){let F=L*T+M;if(p==="quaternion")Kn.multiplyQuaternionsFlat(g.values,F,I,0,g.values,F);else{let U=T-2*M;for(let V=0;V<U;++V)g.values[F+V]-=I[V]}}}return c.blendMode=2501,c}};class ao{constructor(e,n,i,o){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let n=this.parameterPositions,i=this._cachedIndex,o=n[i],l=n[i-1];e:{t:{let h;n:{r:if(!(e<o)){for(let f=i+2;;){if(o===void 0){if(e<l)break r;return i=n.length,this._cachedIndex=i,this.afterEnd_(i-1,e,l)}if(i===f)break;if(l=o,o=n[++i],e<o)break t}h=n.length;break n}if(e>=l)break e;{let f=n[1];e<f&&(i=2,l=f);for(let p=i-2;;){if(l===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,o);if(i===p)break;if(o=l,l=n[--i-1],e>=l)break t}h=i,i=0}}for(;i<h;){let f=i+h>>>1;e<n[f]?h=f:i=f+1}if(o=n[i],l=n[i-1],l===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,o);if(o===void 0)return i=n.length,this._cachedIndex=i,this.afterEnd_(i-1,l,e)}this._cachedIndex=i,this.intervalChanged_(i,l,o)}return this.interpolate_(i,l,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,l=e*o;for(let h=0;h!==o;++h)n[h]=i[l+h];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}ao.prototype.beforeStart_=ao.prototype.copySampleValue_,ao.prototype.afterEnd_=ao.prototype.copySampleValue_;class Pp extends ao{constructor(e,n,i,o){super(e,n,i,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,n,i){let o=this.parameterPositions,l=e-2,h=e+1,f=o[l],p=o[h];if(f===void 0)switch(this.getSettings_().endingStart){case 2401:l=e,f=2*n-i;break;case 2402:l=o.length-2,f=n+o[l]-o[l+1];break;default:l=e,f=i}if(p===void 0)switch(this.getSettings_().endingEnd){case 2401:h=e,p=2*i-n;break;case 2402:h=1,p=i+o[1]-o[0];break;default:h=e-1,p=n}let g=.5*(i-n),x=this.valueSize;this._weightPrev=g/(n-f),this._weightNext=g/(p-i),this._offsetPrev=l*x,this._offsetNext=h*x}interpolate_(e,n,i,o){let l=this.resultBuffer,h=this.sampleValues,f=this.valueSize,p=e*f,g=p-f,x=this._offsetPrev,_=this._offsetNext,M=this._weightPrev,T=this._weightNext,N=(i-n)/(o-n),I=N*N,D=I*N,L=-M*D+2*M*I-M*N,F=(1+M)*D+(-1.5-2*M)*I+(-.5+M)*N+1,U=(-1-T)*D+(1.5+T)*I+.5*N,V=T*D-T*I;for(let K=0;K!==f;++K)l[K]=L*h[x+K]+F*h[g+K]+U*h[p+K]+V*h[_+K];return l}}class cd extends ao{constructor(e,n,i,o){super(e,n,i,o)}interpolate_(e,n,i,o){let l=this.resultBuffer,h=this.sampleValues,f=this.valueSize,p=e*f,g=p-f,x=(i-n)/(o-n),_=1-x;for(let M=0;M!==f;++M)l[M]=h[g+M]*_+h[p+M]*x;return l}}class ud extends ao{constructor(e,n,i,o){super(e,n,i,o)}interpolate_(e){return this.copySampleValue_(e-1)}}class hi{constructor(e,n,i,o){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=gn.convertArray(n,this.TimeBufferType),this.values=gn.convertArray(i,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(e){let n=e.constructor,i;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:gn.convertArray(e.times,Array),values:gn.convertArray(e.values,Array)};let o=e.getInterpolation();o!==e.DefaultInterpolation&&(i.interpolation=o)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new ud(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new cd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Pp(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case 2300:n=this.InterpolantFactoryMethodDiscrete;break;case 2301:n=this.InterpolantFactoryMethodLinear;break;case 2302:n=this.InterpolantFactoryMethodSmooth}if(n===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]+=e}return this}scale(e){if(e!==1){let n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]*=e}return this}trim(e,n){let i=this.times,o=i.length,l=0,h=o-1;for(;l!==o&&i[l]<e;)++l;for(;h!==-1&&i[h]>n;)--h;if(++h,l!==0||h!==o){l>=h&&(h=Math.max(h,1),l=h-1);let f=this.getValueSize();this.times=gn.arraySlice(i,l,h),this.values=gn.arraySlice(this.values,l*f,h*f)}return this}validate(){let e=!0,n=this.getValueSize();n-Math.floor(n)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,o=this.values,l=i.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let h=null;for(let f=0;f!==l;f++){let p=i[f];if(typeof p=="number"&&isNaN(p)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,p),e=!1;break}if(h!==null&&h>p){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,p,h),e=!1;break}h=p}if(o!==void 0&&gn.isTypedArray(o))for(let f=0,p=o.length;f!==p;++f){let g=o[f];if(isNaN(g)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,g),e=!1;break}}return e}optimize(){let e=gn.arraySlice(this.times),n=gn.arraySlice(this.values),i=this.getValueSize(),o=this.getInterpolation()===2302,l=e.length-1,h=1;for(let f=1;f<l;++f){let p=!1,g=e[f];if(g!==e[f+1]&&(f!==1||g!==e[0]))if(o)p=!0;else{let x=f*i,_=x-i,M=x+i;for(let T=0;T!==i;++T){let N=n[x+T];if(N!==n[_+T]||N!==n[M+T]){p=!0;break}}}if(p){if(f!==h){e[h]=e[f];let x=f*i,_=h*i;for(let M=0;M!==i;++M)n[_+M]=n[x+M]}++h}}if(l>0){e[h]=e[l];for(let f=l*i,p=h*i,g=0;g!==i;++g)n[p+g]=n[f+g];++h}return h!==e.length?(this.times=gn.arraySlice(e,0,h),this.values=gn.arraySlice(n,0,h*i)):(this.times=e,this.values=n),this}clone(){let e=gn.arraySlice(this.times,0),n=gn.arraySlice(this.values,0),i=new this.constructor(this.name,e,n);return i.createInterpolant=this.createInterpolant,i}}hi.prototype.TimeBufferType=Float32Array,hi.prototype.ValueBufferType=Float32Array,hi.prototype.DefaultInterpolation=2301;class ws extends hi{}ws.prototype.ValueTypeName="bool",ws.prototype.ValueBufferType=Array,ws.prototype.DefaultInterpolation=2300,ws.prototype.InterpolantFactoryMethodLinear=void 0,ws.prototype.InterpolantFactoryMethodSmooth=void 0;class hd extends hi{}hd.prototype.ValueTypeName="color";class ka extends hi{}ka.prototype.ValueTypeName="number";class Cp extends ao{constructor(e,n,i,o){super(e,n,i,o)}interpolate_(e,n,i,o){let l=this.resultBuffer,h=this.sampleValues,f=this.valueSize,p=(i-n)/(o-n),g=e*f;for(let x=g+f;g!==x;g+=4)Kn.slerpFlat(l,0,h,g-f,h,g,p);return l}}class Fa extends hi{InterpolantFactoryMethodLinear(e){return new Cp(this.times,this.values,this.getValueSize(),e)}}Fa.prototype.ValueTypeName="quaternion",Fa.prototype.DefaultInterpolation=2301,Fa.prototype.InterpolantFactoryMethodSmooth=void 0;class Es extends hi{}Es.prototype.ValueTypeName="string",Es.prototype.ValueBufferType=Array,Es.prototype.DefaultInterpolation=2300,Es.prototype.InterpolantFactoryMethodLinear=void 0,Es.prototype.InterpolantFactoryMethodSmooth=void 0;class Vl extends hi{}Vl.prototype.ValueTypeName="vector";class Wl{constructor(e,n=-1,i,o=2500){this.name=e,this.tracks=i,this.duration=n,this.blendMode=o,this.uuid=mr(),this.duration<0&&this.resetDuration()}static parse(e){let n=[],i=e.tracks,o=1/(e.fps||1);for(let h=0,f=i.length;h!==f;++h)n.push(Lg(i[h]).scale(o));let l=new this(e.name,e.duration,n,e.blendMode);return l.uuid=e.uuid,l}static toJSON(e){let n=[],i=e.tracks,o={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let l=0,h=i.length;l!==h;++l)n.push(hi.toJSON(i[l]));return o}static CreateFromMorphTargetSequence(e,n,i,o){let l=n.length,h=[];for(let f=0;f<l;f++){let p=[],g=[];p.push((f+l-1)%l,f,(f+1)%l),g.push(0,1,0);let x=gn.getKeyframeOrder(p);p=gn.sortedArray(p,1,x),g=gn.sortedArray(g,1,x),o||p[0]!==0||(p.push(l),g.push(g[0])),h.push(new ka(".morphTargetInfluences["+n[f].name+"]",p,g).scale(1/i))}return new this(e,-1,h)}static findByName(e,n){let i=e;if(!Array.isArray(e)){let o=e;i=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<i.length;o++)if(i[o].name===n)return i[o];return null}static CreateClipsFromMorphTargetSequences(e,n,i){let o={},l=/^([\w-]*?)([\d]+)$/;for(let f=0,p=e.length;f<p;f++){let g=e[f],x=g.name.match(l);if(x&&x.length>1){let _=x[1],M=o[_];M||(o[_]=M=[]),M.push(g)}}let h=[];for(let f in o)h.push(this.CreateFromMorphTargetSequence(f,o[f],n,i));return h}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(x,_,M,T,N){if(M.length!==0){let I=[],D=[];gn.flattenJSON(M,I,D,T),I.length!==0&&N.push(new x(_,I,D))}},o=[],l=e.name||"default",h=e.fps||30,f=e.blendMode,p=e.length||-1,g=e.hierarchy||[];for(let x=0;x<g.length;x++){let _=g[x].keys;if(_&&_.length!==0)if(_[0].morphTargets){let M={},T;for(T=0;T<_.length;T++)if(_[T].morphTargets)for(let N=0;N<_[T].morphTargets.length;N++)M[_[T].morphTargets[N]]=-1;for(let N in M){let I=[],D=[];for(let L=0;L!==_[T].morphTargets.length;++L){let F=_[T];I.push(F.time),D.push(F.morphTarget===N?1:0)}o.push(new ka(".morphTargetInfluence["+N+"]",I,D))}p=M.length*(h||1)}else{let M=".bones["+n[x].name+"]";i(Vl,M+".position",_,"pos",o),i(Fa,M+".quaternion",_,"rot",o),i(Vl,M+".scale",_,"scl",o)}}return o.length===0?null:new this(l,p,o,f)}resetDuration(){let e=0;for(let n=0,i=this.tracks.length;n!==i;++n){let o=this.tracks[n];e=Math.max(e,o.times[o.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Lg(c){if(c.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=function(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ka;case"vector":case"vector2":case"vector3":case"vector4":return Vl;case"color":return hd;case"quaternion":return Fa;case"bool":case"boolean":return ws;case"string":return Es}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(c.type);if(c.times===void 0){let n=[],i=[];gn.flattenJSON(c.keys,n,i,"value"),c.times=n,c.values=i}return e.parse!==void 0?e.parse(c):new e(c.name,c.times,c.values,c.interpolation)}let Ss={enabled:!1,files:{},add:function(c,e){this.enabled!==!1&&(this.files[c]=e)},get:function(c){if(this.enabled!==!1)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}};class dd{constructor(e,n,i){let o=this,l,h=!1,f=0,p=0,g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=i,this.itemStart=function(x){p++,h===!1&&o.onStart!==void 0&&o.onStart(x,f,p),h=!0},this.itemEnd=function(x){f++,o.onProgress!==void 0&&o.onProgress(x,f,p),f===p&&(h=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(x){o.onError!==void 0&&o.onError(x)},this.resolveURL=function(x){return l?l(x):x},this.setURLModifier=function(x){return l=x,this},this.addHandler=function(x,_){return g.push(x,_),this},this.removeHandler=function(x){let _=g.indexOf(x);return _!==-1&&g.splice(_,2),this},this.getHandler=function(x){for(let _=0,M=g.length;_<M;_+=2){let T=g[_],N=g[_+1];if(T.global&&(T.lastIndex=0),T.test(x))return N}return null}}}let Ip=new dd;class dr{constructor(e){this.manager=e!==void 0?e:Ip,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){let i=this;return new Promise(function(o,l){i.load(e,o,n,l)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}let lo={};class Bi extends dr{constructor(e){super(e)}load(e,n,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let l=Ss.get(e);if(l!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(l),this.manager.itemEnd(e)},0),l;if(lo[e]!==void 0)return void lo[e].push({onLoad:n,onProgress:i,onError:o});lo[e]=[],lo[e].push({onLoad:n,onProgress:i,onError:o});let h=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(h).then(f=>{if(f.status===200||f.status===0){f.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received.");let p=lo[e],g=f.body.getReader(),x=f.headers.get("Content-Length"),_=x?parseInt(x):0,M=_!==0,T=0;return new ReadableStream({start(N){(function I(){g.read().then(({done:D,value:L})=>{if(D)N.close();else{T+=L.byteLength;let F=new ProgressEvent("progress",{lengthComputable:M,loaded:T,total:_});for(let U=0,V=p.length;U<V;U++){let K=p[U];K.onProgress&&K.onProgress(F)}N.enqueue(L),I()}})})()}})}throw Error(`fetch for "${f.url}" responded with ${f.status}: ${f.statusText}`)}).then(f=>{let p=new Response(f);switch(this.responseType){case"arraybuffer":return p.arrayBuffer();case"blob":return p.blob();case"document":return p.text().then(g=>new DOMParser().parseFromString(g,this.mimeType));case"json":return p.json();default:return p.text()}}).then(f=>{Ss.add(e,f);let p=lo[e];delete lo[e];for(let g=0,x=p.length;g<x;g++){let _=p[g];_.onLoad&&_.onLoad(f)}this.manager.itemEnd(e)}).catch(f=>{let p=lo[e];delete lo[e];for(let g=0,x=p.length;g<x;g++){let _=p[g];_.onError&&_.onError(f)}this.manager.itemError(e),this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class za extends dr{constructor(e){super(e)}load(e,n,i,o){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let l=this,h=Ss.get(e);if(h!==void 0)return l.manager.itemStart(e),setTimeout(function(){n&&n(h),l.manager.itemEnd(e)},0),h;let f=hc("img");function p(){x(),Ss.add(e,this),n&&n(this),l.manager.itemEnd(e)}function g(_){x(),o&&o(_),l.manager.itemError(e),l.manager.itemEnd(e)}function x(){f.removeEventListener("load",p,!1),f.removeEventListener("error",g,!1)}return f.addEventListener("load",p,!1),f.addEventListener("error",g,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(f.crossOrigin=this.crossOrigin),l.manager.itemStart(e),f.src=e,f}}class fd extends dr{constructor(e){super(e)}load(e,n,i,o){let l=new Ao,h=new za(this.manager);h.setCrossOrigin(this.crossOrigin),h.setPath(this.path);let f=0;function p(g){h.load(e[g],function(x){l.images[g]=x,f++,f===6&&(l.needsUpdate=!0,n&&n(l))},void 0,o)}for(let g=0;g<e.length;++g)p(g);return l}}class pd extends dr{constructor(e){super(e)}load(e,n,i,o){let l=this,h=new to,f=new Bi(this.manager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(l.withCredentials),f.load(e,function(p){let g=l.parse(p);g&&(g.image!==void 0?h.image=g.image:g.data!==void 0&&(h.image.width=g.width,h.image.height=g.height,h.image.data=g.data),h.wrapS=g.wrapS!==void 0?g.wrapS:1001,h.wrapT=g.wrapT!==void 0?g.wrapT:1001,h.magFilter=g.magFilter!==void 0?g.magFilter:1006,h.minFilter=g.minFilter!==void 0?g.minFilter:1006,h.anisotropy=g.anisotropy!==void 0?g.anisotropy:1,g.encoding!==void 0&&(h.encoding=g.encoding),g.flipY!==void 0&&(h.flipY=g.flipY),g.format!==void 0&&(h.format=g.format),g.type!==void 0&&(h.type=g.type),g.mipmaps!==void 0&&(h.mipmaps=g.mipmaps,h.minFilter=1008),g.mipmapCount===1&&(h.minFilter=1006),g.generateMipmaps!==void 0&&(h.generateMipmaps=g.generateMipmaps),h.needsUpdate=!0,n&&n(h,g))},i,o),h}}class md extends dr{constructor(e){super(e)}load(e,n,i,o){let l=new Dn,h=new za(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(e,function(f){l.image=f,l.needsUpdate=!0,n!==void 0&&n(l)},i,o),l}}class di extends Xt{constructor(e,n=1){super(),this.type="Light",this.color=new yt(e),this.intensity=n}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n}}di.prototype.isLight=!0;class gd extends di{constructor(e,n,i){super(e,i),this.type="HemisphereLight",this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.groundColor=new yt(n)}copy(e){return di.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}gd.prototype.isHemisphereLight=!0;let Dp=new Mt,Op=new J,mu=new J;class gu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ke(512,512),this.map=null,this.mapPass=null,this.matrix=new Mt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new yl,this._frameExtents=new Ke(1,1),this._viewportCount=1,this._viewports=[new on(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let n=this.camera,i=this.matrix;Op.setFromMatrixPosition(e.matrixWorld),n.position.copy(Op),mu.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(mu),n.updateMatrixWorld(),Dp.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dp),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(n.projectionMatrix),i.multiply(n.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class vd extends gu{constructor(){super(new An(50,1,.5,500)),this.focus=1}updateMatrices(e){let n=this.camera,i=2*Xo*e.angle*this.focus,o=this.mapSize.width/this.mapSize.height,l=e.distance||n.far;i===n.fov&&o===n.aspect&&l===n.far||(n.fov=i,n.aspect=o,n.far=l,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}vd.prototype.isSpotLightShadow=!0;class Ft extends di{constructor(e,n,i=0,o=Math.PI/3,l=0,h=1){super(e,n),this.type="SpotLight",this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.target=new Xt,this.distance=i,this.angle=o,this.penumbra=l,this.decay=h,this.shadow=new vd}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ft.prototype.isSpotLight=!0;let un=new Mt,Bo=new J,jt=new J;class yd extends gu{constructor(){super(new An(90,1,.5,500)),this._frameExtents=new Ke(4,2),this._viewportCount=6,this._viewports=[new on(2,1,1,1),new on(0,1,1,1),new on(3,1,1,1),new on(1,1,1,1),new on(3,0,1,1),new on(1,0,1,1)],this._cubeDirections=[new J(1,0,0),new J(-1,0,0),new J(0,0,1),new J(0,0,-1),new J(0,1,0),new J(0,-1,0)],this._cubeUps=[new J(0,1,0),new J(0,1,0),new J(0,1,0),new J(0,1,0),new J(0,0,1),new J(0,0,-1)]}updateMatrices(e,n=0){let i=this.camera,o=this.matrix,l=e.distance||i.far;l!==i.far&&(i.far=l,i.updateProjectionMatrix()),Bo.setFromMatrixPosition(e.matrixWorld),i.position.copy(Bo),jt.copy(i.position),jt.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(jt),i.updateMatrixWorld(),o.makeTranslation(-Bo.x,-Bo.y,-Bo.z),un.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(un)}}yd.prototype.isPointLightShadow=!0;class xd extends di{constructor(e,n,i=0,o=1){super(e,n),this.type="PointLight",this.distance=i,this.decay=o,this.shadow=new yd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}xd.prototype.isPointLight=!0;class Gp extends gu{constructor(){super(new Yr(-5,5,5,-5,.5,500))}}Gp.prototype.isDirectionalLightShadow=!0;class _d extends di{constructor(e,n){super(e,n),this.type="DirectionalLight",this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.target=new Xt,this.shadow=new Gp}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}_d.prototype.isDirectionalLight=!0;class bd extends di{constructor(e,n){super(e,n),this.type="AmbientLight"}}bd.prototype.isAmbientLight=!0;class Md extends di{constructor(e,n,i=10,o=10){super(e,n),this.type="RectAreaLight",this.width=i,this.height=o}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}Md.prototype.isRectAreaLight=!0;class Ha{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new J)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){let i=e.x,o=e.y,l=e.z,h=this.coefficients;return n.copy(h[0]).multiplyScalar(.282095),n.addScaledVector(h[1],.488603*o),n.addScaledVector(h[2],.488603*l),n.addScaledVector(h[3],.488603*i),n.addScaledVector(h[4],i*o*1.092548),n.addScaledVector(h[5],o*l*1.092548),n.addScaledVector(h[6],.315392*(3*l*l-1)),n.addScaledVector(h[7],i*l*1.092548),n.addScaledVector(h[8],.546274*(i*i-o*o)),n}getIrradianceAt(e,n){let i=e.x,o=e.y,l=e.z,h=this.coefficients;return n.copy(h[0]).multiplyScalar(.886227),n.addScaledVector(h[1],1.023328*o),n.addScaledVector(h[2],1.023328*l),n.addScaledVector(h[3],1.023328*i),n.addScaledVector(h[4],.858086*i*o),n.addScaledVector(h[5],.858086*o*l),n.addScaledVector(h[6],.743125*l*l-.247708),n.addScaledVector(h[7],.858086*i*l),n.addScaledVector(h[8],.429043*(i*i-o*o)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){let i=this.coefficients;for(let o=0;o<9;o++)i[o].fromArray(e,n+3*o);return this}toArray(e=[],n=0){let i=this.coefficients;for(let o=0;o<9;o++)i[o].toArray(e,n+3*o);return e}static getBasisAt(e,n){let i=e.x,o=e.y,l=e.z;n[0]=.282095,n[1]=.488603*o,n[2]=.488603*l,n[3]=.488603*i,n[4]=1.092548*i*o,n[5]=1.092548*o*l,n[6]=.315392*(3*l*l-1),n[7]=1.092548*i*l,n[8]=.546274*(i*i-o*o)}}Ha.prototype.isSphericalHarmonics3=!0;class Va extends di{constructor(e=new Ha,n=1){super(void 0,n),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}Va.prototype.isLightProbe=!0;class jl extends dr{constructor(e){super(e),this.textures={}}load(e,n,i,o){let l=this,h=new Bi(l.manager);h.setPath(l.path),h.setRequestHeader(l.requestHeader),h.setWithCredentials(l.withCredentials),h.load(e,function(f){try{n(l.parse(JSON.parse(f)))}catch(p){o?o(p):console.error(p),l.manager.itemError(e)}},i,o)}parse(e){let n=this.textures;function i(l){return n[l]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",l),n[l]}let o=new Rg[e.type];if(e.uuid!==void 0&&(o.uuid=e.uuid),e.name!==void 0&&(o.name=e.name),e.color!==void 0&&o.color!==void 0&&o.color.setHex(e.color),e.roughness!==void 0&&(o.roughness=e.roughness),e.metalness!==void 0&&(o.metalness=e.metalness),e.sheen!==void 0&&(o.sheen=e.sheen),e.sheenColor!==void 0&&(o.sheenColor=new yt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(o.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&o.emissive!==void 0&&o.emissive.setHex(e.emissive),e.specular!==void 0&&o.specular!==void 0&&o.specular.setHex(e.specular),e.specularIntensity!==void 0&&(o.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&o.specularColor!==void 0&&o.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(o.shininess=e.shininess),e.clearcoat!==void 0&&(o.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(o.transmission=e.transmission),e.thickness!==void 0&&(o.thickness=e.thickness),e.attenuationDistance!==void 0&&(o.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&o.attenuationColor!==void 0&&o.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(o.fog=e.fog),e.flatShading!==void 0&&(o.flatShading=e.flatShading),e.blending!==void 0&&(o.blending=e.blending),e.combine!==void 0&&(o.combine=e.combine),e.side!==void 0&&(o.side=e.side),e.shadowSide!==void 0&&(o.shadowSide=e.shadowSide),e.opacity!==void 0&&(o.opacity=e.opacity),e.format!==void 0&&(o.format=e.format),e.transparent!==void 0&&(o.transparent=e.transparent),e.alphaTest!==void 0&&(o.alphaTest=e.alphaTest),e.depthTest!==void 0&&(o.depthTest=e.depthTest),e.depthWrite!==void 0&&(o.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(o.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(o.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(o.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(o.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(o.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(o.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(o.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(o.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(o.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(o.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(o.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(o.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(o.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(o.rotation=e.rotation),e.linewidth!==1&&(o.linewidth=e.linewidth),e.dashSize!==void 0&&(o.dashSize=e.dashSize),e.gapSize!==void 0&&(o.gapSize=e.gapSize),e.scale!==void 0&&(o.scale=e.scale),e.polygonOffset!==void 0&&(o.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(o.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(o.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(o.dithering=e.dithering),e.alphaToCoverage!==void 0&&(o.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(o.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(o.visible=e.visible),e.toneMapped!==void 0&&(o.toneMapped=e.toneMapped),e.userData!==void 0&&(o.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.uniforms!==void 0)for(let l in e.uniforms){let h=e.uniforms[l];switch(o.uniforms[l]={},h.type){case"t":o.uniforms[l].value=i(h.value);break;case"c":o.uniforms[l].value=new yt().setHex(h.value);break;case"v2":o.uniforms[l].value=new Ke().fromArray(h.value);break;case"v3":o.uniforms[l].value=new J().fromArray(h.value);break;case"v4":o.uniforms[l].value=new on().fromArray(h.value);break;case"m3":o.uniforms[l].value=new In().fromArray(h.value);break;case"m4":o.uniforms[l].value=new Mt().fromArray(h.value);break;default:o.uniforms[l].value=h.value}}if(e.defines!==void 0&&(o.defines=e.defines),e.vertexShader!==void 0&&(o.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(o.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(let l in e.extensions)o.extensions[l]=e.extensions[l];if(e.shading!==void 0&&(o.flatShading=e.shading===1),e.size!==void 0&&(o.size=e.size),e.sizeAttenuation!==void 0&&(o.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(o.map=i(e.map)),e.matcap!==void 0&&(o.matcap=i(e.matcap)),e.alphaMap!==void 0&&(o.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(o.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(o.bumpScale=e.bumpScale),e.normalMap!==void 0&&(o.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(o.normalMapType=e.normalMapType),e.normalScale!==void 0){let l=e.normalScale;Array.isArray(l)===!1&&(l=[l,l]),o.normalScale=new Ke().fromArray(l)}return e.displacementMap!==void 0&&(o.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(o.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(o.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(o.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(o.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(o.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(o.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(o.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(o.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(o.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(o.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(o.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(o.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(o.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(o.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(o.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(o.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(o.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(o.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(o.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(o.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(o.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(o.clearcoatNormalScale=new Ke().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(o.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(o.thicknessMap=i(e.thicknessMap)),e.sheenColorMap!==void 0&&(o.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(o.sheenRoughnessMap=i(e.sheenRoughnessMap)),o}setTextures(e){return this.textures=e,this}}class Wa{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let i=0,o=e.length;i<o;i++)n+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){let n=e.lastIndexOf("/");return n===-1?"./":e.substr(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class Yl extends Dt{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Yl.prototype.isInstancedBufferGeometry=!0;class vu extends dr{constructor(e){super(e)}load(e,n,i,o){let l=this,h=new Bi(l.manager);h.setPath(l.path),h.setRequestHeader(l.requestHeader),h.setWithCredentials(l.withCredentials),h.load(e,function(f){try{n(l.parse(JSON.parse(f)))}catch(p){o?o(p):console.error(p),l.manager.itemError(e)}},i,o)}parse(e){let n={},i={};function o(_,M){if(n[M]!==void 0)return n[M];let T=_.interleavedBuffers[M],N=function(L,F){if(i[F]!==void 0)return i[F];let U=L.arrayBuffers[F],V=new Uint32Array(U).buffer;return i[F]=V,V}(_,T.buffer),I=Vs(T.type,N),D=new eo(I,T.stride);return D.uuid=T.uuid,n[M]=D,D}let l=e.isInstancedBufferGeometry?new Yl:new Dt,h=e.data.index;if(h!==void 0){let _=Vs(h.type,h.array);l.setIndex(new Jt(_,1))}let f=e.data.attributes;for(let _ in f){let M=f[_],T;if(M.isInterleavedBufferAttribute){let N=o(e.data,M.data);T=new Rr(N,M.itemSize,M.offset,M.normalized)}else{let N=Vs(M.type,M.array);T=new(M.isInstancedBufferAttribute?hs:Jt)(N,M.itemSize,M.normalized)}M.name!==void 0&&(T.name=M.name),M.usage!==void 0&&T.setUsage(M.usage),M.updateRange!==void 0&&(T.updateRange.offset=M.updateRange.offset,T.updateRange.count=M.updateRange.count),l.setAttribute(_,T)}let p=e.data.morphAttributes;if(p)for(let _ in p){let M=p[_],T=[];for(let N=0,I=M.length;N<I;N++){let D=M[N],L;if(D.isInterleavedBufferAttribute){let F=o(e.data,D.data);L=new Rr(F,D.itemSize,D.offset,D.normalized)}else{let F=Vs(D.type,D.array);L=new Jt(F,D.itemSize,D.normalized)}D.name!==void 0&&(L.name=D.name),T.push(L)}l.morphAttributes[_]=T}e.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);let g=e.data.groups||e.data.drawcalls||e.data.offsets;if(g!==void 0)for(let _=0,M=g.length;_!==M;++_){let T=g[_];l.addGroup(T.start,T.count,T.materialIndex)}let x=e.data.boundingSphere;if(x!==void 0){let _=new J;x.center!==void 0&&_.fromArray(x.center),l.boundingSphere=new qi(_,x.radius)}return e.name&&(l.name=e.name),e.userData&&(l.userData=e.userData),l}}let Bp={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Up={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},kp={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};class wd extends dr{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let l=this,h=Ss.get(e);if(h!==void 0)return l.manager.itemStart(e),setTimeout(function(){n&&n(h),l.manager.itemEnd(e)},0),h;let f={};f.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",f.headers=this.requestHeader,fetch(e,f).then(function(p){return p.blob()}).then(function(p){return createImageBitmap(p,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(p){Ss.add(e,p),n&&n(p),l.manager.itemEnd(e)}).catch(function(p){o&&o(p),l.manager.itemError(e),l.manager.itemEnd(e)}),l.manager.itemStart(e)}}let ja;wd.prototype.isImageBitmapLoader=!0;let Ts={getContext:function(){return ja===void 0&&(ja=new(window.AudioContext||window.webkitAudioContext)),ja},setContext:function(c){ja=c}};class Ed extends dr{constructor(e){super(e)}load(e,n,i,o){let l=this,h=new Bi(this.manager);h.setResponseType("arraybuffer"),h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(f){try{let p=f.slice(0);Ts.getContext().decodeAudioData(p,function(g){n(g)})}catch(p){o?o(p):console.error(p),l.manager.itemError(e)}},i,o)}}class Sd extends Va{constructor(e,n,i=1){super(void 0,i);let o=new yt().set(e),l=new yt().set(n),h=new J(o.r,o.g,o.b),f=new J(l.r,l.g,l.b),p=Math.sqrt(Math.PI),g=p*Math.sqrt(.75);this.sh.coefficients[0].copy(h).add(f).multiplyScalar(p),this.sh.coefficients[1].copy(h).sub(f).multiplyScalar(g)}}Sd.prototype.isHemisphereLightProbe=!0;class Ya extends Va{constructor(e,n=1){super(void 0,n);let i=new yt().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Ya.prototype.isAmbientLightProbe=!0;let Fp=new Mt,zp=new Mt;class yu{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Hp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let n=Hp();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function Hp(){return(typeof performance>"u"?Date:performance).now()}let As=new J,Vp=new Kn,Uo=new J,Ui=new J;class qa extends Xt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;let n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}let ko=new J,Td=new Kn,Wp=new J,ki=new J;class xu{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,n=this.getFrequencyData();for(let i=0;i<n.length;i++)e+=n[i];return e/n.length}}class _u{constructor(e,n,i){let o,l,h;switch(this.binding=e,this.valueSize=i,n){case"quaternion":o=this._slerp,l=this._slerpAdditive,h=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":o=this._select,l=this._select,h=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:o=this._lerp,l=this._lerpAdditive,h=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=l,this._setIdentity=h,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){let i=this.buffer,o=this.valueSize,l=e*o+o,h=this.cumulativeWeight;if(h===0){for(let f=0;f!==o;++f)i[l+f]=i[f];h=n}else{h+=n;let f=n/h;this._mixBufferRegion(i,l,0,f,o)}this.cumulativeWeight=h}accumulateAdditive(e){let n=this.buffer,i=this.valueSize,o=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,o,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let n=this.valueSize,i=this.buffer,o=e*n+n,l=this.cumulativeWeight,h=this.cumulativeWeightAdditive,f=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,l<1){let p=n*this._origIndex;this._mixBufferRegion(i,o,p,1-l,n)}h>0&&this._mixBufferRegionAdditive(i,o,this._addIndex*n,1,n);for(let p=n,g=n+n;p!==g;++p)if(i[p]!==i[p+n]){f.setValue(i,o);break}}saveOriginalState(){let e=this.binding,n=this.buffer,i=this.valueSize,o=i*this._origIndex;e.getValue(n,o);for(let l=i,h=o;l!==h;++l)n[l]=n[o+l%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let i=e;i<n;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[e+i]}_select(e,n,i,o,l){if(o>=.5)for(let h=0;h!==l;++h)e[n+h]=e[i+h]}_slerp(e,n,i,o){Kn.slerpFlat(e,n,e,n,e,i,o)}_slerpAdditive(e,n,i,o,l){let h=this._workIndex*l;Kn.multiplyQuaternionsFlat(e,h,e,n,e,i),Kn.slerpFlat(e,n,e,n,e,h,o)}_lerp(e,n,i,o,l){let h=1-o;for(let f=0;f!==l;++f){let p=n+f;e[p]=e[p]*h+e[i+f]*o}}_lerpAdditive(e,n,i,o,l){for(let h=0;h!==l;++h){let f=n+h;e[f]=e[f]+e[i+h]*o}}}let Ad="\\[\\]\\.:\\/",Nd=new RegExp("[\\[\\]\\.:\\/]","g"),bu="[^\\[\\]\\.:\\/]",jp="[^"+Ad.replace("\\.","")+"]",Yp=/((?:WC+[\/:])*)/.source.replace("WC",bu),qp=/(WCOD+)?/.source.replace("WCOD",jp),Xp=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bu),Jp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bu),Rd=new RegExp("^"+Yp+qp+Xp+Jp+"$"),Mu=["material","materials","bones"];class Kt{constructor(e,n,i){this.path=n,this.parsedPath=i||Kt.parseTrackName(n),this.node=Kt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new Kt.Composite(e,n,i):new Kt(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Nd,"")}static parseTrackName(e){let n=Rd.exec(e);if(!n)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},o=i.nodeName&&i.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){let l=i.nodeName.substring(o+1);Mu.indexOf(l)!==-1&&(i.nodeName=i.nodeName.substring(0,o),i.objectName=l)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(!n||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){let i=function(l){for(let h=0;h<l.length;h++){let f=l[h];if(f.name===n||f.uuid===n)return f;let p=i(f.children);if(p)return p}return null},o=i(e.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){let i=this.resolvedProperty;for(let o=0,l=i.length;o!==l;++o)e[n++]=i[o]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){let i=this.resolvedProperty;for(let o=0,l=i.length;o!==l;++o)i[o]=e[n++]}_setValue_array_setNeedsUpdate(e,n){let i=this.resolvedProperty;for(let o=0,l=i.length;o!==l;++o)i[o]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){let i=this.resolvedProperty;for(let o=0,l=i.length;o!==l;++o)i[o]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node,n=this.parsedPath,i=n.objectName,o=n.propertyName,l=n.propertyIndex;if(e||(e=Kt.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let g=n.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let x=0;x<e.length;x++)if(e[x].name===g){g=x;break}break;default:if(e[i]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(g!==void 0){if(e[g]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[g]}}let h=e[o];if(h===void 0){let g=n.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+g+"."+o+" but it wasn't found.",e)}let f=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?f=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(f=this.Versioning.MatrixWorldNeedsUpdate);let p=this.BindingType.Direct;if(l!==void 0){if(o==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[l]!==void 0&&(l=e.morphTargetDictionary[l])}p=this.BindingType.ArrayElement,this.resolvedProperty=h,this.propertyIndex=l}else h.fromArray!==void 0&&h.toArray!==void 0?(p=this.BindingType.HasFromToArray,this.resolvedProperty=h):Array.isArray(h)?(p=this.BindingType.EntireArray,this.resolvedProperty=h):this.propertyName=o;this.getValue=this.GetterByBindingType[p],this.setValue=this.SetterByBindingTypeAndVersioning[p][f]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Kt.Composite=class{constructor(c,e,n){let i=n||Kt.parseTrackName(e);this._targetGroup=c,this._bindings=c.subscribe_(e,i)}getValue(c,e){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(c,e)}setValue(c,e){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=n.length;i!==o;++i)n[i].setValue(c,e)}bind(){let c=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=c.length;e!==n;++e)c[e].bind()}unbind(){let c=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=c.length;e!==n;++e)c[e].unbind()}},Kt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Kt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Kt.prototype.GetterByBindingType=[Kt.prototype._getValue_direct,Kt.prototype._getValue_array,Kt.prototype._getValue_arrayElement,Kt.prototype._getValue_toArray],Kt.prototype.SetterByBindingTypeAndVersioning=[[Kt.prototype._setValue_direct,Kt.prototype._setValue_direct_setNeedsUpdate,Kt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_array,Kt.prototype._setValue_array_setNeedsUpdate,Kt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_arrayElement,Kt.prototype._setValue_arrayElement_setNeedsUpdate,Kt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_fromArray,Kt.prototype._setValue_fromArray_setNeedsUpdate,Kt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ld{constructor(){this.uuid=mr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let i=0,o=arguments.length;i!==o;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){let e=this._objects,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,l=this._bindings,h=l.length,f,p=e.length,g=this.nCachedObjects_;for(let x=0,_=arguments.length;x!==_;++x){let M=arguments[x],T=M.uuid,N=n[T];if(N===void 0){N=p++,n[T]=N,e.push(M);for(let I=0,D=h;I!==D;++I)l[I].push(new Kt(M,i[I],o[I]))}else if(N<g){f=e[N];let I=--g,D=e[I];n[D.uuid]=N,e[N]=D,n[T]=I,e[I]=M;for(let L=0,F=h;L!==F;++L){let U=l[L],V=U[I],K=U[N];U[N]=V,K===void 0&&(K=new Kt(M,i[L],o[L])),U[I]=K}}else e[N]!==f&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}remove(){let e=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length,l=this.nCachedObjects_;for(let h=0,f=arguments.length;h!==f;++h){let p=arguments[h],g=p.uuid,x=n[g];if(x!==void 0&&x>=l){let _=l++,M=e[_];n[M.uuid]=x,e[x]=M,n[g]=_,e[_]=p;for(let T=0,N=o;T!==N;++T){let I=i[T],D=I[_],L=I[x];I[x]=D,I[_]=L}}}this.nCachedObjects_=l}uncache(){let e=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length,l=this.nCachedObjects_,h=e.length;for(let f=0,p=arguments.length;f!==p;++f){let g=arguments[f].uuid,x=n[g];if(x!==void 0)if(delete n[g],x<l){let _=--l,M=e[_],T=--h,N=e[T];n[M.uuid]=x,e[x]=M,n[N.uuid]=_,e[_]=N,e.pop();for(let I=0,D=o;I!==D;++I){let L=i[I],F=L[_],U=L[T];L[x]=F,L[_]=U,L.pop()}}else{let _=--h,M=e[_];_>0&&(n[M.uuid]=x),e[x]=M,e.pop();for(let T=0,N=o;T!==N;++T){let I=i[T];I[x]=I[_],I.pop()}}}this.nCachedObjects_=l}subscribe_(e,n){let i=this._bindingsIndicesByPath,o=i[e],l=this._bindings;if(o!==void 0)return l[o];let h=this._paths,f=this._parsedPaths,p=this._objects,g=p.length,x=this.nCachedObjects_,_=new Array(g);o=l.length,i[e]=o,h.push(e),f.push(n),l.push(_);for(let M=x,T=p.length;M!==T;++M){let N=p[M];_[M]=new Kt(N,e,n)}return _}unsubscribe_(e){let n=this._bindingsIndicesByPath,i=n[e];if(i!==void 0){let o=this._paths,l=this._parsedPaths,h=this._bindings,f=h.length-1,p=h[f];n[e[f]]=i,h[i]=p,h.pop(),l[i]=l[f],l.pop(),o[i]=o[f],o.pop()}}}Ld.prototype.isAnimationObjectGroup=!0;class Zp{constructor(e,n,i=null,o=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=o;let l=n.tracks,h=l.length,f=new Array(h),p={endingStart:2400,endingEnd:2400};for(let g=0;g!==h;++g){let x=l[g].createInterpolant(null);f[g]=x,x.settings=p}this._interpolantSettings=p,this._interpolants=f,this._propertyBindings=new Array(h),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,i){if(e.fadeOut(n),this.fadeIn(n),i){let o=this._clip.duration,l=e._clip.duration,h=l/o,f=o/l;e.warp(1,h,n),this.warp(f,1,n)}return this}crossFadeTo(e,n,i){return e.crossFadeFrom(this,n,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,i){let o=this._mixer,l=o.time,h=this.timeScale,f=this._timeScaleInterpolant;f===null&&(f=o._lendControlInterpolant(),this._timeScaleInterpolant=f);let p=f.parameterPositions,g=f.sampleValues;return p[0]=l,p[1]=l+i,g[0]=e/h,g[1]=n/h,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,i,o){if(!this.enabled)return void this._updateWeight(e);let l=this._startTime;if(l!==null){let p=(e-l)*i;if(p<0||i===0)return;this._startTime=null,n=i*p}n*=this._updateTimeScale(e);let h=this._updateTime(n),f=this._updateWeight(e);if(f>0){let p=this._interpolants,g=this._propertyBindings;if(this.blendMode===2501)for(let x=0,_=p.length;x!==_;++x)p[x].evaluate(h),g[x].accumulateAdditive(f);else for(let x=0,_=p.length;x!==_;++x)p[x].evaluate(h),g[x].accumulate(o,f)}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;let i=this._weightInterpolant;if(i!==null){let o=i.evaluate(e)[0];n*=o,e>i.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;let i=this._timeScaleInterpolant;i!==null&&(n*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n))}return this._effectiveTimeScale=n,n}_updateTime(e){let n=this._clip.duration,i=this.loop,o=this.time+e,l=this._loopCount,h=i===2202;if(e===0)return l===-1?o:h&&(1&l)==1?n-o:o;if(i===2200){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(o>=n)o=n;else{if(!(o<0)){this.time=o;break e}o=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(l===-1&&(e>=0?(l=0,this._setEndings(!0,this.repetitions===0,h)):this._setEndings(this.repetitions===0,!0,h)),o>=n||o<0){let f=Math.floor(o/n);o-=n*f,l+=Math.abs(f);let p=this.repetitions-l;if(p<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=e>0?n:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(p===1){let g=e<0;this._setEndings(g,!g,h)}else this._setEndings(!1,!1,h);this._loopCount=l,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=o;if(h&&(1&l)==1)return n-o}return o}_setEndings(e,n,i){let o=this._interpolantSettings;i?(o.endingStart=2401,o.endingEnd=2401):(o.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,o.endingEnd=n?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,n,i){let o=this._mixer,l=o.time,h=this._weightInterpolant;h===null&&(h=o._lendControlInterpolant(),this._weightInterpolant=h);let f=h.parameterPositions,p=h.sampleValues;return f[0]=l,p[0]=n,f[1]=l+e,p[1]=i,this}}class Pd extends Qr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){let i=e._localRoot||this._root,o=e._clip.tracks,l=o.length,h=e._propertyBindings,f=e._interpolants,p=i.uuid,g=this._bindingsByRootAndName,x=g[p];x===void 0&&(x={},g[p]=x);for(let _=0;_!==l;++_){let M=o[_],T=M.name,N=x[T];if(N!==void 0)h[_]=N;else{if(N=h[_],N!==void 0){N._cacheIndex===null&&(++N.referenceCount,this._addInactiveBinding(N,p,T));continue}let I=n&&n._propertyBindings[_].binding.parsedPath;N=new _u(Kt.create(i,T,I),M.ValueTypeName,M.getValueSize()),++N.referenceCount,this._addInactiveBinding(N,p,T),h[_]=N}f[_].resultBuffer=N.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,o=e._clip.uuid,l=this._actionsByClip[o];this._bindAction(e,l&&l.knownActions[0]),this._addInactiveAction(e,o,i)}let n=e._propertyBindings;for(let i=0,o=n.length;i!==o;++i){let l=n[i];l.useCount++==0&&(this._lendBinding(l),l.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let n=e._propertyBindings;for(let i=0,o=n.length;i!==o;++i){let l=n[i];--l.useCount==0&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,i){let o=this._actions,l=this._actionsByClip,h=l[n];if(h===void 0)h={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,l[n]=h;else{let f=h.knownActions;e._byClipCacheIndex=f.length,f.push(e)}e._cacheIndex=o.length,o.push(e),h.actionByRoot[i]=e}_removeInactiveAction(e){let n=this._actions,i=n[n.length-1],o=e._cacheIndex;i._cacheIndex=o,n[o]=i,n.pop(),e._cacheIndex=null;let l=e._clip.uuid,h=this._actionsByClip,f=h[l],p=f.knownActions,g=p[p.length-1],x=e._byClipCacheIndex;g._byClipCacheIndex=x,p[x]=g,p.pop(),e._byClipCacheIndex=null,delete f.actionByRoot[(e._localRoot||this._root).uuid],p.length===0&&delete h[l],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let n=e._propertyBindings;for(let i=0,o=n.length;i!==o;++i){let l=n[i];--l.referenceCount==0&&this._removeInactiveBinding(l)}}_lendAction(e){let n=this._actions,i=e._cacheIndex,o=this._nActiveActions++,l=n[o];e._cacheIndex=o,n[o]=e,l._cacheIndex=i,n[i]=l}_takeBackAction(e){let n=this._actions,i=e._cacheIndex,o=--this._nActiveActions,l=n[o];e._cacheIndex=o,n[o]=e,l._cacheIndex=i,n[i]=l}_addInactiveBinding(e,n,i){let o=this._bindingsByRootAndName,l=this._bindings,h=o[n];h===void 0&&(h={},o[n]=h),h[i]=e,e._cacheIndex=l.length,l.push(e)}_removeInactiveBinding(e){let n=this._bindings,i=e.binding,o=i.rootNode.uuid,l=i.path,h=this._bindingsByRootAndName,f=h[o],p=n[n.length-1],g=e._cacheIndex;p._cacheIndex=g,n[g]=p,n.pop(),delete f[l],Object.keys(f).length===0&&delete h[o]}_lendBinding(e){let n=this._bindings,i=e._cacheIndex,o=this._nActiveBindings++,l=n[o];e._cacheIndex=o,n[o]=e,l._cacheIndex=i,n[i]=l}_takeBackBinding(e){let n=this._bindings,i=e._cacheIndex,o=--this._nActiveBindings,l=n[o];e._cacheIndex=o,n[o]=e,l._cacheIndex=i,n[i]=l}_lendControlInterpolant(){let e=this._controlInterpolants,n=this._nActiveControlInterpolants++,i=e[n];return i===void 0&&(i=new cd(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=n,e[n]=i),i}_takeBackControlInterpolant(e){let n=this._controlInterpolants,i=e.__cacheIndex,o=--this._nActiveControlInterpolants,l=n[o];e.__cacheIndex=o,n[o]=e,l.__cacheIndex=i,n[i]=l}clipAction(e,n,i){let o=n||this._root,l=o.uuid,h=typeof e=="string"?Wl.findByName(o,e):e,f=h!==null?h.uuid:e,p=this._actionsByClip[f],g=null;if(i===void 0&&(i=h!==null?h.blendMode:2500),p!==void 0){let _=p.actionByRoot[l];if(_!==void 0&&_.blendMode===i)return _;g=p.knownActions[0],h===null&&(h=g._clip)}if(h===null)return null;let x=new Zp(this,h,n,i);return this._bindAction(x,g),this._addInactiveAction(x,f,l),x}existingAction(e,n){let i=n||this._root,o=i.uuid,l=typeof e=="string"?Wl.findByName(i,e):e,h=l?l.uuid:e,f=this._actionsByClip[h];return f!==void 0&&f.actionByRoot[o]||null}stopAllAction(){let e=this._actions;for(let n=this._nActiveActions-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let n=this._actions,i=this._nActiveActions,o=this.time+=e,l=Math.sign(e),h=this._accuIndex^=1;for(let g=0;g!==i;++g)n[g]._update(o,e,l,h);let f=this._bindings,p=this._nActiveBindings;for(let g=0;g!==p;++g)f[g].apply(h);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let n=this._actions,i=e.uuid,o=this._actionsByClip,l=o[i];if(l!==void 0){let h=l.knownActions;for(let f=0,p=h.length;f!==p;++f){let g=h[f];this._deactivateAction(g);let x=g._cacheIndex,_=n[n.length-1];g._cacheIndex=null,g._byClipCacheIndex=null,_._cacheIndex=x,n[x]=_,n.pop(),this._removeInactiveBindingsForAction(g)}delete o[i]}}uncacheRoot(e){let n=e.uuid,i=this._actionsByClip;for(let l in i){let h=i[l].actionByRoot[n];h!==void 0&&(this._deactivateAction(h),this._removeInactiveAction(h))}let o=this._bindingsByRootAndName[n];if(o!==void 0)for(let l in o){let h=o[l];h.restoreOriginalState(),this._removeInactiveBinding(h)}}uncacheAction(e,n){let i=this.existingAction(e,n);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Pd.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Ns{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Ns(this.value.clone===void 0?this.value:this.value.clone())}}class Rs extends eo{constructor(e,n,i=1){super(e,n),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){let n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}Rs.prototype.isInstancedInterleavedBuffer=!0;class Ls{constructor(e,n,i,o,l){this.buffer=e,this.type=n,this.itemSize=i,this.elementSize=o,this.count=l,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Ls.prototype.isGLBufferAttribute=!0;function $p(c,e){return c.distance-e.distance}function wu(c,e,n,i){if(c.layers.test(e.layers)&&c.raycast(e,n),i===!0){let o=c.children;for(let l=0,h=o.length;l<h;l++)wu(o[l],e,n,!0)}}let Cd=new Ke;class Ps{constructor(e=new Ke(1/0,1/0),n=new Ke(-1/0,-1/0)){this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){let i=Cd.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Cd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ps.prototype.isBox2=!0;let Qp=new J,Eu=new J;class ql{constructor(e=new J,n=new J){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){Qp.subVectors(e,this.start),Eu.subVectors(this.end,this.start);let i=Eu.dot(Eu),o=Eu.dot(Qp)/i;return n&&(o=Qn(o,0,1)),o}closestPointToPoint(e,n,i){let o=this.closestPointToPointParameter(e,n);return this.delta(i).multiplyScalar(o).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}let Xl=new J,Xr=new J,Fo=new Mt,Su=new Mt;class Xa extends hr{constructor(e){let n=Ja(e),i=new Dt,o=[],l=[],h=new yt(0,0,1),f=new yt(0,1,0);for(let p=0;p<n.length;p++){let g=n[p];g.parent&&g.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),l.push(h.r,h.g,h.b),l.push(f.r,f.g,f.b))}i.setAttribute("position",new At(o,3)),i.setAttribute("color",new At(l,3)),super(i,new Yn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let n=this.bones,i=this.geometry,o=i.getAttribute("position");Su.copy(this.root.matrixWorld).invert();for(let l=0,h=0;l<n.length;l++){let f=n[l];f.parent&&f.parent.isBone&&(Fo.multiplyMatrices(Su,f.matrixWorld),Xr.setFromMatrixPosition(Fo),o.setXYZ(h,Xr.x,Xr.y,Xr.z),Fo.multiplyMatrices(Su,f.parent.matrixWorld),Xr.setFromMatrixPosition(Fo),o.setXYZ(h+1,Xr.x,Xr.y,Xr.z),h+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Ja(c){let e=[];c&&c.isBone&&e.push(c);for(let n=0;n<c.children.length;n++)e.push.apply(e,Ja(c.children[n]));return e}let Tu=new J,Kp=new yt,em=new yt;class tm extends hr{constructor(e=10,n=10,i=4473924,o=8947848){i=new yt(i),o=new yt(o);let l=n/2,h=e/n,f=e/2,p=[],g=[];for(let _=0,M=0,T=-f;_<=n;_++,T+=h){p.push(-f,0,T,f,0,T),p.push(T,0,-f,T,0,f);let N=_===l?i:o;N.toArray(g,M),M+=3,N.toArray(g,M),M+=3,N.toArray(g,M),M+=3,N.toArray(g,M),M+=3}let x=new Dt;x.setAttribute("position",new At(p,3)),x.setAttribute("color",new At(g,3)),super(x,new Yn({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}let Id=new J,Au=new J,nm=new J,co=new J,pn=new To;function Nn(c,e,n,i,o,l,h){co.set(o,l,h).unproject(i);let f=e[c];if(f!==void 0){let p=n.getAttribute("position");for(let g=0,x=f.length;g<x;g++)p.setXYZ(f[g],co.x,co.y,co.z)}}let Jl=new gr;class Nu extends hr{constructor(e,n=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),l=new Dt;l.setIndex(new Jt(i,1)),l.setAttribute("position",new Jt(o,3)),super(l,new Yn({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Jl.setFromObject(this.object),Jl.isEmpty())return;let n=Jl.min,i=Jl.max,o=this.geometry.attributes.position,l=o.array;l[0]=i.x,l[1]=i.y,l[2]=i.z,l[3]=n.x,l[4]=i.y,l[5]=i.z,l[6]=n.x,l[7]=n.y,l[8]=i.z,l[9]=i.x,l[10]=n.y,l[11]=i.z,l[12]=i.x,l[13]=i.y,l[14]=n.z,l[15]=n.x,l[16]=i.y,l[17]=n.z,l[18]=n.x,l[19]=n.y,l[20]=n.z,l[21]=i.x,l[22]=n.y,l[23]=n.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return hr.prototype.copy.call(this,e),this.object=e.object,this}}let Dd=new J,Ru,Zl;class $l extends hr{constructor(e=1){let n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Dt;i.setAttribute("position",new At(n,3)),i.setAttribute("color",new At([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Yn({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,n,i){let o=new yt,l=this.geometry.attributes.color.array;return o.set(e),o.toArray(l,0),o.toArray(l,3),o.set(n),o.toArray(l,6),o.toArray(l,9),o.set(i),o.toArray(l,12),o.toArray(l,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}let rm=new Float32Array(1),uo=new Int32Array(rm.buffer);vr.create=function(c,e){return console.log("THREE.Curve.create() has been deprecated"),c.prototype=Object.create(vr.prototype),c.prototype.constructor=c,c.prototype.getPoint=e,c},kl.prototype.fromPoints=function(c){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(c)},tm.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Xa.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},dr.prototype.extractUrlBase=function(c){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Wa.extractUrlBase(c)},dr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Ps.prototype.center=function(c){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(c)},Ps.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ps.prototype.isIntersectionBox=function(c){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)},Ps.prototype.size=function(c){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(c)},gr.prototype.center=function(c){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(c)},gr.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},gr.prototype.isIntersectionBox=function(c){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)},gr.prototype.isIntersectionSphere=function(c){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(c)},gr.prototype.size=function(c){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(c)},qi.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},yl.prototype.setFromMatrix=function(c){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(c)},ql.prototype.center=function(c){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(c)},In.prototype.flattenToArrayOffset=function(c,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(c,e)},In.prototype.multiplyVector3=function(c){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),c.applyMatrix3(this)},In.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},In.prototype.applyToBufferAttribute=function(c){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),c.applyMatrix3(this)},In.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},In.prototype.getInverse=function(c){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(c).invert()},Mt.prototype.extractPosition=function(c){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(c)},Mt.prototype.flattenToArrayOffset=function(c,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(c,e)},Mt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new J().setFromMatrixColumn(this,3)},Mt.prototype.setRotationFromQuaternion=function(c){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(c)},Mt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Mt.prototype.multiplyVector3=function(c){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)},Mt.prototype.multiplyVector4=function(c){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)},Mt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Mt.prototype.rotateAxis=function(c){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),c.transformDirection(this)},Mt.prototype.crossVector=function(c){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)},Mt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Mt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Mt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Mt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Mt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Mt.prototype.applyToBufferAttribute=function(c){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)},Mt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Mt.prototype.makeFrustum=function(c,e,n,i,o,l){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(c,e,i,n,o,l)},Mt.prototype.getInverse=function(c){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(c).invert()},jr.prototype.isIntersectionLine=function(c){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(c)},Kn.prototype.multiplyVector3=function(c){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),c.applyQuaternion(this)},Kn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},ri.prototype.isIntersectionBox=function(c){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)},ri.prototype.isIntersectionPlane=function(c){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(c)},ri.prototype.isIntersectionSphere=function(c){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(c)},Sn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Sn.prototype.barycoordFromPoint=function(c,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(c,e)},Sn.prototype.midpoint=function(c){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(c)},Sn.prototypenormal=function(c){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(c)},Sn.prototype.plane=function(c){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(c)},Sn.barycoordFromPoint=function(c,e,n,i,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Sn.getBarycoord(c,e,n,i,o)},Sn.normal=function(c,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Sn.getNormal(c,e,n,i)},Di.prototype.extractAllPoints=function(c){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(c)},Di.prototype.extrude=function(c){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Gi(this,c)},Di.prototype.makeGeometry=function(c){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new bs(this,c)},Ke.prototype.fromAttribute=function(c,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,e,n)},Ke.prototype.distanceToManhattan=function(c){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(c)},Ke.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},J.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},J.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},J.prototype.getPositionFromMatrix=function(c){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(c)},J.prototype.getScaleFromMatrix=function(c){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(c)},J.prototype.getColumnFromMatrix=function(c,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,c)},J.prototype.applyProjection=function(c){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(c)},J.prototype.fromAttribute=function(c,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,e,n)},J.prototype.distanceToManhattan=function(c){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(c)},J.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},on.prototype.fromAttribute=function(c,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,e,n)},on.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Xt.prototype.getChildByName=function(c){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(c)},Xt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Xt.prototype.translate=function(c,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,c)},Xt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Xt.prototype.applyMatrix=function(c){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(c)},Object.defineProperties(Xt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(c){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=c}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Tn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Tn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),us.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},An.prototype.setLens=function(c,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(c)},Object.defineProperties(di.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(c){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=c}},shadowCameraLeft:{set:function(c){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=c}},shadowCameraRight:{set:function(c){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=c}},shadowCameraTop:{set:function(c){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=c}},shadowCameraBottom:{set:function(c){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=c}},shadowCameraNear:{set:function(c){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=c}},shadowCameraFar:{set:function(c){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=c}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(c){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=c}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(c){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=c}},shadowMapHeight:{set:function(c){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=c}}}),Object.defineProperties(Jt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===35048},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Jt.prototype.setDynamic=function(c){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(c===!0?35048:35044),this},Jt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Jt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Dt.prototype.addIndex=function(c){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(c)},Dt.prototype.addAttribute=function(c,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?c==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(c,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(c,new Jt(arguments[1],arguments[2])))},Dt.prototype.addDrawCall=function(c,e,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(c,e)},Dt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Dt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Dt.prototype.removeAttribute=function(c){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(c)},Dt.prototype.applyMatrix=function(c){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(c)},Object.defineProperties(Dt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),eo.prototype.setDynamic=function(c){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(c===!0?35048:35044),this},eo.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Gi.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Gi.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Gi.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Po.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Ns.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Gn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new yt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(c){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=c===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(c){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=c}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties($i.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(c){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=c}}}),sn.prototype.clearTarget=function(c,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(c),this.clear(e,n,i)},sn.prototype.animate=function(c){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(c)},sn.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},sn.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},sn.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},sn.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},sn.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},sn.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},sn.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},sn.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},sn.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},sn.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},sn.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},sn.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},sn.prototype.enableScissorTest=function(c){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(c)},sn.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},sn.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},sn.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},sn.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},sn.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},sn.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},sn.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},sn.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},sn.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},sn.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(sn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=c}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=c}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(c){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=c===!0?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Lo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(lr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=c}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=c}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=c}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=c}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(c){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=c}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(c){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=c}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(c){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=c}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(c){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=c}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(c){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=c}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(c){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=c}}}),qa.prototype.load=function(c){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new Ed().load(c,function(n){e.setBuffer(n)}),this},xu.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Lc.prototype.updateCubeMap=function(c,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(c,e)},Lc.prototype.clear=function(c,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(c,e,n,i)},Jo.crossOrigin=void 0,Jo.loadTexture=function(c,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let o=new md;o.setCrossOrigin(this.crossOrigin);let l=o.load(c,n,void 0,i);return e&&(l.mapping=e),l},Jo.loadTextureCube=function(c,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let o=new fd;o.setCrossOrigin(this.crossOrigin);let l=o.load(c,n,void 0,i);return e&&(l.mapping=e),l},Jo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Jo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};let im={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:G}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=G),S.ACESFilmicToneMapping=4,S.AddEquation=100,S.AddOperation=2,S.AdditiveAnimationBlendMode=2501,S.AdditiveBlending=2,S.AlphaFormat=1021,S.AlwaysDepth=1,S.AlwaysStencilFunc=519,S.AmbientLight=bd,S.AmbientLightProbe=Ya,S.AnimationClip=Wl,S.AnimationLoader=class extends dr{constructor(c){super(c)}load(c,e,n,i){let o=this,l=new Bi(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(c,function(h){try{e(o.parse(JSON.parse(h)))}catch(f){i?i(f):console.error(f),o.manager.itemError(c)}},n,i)}parse(c){let e=[];for(let n=0;n<c.length;n++){let i=Wl.parse(c[n]);e.push(i)}return e}},S.AnimationMixer=Pd,S.AnimationObjectGroup=Ld,S.AnimationUtils=gn,S.ArcCurve=Xh,S.ArrayCamera=Jc,S.ArrowHelper=class extends Xt{constructor(c=new J(0,0,1),e=new J(0,0,0),n=1,i=16776960,o=.2*n,l=.2*o){super(),this.type="ArrowHelper",Ru===void 0&&(Ru=new Dt,Ru.setAttribute("position",new At([0,0,0,0,1,0],3)),Zl=new qr(0,.5,1,5,1),Zl.translate(0,-.5,0)),this.position.copy(e),this.line=new Ci(Ru,new Yn({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Tn(Zl,new Zi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(c),this.setLength(n,o,l)}setDirection(c){if(c.y>.99999)this.quaternion.set(0,0,0,1);else if(c.y<-.99999)this.quaternion.set(1,0,0,0);else{Dd.set(c.z,0,-c.x).normalize();let e=Math.acos(c.y);this.quaternion.setFromAxisAngle(Dd,e)}}setLength(c,e=.2*c,n=.2*e){this.line.scale.set(1,Math.max(1e-4,c-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=c,this.cone.updateMatrix()}setColor(c){this.line.material.color.set(c),this.cone.material.color.set(c)}copy(c){return super.copy(c,!1),this.line.copy(c.line),this.cone.copy(c.cone),this}},S.Audio=qa,S.AudioAnalyser=xu,S.AudioContext=Ts,S.AudioListener=class extends Xt{constructor(){super(),this.type="AudioListener",this.context=Ts.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new yu}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(c){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=c,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(c){return this.gain.gain.setTargetAtTime(c,this.context.currentTime,.01),this}updateMatrixWorld(c){super.updateMatrixWorld(c);let e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(As,Vp,Uo),Ui.set(0,0,-1).applyQuaternion(Vp),e.positionX){let i=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(As.x,i),e.positionY.linearRampToValueAtTime(As.y,i),e.positionZ.linearRampToValueAtTime(As.z,i),e.forwardX.linearRampToValueAtTime(Ui.x,i),e.forwardY.linearRampToValueAtTime(Ui.y,i),e.forwardZ.linearRampToValueAtTime(Ui.z,i),e.upX.linearRampToValueAtTime(n.x,i),e.upY.linearRampToValueAtTime(n.y,i),e.upZ.linearRampToValueAtTime(n.z,i)}else e.setPosition(As.x,As.y,As.z),e.setOrientation(Ui.x,Ui.y,Ui.z,n.x,n.y,n.z)}},S.AudioLoader=Ed,S.AxesHelper=$l,S.AxisHelper=function(c){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new $l(c)},S.BackSide=1,S.BasicDepthPacking=3200,S.BasicShadowMap=0,S.BinaryTextureLoader=function(c){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new pd(c)},S.Bone=ba,S.BooleanKeyframeTrack=ws,S.BoundingBoxHelper=function(c,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Nu(c,e)},S.Box2=Ps,S.Box3=gr,S.Box3Helper=class extends hr{constructor(c,e=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Dt;i.setIndex(new Jt(n,1)),i.setAttribute("position",new At([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Yn({color:e,toneMapped:!1})),this.box=c,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(c){let e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(c))}},S.BoxBufferGeometry=Pi,S.BoxGeometry=Pi,S.BoxHelper=Nu,S.BufferAttribute=Jt,S.BufferGeometry=Dt,S.BufferGeometryLoader=vu,S.ByteType=1010,S.Cache=Ss,S.Camera=To,S.CameraHelper=class extends hr{constructor(c){let e=new Dt,n=new Yn({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],o=[],l={},h=new yt(16755200),f=new yt(16711680),p=new yt(43775),g=new yt(16777215),x=new yt(3355443);function _(T,N,I){M(T,I),M(N,I)}function M(T,N){i.push(0,0,0),o.push(N.r,N.g,N.b),l[T]===void 0&&(l[T]=[]),l[T].push(i.length/3-1)}_("n1","n2",h),_("n2","n4",h),_("n4","n3",h),_("n3","n1",h),_("f1","f2",h),_("f2","f4",h),_("f4","f3",h),_("f3","f1",h),_("n1","f1",h),_("n2","f2",h),_("n3","f3",h),_("n4","f4",h),_("p","n1",f),_("p","n2",f),_("p","n3",f),_("p","n4",f),_("u1","u2",p),_("u2","u3",p),_("u3","u1",p),_("c","t",g),_("p","c",x),_("cn1","cn2",x),_("cn3","cn4",x),_("cf1","cf2",x),_("cf3","cf4",x),e.setAttribute("position",new At(i,3)),e.setAttribute("color",new At(o,3)),super(e,n),this.type="CameraHelper",this.camera=c,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.update()}update(){let c=this.geometry,e=this.pointMap;pn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Nn("c",e,c,pn,0,0,-1),Nn("t",e,c,pn,0,0,1),Nn("n1",e,c,pn,-1,-1,-1),Nn("n2",e,c,pn,1,-1,-1),Nn("n3",e,c,pn,-1,1,-1),Nn("n4",e,c,pn,1,1,-1),Nn("f1",e,c,pn,-1,-1,1),Nn("f2",e,c,pn,1,-1,1),Nn("f3",e,c,pn,-1,1,1),Nn("f4",e,c,pn,1,1,1),Nn("u1",e,c,pn,.7,1.1,-1),Nn("u2",e,c,pn,-.7,1.1,-1),Nn("u3",e,c,pn,0,2,-1),Nn("cf1",e,c,pn,-1,0,1),Nn("cf2",e,c,pn,1,0,1),Nn("cf3",e,c,pn,0,-1,1),Nn("cf4",e,c,pn,0,1,1),Nn("cn1",e,c,pn,-1,0,-1),Nn("cn2",e,c,pn,1,0,-1),Nn("cn3",e,c,pn,0,-1,-1),Nn("cn4",e,c,pn,0,1,-1),c.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},S.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},S.CanvasTexture=su,S.CatmullRomCurve3=Dl,S.CineonToneMapping=3,S.CircleBufferGeometry=gs,S.CircleGeometry=gs,S.ClampToEdgeWrapping=1001,S.Clock=yu,S.Color=yt,S.ColorKeyframeTrack=hd,S.CompressedTexture=ou,S.CompressedTextureLoader=class extends dr{constructor(c){super(c)}load(c,e,n,i){let o=this,l=[],h=new ou,f=new Bi(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(o.withCredentials);let p=0;function g(x){f.load(c[x],function(_){let M=o.parse(_,!0);l[x]={width:M.width,height:M.height,format:M.format,mipmaps:M.mipmaps},p+=1,p===6&&(M.mipmapCount===1&&(h.minFilter=1006),h.image=l,h.format=M.format,h.needsUpdate=!0,e&&e(h))},n,i)}if(Array.isArray(c))for(let x=0,_=c.length;x<_;++x)g(x);else f.load(c,function(x){let _=o.parse(x,!0);if(_.isCubemap){let M=_.mipmaps.length/_.mipmapCount;for(let T=0;T<M;T++){l[T]={mipmaps:[]};for(let N=0;N<_.mipmapCount;N++)l[T].mipmaps.push(_.mipmaps[T*_.mipmapCount+N]),l[T].format=_.format,l[T].width=_.width,l[T].height=_.height}h.image=l}else h.image.width=_.width,h.image.height=_.height,h.mipmaps=_.mipmaps;_.mipmapCount===1&&(h.minFilter=1006),h.format=_.format,h.needsUpdate=!0,e&&e(h)},n,i);return h}},S.ConeBufferGeometry=Ea,S.ConeGeometry=Ea,S.CubeCamera=Lc,S.CubeReflectionMapping=301,S.CubeRefractionMapping=302,S.CubeTexture=Ao,S.CubeTextureLoader=fd,S.CubeUVReflectionMapping=306,S.CubeUVRefractionMapping=307,S.CubicBezierCurve=uu,S.CubicBezierCurve3=Zh,S.CubicInterpolant=Pp,S.CullFaceBack=1,S.CullFaceFront=2,S.CullFaceFrontBack=3,S.CullFaceNone=0,S.Curve=vr,S.CurvePath=$h,S.CustomBlending=5,S.CustomToneMapping=5,S.CylinderBufferGeometry=qr,S.CylinderGeometry=qr,S.Cylindrical=class{constructor(c=1,e=0,n=0){return this.radius=c,this.theta=e,this.y=n,this}set(c,e,n){return this.radius=c,this.theta=e,this.y=n,this}copy(c){return this.radius=c.radius,this.theta=c.theta,this.y=c.y,this}setFromVector3(c){return this.setFromCartesianCoords(c.x,c.y,c.z)}setFromCartesianCoords(c,e,n){return this.radius=Math.sqrt(c*c+n*n),this.theta=Math.atan2(c,n),this.y=e,this}clone(){return new this.constructor().copy(this)}},S.DataTexture=to,S.DataTexture2DArray=bl,S.DataTexture3D=vh,S.DataTextureLoader=pd,S.DataUtils=class{static toHalfFloat(c){c>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),c=65504),rm[0]=c;let e=uo[0],n=e>>16&32768,i=e>>12&2047,o=e>>23&255;return o<103?n:o>142?(n|=31744,n|=(o==255?0:1)&&8388607&e,n):o<113?(i|=2048,n|=(i>>114-o)+(i>>113-o&1),n):(n|=o-112<<10|i>>1,n+=1&i,n)}},S.DecrementStencilOp=7683,S.DecrementWrapStencilOp=34056,S.DefaultLoadingManager=Ip,S.DepthFormat=1026,S.DepthStencilFormat=1027,S.DepthTexture=qh,S.DirectionalLight=_d,S.DirectionalLightHelper=class extends Xt{constructor(c,e,n){super(),this.light=c,this.light.updateMatrixWorld(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,e===void 0&&(e=1);let i=new Dt;i.setAttribute("position",new At([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));let o=new Yn({fog:!1,toneMapped:!1});this.lightPlane=new Ci(i,o),this.add(this.lightPlane),i=new Dt,i.setAttribute("position",new At([0,0,0,0,0,1],3)),this.targetLine=new Ci(i,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Id.setFromMatrixPosition(this.light.matrixWorld),Au.setFromMatrixPosition(this.light.target.matrixWorld),nm.subVectors(Au,Id),this.lightPlane.lookAt(Au),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Au),this.targetLine.scale.z=nm.length()}},S.DiscreteInterpolant=ud,S.DodecahedronBufferGeometry=Sa,S.DodecahedronGeometry=Sa,S.DoubleSide=2,S.DstAlphaFactor=206,S.DstColorFactor=208,S.DynamicBufferAttribute=function(c,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Jt(c,e).setUsage(35048)},S.DynamicCopyUsage=35050,S.DynamicDrawUsage=35048,S.DynamicReadUsage=35049,S.EdgesGeometry=Ra,S.EdgesHelper=function(c,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new hr(new Ra(c.geometry),new Yn({color:e!==void 0?e:16777215}))},S.EllipseCurve=Pl,S.EqualDepth=4,S.EqualStencilFunc=514,S.EquirectangularReflectionMapping=303,S.EquirectangularRefractionMapping=304,S.Euler=Ti,S.EventDispatcher=Qr,S.ExtrudeBufferGeometry=Gi,S.ExtrudeGeometry=Gi,S.FaceColors=1,S.FileLoader=Bi,S.FlatShading=1,S.Float16BufferAttribute=wc,S.Float32Attribute=function(c,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new At(c,e)},S.Float32BufferAttribute=At,S.Float64Attribute=function(c,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Cf(c,e)},S.Float64BufferAttribute=Cf,S.FloatType=1015,S.Fog=ha,S.FogExp2=ua,S.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},S.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},S.FrontSide=0,S.Frustum=yl,S.GLBufferAttribute=Ls,S.GLSL1="100",S.GLSL3=zr,S.GammaEncoding=3007,S.GreaterDepth=6,S.GreaterEqualDepth=5,S.GreaterEqualStencilFunc=518,S.GreaterStencilFunc=516,S.GridHelper=tm,S.Group=as,S.HalfFloatType=1016,S.HemisphereLight=gd,S.HemisphereLightHelper=class extends Xt{constructor(c,e,n){super(),this.light=c,this.light.updateMatrixWorld(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;let i=new Go(e);i.rotateY(.5*Math.PI),this.material=new Zi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);let o=i.getAttribute("position"),l=new Float32Array(3*o.count);i.setAttribute("color",new Jt(l,3)),this.add(new Tn(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let c=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{let e=c.geometry.getAttribute("color");Kp.copy(this.light.color),em.copy(this.light.groundColor);for(let n=0,i=e.count;n<i;n++){let o=n<i/2?Kp:em;e.setXYZ(n,o.r,o.g,o.b)}e.needsUpdate=!0}c.lookAt(Tu.setFromMatrixPosition(this.light.matrixWorld).negate())}},S.HemisphereLightProbe=Sd,S.IcosahedronBufferGeometry=_s,S.IcosahedronGeometry=_s,S.ImageBitmapLoader=wd,S.ImageLoader=za,S.ImageUtils=Jo,S.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},S.IncrementStencilOp=7682,S.IncrementWrapStencilOp=34055,S.InstancedBufferAttribute=hs,S.InstancedBufferGeometry=Yl,S.InstancedInterleavedBuffer=Rs,S.InstancedMesh=Rl,S.Int16Attribute=function(c,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Lf(c,e)},S.Int16BufferAttribute=Lf,S.Int32Attribute=function(c,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Pf(c,e)},S.Int32BufferAttribute=Pf,S.Int8Attribute=function(c,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new bc(c,e)},S.Int8BufferAttribute=bc,S.IntType=1013,S.InterleavedBuffer=eo,S.InterleavedBufferAttribute=Rr,S.Interpolant=ao,S.InterpolateDiscrete=2300,S.InterpolateLinear=2301,S.InterpolateSmooth=2302,S.InvertStencilOp=5386,S.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},S.KeepStencilOp=7680,S.KeyframeTrack=hi,S.LOD=Fh,S.LatheBufferGeometry=Ia,S.LatheGeometry=Ia,S.Layers=Hr,S.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},S.LessDepth=2,S.LessEqualDepth=3,S.LessEqualStencilFunc=515,S.LessStencilFunc=513,S.Light=di,S.LightProbe=Va,S.Line=Ci,S.Line3=ql,S.LineBasicMaterial=Yn,S.LineCurve=Gl,S.LineCurve3=Bl,S.LineDashedMaterial=ld,S.LineLoop=iu,S.LinePieces=1,S.LineSegments=hr,S.LineStrip=0,S.LinearEncoding=3e3,S.LinearFilter=1006,S.LinearInterpolant=cd,S.LinearMipMapLinearFilter=1008,S.LinearMipMapNearestFilter=1007,S.LinearMipmapLinearFilter=1008,S.LinearMipmapNearestFilter=1007,S.LinearToneMapping=1,S.Loader=dr,S.LoaderUtils=Wa,S.LoadingManager=dd,S.LogLuvEncoding=3003,S.LoopOnce=2200,S.LoopPingPong=2202,S.LoopRepeat=2201,S.LuminanceAlphaFormat=1025,S.LuminanceFormat=1024,S.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},S.Material=Gn,S.MaterialLoader=jl,S.Math=Mf,S.MathUtils=Mf,S.Matrix3=In,S.Matrix4=Mt,S.MaxEquation=104,S.Mesh=Tn,S.MeshBasicMaterial=Zi,S.MeshDepthMaterial=Tl,S.MeshDistanceMaterial=Xc,S.MeshFaceMaterial=function(c){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),c},S.MeshLambertMaterial=sd,S.MeshMatcapMaterial=ad,S.MeshNormalMaterial=od,S.MeshPhongMaterial=rd,S.MeshPhysicalMaterial=nd,S.MeshStandardMaterial=Hl,S.MeshToonMaterial=id,S.MinEquation=103,S.MirroredRepeatWrapping=1002,S.MixOperation=1,S.MultiMaterial=function(c=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),c.isMultiMaterial=!0,c.materials=c,c.clone=function(){return c.slice()},c},S.MultiplyBlending=4,S.MultiplyOperation=0,S.NearestFilter=1003,S.NearestMipMapLinearFilter=1005,S.NearestMipMapNearestFilter=1004,S.NearestMipmapLinearFilter=1005,S.NearestMipmapNearestFilter=1004,S.NeverDepth=0,S.NeverStencilFunc=512,S.NoBlending=0,S.NoColors=0,S.NoToneMapping=0,S.NormalAnimationBlendMode=2500,S.NormalBlending=1,S.NotEqualDepth=7,S.NotEqualStencilFunc=517,S.NumberKeyframeTrack=ka,S.Object3D=Xt,S.ObjectLoader=class extends dr{constructor(c){super(c)}load(c,e,n,i){let o=this,l=this.path===""?Wa.extractUrlBase(c):this.path;this.resourcePath=this.resourcePath||l;let h=new Bi(this.manager);h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(c,function(f){let p=null;try{p=JSON.parse(f)}catch(x){return i!==void 0&&i(x),void console.error("THREE:ObjectLoader: Can't parse "+c+".",x.message)}let g=p.metadata;g!==void 0&&g.type!==void 0&&g.type.toLowerCase()!=="geometry"?o.parse(p,e):console.error("THREE.ObjectLoader: Can't load "+c)},n,i)}async loadAsync(c,e){let n=this.path===""?Wa.extractUrlBase(c):this.path;this.resourcePath=this.resourcePath||n;let i=new Bi(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);let o=await i.loadAsync(c,e),l=JSON.parse(o),h=l.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+c);return await this.parseAsync(l)}parse(c,e){let n=this.parseAnimations(c.animations),i=this.parseShapes(c.shapes),o=this.parseGeometries(c.geometries,i),l=this.parseImages(c.images,function(){e!==void 0&&e(p)}),h=this.parseTextures(c.textures,l),f=this.parseMaterials(c.materials,h),p=this.parseObject(c.object,o,f,h,n),g=this.parseSkeletons(c.skeletons,p);if(this.bindSkeletons(p,g),e!==void 0){let x=!1;for(let _ in l)if(l[_]instanceof HTMLImageElement){x=!0;break}x===!1&&e(p)}return p}async parseAsync(c){let e=this.parseAnimations(c.animations),n=this.parseShapes(c.shapes),i=this.parseGeometries(c.geometries,n),o=await this.parseImagesAsync(c.images),l=this.parseTextures(c.textures,o),h=this.parseMaterials(c.materials,l),f=this.parseObject(c.object,i,h,l,e),p=this.parseSkeletons(c.skeletons,f);return this.bindSkeletons(f,p),f}parseShapes(c){let e={};if(c!==void 0)for(let n=0,i=c.length;n<i;n++){let o=new Di().fromJSON(c[n]);e[o.uuid]=o}return e}parseSkeletons(c,e){let n={},i={};if(e.traverse(function(o){o.isBone&&(i[o.uuid]=o)}),c!==void 0)for(let o=0,l=c.length;o<l;o++){let h=new eu().fromJSON(c[o],i);n[h.uuid]=h}return n}parseGeometries(c,e){let n={};if(c!==void 0){let i=new vu;for(let o=0,l=c.length;o<l;o++){let h,f=c[o];switch(f.type){case"BufferGeometry":case"InstancedBufferGeometry":h=i.parse(f);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:f.type in Lp?h=Lp[f.type].fromJSON(f,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${f.type}"`)}h.uuid=f.uuid,f.name!==void 0&&(h.name=f.name),h.isBufferGeometry===!0&&f.userData!==void 0&&(h.userData=f.userData),n[f.uuid]=h}}return n}parseMaterials(c,e){let n={},i={};if(c!==void 0){let o=new jl;o.setTextures(e);for(let l=0,h=c.length;l<h;l++){let f=c[l];if(f.type==="MultiMaterial"){let p=[];for(let g=0;g<f.materials.length;g++){let x=f.materials[g];n[x.uuid]===void 0&&(n[x.uuid]=o.parse(x)),p.push(n[x.uuid])}i[f.uuid]=p}else n[f.uuid]===void 0&&(n[f.uuid]=o.parse(f)),i[f.uuid]=n[f.uuid]}}return i}parseAnimations(c){let e={};if(c!==void 0)for(let n=0;n<c.length;n++){let i=c[n],o=Wl.parse(i);e[o.uuid]=o}return e}parseImages(c,e){let n=this,i={},o;function l(h){if(typeof h=="string"){let f=h;return function(p){return n.manager.itemStart(p),o.load(p,function(){n.manager.itemEnd(p)},void 0,function(){n.manager.itemError(p),n.manager.itemEnd(p)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:n.resourcePath+f)}return h.data?{data:Vs(h.type,h.data),width:h.width,height:h.height}:null}if(c!==void 0&&c.length>0){let h=new dd(e);o=new za(h),o.setCrossOrigin(this.crossOrigin);for(let f=0,p=c.length;f<p;f++){let g=c[f],x=g.url;if(Array.isArray(x)){i[g.uuid]=[];for(let _=0,M=x.length;_<M;_++){let T=l(x[_]);T!==null&&(T instanceof HTMLImageElement?i[g.uuid].push(T):i[g.uuid].push(new to(T.data,T.width,T.height)))}}else{let _=l(g.url);_!==null&&(i[g.uuid]=_)}}}return i}async parseImagesAsync(c){let e=this,n={},i;async function o(l){if(typeof l=="string"){let h=l,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:e.resourcePath+h;return await i.loadAsync(f)}return l.data?{data:Vs(l.type,l.data),width:l.width,height:l.height}:null}if(c!==void 0&&c.length>0){i=new za(this.manager),i.setCrossOrigin(this.crossOrigin);for(let l=0,h=c.length;l<h;l++){let f=c[l],p=f.url;if(Array.isArray(p)){n[f.uuid]=[];for(let g=0,x=p.length;g<x;g++){let _=p[g],M=await o(_);M!==null&&(M instanceof HTMLImageElement?n[f.uuid].push(M):n[f.uuid].push(new to(M.data,M.width,M.height)))}}else{let g=await o(f.url);g!==null&&(n[f.uuid]=g)}}}return n}parseTextures(c,e){function n(o,l){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),l[o])}let i={};if(c!==void 0)for(let o=0,l=c.length;o<l;o++){let h=c[o],f;h.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',h.uuid),e[h.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",h.image);let p=e[h.image];Array.isArray(p)?(f=new Ao(p),p.length===6&&(f.needsUpdate=!0)):(f=p&&p.data?new to(p.data,p.width,p.height):new Dn(p),p&&(f.needsUpdate=!0)),f.uuid=h.uuid,h.name!==void 0&&(f.name=h.name),h.mapping!==void 0&&(f.mapping=n(h.mapping,Bp)),h.offset!==void 0&&f.offset.fromArray(h.offset),h.repeat!==void 0&&f.repeat.fromArray(h.repeat),h.center!==void 0&&f.center.fromArray(h.center),h.rotation!==void 0&&(f.rotation=h.rotation),h.wrap!==void 0&&(f.wrapS=n(h.wrap[0],Up),f.wrapT=n(h.wrap[1],Up)),h.format!==void 0&&(f.format=h.format),h.type!==void 0&&(f.type=h.type),h.encoding!==void 0&&(f.encoding=h.encoding),h.minFilter!==void 0&&(f.minFilter=n(h.minFilter,kp)),h.magFilter!==void 0&&(f.magFilter=n(h.magFilter,kp)),h.anisotropy!==void 0&&(f.anisotropy=h.anisotropy),h.flipY!==void 0&&(f.flipY=h.flipY),h.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=h.premultiplyAlpha),h.unpackAlignment!==void 0&&(f.unpackAlignment=h.unpackAlignment),h.userData!==void 0&&(f.userData=h.userData),i[h.uuid]=f}return i}parseObject(c,e,n,i,o){let l,h,f;function p(_){return e[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",_),e[_]}function g(_){if(_!==void 0){if(Array.isArray(_)){let M=[];for(let T=0,N=_.length;T<N;T++){let I=_[T];n[I]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",I),M.push(n[I])}return M}return n[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",_),n[_]}}function x(_){return i[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",_),i[_]}switch(c.type){case"Scene":l=new Po,c.background!==void 0&&(Number.isInteger(c.background)?l.background=new yt(c.background):l.background=x(c.background)),c.environment!==void 0&&(l.environment=x(c.environment)),c.fog!==void 0&&(c.fog.type==="Fog"?l.fog=new ha(c.fog.color,c.fog.near,c.fog.far):c.fog.type==="FogExp2"&&(l.fog=new ua(c.fog.color,c.fog.density)));break;case"PerspectiveCamera":l=new An(c.fov,c.aspect,c.near,c.far),c.focus!==void 0&&(l.focus=c.focus),c.zoom!==void 0&&(l.zoom=c.zoom),c.filmGauge!==void 0&&(l.filmGauge=c.filmGauge),c.filmOffset!==void 0&&(l.filmOffset=c.filmOffset),c.view!==void 0&&(l.view=Object.assign({},c.view));break;case"OrthographicCamera":l=new Yr(c.left,c.right,c.top,c.bottom,c.near,c.far),c.zoom!==void 0&&(l.zoom=c.zoom),c.view!==void 0&&(l.view=Object.assign({},c.view));break;case"AmbientLight":l=new bd(c.color,c.intensity);break;case"DirectionalLight":l=new _d(c.color,c.intensity);break;case"PointLight":l=new xd(c.color,c.intensity,c.distance,c.decay);break;case"RectAreaLight":l=new Md(c.color,c.intensity,c.width,c.height);break;case"SpotLight":l=new Ft(c.color,c.intensity,c.distance,c.angle,c.penumbra,c.decay);break;case"HemisphereLight":l=new gd(c.color,c.groundColor,c.intensity);break;case"LightProbe":l=new Va().fromJSON(c);break;case"SkinnedMesh":h=p(c.geometry),f=g(c.material),l=new us(h,f),c.bindMode!==void 0&&(l.bindMode=c.bindMode),c.bindMatrix!==void 0&&l.bindMatrix.fromArray(c.bindMatrix),c.skeleton!==void 0&&(l.skeleton=c.skeleton);break;case"Mesh":h=p(c.geometry),f=g(c.material),l=new Tn(h,f);break;case"InstancedMesh":h=p(c.geometry),f=g(c.material);let _=c.count,M=c.instanceMatrix,T=c.instanceColor;l=new Rl(h,f,_),l.instanceMatrix=new hs(new Float32Array(M.array),16),T!==void 0&&(l.instanceColor=new hs(new Float32Array(T.array),T.itemSize));break;case"LOD":l=new Fh;break;case"Line":l=new Ci(p(c.geometry),g(c.material));break;case"LineLoop":l=new iu(p(c.geometry),g(c.material));break;case"LineSegments":l=new hr(p(c.geometry),g(c.material));break;case"PointCloud":case"Points":l=new ui(p(c.geometry),g(c.material));break;case"Sprite":l=new $c(g(c.material));break;case"Group":l=new as;break;case"Bone":l=new ba;break;default:l=new Xt}if(l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),c.matrix!==void 0?(l.matrix.fromArray(c.matrix),c.matrixAutoUpdate!==void 0&&(l.matrixAutoUpdate=c.matrixAutoUpdate),l.matrixAutoUpdate&&l.matrix.decompose(l.position,l.quaternion,l.scale)):(c.position!==void 0&&l.position.fromArray(c.position),c.rotation!==void 0&&l.rotation.fromArray(c.rotation),c.quaternion!==void 0&&l.quaternion.fromArray(c.quaternion),c.scale!==void 0&&l.scale.fromArray(c.scale)),c.castShadow!==void 0&&(l.castShadow=c.castShadow),c.receiveShadow!==void 0&&(l.receiveShadow=c.receiveShadow),c.shadow&&(c.shadow.bias!==void 0&&(l.shadow.bias=c.shadow.bias),c.shadow.normalBias!==void 0&&(l.shadow.normalBias=c.shadow.normalBias),c.shadow.radius!==void 0&&(l.shadow.radius=c.shadow.radius),c.shadow.mapSize!==void 0&&l.shadow.mapSize.fromArray(c.shadow.mapSize),c.shadow.camera!==void 0&&(l.shadow.camera=this.parseObject(c.shadow.camera))),c.visible!==void 0&&(l.visible=c.visible),c.frustumCulled!==void 0&&(l.frustumCulled=c.frustumCulled),c.renderOrder!==void 0&&(l.renderOrder=c.renderOrder),c.userData!==void 0&&(l.userData=c.userData),c.layers!==void 0&&(l.layers.mask=c.layers),c.children!==void 0){let _=c.children;for(let M=0;M<_.length;M++)l.add(this.parseObject(_[M],e,n,i,o))}if(c.animations!==void 0){let _=c.animations;for(let M=0;M<_.length;M++){let T=_[M];l.animations.push(o[T])}}if(c.type==="LOD"){c.autoUpdate!==void 0&&(l.autoUpdate=c.autoUpdate);let _=c.levels;for(let M=0;M<_.length;M++){let T=_[M],N=l.getObjectByProperty("uuid",T.object);N!==void 0&&l.addLevel(N,T.distance)}}return l}bindSkeletons(c,e){Object.keys(e).length!==0&&c.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){let i=e[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}setTexturePath(c){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(c)}},S.ObjectSpaceNormalMap=1,S.OctahedronBufferGeometry=Go,S.OctahedronGeometry=Go,S.OneFactor=201,S.OneMinusDstAlphaFactor=207,S.OneMinusDstColorFactor=209,S.OneMinusSrcAlphaFactor=205,S.OneMinusSrcColorFactor=203,S.OrthographicCamera=Yr,S.PCFShadowMap=1,S.PCFSoftShadowMap=2,S.PMREMGenerator=ph,S.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Dt},S.Particle=function(c){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new $c(c)},S.ParticleBasicMaterial=function(c){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Do(c)},S.ParticleSystem=function(c,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ui(c,e)},S.ParticleSystemMaterial=function(c){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Do(c)},S.Path=kl,S.PerspectiveCamera=An,S.Plane=jr,S.PlaneBufferGeometry=ns,S.PlaneGeometry=ns,S.PlaneHelper=class extends Ci{constructor(c,e=1,n=16776960){let i=n,o=new Dt;o.setAttribute("position",new At([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),super(o,new Yn({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=c,this.size=e;let l=new Dt;l.setAttribute("position",new At([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),l.computeBoundingSphere(),this.add(new Tn(l,new Zi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(c){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(c)}},S.PointCloud=function(c,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ui(c,e)},S.PointCloudMaterial=function(c){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Do(c)},S.PointLight=xd,S.PointLightHelper=class extends Tn{constructor(c,e,n){super(new Ms(e,4,2),new Zi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=c,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},S.Points=ui,S.PointsMaterial=Do,S.PolarGridHelper=class extends hr{constructor(c=10,e=16,n=8,i=64,o=4473924,l=8947848){o=new yt(o),l=new yt(l);let h=[],f=[];for(let g=0;g<=e;g++){let x=g/e*(2*Math.PI),_=Math.sin(x)*c,M=Math.cos(x)*c;h.push(0,0,0),h.push(_,0,M);let T=1&g?o:l;f.push(T.r,T.g,T.b),f.push(T.r,T.g,T.b)}for(let g=0;g<=n;g++){let x=1&g?o:l,_=c-c/n*g;for(let M=0;M<i;M++){let T=M/i*(2*Math.PI),N=Math.sin(T)*_,I=Math.cos(T)*_;h.push(N,0,I),f.push(x.r,x.g,x.b),T=(M+1)/i*(2*Math.PI),N=Math.sin(T)*_,I=Math.cos(T)*_,h.push(N,0,I),f.push(x.r,x.g,x.b)}}let p=new Dt;p.setAttribute("position",new At(h,3)),p.setAttribute("color",new At(f,3)),super(p,new Yn({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},S.PolyhedronBufferGeometry=Ii,S.PolyhedronGeometry=Ii,S.PositionalAudio=class extends qa{constructor(c){super(c),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(c){return this.panner.refDistance=c,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(c){return this.panner.rolloffFactor=c,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(c){return this.panner.distanceModel=c,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(c){return this.panner.maxDistance=c,this}setDirectionalCone(c,e,n){return this.panner.coneInnerAngle=c,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(c){if(super.updateMatrixWorld(c),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ko,Td,Wp),ki.set(0,0,1).applyQuaternion(Td);let e=this.panner;if(e.positionX){let n=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ko.x,n),e.positionY.linearRampToValueAtTime(ko.y,n),e.positionZ.linearRampToValueAtTime(ko.z,n),e.orientationX.linearRampToValueAtTime(ki.x,n),e.orientationY.linearRampToValueAtTime(ki.y,n),e.orientationZ.linearRampToValueAtTime(ki.z,n)}else e.setPosition(ko.x,ko.y,ko.z),e.setOrientation(ki.x,ki.y,ki.z)}},S.PropertyBinding=Kt,S.PropertyMixer=_u,S.QuadraticBezierCurve=ys,S.QuadraticBezierCurve3=ro,S.Quaternion=Kn,S.QuaternionKeyframeTrack=Fa,S.QuaternionLinearInterpolant=Cp,S.REVISION=G,S.RGBADepthPacking=3201,S.RGBAFormat=1023,S.RGBAIntegerFormat=1033,S.RGBA_ASTC_10x10_Format=37819,S.RGBA_ASTC_10x5_Format=37816,S.RGBA_ASTC_10x6_Format=37817,S.RGBA_ASTC_10x8_Format=37818,S.RGBA_ASTC_12x10_Format=37820,S.RGBA_ASTC_12x12_Format=37821,S.RGBA_ASTC_4x4_Format=37808,S.RGBA_ASTC_5x4_Format=37809,S.RGBA_ASTC_5x5_Format=37810,S.RGBA_ASTC_6x5_Format=37811,S.RGBA_ASTC_6x6_Format=37812,S.RGBA_ASTC_8x5_Format=37813,S.RGBA_ASTC_8x6_Format=37814,S.RGBA_ASTC_8x8_Format=37815,S.RGBA_BPTC_Format=36492,S.RGBA_ETC2_EAC_Format=37496,S.RGBA_PVRTC_2BPPV1_Format=35843,S.RGBA_PVRTC_4BPPV1_Format=35842,S.RGBA_S3TC_DXT1_Format=33777,S.RGBA_S3TC_DXT3_Format=33778,S.RGBA_S3TC_DXT5_Format=33779,S.RGBDEncoding=3006,S.RGBEEncoding=3002,S.RGBEFormat=1023,S.RGBFormat=1022,S.RGBIntegerFormat=1032,S.RGBM16Encoding=3005,S.RGBM7Encoding=3004,S.RGB_ETC1_Format=36196,S.RGB_ETC2_Format=37492,S.RGB_PVRTC_2BPPV1_Format=35841,S.RGB_PVRTC_4BPPV1_Format=35840,S.RGB_S3TC_DXT1_Format=33776,S.RGFormat=1030,S.RGIntegerFormat=1031,S.RawShaderMaterial=ta,S.Ray=ri,S.Raycaster=class{constructor(c,e,n=0,i=1/0){this.ray=new ri(c,e),this.near=n,this.far=i,this.camera=null,this.layers=new Hr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(c,e){this.ray.set(c,e)}setFromCamera(c,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(c.x,c.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(c.x,c.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(c,e=!0,n=[]){return wu(c,this,n,e),n.sort($p),n}intersectObjects(c,e=!0,n=[]){for(let i=0,o=c.length;i<o;i++)wu(c[i],this,n,e);return n.sort($p),n}},S.RectAreaLight=Md,S.RedFormat=1028,S.RedIntegerFormat=1029,S.ReinhardToneMapping=2,S.RepeatWrapping=1e3,S.ReplaceStencilOp=7681,S.ReverseSubtractEquation=102,S.RingBufferGeometry=Da,S.RingGeometry=Da,S.SRGB8_ALPHA8_ASTC_10x10_Format=37851,S.SRGB8_ALPHA8_ASTC_10x5_Format=37848,S.SRGB8_ALPHA8_ASTC_10x6_Format=37849,S.SRGB8_ALPHA8_ASTC_10x8_Format=37850,S.SRGB8_ALPHA8_ASTC_12x10_Format=37852,S.SRGB8_ALPHA8_ASTC_12x12_Format=37853,S.SRGB8_ALPHA8_ASTC_4x4_Format=37840,S.SRGB8_ALPHA8_ASTC_5x4_Format=37841,S.SRGB8_ALPHA8_ASTC_5x5_Format=37842,S.SRGB8_ALPHA8_ASTC_6x5_Format=37843,S.SRGB8_ALPHA8_ASTC_6x6_Format=37844,S.SRGB8_ALPHA8_ASTC_8x5_Format=37845,S.SRGB8_ALPHA8_ASTC_8x6_Format=37846,S.SRGB8_ALPHA8_ASTC_8x8_Format=37847,S.Scene=Po,S.SceneUtils=im,S.ShaderChunk=Wt,S.ShaderLib=si,S.ShaderMaterial=$i,S.ShadowMaterial=td,S.Shape=Di,S.ShapeBufferGeometry=bs,S.ShapeGeometry=bs,S.ShapePath=class{constructor(){this.type="ShapePath",this.color=new yt,this.subPaths=[],this.currentPath=null}moveTo(c,e){return this.currentPath=new kl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(c,e),this}lineTo(c,e){return this.currentPath.lineTo(c,e),this}quadraticCurveTo(c,e,n,i){return this.currentPath.quadraticCurveTo(c,e,n,i),this}bezierCurveTo(c,e,n,i,o,l){return this.currentPath.bezierCurveTo(c,e,n,i,o,l),this}splineThru(c){return this.currentPath.splineThru(c),this}toShapes(c,e){function n(L){let F=[];for(let U=0,V=L.length;U<V;U++){let K=L[U],re=new Di;re.curves=K.curves,F.push(re)}return F}function i(L,F){let U=F.length,V=!1;for(let K=U-1,re=0;re<U;K=re++){let ve=F[K],_e=F[re],Te=_e.x-ve.x,Ee=_e.y-ve.y;if(Math.abs(Ee)>Number.EPSILON){if(Ee<0&&(ve=F[re],Te=-Te,_e=F[K],Ee=-Ee),L.y<ve.y||L.y>_e.y)continue;if(L.y===ve.y){if(L.x===ve.x)return!0}else{let Ne=Ee*(L.x-ve.x)-Te*(L.y-ve.y);if(Ne===0)return!0;if(Ne<0)continue;V=!V}}else{if(L.y!==ve.y)continue;if(_e.x<=L.x&&L.x<=ve.x||ve.x<=L.x&&L.x<=_e.x)return!0}}return V}let o=Oi.isClockWise,l=this.subPaths;if(l.length===0)return[];if(e===!0)return n(l);let h,f,p,g=[];if(l.length===1)return f=l[0],p=new Di,p.curves=f.curves,g.push(p),g;let x=!o(l[0].getPoints());x=c?!x:x;let _=[],M=[],T,N,I=[],D=0;M[D]=void 0,I[D]=[];for(let L=0,F=l.length;L<F;L++)f=l[L],T=f.getPoints(),h=o(T),h=c?!h:h,h?(!x&&M[D]&&D++,M[D]={s:new Di,p:T},M[D].s.curves=f.curves,x&&D++,I[D]=[]):I[D].push({h:f,p:T[0]});if(!M[0])return n(l);if(M.length>1){let L=!1,F=[];for(let U=0,V=M.length;U<V;U++)_[U]=[];for(let U=0,V=M.length;U<V;U++){let K=I[U];for(let re=0;re<K.length;re++){let ve=K[re],_e=!0;for(let Te=0;Te<M.length;Te++)i(ve.p,M[Te].p)&&(U!==Te&&F.push({froms:U,tos:Te,hole:re}),_e?(_e=!1,_[Te].push(ve)):L=!0);_e&&_[U].push(ve)}}F.length>0&&(L||(I=_))}for(let L=0,F=M.length;L<F;L++){p=M[L].s,g.push(p),N=I[L];for(let U=0,V=N.length;U<V;U++)p.holes.push(N[U].h)}return g}},S.ShapeUtils=Oi,S.ShortType=1011,S.Skeleton=eu,S.SkeletonHelper=Xa,S.SkinnedMesh=us,S.SmoothShading=2,S.Sphere=qi,S.SphereBufferGeometry=Ms,S.SphereGeometry=Ms,S.Spherical=class{constructor(c=1,e=0,n=0){return this.radius=c,this.phi=e,this.theta=n,this}set(c,e,n){return this.radius=c,this.phi=e,this.theta=n,this}copy(c){return this.radius=c.radius,this.phi=c.phi,this.theta=c.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(c){return this.setFromCartesianCoords(c.x,c.y,c.z)}setFromCartesianCoords(c,e,n){return this.radius=Math.sqrt(c*c+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(c,n),this.phi=Math.acos(Qn(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},S.SphericalHarmonics3=Ha,S.SplineCurve=Ul,S.SpotLight=Ft,S.SpotLightHelper=class extends Xt{constructor(c,e){super(),this.light=c,this.light.updateMatrixWorld(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;let n=new Dt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let l=0,h=1,f=32;l<f;l++,h++){let p=l/f*Math.PI*2,g=h/f*Math.PI*2;i.push(Math.cos(p),Math.sin(p),1,Math.cos(g),Math.sin(g),1)}n.setAttribute("position",new At(i,3));let o=new Yn({fog:!1,toneMapped:!1});this.cone=new hr(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();let c=this.light.distance?this.light.distance:1e3,e=c*Math.tan(this.light.angle);this.cone.scale.set(e,e,c),Xl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Xl),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},S.Sprite=$c,S.SpriteMaterial=da,S.SrcAlphaFactor=204,S.SrcAlphaSaturateFactor=210,S.SrcColorFactor=202,S.StaticCopyUsage=35046,S.StaticDrawUsage=35044,S.StaticReadUsage=35045,S.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new An,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new An,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(c){let e=this._cache;if(e.focus!==c.focus||e.fov!==c.fov||e.aspect!==c.aspect*this.aspect||e.near!==c.near||e.far!==c.far||e.zoom!==c.zoom||e.eyeSep!==this.eyeSep){e.focus=c.focus,e.fov=c.fov,e.aspect=c.aspect*this.aspect,e.near=c.near,e.far=c.far,e.zoom=c.zoom,e.eyeSep=this.eyeSep;let n=c.projectionMatrix.clone(),i=e.eyeSep/2,o=i*e.near/e.focus,l=e.near*Math.tan(qo*e.fov*.5)/e.zoom,h,f;zp.elements[12]=-i,Fp.elements[12]=i,h=-l*e.aspect+o,f=l*e.aspect+o,n.elements[0]=2*e.near/(f-h),n.elements[8]=(f+h)/(f-h),this.cameraL.projectionMatrix.copy(n),h=-l*e.aspect-o,f=l*e.aspect-o,n.elements[0]=2*e.near/(f-h),n.elements[8]=(f+h)/(f-h),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(zp),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(Fp)}},S.StreamCopyUsage=35042,S.StreamDrawUsage=35040,S.StreamReadUsage=35041,S.StringKeyframeTrack=Es,S.SubtractEquation=101,S.SubtractiveBlending=3,S.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},S.TangentSpaceNormalMap=0,S.TetrahedronBufferGeometry=Oa,S.TetrahedronGeometry=Oa,S.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Dt},S.Texture=Dn,S.TextureLoader=md,S.TorusBufferGeometry=Ga,S.TorusGeometry=Ga,S.TorusKnotBufferGeometry=Ba,S.TorusKnotGeometry=Ba,S.Triangle=Sn,S.TriangleFanDrawMode=2,S.TriangleStripDrawMode=1,S.TrianglesDrawMode=0,S.TubeBufferGeometry=Ua,S.TubeGeometry=Ua,S.UVMapping=300,S.Uint16Attribute=function(c,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Li(c,e)},S.Uint16BufferAttribute=Li,S.Uint32Attribute=function(c,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Mc(c,e)},S.Uint32BufferAttribute=Mc,S.Uint8Attribute=function(c,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Mo(c,e)},S.Uint8BufferAttribute=Mo,S.Uint8ClampedAttribute=function(c,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Vr(c,e)},S.Uint8ClampedBufferAttribute=Vr,S.Uniform=Ns,S.UniformsLib=dt,S.UniformsUtils=uh,S.UnsignedByteType=1009,S.UnsignedInt248Type=1020,S.UnsignedIntType=1014,S.UnsignedShort4444Type=1017,S.UnsignedShort5551Type=1018,S.UnsignedShort565Type=1019,S.UnsignedShortType=1012,S.VSMShadowMap=3,S.Vector2=Ke,S.Vector3=J,S.Vector4=on,S.VectorKeyframeTrack=Vl,S.Vertex=function(c,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new J(c,e,n)},S.VertexColors=2,S.VideoTexture=_p,S.WebGL1Renderer=Bh,S.WebGLCubeRenderTarget=ea,S.WebGLMultipleRenderTargets=Zu,S.WebGLMultisampleRenderTarget=$u,S.WebGLRenderTarget=lr,S.WebGLRenderTargetCube=function(c,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new ea(c,n)},S.WebGLRenderer=sn,S.WebGLUtils=pp,S.WireframeGeometry=pu,S.WireframeHelper=function(c,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new hr(new pu(c.geometry),new Yn({color:e!==void 0?e:16777215}))},S.WrapAroundEnding=2402,S.XHRLoader=function(c){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Bi(c)},S.ZeroCurvatureEnding=2400,S.ZeroFactor=200,S.ZeroSlopeEnding=2401,S.ZeroStencilOp=0,S.sRGBEncoding=3001,Object.defineProperty(S,"__esModule",{value:!0}),globalThis.THREE=S});var R=R||{};(function(){function S(t){return function(){return this.matches(t)}}function G(t,r){return t<r?-1:t>r?1:t>=r?0:NaN}function ae(t){return t.length===1&&(t=O(t)),{left:function(r,s,a,u){for(a==null&&(a=0),u==null&&(u=r.length);a<u;){var d=a+u>>>1;0>t(r[d],s)?a=d+1:u=d}return a},right:function(r,s,a,u){for(a==null&&(a=0),u==null&&(u=r.length);a<u;){var d=a+u>>>1;0<t(r[d],s)?u=d:a=d+1}return a}}}function O(t){return function(r,s){return G(t(r),s)}}function q(t,r){return[t,r]}function ge(t){return t===null?NaN:+t}function oe(t,r){var s=t.length,a=0,u=-1,d=0,m,v=0;if(r==null){for(;++u<s;)if(!isNaN(m=ge(t[u]))){var y=m-d;d+=y/++a,v+=y*(m-d)}}else for(;++u<s;)isNaN(m=ge(r(t[u],u,t)))||(y=m-d,d+=y/++a,v+=y*(m-d));if(1<a)return v/(a-1)}function se(t,r){return(t=oe(t,r))?Math.sqrt(t):t}function le(t,r){var s=t.length,a=-1,u,d,m;if(r==null){for(;++a<s;)if((u=t[a])!=null&&u>=u)for(d=m=u;++a<s;)(u=t[a])!=null&&(d>u&&(d=u),m<u&&(m=u))}else for(;++a<s;)if((u=r(t[a],a,t))!=null&&u>=u)for(d=m=u;++a<s;)(u=r(t[a],a,t))!=null&&(d>u&&(d=u),m<u&&(m=u));return[d,m]}function Q(t){return function(){return t}}function W(t){return t}function H(t,r,s){t=+t,r=+r,s=2>(u=arguments.length)?(r=t,t=0,1):3>u?1:+s;for(var a=-1,u=Math.max(0,Math.ceil((r-t)/s))|0,d=Array(u);++a<u;)d[a]=t+a*s;return d}function k(t,r,s){var a,u=-1,d;if(r=+r,t=+t,s=+s,t===r&&0<s)return[t];if(a=r<t){var m=t;t=r,r=m}if((d=$(t,r,s))===0||!isFinite(d))return[];if(0<d)for(t=Math.ceil(t/d),r=Math.floor(r/d),r=Array(m=Math.ceil(r-t+1));++u<m;)r[u]=(t+u)*d;else for(t=Math.floor(t*d),r=Math.ceil(r*d),r=Array(m=Math.ceil(t-r+1));++u<m;)r[u]=(t-u)/d;return a&&r.reverse(),r}function $(t,r,s){return r=(r-t)/Math.max(0,s),t=Math.floor(Math.log(r)/Math.LN10),r/=Math.pow(10,t),0<=t?(r>=T?10:r>=N?5:r>=I?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(r>=T?10:r>=N?5:r>=I?2:1)}function X(t,r,s){var a=Math.abs(r-t)/Math.max(0,s);return s=Math.pow(10,Math.floor(Math.log(a)/Math.LN10)),a/=s,a>=T?s*=10:a>=N?s*=5:a>=I&&(s*=2),r<t?-s:s}function ne(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1}function j(t,r,s){if(s==null&&(s=ge),a=t.length){if(0>=(r=+r)||2>a)return+s(t[0],0,t);if(1<=r)return+s(t[a-1],a-1,t);var a;r*=a-1,a=Math.floor(r);var u=+s(t[a],a,t);return t=+s(t[a+1],a+1,t),u+(t-u)*(r-a)}}function z(t,r){var s=t.length,a=-1,u,d;if(r==null){for(;++a<s;)if((u=t[a])!=null&&u>=u)for(d=u;++a<s;)(u=t[a])!=null&&u>d&&(d=u)}else for(;++a<s;)if((u=r(t[a],a,t))!=null&&u>=u)for(d=u;++a<s;)(u=r(t[a],a,t))!=null&&u>d&&(d=u);return d}function me(t){for(var r=t.length,s=-1,a=0,u,d;++s<r;)a+=t[s].length;for(u=Array(a);0<=--r;)for(d=t[r],s=d.length;0<=--s;)u[--a]=d[s];return u}function Re(t,r){var s=t.length,a=-1,u,d;if(r==null){for(;++a<s;)if((u=t[a])!=null&&u>=u)for(d=u;++a<s;)(u=t[a])!=null&&d>u&&(d=u)}else for(;++a<s;)if((u=r(t[a],a,t))!=null&&u>=u)for(d=u;++a<s;)(u=r(t[a],a,t))!=null&&d>u&&(d=u);return d}function Xe(t){if(!(d=t.length))return[];for(var r=-1,s=Re(t,ze),a=Array(s);++r<s;)for(var u=-1,d,m=a[r]=Array(d);++u<d;)m[u]=t[u][r];return a}function ze(t){return t.length}function Ge(t){return t}function tt(t){return"translate("+(t+.5)+",0)"}function ft(t){return"translate(0,"+(t+.5)+")"}function je(t){return function(r){return+t(r)}}function rt(t){var r=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(r=Math.round(r)),function(s){return+t(s)+r}}function Me(){return!this.__axis}function Ie(t,r){function s(E){var P=u??(r.ticks?r.ticks.apply(r,a):r.domain()),C=d??(r.tickFormat?r.tickFormat.apply(r,a):Ge),B=Math.max(m,0)+y,ee=r.range(),Y=+ee[0]+.5;ee=+ee[ee.length-1]+.5;var ce=(r.bandwidth?rt:je)(r.copy()),ue=E.selection?E.selection():E,pe=ue.selectAll(".domain").data([null]);P=ue.selectAll(".tick").data(P,r).order();var Pe=P.exit(),Oe=P.enter().append("g").attr("class","tick"),xe=P.select("line"),Ce=P.select("text");pe=pe.merge(pe.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),P=P.merge(Oe),xe=xe.merge(Oe.append("line").attr("stroke","currentColor").attr(w+"2",b*m)),Ce=Ce.merge(Oe.append("text").attr("fill","currentColor").attr(w,b*B).attr("dy",t===1?"0em":t===3?"0.71em":"0.32em")),E!==ue&&(pe=pe.transition(E),P=P.transition(E),xe=xe.transition(E),Ce=Ce.transition(E),Pe=Pe.transition(E).attr("opacity",1e-6).attr("transform",function(ye){return isFinite(ye=ce(ye))?A(ye):this.getAttribute("transform")}),Oe.attr("opacity",1e-6).attr("transform",function(ye){var be=this.parentNode.__axis;return A(be&&isFinite(be=be(ye))?be:ce(ye))})),Pe.remove(),pe.attr("d",t===4||t==2?v?"M"+b*v+","+Y+"H0.5V"+ee+"H"+b*v:"M0.5,"+Y+"V"+ee:v?"M"+Y+","+b*v+"V0.5H"+ee+"V"+b*v:"M"+Y+",0.5H"+ee),P.attr("opacity",1).attr("transform",function(ye){return A(ce(ye))}),xe.attr(w+"2",b*m),Ce.attr(w,b*B).text(C),ue.filter(Me).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===2?"start":t===4?"end":"middle"),ue.each(function(){this.__axis=ce})}var a=[],u=null,d=null,m=6,v=6,y=3,b=t===1||t===4?-1:1,w=t===4||t===2?"x":"y",A=t===1||t===3?tt:ft;return s.scale=function(E){return arguments.length?(r=E,s):r},s.ticks=function(){return a=D.call(arguments),s},s.tickArguments=function(E){return arguments.length?(a=E==null?[]:D.call(E),s):a.slice()},s.tickValues=function(E){return arguments.length?(u=E==null?null:D.call(E),s):u&&u.slice()},s.tickFormat=function(E){return arguments.length?(d=E,s):d},s.tickSize=function(E){return arguments.length?(m=v=+E,s):m},s.tickSizeInner=function(E){return arguments.length?(m=+E,s):m},s.tickSizeOuter=function(E){return arguments.length?(v=+E,s):v},s.tickPadding=function(E){return arguments.length?(y=+E,s):y},s}function ke(){for(var t=0,r=arguments.length,s={},a;t<r;++t){if(!(a=arguments[t]+"")||a in s)throw Error("illegal type: "+a);s[a]=[]}return new He(s)}function He(t){this._=t}function Qe(t,r){return t.trim().split(/^|\s+/).map(function(s){var a="",u=s.indexOf(".");if(0<=u&&(a=s.slice(u+1),s=s.slice(0,u)),s&&!r.hasOwnProperty(s))throw Error("unknown type: "+s);return{type:s,name:a}})}function gt(t,r,s){for(var a=0,u=t.length;a<u;++a)if(t[a].name===r){t[a]=L,t=t.slice(0,a).concat(t.slice(a+1));break}return s!=null&&t.push({name:r,value:s}),t}function bt(t){var r=t+="",s=r.indexOf(":");return 0<=s&&(r=t.slice(0,s))!=="xmlns"&&(t=t.slice(s+1)),F.hasOwnProperty(r)?{space:F[r],local:t}:t}function Bt(t){return function(){var r=this.ownerDocument,s=this.namespaceURI;return s==="http://www.w3.org/1999/xhtml"&&r.documentElement.namespaceURI==="http://www.w3.org/1999/xhtml"?r.createElement(t):r.createElementNS(s,t)}}function Ut(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Vt(t){return t=bt(t),(t.local?Ut:Bt)(t)}function Cn(){}function $n(t){return t==null?Cn:function(){return this.querySelector(t)}}function vo(){return[]}function ac(t){return t==null?vo:function(){return this.querySelectorAll(t)}}function Yu(t){return Array(t.length)}function sl(t,r){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=r}function lc(t){return function(){return t}}function cc(t,r,s,a,u,d){for(var m=0,v,y=r.length,b=d.length;m<b;++m)(v=r[m])?(v.__data__=d[m],a[m]=v):s[m]=new sl(t,d[m]);for(;m<y;++m)(v=r[m])&&(u[m]=v)}function Ye(t,r,s,a,u,d,m){var v,y,b={},w=r.length,A=d.length,E=Array(w),P;for(v=0;v<w;++v)(y=r[v])&&(E[v]=P="$"+m.call(y,y.__data__,v,r),P in b?u[v]=y:b[P]=y);for(v=0;v<A;++v)P="$"+m.call(t,d[v],v,d),(y=b[P])?(a[v]=y,y.__data__=d[v],b[P]=null):s[v]=new sl(t,d[v]);for(v=0;v<w;++v)(y=r[v])&&b[E[v]]===y&&(u[v]=y)}function it(t,r){return t<r?-1:t>r?1:t>=r?0:NaN}function st(t){return function(){this.removeAttribute(t)}}function St(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Qt(t,r){return function(){this.setAttribute(t,r)}}function dn(t,r){return function(){this.setAttributeNS(t.space,t.local,r)}}function yn(t,r){return function(){var s=r.apply(this,arguments);s==null?this.removeAttribute(t):this.setAttribute(t,s)}}function br(t,r){return function(){var s=r.apply(this,arguments);s==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,s)}}function al(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Mr(t){return function(){this.style.removeProperty(t)}}function ar(t,r,s){return function(){this.style.setProperty(t,r,s)}}function Hs(t,r,s){return function(){var a=r.apply(this,arguments);a==null?this.style.removeProperty(t):this.style.setProperty(t,a,s)}}function zr(t,r){return t.style.getPropertyValue(r)||al(t).getComputedStyle(t,null).getPropertyValue(r)}function Qr(t){return function(){delete this[t]}}function uc(t,r){return function(){this[t]=r}}function qo(t,r){return function(){var s=r.apply(this,arguments);s==null?delete this[t]:this[t]=s}}function Xo(t){return t.classList||new Wn(t)}function Wn(t){this._node=t,this._names=(t.getAttribute("class")||"").trim().split(/^|\s+/)}function xf(t,r){t=Xo(t);for(var s=-1,a=r.length;++s<a;)t.add(r[s])}function mr(t,r){t=Xo(t);for(var s=-1,a=r.length;++s<a;)t.remove(r[s])}function Qn(t){return function(){xf(this,t)}}function qu(t){return function(){mr(this,t)}}function ll(t,r){return function(){(r.apply(this,arguments)?xf:mr)(this,t)}}function Xu(){this.textContent=""}function _f(t){return function(){this.textContent=t}}function bf(t){return function(){var r=t.apply(this,arguments);this.textContent=r??""}}function Mf(){this.innerHTML=""}function Ke(t){return function(){this.innerHTML=t}}function In(t){return function(){var r=t.apply(this,arguments);this.innerHTML=r??""}}function wf(){this.nextSibling&&this.parentNode.appendChild(this)}function Zm(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Vs(){return null}function hc(){var t=this.parentNode;t&&t.removeChild(this)}function Ef(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Ws(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function Jo(t,r,s){return t=Sf(t,r,s),function(a){var u=a.relatedTarget;u&&(u===this||u.compareDocumentPosition(this)&8)||t.call(this,a)}}function Sf(t,r,s){return function(a){var u=R.event;R.event=a;try{t.call(this,this.__data__,r,s)}finally{R.event=u}}}function Dn(t){return t.trim().split(/^|\s+/).map(function(r){var s="",a=r.indexOf(".");return 0<=a&&(s=r.slice(a+1),r=r.slice(0,a)),{type:r,name:s}})}function Ju(t){return function(){var r=this.__on;if(r){for(var s=0,a=-1,u=r.length,d;s<u;++s)d=r[s],t.type&&d.type!==t.type||d.name!==t.name?r[++a]=d:this.removeEventListener(d.type,d.listener,d.capture);++a?r.length=a:delete this.__on}}}function on(t,r,s){var a=re.hasOwnProperty(t.type)?Jo:Sf;return function(u,d,m){u=this.__on;var v;if(d=a(r,d,m),u){m=0;for(var y=u.length;m<y;++m)if((v=u[m]).type===t.type&&v.name===t.name){this.removeEventListener(v.type,v.listener,v.capture),this.addEventListener(v.type,v.listener=d,v.capture=s),v.value=r;return}}this.addEventListener(t.type,d,s),v={type:t.type,name:t.name,value:r,listener:d,capture:s},u?u.push(v):this.__on=[v]}}function lr(t,r,s,a){var u=R.event;t.sourceEvent=R.event,R.event=t;try{return r.apply(s,a)}finally{R.event=u}}function Zu(t,r,s){var a=al(t),u=a.CustomEvent;typeof u=="function"?u=new u(r,s):(u=a.document.createEvent("Event"),s?(u.initEvent(r,s.bubbles,s.cancelable),u.detail=s.detail):u.initEvent(r,!1,!1)),t.dispatchEvent(u)}function $u(t,r){return function(){return Zu(this,t,r)}}function Kn(t,r){return function(){return Zu(this,t,r.apply(this,arguments))}}function J(t,r){this._groups=t,this._parents=r}function ji(){return new J([[document.documentElement]],ve)}function cr(t){return typeof t=="string"?new J([[document.querySelector(t)]],[document.documentElement]):new J([[t]],ve)}function gr(){return new Kr}function Kr(){this._="@"+(++_e).toString(36)}function Zo(){for(var t=R.event,r;r=t.sourceEvent;)t=r;return t}function js(t,r){var s=t.ownerSVGElement||t;return s.createSVGPoint?(s=s.createSVGPoint(),s.x=r.clientX,s.y=r.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]):(s=t.getBoundingClientRect(),[r.clientX-s.left-t.clientLeft,r.clientY-s.top-t.clientTop])}function wr(t){var r=Zo();return r.changedTouches&&(r=r.changedTouches[0]),js(t,r)}function Yi(t,r,s){3>arguments.length&&(s=r,r=Zo().changedTouches);for(var a=0,u=r?r.length:0,d;a<u;++a)if((d=r[a]).identifier===s)return js(t,d);return null}function ei(){R.event.preventDefault(),R.event.stopImmediatePropagation()}function ti(t){var r=t.document.documentElement;t=cr(t).on("dragstart.drag",ei,!0),"onselectstart"in r?t.on("selectstart.drag",ei,!0):(r.__noselect=r.style.MozUserSelect,r.style.MozUserSelect="none")}function ni(t,r){var s=t.document.documentElement,a=cr(t).on("dragstart.drag",null);r&&(a.on("click.drag",ei,!0),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in s?a.on("selectstart.drag",null):(s.style.MozUserSelect=s.__noselect,delete s.__noselect)}function bi(t){return function(){return t}}function $o(t,r,s,a,u,d,m,v,y,b){this.target=t,this.type=r,this.subject=s,this.identifier=a,this.active=u,this.x=d,this.y=m,this.dx=v,this.dy=y,this._=b}function dc(){return!R.event.button}function fc(){return this.parentNode}function Qo(t){return t??{x:R.event.x,y:R.event.y}}function Qu(){return"ontouchstart"in this}function Ys(t,r,s){t.prototype=r.prototype=s,s.constructor=t}function qs(t,r){t=Object.create(t.prototype);for(var s in r)t[s]=r[s];return t}function Mi(){}function wi(t){var r;return t=(t+"").trim().toLowerCase(),(r=Ee.exec(t))?(r=parseInt(r[1],16),new xn(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1)):(r=Ne.exec(t))?qi(parseInt(r[1],16)):(r=ct.exec(t))?new xn(r[1],r[2],r[3],1):(r=Je.exec(t))?new xn(255*r[1]/100,255*r[2]/100,255*r[3]/100,1):(r=De.exec(t))?Ei(r[1],r[2],r[3],r[4]):(r=Ze.exec(t))?Ei(255*r[1]/100,255*r[2]/100,255*r[3]/100,r[4]):(r=vt.exec(t))?hl(r[1],r[2]/100,r[3]/100,1):(r=xt.exec(t))?hl(r[1],r[2]/100,r[3]/100,r[4]):Tt.hasOwnProperty(t)?qi(Tt[t]):t==="transparent"?new xn(NaN,NaN,NaN,0):null}function qi(t){return new xn(t>>16&255,t>>8&255,t&255,1)}function Ei(t,r,s,a){return 0>=a&&(t=r=s=NaN),new xn(t,r,s,a)}function cl(t){return t instanceof Mi||(t=wi(t)),t?(t=t.rgb(),new xn(t.r,t.g,t.b,t.opacity)):new xn}function Xi(t,r,s,a){return arguments.length===1?cl(t):new xn(t,r,s,a??1)}function xn(t,r,s,a){this.r=+t,this.g=+r,this.b=+s,this.opacity=+a}function ul(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(16>t?"0":"")+t.toString(16)}function hl(t,r,s,a){return 0>=a?t=r=s=NaN:0>=s||1<=s?t=r=NaN:0>=r&&(t=NaN),new Mt(t,r,s,a)}function Ku(t){if(t instanceof Mt)return new Mt(t.h,t.s,t.l,t.opacity);if(t instanceof Mi||(t=wi(t)),!t)return new Mt;if(t instanceof Mt)return t;t=t.rgb();var r=t.r/255,s=t.g/255,a=t.b/255,u=Math.min(r,s,a),d=Math.max(r,s,a),m=NaN,v=d-u,y=(d+u)/2;return v?(m=r===d?(s-a)/v+6*(s<a):s===d?(a-r)/v+2:(r-s)/v+4,v/=.5>y?d+u:2-d-u,m*=60):v=0<y&&1>y?0:m,new Mt(m,v,y,t.opacity)}function ri(t,r,s,a){return arguments.length===1?Ku(t):new Mt(t,r,s,a??1)}function Mt(t,r,s,a){this.h=+t,this.s=+r,this.l=+s,this.opacity=+a}function yo(t,r,s){return 255*(60>t?r+(s-r)*t/60:180>t?s:240>t?r+(s-r)*(240-t)/60:r)}function Er(t){if(t instanceof ii)return new ii(t.l,t.a,t.b,t.opacity);if(t instanceof Hr){if(isNaN(t.h))return new ii(t.l,0,0,t.opacity);var r=t.h*Pt;return new ii(t.l,Math.cos(r)*t.c,Math.sin(r)*t.c,t.opacity)}t instanceof xn||(t=cl(t));var s=mc(t.r),a=mc(t.g),u=mc(t.b);if(r=Si(.2225045*s+.7168786*a+.0606169*u),s===a&&a===u)var d=s=r;else d=Si((.4360747*s+.3850649*a+.1430804*u)/.96422),s=Si((.0139322*s+.0971045*a+.7141733*u)/.82521);return new ii(116*r-16,500*(d-r),200*(r-s),t.opacity)}function pc(t,r,s,a){return arguments.length===1?Er(t):new ii(t,r,s,a??1)}function ii(t,r,s,a){this.l=+t,this.a=+r,this.b=+s,this.opacity=+a}function Si(t){return t>Ue?Math.pow(t,1/3):t/he+nt}function Xs(t){return t>ie?t*t*t:he*(t-nt)}function ur(t){return 255*(.0031308>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function mc(t){return .04045>=(t/=255)?t/12.92:Math.pow((t+.055)/1.055,2.4)}function eh(t){if(t instanceof Hr)return new Hr(t.h,t.c,t.l,t.opacity);if(t instanceof ii||(t=Er(t)),t.a===0&&t.b===0)return new Hr(NaN,0,t.l,t.opacity);var r=Math.atan2(t.b,t.a)*Ct;return new Hr(0>r?r+360:r,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Ti(t,r,s,a){return arguments.length===1?eh(t):new Hr(t,r,s,a??1)}function Hr(t,r,s,a){this.h=+t,this.c=+r,this.l=+s,this.opacity=+a}function oi(t,r,s,a){if(arguments.length===1){var u=t;if(u instanceof xo)u=new xo(u.h,u.s,u.l,u.opacity);else{u instanceof xn||(u=cl(u));var d=u.g/255,m=u.b/255,v=(Be*m+u.r/255*-1.7884503806-3.5172982438*d)/(Be+-1.7884503806-3.5172982438);m-=v;var y=(1.97294*(d-v)- -.29227*m)/-.90649;m=(d=Math.sqrt(y*y+m*m)/(1.97294*v*(1-v)))?Math.atan2(y,m)*Ct-120:NaN,u=new xo(0>m?m+360:m,d,v,u.opacity)}}else u=new xo(t,r,s,a??1);return u}function xo(t,r,s,a){this.h=+t,this.s=+r,this.l=+s,this.opacity=+a}function Ko(t,r,s,a,u){var d=t*t,m=d*t;return((1-3*t+3*d-m)*r+(4-6*d+3*m)*s+(1+3*t+3*d-3*m)*a+m*u)/6}function Ai(t){var r=t.length-1;return function(s){var a=0>=s?s=0:1<=s?(s=1,r-1):Math.floor(s*r),u=t[a],d=t[a+1];return Ko((s-a/r)*r,0<a?t[a-1]:2*u-d,u,d,a<r-1?t[a+2]:2*d-u)}}function dl(t){var r=t.length;return function(s){var a=Math.floor((0>(s%=1)?++s:s)*r);return Ko((s-a/r)*r,t[(a+r-1)%r],t[a%r],t[(a+1)%r],t[(a+2)%r])}}function _o(t){return function(){return t}}function Tf(t,r){return function(s){return t+s*r}}function $m(t,r,s){return t=Math.pow(t,s),r=Math.pow(r,s)-t,s=1/s,function(a){return Math.pow(t+a*r,s)}}function fl(t,r){var s=r-t;return s?Tf(t,180<s||-180>s?s-360*Math.round(s/360):s):_o(isNaN(t)?r:t)}function Af(t){return(t=+t)==1?On:function(r,s){return s-r?$m(r,s,t):_o(isNaN(r)?s:r)}}function On(t,r){var s=r-t;return s?Tf(t,s):_o(isNaN(t)?r:t)}function Nf(t){return function(r){var s=r.length,a=Array(s),u=Array(s),d=Array(s),m;for(m=0;m<s;++m){var v=Xi(r[m]);a[m]=v.r||0,u[m]=v.g||0,d[m]=v.b||0}return a=t(a),u=t(u),d=t(d),v.opacity=1,function(y){return v.r=a(y),v.g=u(y),v.b=d(y),v+""}}}function th(t,r){var s=r?r.length:0,a=t?Math.min(s,t.length):0,u=Array(a),d=Array(s),m;for(m=0;m<a;++m)u[m]=Ri(t[m],r[m]);for(;m<s;++m)d[m]=r[m];return function(v){for(m=0;m<a;++m)d[m]=u[m](v);return d}}function Xt(t,r){var s=new Date;return t=+t,r-=t,function(a){return s.setTime(t+r*a),s}}function bn(t,r){return t=+t,r-=t,function(s){return t+r*s}}function Ni(t,r){var s={},a={},u;(t===null||typeof t!="object")&&(t={}),(r===null||typeof r!="object")&&(r={});for(u in r)u in t?s[u]=Ri(t[u],r[u]):a[u]=r[u];return function(d){for(u in s)a[u]=s[u](d);return a}}function nh(t){return function(){return t}}function Ji(t){return function(r){return t(r)+""}}function bo(t,r){var s=Le.lastIndex=te.lastIndex=0,a,u,d,m=-1,v=[],y=[];for(t+="",r+="";(a=Le.exec(t))&&(u=te.exec(r));)(d=u.index)>s&&(d=r.slice(s,d),v[m]?v[m]+=d:v[++m]=d),(a=a[0])===(u=u[0])?v[m]?v[m]+=u:v[++m]=u:(v[++m]=null,y.push({i:m,x:bn(a,u)})),s=te.lastIndex;return s<r.length&&(d=r.slice(s),v[m]?v[m]+=d:v[++m]=d),2>v.length?y[0]?Ji(y[0].x):nh(r):(r=y.length,function(b){for(var w=0,A;w<r;++w)v[(A=y[w]).i]=A.x(b);return v.join("")})}function Ri(t,r){var s=typeof r,a;return r==null||s==="boolean"?_o(r):(s==="number"?bn:s==="string"?(a=wi(r))?(r=a,we):bo:r instanceof wi?we:r instanceof Date?Xt:Array.isArray(r)?th:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?Ni:bn)(t,r)}function rh(t,r){return t=+t,r-=t,function(s){return Math.round(t+r*s)}}function gc(t,r,s,a,u,d){var m,v,y;return(m=Math.sqrt(t*t+r*r))&&(t/=m,r/=m),(y=t*s+r*a)&&(s-=t*y,a-=r*y),(v=Math.sqrt(s*s+a*a))&&(s/=v,a/=v,y/=v),t*a<r*s&&(t=-t,r=-r,y=-y,m=-m),{translateX:u,translateY:d,rotate:Math.atan2(r,t)*Se,skewX:Math.atan(y)*Se,scaleX:m,scaleY:v}}function vc(t,r,s,a){function u(b){return b.length?b.pop()+" ":""}function d(b,w,A,E,P,C){b!==A||w!==E?(P=P.push("translate(",null,r,null,s),C.push({i:P-4,x:bn(b,A)},{i:P-2,x:bn(w,E)})):(A||E)&&P.push("translate("+A+r+E+s)}function m(b,w,A,E){b!==w?(180<b-w?w+=360:180<w-b&&(b+=360),E.push({i:A.push(u(A)+"rotate(",null,a)-2,x:bn(b,w)})):w&&A.push(u(A)+"rotate("+w+a)}function v(b,w,A,E){b!==w?E.push({i:A.push(u(A)+"skewX(",null,a)-2,x:bn(b,w)}):w&&A.push(u(A)+"skewX("+w+a)}function y(b,w,A,E,P,C){b!==A||w!==E?(P=P.push(u(P)+"scale(",null,",",null,")"),C.push({i:P-4,x:bn(b,A)},{i:P-2,x:bn(w,E)})):A===1&&E===1||P.push(u(P)+"scale("+A+","+E+")")}return function(b,w){var A=[],E=[];return b=t(b),w=t(w),d(b.translateX,b.translateY,w.translateX,w.translateY,A,E),m(b.rotate,w.rotate,A,E),v(b.skewX,w.skewX,A,E),y(b.scaleX,b.scaleY,w.scaleX,w.scaleY,A,E),b=w=null,function(P){for(var C=-1,B=E.length,ee;++C<B;)A[(ee=E[C]).i]=ee.x(P);return A.join("")}}}function yc(t){return((t=Math.exp(t))+1/t)/2}function Sn(t,r){var s=t[0],a=t[1],u=t[2];t=r[2];var d=r[0]-s,m=r[1]-a,v=d*d+m*m;if(1e-12>v){var y=Math.log(t/u)/Ot;t=function(A){return[s+A*d,a+A*m,u*Math.exp(Ot*A*y)]}}else{var b=Math.sqrt(v);r=(t*t-u*u+4*v)/(4*u*b),t=(t*t-u*u-4*v)/(4*t*b);var w=Math.log(Math.sqrt(r*r+1)-r);y=(Math.log(Math.sqrt(t*t+1)-t)-w)/Ot,t=function(A){A*=y;var E=yc(w),P=Ot*A+w,C=((P=Math.exp(2*P))-1)/(P+1),B=w;return P=((B=Math.exp(B))-1/B)/2,C=u/(2*b)*(E*C-P),[s+C*d,a+C*m,u*E/yc(Ot*A+w)]}}return t.duration=1e3*y,t}function Rf(t){return function(r,s){var a=t((r=ri(r)).h,(s=ri(s)).h),u=On(r.s,s.s),d=On(r.l,s.l),m=On(r.opacity,s.opacity);return function(v){return r.h=a(v),r.s=u(v),r.l=d(v),r.opacity=m(v),r+""}}}function Gn(t){return function(r,s){var a=t((r=Ti(r)).h,(s=Ti(s)).h),u=On(r.c,s.c),d=On(r.l,s.l),m=On(r.opacity,s.opacity);return function(v){return r.h=a(v),r.c=u(v),r.l=d(v),r.opacity=m(v),r+""}}}function ih(t){return function r(s){function a(u,d){var m=t((u=oi(u)).h,(d=oi(d)).h),v=On(u.s,d.s),y=On(u.l,d.l),b=On(u.opacity,d.opacity);return function(w){return u.h=m(w),u.s=v(w),u.l=y(Math.pow(w,s)),u.opacity=b(w),u+""}}return s=+s,a.gamma=r,a}(1)}function tr(){return kn||(Od(xc),kn=$a.now()+Kl)}function xc(){kn=0}function es(){this._call=this._time=this._next=null}function Js(t,r,s){var a=new es;return a.restart(t,r,s),a}function _c(){tr(),++Jr;for(var t=pt,r;t;)0<=(r=kn-t._time)&&t._call.call(null,r),t=t._next;--Jr}function yt(){kn=(Ql=$a.now())+Kl,Jr=sr=0;try{_c()}finally{Jr=0;for(var t,r=pt,s,a=1/0;r;)r._call?(a>r._time&&(a=r._time),t=r,r=r._next):(s=r._next,r._next=null,r=t?t._next=s:pt=s);Za=t,cn(a),kn=0}}function Zi(){var t=$a.now(),r=t-Ql;1e3<r&&(Kl-=r,Ql=t)}function cn(t){Jr||(sr&&(sr=clearTimeout(sr)),24<t-kn?(1/0>t&&(sr=setTimeout(yt,t-$a.now()-Kl)),fi&&(fi=clearInterval(fi))):(fi||(Ql=$a.now(),fi=setInterval(Zi,1e3)),Jr=1,Od(yt)))}function Zs(t,r,s){var a=new es;return r=r==null?0:+r,a.restart(function(u){a.stop(),t(u+r)},r,s),a}function Jt(t,r,s,a,u,d){var m=t.__transition;if(!m)t.__transition={};else if(s in m)return;Lf(t,s,{name:r,index:a,group:u,on:Gd,tween:om,time:d.time,delay:d.delay,duration:d.duration,ease:d.ease,timer:null,state:0})}function bc(t,r){if(t=Vr(t,r),0<t.state)throw Error("too late; already scheduled");return t}function Mo(t,r){if(t=Vr(t,r),2<t.state)throw Error("too late; already started");return t}function Vr(t,r){if(t=t.__transition,!t||!(t=t[r]))throw Error("transition not found");return t}function Lf(t,r,s){function a(y){var b,w;if(s.state!==1)return d();for(E in m){var A=m[E];if(A.name===s.name){if(A.state===3)return Zs(a);A.state===4?(A.state=6,A.timer.stop(),A.on.call("interrupt",t,t.__data__,A.index,A.group),delete m[E]):+E<r&&(A.state=6,A.timer.stop(),delete m[E])}}if(Zs(function(){s.state===3&&(s.state=4,s.timer.restart(u,s.delay,s.time),u(y))}),s.state=2,s.on.call("start",t,t.__data__,s.index,s.group),s.state===2){s.state=3,v=Array(w=s.tween.length);var E=0;for(b=-1;E<w;++E)(A=s.tween[E].value.call(t,t.__data__,s.index,s.group))&&(v[++b]=A);v.length=b+1}}function u(y){y=y<s.duration?s.ease.call(null,y/s.duration):(s.timer.restart(d),s.state=5,1);for(var b=-1,w=v.length;++b<w;)v[b].call(null,y);s.state===5&&(s.on.call("end",t,t.__data__,s.index,s.group),d())}function d(){s.state=6,s.timer.stop(),delete m[r];for(var y in m)return;delete t.__transition}var m=t.__transition,v;m[r]=s,s.timer=Js(function(y){s.state=1,s.timer.restart(a,s.delay,s.time),s.delay<=y&&a(y-s.delay)},0,s.time)}function Li(t,r){var s=t.__transition,a,u=!0,d;if(s){r=r==null?null:r+"";for(d in s)if((a=s[d]).name!==r)u=!1;else{var m=2<a.state&&5>a.state;a.state=6,a.timer.stop(),m&&a.on.call("interrupt",t,t.__data__,a.index,a.group),delete s[d]}u&&delete t.__transition}}function Pf(t,r){var s,a;return function(){var u=Mo(this,t),d=u.tween;if(d!==s){a=s=d,d=0;for(var m=a.length;d<m;++d)if(a[d].name===r){a=a.slice(),a.splice(d,1);break}}u.tween=a}}function Mc(t,r,s){var a,u;if(typeof s!="function")throw Error();return function(){var d=Mo(this,t),m=d.tween;if(m!==a){u=(a=m).slice(),m={name:r,value:s};for(var v=0,y=u.length;v<y;++v)if(u[v].name===r){u[v]=m;break}v===y&&u.push(m)}d.tween=u}}function wc(t,r,s){var a=t._id;return t.each(function(){var u=Mo(this,a);(u.value||(u.value={}))[r]=s.apply(this,arguments)}),function(u){return Vr(u,a).value[r]}}function At(t,r){var s;return(typeof r=="number"?bn:r instanceof wi?we:(s=wi(r))?(r=s,we):bo)(t,r)}function Cf(t){return function(){this.removeAttribute(t)}}function Qm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Wr(t,r,s){var a,u;return function(){var d=this.getAttribute(t);return d===s?null:d===a?u:u=r(a=d,s)}}function oh(t,r,s){var a,u;return function(){var d=this.getAttributeNS(t.space,t.local);return d===s?null:d===a?u:u=r(a=d,s)}}function $s(t,r,s){var a,u,d;return function(){var m=s(this);if(m==null)return void this.removeAttribute(t);var v=this.getAttribute(t);return v===m?null:v===a&&m===u?d:d=r(a=v,u=m)}}function Sr(t,r,s){var a,u,d;return function(){var m=s(this);if(m==null)return void this.removeAttributeNS(t.space,t.local);var v=this.getAttributeNS(t.space,t.local);return v===m?null:v===a&&m===u?d:d=r(a=v,u=m)}}function pl(t,r){function s(){var a=this,u=r.apply(a,arguments);return u&&function(d){a.setAttributeNS(t.space,t.local,u(d))}}return s._value=r,s}function jn(t,r){function s(){var a=this,u=r.apply(a,arguments);return u&&function(d){a.setAttribute(t,u(d))}}return s._value=r,s}function Dt(t,r){return function(){bc(this,t).delay=+r.apply(this,arguments)}}function If(t,r){return r=+r,function(){bc(this,t).delay=r}}function Qs(t,r){return function(){Mo(this,t).duration=+r.apply(this,arguments)}}function sh(t,r){return r=+r,function(){Mo(this,t).duration=r}}function wo(t,r){if(typeof r!="function")throw Error();return function(){Mo(this,t).ease=r}}function Eo(t){return(t+"").trim().split(/^|\s+/).every(function(r){var s=r.indexOf(".");return 0<=s&&(r=r.slice(0,s)),!r||r==="start"})}function So(t,r,s){var a,u,d=Eo(r)?bc:Mo;return function(){var m=d(this,t),v=m.on;v!==a&&(u=(a=v).copy()).on(r,s),m.on=u}}function ah(t){return function(){var r=this.parentNode,s;for(s in this.__transition)if(+s!==t)return;r&&r.removeChild(this)}}function lh(t,r){var s,a,u;return function(){var d=zr(this,t),m=(this.style.removeProperty(t),zr(this,t));return d===m?null:d===s&&m===a?u:u=r(s=d,a=m)}}function ch(t){return function(){this.style.removeProperty(t)}}function Ec(t,r,s){var a,u;return function(){var d=zr(this,t);return d===s?null:d===a?u:u=r(a=d,s)}}function Sc(t,r,s){var a,u,d;return function(){var m=zr(this,t),v=s(this);return v==null&&(v=(this.style.removeProperty(t),zr(this,t))),m===v?null:m===a&&v===u?d:d=r(a=m,u=v)}}function Tc(t,r,s){function a(){var u=this,d=r.apply(u,arguments);return d&&function(m){u.style.setProperty(t,d(m),s)}}return a._value=r,a}function Ac(t){return function(){this.textContent=t}}function Nc(t){return function(){var r=t(this);this.textContent=r??""}}function Tr(t,r,s,a){this._groups=t,this._parents=r,this._name=s,this._id=a}function Rc(t){return ji().transition(t)}function ml(t){return(1>=(t*=2)?t*t:--t*(2-t)+1)/2}function Tn(t){return(1>=(t*=2)?t*t*t:(t-=2)*t*t+2)/2}function gl(t){return(1-Math.cos(Pu*t))/2}function Pi(t){return(1>=(t*=2)?Math.pow(2,10*t-10):2-Math.pow(2,10-10*t))/2}function ts(t){return(1>=(t*=2)?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}function Rn(t){return(t=+t)<de?Rt*t*t:t<$e?Rt*(t-=We)*t+.75:t<lt?Rt*(t-=at)*t+.9375:Rt*(t-=kt)*t+.984375}function uh(t){return function(){return t}}function $i(t,r,s){this.target=t,this.type=r,this.selection=s}function To(){R.event.preventDefault(),R.event.stopImmediatePropagation()}function An(t){return{type:t}}function Ks(){return!R.event.button}function Lc(){var t=this.ownerSVGElement||this;return[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Ao(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function ea(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function vl(t){function r(E){var P=E.property("__brush",m).selectAll(".overlay").data([An("overlay")]);P.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",zn.overlay).merge(P).each(function(){var C=Ao(this).extent;cr(this).attr("x",C[0][0]).attr("y",C[0][1]).attr("width",C[1][0]-C[0][0]).attr("height",C[1][1]-C[0][1])}),E.selectAll(".selection").data([An("selection")]).enter().append("rect").attr("class","selection").attr("cursor",zn.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges"),P=E.selectAll(".handle").data(t.handles,function(C){return C.type}),P.exit().remove(),P.enter().append("rect").attr("class",function(C){return"handle handle--"+C.type}).attr("cursor",function(C){return zn[C.type]}),E.each(s).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",d)}function s(){var E=cr(this),P=Ao(this).selection;P?(E.selectAll(".selection").style("display",null).attr("x",P[0][0]).attr("y",P[0][1]).attr("width",P[1][0]-P[0][0]).attr("height",P[1][1]-P[0][1]),E.selectAll(".handle").style("display",null).attr("x",function(C){return C.type[C.type.length-1]==="e"?P[1][0]-w/2:P[0][0]-w/2}).attr("y",function(C){return C.type[0]==="s"?P[1][1]-w/2:P[0][1]-w/2}).attr("width",function(C){return C.type==="n"||C.type==="s"?P[1][0]-P[0][0]+w:w}).attr("height",function(C){return C.type==="e"||C.type==="w"?P[1][1]-P[0][1]+w:w})):E.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function a(E,P){return E.__brush.emitter||new u(E,P)}function u(E,P){this.that=E,this.args=P,this.state=E.__brush,this.active=0}function d(){function E(){var go=wr(Y);!Wu||$r||rl||(Math.abs(go[0]-uf[0])>Math.abs(go[1]-uf[1])?rl=!0:$r=!0),uf=go,Vu=!0,To(),P()}function P(){switch(It=uf[0]-cf[0],Ht=uf[1]-cf[1],ue){case kd:case ho:pe&&(It=Math.max(ye-be,Math.min(Ae-et,It)),Br=be+It,kr=et+It),Pe&&(Ht=Math.max(Z-fe,Math.min(mt-ht,Ht)),Ur=fe+Ht,Fr=ht+Ht);break;case fo:0>pe?(It=Math.max(ye-be,Math.min(Ae-be,It)),Br=be+It,kr=et):0<pe&&(It=Math.max(ye-et,Math.min(Ae-et,It)),Br=be,kr=et+It),0>Pe?(Ht=Math.max(Z-fe,Math.min(mt-fe,Ht)),Ur=fe+Ht,Fr=ht):0<Pe&&(Ht=Math.max(Z-ht,Math.min(mt-ht,Ht)),Ur=fe,Fr=ht+Ht);break;case Qa:pe&&(Br=Math.max(ye,Math.min(Ae,be-It*pe)),kr=Math.max(ye,Math.min(Ae,et+It*pe))),Pe&&(Ur=Math.max(Z,Math.min(mt,fe-Ht*Pe)),Fr=Math.max(Z,Math.min(mt,ht+Ht*Pe)))}if(kr<Br){pe*=-1;var go=be;be=et,et=go,go=Br,Br=kr,kr=go,ce in Yt&&hf.attr("cursor",zn[ce=Yt[ce]])}Fr<Ur&&(Pe*=-1,go=fe,fe=ht,ht=go,go=Ur,Ur=Fr,Fr=go,ce in Hn&&hf.attr("cursor",zn[ce=Hn[ce]])),Oe.selection&&(Ce=Oe.selection),$r&&(Br=Ce[0][0],kr=Ce[1][0]),rl&&(Ur=Ce[0][1],Fr=Ce[1][1]),(Ce[0][0]!==Br||Ce[0][1]!==Ur||Ce[1][0]!==kr||Ce[1][1]!==Fr)&&(Oe.selection=[[Br,Ur],[kr,Fr]],s.call(Y),x0.brush())}function C(){if(R.event.stopImmediatePropagation(),R.event.touches){if(R.event.touches.length)return;A&&clearTimeout(A),A=setTimeout(function(){A=null},500),zm.on("touchmove.brush touchend.brush touchcancel.brush",null)}else ni(R.event.view,Vu),Lx.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);zm.attr("pointer-events","all"),hf.attr("cursor",zn.overlay),Oe.selection&&(Ce=Oe.selection),ea(Ce)&&(Oe.selection=null,s.call(Y)),x0.end()}function B(){switch(R.event.keyCode){case 16:Wu=pe&&Pe;break;case 18:ue===fo&&(pe&&(et=kr-It*pe,be=Br+It*pe),Pe&&(ht=Fr-Ht*Pe,fe=Ur+Ht*Pe),ue=Qa,P());break;case 32:(ue===fo||ue===Qa)&&(0>pe?et=kr-It:0<pe&&(be=Br-It),0>Pe?ht=Fr-Ht:0<Pe&&(fe=Ur-Ht),ue=kd,hf.attr("cursor",zn.selection),P());break;default:return}To()}function ee(){switch(R.event.keyCode){case 16:Wu&&($r=rl=Wu=!1,P());break;case 18:ue===Qa&&(0>pe?et=kr:0<pe&&(be=Br),0>Pe?ht=Fr:0<Pe&&(fe=Ur),ue=fo,P());break;case 32:ue===kd&&(R.event.altKey?(pe&&(et=kr-It*pe,be=Br+It*pe),Pe&&(ht=Fr-Ht*Pe,fe=Ur+Ht*Pe),ue=Qa):(0>pe?et=kr:0<pe&&(be=Br),0>Pe?ht=Fr:0<Pe&&(fe=Ur),ue=fo),hf.attr("cursor",zn[ce]),P());break;default:return}To()}if(R.event.touches){if(R.event.changedTouches.length<R.event.touches.length)return To()}else if(A)return;if(y.apply(this,arguments)){var Y=this,ce=R.event.target.__data__.type,ue=(R.event.metaKey?ce="overlay":ce)==="selection"?ho:R.event.altKey?Qa:fo,pe=t===Ln?null:Fd[ce],Pe=t===Ds?null:Pg[ce],Oe=Ao(Y),xe=Oe.extent,Ce=Oe.selection,ye=xe[0][0],be,Z=xe[0][1],fe,Ae=xe[1][0],et,mt=xe[1][1],ht,It,Ht,Vu,Wu=pe&&Pe&&R.event.shiftKey,$r,rl,cf=wr(Y),uf=cf,x0=a(Y,arguments).beforestart();ce==="overlay"?Oe.selection=Ce=[[be=t===Ln?ye:cf[0],fe=t===Ds?Z:cf[1]],[et=t===Ln?Ae:be,ht=t===Ds?mt:fe]]:(be=Ce[0][0],fe=Ce[0][1],et=Ce[1][0],ht=Ce[1][1]);var Br=be,Ur=fe,kr=et,Fr=ht,zm=cr(Y).attr("pointer-events","none"),hf=zm.selectAll(".overlay").attr("cursor",zn[ce]);if(R.event.touches)zm.on("touchmove.brush",E,!0).on("touchend.brush touchcancel.brush",C,!0);else{var Lx=cr(R.event.view).on("keydown.brush",B,!0).on("keyup.brush",ee,!0).on("mousemove.brush",E,!0).on("mouseup.brush",C,!0);ti(R.event.view)}R.event.stopImmediatePropagation(),Li(Y),s.call(Y),x0.start()}}function m(){var E=this.__brush||{selection:null};return E.extent=v.apply(this,arguments),E.dim=t,E}var v=Lc,y=Ks,b=ke(r,"start","brush","end"),w=6,A;return r.move=function(E,P){E.selection?E.on("start.brush",function(){a(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){a(this,arguments).end()}).tween("brush",function(){function C(Pe){ee.selection=Pe===1&&ea(ue)?null:pe(Pe),s.call(B),Y.brush()}var B=this,ee=B.__brush,Y=a(B,arguments),ce=ee.selection,ue=t.input(typeof P=="function"?P.apply(this,arguments):P,ee.extent),pe=Ri(ce,ue);return ce&&ue?C:C(1)}):E.each(function(){var C=arguments,B=this.__brush,ee=t.input(typeof P=="function"?P.apply(this,C):P,B.extent);C=a(this,C).beforestart(),Li(this),B.selection=ee==null||ea(ee)?null:ee,s.call(this),C.start().brush().end()})},u.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(E){lr(new $i(r,E,t.output(this.state.selection)),b.apply,b,[E,this.that,this.args])}},r.extent=function(E){return arguments.length?(v=typeof E=="function"?E:uh([[+E[0][0],+E[0][1]],[+E[1][0],+E[1][1]]]),r):v},r.filter=function(E){return arguments.length?(y=typeof E=="function"?E:uh(!!E),r):y},r.handleSize=function(E){return arguments.length?(w=+E,r):w},r.on=function(){var E=b.on.apply(b,arguments);return E===b?r:E},r}function Km(t){return function(r,s){return t(r.source.value+r.target.value,s.source.value+s.target.value)}}function hh(t){return function(){return t}}function jr(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Ar(){return new jr}function Pc(t){return t.source}function yl(t){return t.target}function Df(t){return t.radius}function eg(t){return t.startAngle}function ns(t){return t.endAngle}function Wt(){}function dt(t,r){var s=new Wt;if(t instanceof Wt)t.each(function(m,v){s.set(v,m)});else if(Array.isArray(t)){var a=-1,u=t.length,d;if(r==null)for(;++a<u;)s.set(a,t[a]);else for(;++a<u;)s.set(r(d=t[a],a,t),d)}else if(t)for(a in t)s.set(a,t[a]);return s}function si(){return{}}function tg(t,r,s){t[r]=s}function Of(){return dt()}function Gf(t,r,s){t.set(r,s)}function Cc(){}function Bf(t,r){var s=new Cc;if(t instanceof Cc)t.each(function(d){s.add(d)});else if(t){var a=-1,u=t.length;if(r==null)for(;++a<u;)s.add(t[a]);else for(;++a<u;)s.add(r(t[a],a,t))}return s}function ng(t,r){return t-r}function Yr(t){return function(){return t}}function ta(){}function ai(){function t(y){var b=m(y);if(Array.isArray(b))b=b.slice().sort(ng);else{var w=le(y),A=w[0];w=w[1],b=X(A,w,b),b=H(Math.floor(A/b)*b,Math.floor(w/b)*b,b)}return b.map(function(E){return r(y,E)})}function r(y,b){var w=[],A=[];return s(y,b,function(E){v(E,y,b);for(var P=0,C=E.length,B=E[C-1][1]*E[0][0]-E[C-1][0]*E[0][1];++P<C;)B+=E[P-1][1]*E[P][0]-E[P-1][0]*E[P][1];0<B?w.push([E]):A.push(E)}),A.forEach(function(E){for(var P=0,C=w.length,B;P<C;++P){e:{for(var ee=(B=w[P])[0],Y=E,ce=-1,ue=Y.length;++ce<ue;){t:{for(var pe=ee,Pe=Y[ce],Oe=Pe[0],xe=Pe[1],Ce=-1,ye=0,be=pe.length,Z=be-1;ye<be;Z=ye++){var fe=pe[ye],Ae=fe[0],et=fe[1],mt=pe[Z];Z=mt[0];var ht=mt[1],It,Ht=fe;if(fe=mt,mt=Pe,(It=(fe[0]-Ht[0])*(mt[1]-Ht[1])===(mt[0]-Ht[0])*(fe[1]-Ht[1]))&&(Ht=Ht[It=+(Ht[0]===fe[0])],mt=mt[It],fe=fe[It],It=Ht<=mt&&mt<=fe||fe<=mt&&mt<=Ht),It){pe=0;break t}et>xe!=ht>xe&&Oe<(Z-Ae)*(xe-et)/(ht-et)+Ae&&(Ce=-Ce)}pe=Ce}if(pe){ee=pe;break e}}ee=0}if(ee!==-1){B.push(E);break}}}),{type:"MultiPolygon",value:b,coordinates:w}}function s(y,b,w){function A(pe){var Pe=[pe[0][0]+B,pe[0][1]+C];pe=[pe[1][0]+B,pe[1][1]+C];var Oe=2*Pe[0]+Pe[1]*(u+1)*4,xe=2*pe[0]+pe[1]*(u+1)*4,Ce,ye;(Ce=P[Oe])?(ye=E[xe])?(delete P[Ce.end],delete E[ye.start],Ce===ye?(Ce.ring.push(pe),w(Ce.ring)):E[Ce.start]=P[ye.end]={start:Ce.start,end:ye.end,ring:Ce.ring.concat(ye.ring)}):(delete P[Ce.end],Ce.ring.push(pe),P[Ce.end=xe]=Ce):(Ce=E[xe])?(ye=P[Oe])?(delete E[Ce.start],delete P[ye.end],Ce===ye?(Ce.ring.push(pe),w(Ce.ring)):E[ye.start]=P[Ce.end]={start:ye.start,end:Ce.end,ring:ye.ring.concat(Ce.ring)}):(delete E[Ce.start],Ce.ring.unshift(Pe),E[Ce.start=Oe]=Ce):E[Oe]=P[xe]={start:Oe,end:xe,ring:[Pe,pe]}}var E=[],P=[],C,B=C=-1,ee=y[0]>=b;for(Pr[ee<<1].forEach(A);++B<u-1;){var Y=ee;ee=y[B+1]>=b,Pr[Y|ee<<1].forEach(A)}for(Pr[ee<<0].forEach(A);++C<d-1;){B=-1,ee=y[C*u+u]>=b;var ce=y[C*u]>=b;for(Pr[ee<<1|ce<<2].forEach(A);++B<u-1;){Y=ee,ee=y[C*u+u+B+1]>=b;var ue=ce;ce=y[C*u+B+1]>=b,Pr[Y|ee<<1|ce<<2|ue<<3].forEach(A)}Pr[ee|ce<<3].forEach(A)}for(B=-1,ce=y[C*u]>=b,Pr[ce<<2].forEach(A);++B<u-1;)ue=ce,ce=y[C*u+B+1]>=b,Pr[ce<<2|ue<<3].forEach(A);Pr[ce<<3].forEach(A)}function a(y,b,w){y.forEach(function(A){var E=A[0],P=A[1],C=E|0,B=P|0,ee=b[B*u+C];if(0<E&&E<u&&C===E){var Y=b[B*u+C-1];A[0]=E+(w-Y)/(ee-Y)-.5}0<P&&P<d&&B===P&&(Y=b[(B-1)*u+C],A[1]=P+(w-Y)/(ee-Y)-.5)})}var u=1,d=1,m=ne,v=a;return t.contour=r,t.size=function(y){if(!arguments.length)return[u,d];var b=Math.ceil(y[0]),w=Math.ceil(y[1]);if(!(0<b&&0<w))throw Error("invalid size");return u=b,d=w,t},t.thresholds=function(y){return arguments.length?(m=typeof y=="function"?y:Array.isArray(y)?Yr(Hd.call(y)):Yr(y),t):m},t.smooth=function(y){return arguments.length?(v=y?a:ta,t):v===a},t}function Ic(t,r,s){for(var a=t.width,u=t.height,d=(s<<1)+1,m=0;m<u;++m)for(var v=0,y=0;v<a+s;++v)v<a&&(y+=t.data[v+m*a]),v>=s&&(v>=d&&(y-=t.data[v-d+m*a]),r.data[v-s+m*a]=y/Math.min(v+1,a-1+d-v,d))}function Dc(t,r,s){for(var a=t.width,u=t.height,d=(s<<1)+1,m=0;m<a;++m)for(var v=0,y=0;v<u+s;++v)v<u&&(y+=t.data[m+v*a]),v>=s&&(v>=d&&(y-=t.data[m+(v-d)*a]),r.data[m+(v-s)*a]=y/Math.min(v+1,u-1+d-v,d))}function Oc(t){return t[0]}function No(t){return t[1]}function dh(){return 1}function na(t){return function(r){for(var s={},a=0;a<t.length;a++)s[t[a]]=r[a]||"";return s}}function Uf(t,r){var s=na(t);return function(a,u){return r(s(a),u,t)}}function Gc(t){var r=Object.create(null),s=[];return t.forEach(function(a){for(var u in a)u in r||s.push(r[u]=u)}),s}function xl(t){function r(m,v){function y(){if(C)return Jn;if(B)return B=!1,Iu;var Y,ce=A,ue;if(m.charCodeAt(ce)===34){for(;A++<w&&m.charCodeAt(A)!==34||m.charCodeAt(++A)===34;);return(Y=A)>=w?C=!0:(ue=m.charCodeAt(A++))===10?B=!0:ue===13&&(B=!0,m.charCodeAt(A)===10&&++A),m.slice(ce+1,Y-1).replace(/""/g,'"')}for(;A<w;){if((ue=m.charCodeAt(Y=A++))===10)B=!0;else if(ue===13)B=!0,m.charCodeAt(A)===10&&++A;else if(ue!==d)continue;return m.slice(ce,Y)}return C=!0,m.slice(ce,w)}var b=[],w=m.length,A=0,E=0,P,C=0>=w,B=!1;for(m.charCodeAt(w-1)===10&&--w,m.charCodeAt(w-1)===13&&--w;(P=y())!==Jn;){for(var ee=[];P!==Iu&&P!==Jn;)ee.push(P),P=y();v&&(ee=v(ee,E++))==null||b.push(ee)}return b}function s(m){return m.map(a).join(t)}function a(m){return m==null?"":u.test(m+="")?'"'+m.replace(/"/g,'""')+'"':m}var u=new RegExp('["'+t+`
\r]`),d=t.charCodeAt(0);return{parse:function(m,v){var y,b;return m=r(m,function(w,A){if(y)return y(w,A-1);b=w,y=v?Uf(w,v):na(w)}),m.columns=b||[],m},parseRows:r,format:function(m,v){return v==null&&(v=Gc(m)),[v.map(a).join(t)].concat(m.map(function(y){return v.map(function(b){return a(y[b])}).join(t)})).join(`
`)},formatRows:function(m){return m.map(s).join(`
`)}}}function fh(t){if(!t.ok)throw Error(t.status+" "+t.statusText);return t.blob()}function rs(t){if(!t.ok)throw Error(t.status+" "+t.statusText);return t.arrayBuffer()}function ra(t){if(!t.ok)throw Error(t.status+" "+t.statusText);return t.text()}function Bc(t,r){return fetch(t,r).then(ra)}function ph(t){return function(r,s,a){return arguments.length===2&&typeof s=="function"&&(a=s,s=void 0),Bc(r,s).then(function(u){return t(u,a)})}}function rg(t){if(!t.ok)throw Error(t.status+" "+t.statusText);return t.json()}function Bn(t){return function(){return t}}function Qi(){return 1e-6*(Math.random()-.5)}function _l(t,r,s,a){if(isNaN(r)||isNaN(s))return t;var u,d=t._root;a={data:a};var m=t._x0,v=t._y0,y=t._x1,b=t._y1,w,A,E,P,C;if(!d)return t._root=a,t;for(;d.length;)if((E=r>=(w=(m+y)/2))?m=w:y=w,(P=s>=(A=(v+b)/2))?v=A:b=A,u=d,!(d=d[C=P<<1|E]))return u[C]=a,t;var B=+t._x.call(null,d.data),ee=+t._y.call(null,d.data);if(r===B&&s===ee)return a.next=d,u?u[C]=a:t._root=a,t;do u=u?u[C]=Array(4):t._root=Array(4),(E=r>=(w=(m+y)/2))?m=w:y=w,(P=s>=(A=(v+b)/2))?v=A:b=A;while((C=P<<1|E)===(E=(ee>=A)<<1|B>=w));return u[E]=d,u[C]=a,t}function nr(t,r,s,a,u){this.node=t,this.x0=r,this.y0=s,this.x1=a,this.y1=u}function kf(t){return t[0]}function mh(t){return t[1]}function ia(t,r,s){return r=new gh(r??kf,s??mh,NaN,NaN,NaN,NaN),t==null?r:r.addAll(t)}function gh(t,r,s,a,u,d){this._x=t,this._y=r,this._x0=s,this._y0=a,this._x1=u,this._y1=d,this._root=void 0}function Ff(t){for(var r={data:t.data},s=r;t=t.next;)s=s.next={data:t.data};return r}function ig(t){return t.x+t.vx}function og(t){return t.y+t.vy}function sg(t){return t.index}function bl(t,r){if(t=t.get(r),!t)throw Error("missing: "+r);return t}function ag(t){return t.x}function lg(t){return t.y}function Ml(t,r){if(0>(r=(t=r?t.toExponential(r-1):t.toExponential()).indexOf("e")))return null;var s=t.slice(0,r);return[1<s.length?s[0]+s.slice(2):s,+t.slice(r+1)]}function oa(t){return t=Ml(Math.abs(t)),t?t[1]:NaN}function cg(t,r){return function(s,a){for(var u=s.length,d=[],m=0,v=t[0],y=0;0<u&&0<v&&(y+v+1>a&&(v=Math.max(1,a-y)),d.push(s.substring(u-=v,u+v)),!((y+=v+1)>a));)v=t[m=(m+1)%t.length];return d.reverse().join(r)}}function vh(t){return function(r){return r.replace(/[0-9]/g,function(s){return t[+s]})}}function sa(t){return new yh(t)}function yh(t){if(!(r=ky.exec(t)))throw Error("invalid format: "+t);var r;this.fill=r[1]||" ",this.align=r[2]||">",this.sign=r[3]||"-",this.symbol=r[4]||"",this.zero=!!r[5],this.width=r[6]&&+r[6],this.comma=!!r[7],this.precision=r[8]&&+r[8].slice(1),this.trim=!!r[9],this.type=r[10]||""}function zf(t,r){return r=Ml(t,r),r?(t=r[0],r=r[1],0>r?"0."+Array(-r).join("0")+t:t.length>r+1?t.slice(0,r+1)+"."+t.slice(r+1):t+Array(r-t.length+2).join("0")):t+""}function xh(t){return t}function _h(t){function r(v){function y(xe){var Ce=ue,ye=pe,be,Z;if(ce==="c")ye=Pe(xe)+ye,xe="";else{xe=+xe;var fe=0>xe;if(xe=Pe(Math.abs(xe),ee),Y){var Ae=xe.length,et=1,mt=-1;e:for(;et<Ae;++et)switch(xe[et]){case".":mt=be=et;break;case"0":mt===0&&(mt=et),be=et;break;default:if(!+xe[et])break e;0<mt&&(mt=0)}xe=0<mt?xe.slice(0,mt)+xe.slice(be+1):xe}if(fe&&+xe==0&&(fe=!1),Ce=(fe?A==="("?A:"-":A==="-"||A==="("?"":A)+Ce,ye=(ce==="s"?k0[8+B0/3]:"")+ye+(fe&&A==="("?")":""),Oe){for(fe=-1,be=xe.length;++fe<be;)if(Z=xe.charCodeAt(fe),48>Z||57<Z){ye=(Z===46?u+xe.slice(fe+1):xe.slice(fe))+ye,xe=xe.slice(0,fe);break}}}switch(B&&!P&&(xe=s(xe,1/0)),Z=Ce.length+xe.length+ye.length,fe=Z<C?Array(C-Z+1).join(b):"",B&&P&&(xe=s(fe+xe,fe.length?C-ye.length:1/0),fe=""),w){case"<":xe=Ce+xe+ye+fe;break;case"=":xe=Ce+fe+xe+ye;break;case"^":xe=fe.slice(0,Z=fe.length>>1)+Ce+xe+ye+fe.slice(Z);break;default:xe=fe+Ce+xe+ye}return d(xe)}v=sa(v);var b=v.fill,w=v.align,A=v.sign,E=v.symbol,P=v.zero,C=v.width,B=v.comma,ee=v.precision,Y=v.trim,ce=v.type;ce==="n"?(B=!0,ce="g"):U0[ce]||(ee==null&&(ee=12),Y=!0,ce="g"),(P||b==="0"&&w==="=")&&(P=!0,b="0",w="=");var ue=E==="$"?a[0]:E==="#"&&/[boxX]/.test(ce)?"0"+ce.toLowerCase():"",pe=E==="$"?a[1]:/[%p]/.test(ce)?m:"",Pe=U0[ce],Oe=/[defgprs%]/.test(ce);return ee=ee==null?6:/[gprs]/.test(ce)?Math.max(1,Math.min(21,ee)):Math.max(0,Math.min(20,ee)),y.toString=function(){return v+""},y}var s=t.grouping&&t.thousands?cg(t.grouping,t.thousands):xh,a=t.currency,u=t.decimal,d=t.numerals?vh(t.numerals):xh,m=t.percent||"%";return{format:r,formatPrefix:function(v,y){var b=r((v=sa(v),v.type="f",v));v=3*Math.max(-8,Math.min(8,Math.floor(oa(y)/3)));var w=Math.pow(10,-v),A=k0[8+v/3];return function(E){return b(w*E)+A}}}}function bh(t){return mm=_h(t),R.format=mm.format,R.formatPrefix=mm.formatPrefix,mm}function Mh(t){return Math.max(0,-oa(Math.abs(t)))}function wh(t,r){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(oa(r)/3)))-oa(Math.abs(t)))}function Eh(t,r){return t=Math.abs(t),r=Math.abs(r)-t,Math.max(0,oa(r)-oa(t))+1}function rr(){this.reset()}function ir(t,r,s){var a=t.s=r+s,u=a-r;t.t=r-(a-u)+(s-u)}function er(t){return 1<t?0:-1>t?nn:Math.acos(t)}function or(t){return 1<t?En:-1>t?-En:Math.asin(t)}function Hf(t){return(t=Et(t/2))*t}function Mn(){}function Uc(t,r){t&&H0.hasOwnProperty(t.type)&&H0[t.type](t,r)}function Sh(t,r,s){var a=-1;for(s=t.length-s,r.lineStart();++a<s;){var u=t[a];r.point(u[0],u[1],u[2])}r.lineEnd()}function Vf(t,r){var s=-1,a=t.length;for(r.polygonStart();++s<a;)Sh(t[s],r,1);r.polygonEnd()}function li(t,r){t&&z0.hasOwnProperty(t.type)?z0[t.type](t,r):Uc(t,r)}function ug(){Vo.point=dg}function hg(){Wf(V0,W0)}function dg(t,r){Vo.point=Wf,V0=t,W0=r,t*=Gt,r*=Gt,Dg=t,Og=Lt(r=r/2+vm),Gg=Et(r)}function Wf(t,r){t*=Gt,r*=Gt,r=r/2+vm;var s=t-Dg,a=0<=s?1:-1,u=a*s;s=Lt(r),r=Et(r);var d=Gg*r,m=Og*s+d*Lt(u);a=d*a*Et(u),_m.add(Ir(a,m)),Dg=t,Og=s,Gg=r}function kc(t){return[Ir(t[1],t[0]),or(t[2])]}function is(t){var r=t[0];t=t[1];var s=Lt(t);return[s*Lt(r),s*Et(r),Et(t)]}function Fc(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function aa(t,r){return[t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]]}function Th(t,r){t[0]+=r[0],t[1]+=r[1],t[2]+=r[2]}function zc(t,r){return[t[0]*r,t[1]*r,t[2]*r]}function Hc(t){var r=Zn(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=r,t[1]/=r,t[2]/=r}function Ah(t,r){Ka.push(Os=[Pn=t,Vn=t]),r<yi&&(yi=r),r>zi&&(zi=r)}function jf(t,r){var s=is([t*Gt,r*Gt]);if(Gu){var a=aa(Gu,s);a=aa([a[1],-a[0],0],a),Hc(a),a=kc(a);var u=t-nc,d=0<u?1:-1,m=a[0]*_n*d;u=180<rn(u),u^(d*nc<m&&m<d*t)?(a=a[1]*_n,a>zi&&(zi=a)):(m=(m+360)%360-180,u^(d*nc<m&&m<d*t)?(a=-a[1]*_n,a<yi&&(yi=a)):(r<yi&&(yi=r),r>zi&&(zi=r))),u?t<nc?Nr(Pn,t)>Nr(Pn,Vn)&&(Vn=t):Nr(t,Vn)>Nr(Pn,Vn)&&(Pn=t):Vn>=Pn?(t<Pn&&(Pn=t),t>Vn&&(Vn=t)):t>nc?Nr(Pn,t)>Nr(Pn,Vn)&&(Vn=t):Nr(t,Vn)>Nr(Pn,Vn)&&(Pn=t)}else Ka.push(Os=[Pn=t,Vn=t]);r<yi&&(yi=r),r>zi&&(zi=r),Gu=s,nc=t}function Yf(){Gs.point=jf}function qf(){Os[0]=Pn,Os[1]=Vn,Gs.point=Ah,Gu=null}function Xf(t,r){if(Gu){var s=t-nc;Wd.add(180<rn(s)?s+(0<s?360:-360):s)}else j0=t,Y0=r;Vo.point(t,r),jf(t,r)}function fg(){Vo.lineStart()}function pg(){Xf(j0,Y0),Vo.lineEnd(),1e-6<rn(Wd)&&(Pn=-(Vn=180)),Os[0]=Pn,Os[1]=Vn,Gu=null}function Nr(t,r){return 0>(r-=t)?r+360:r}function mg(t,r){return t[0]-r[0]}function Jf(t,r){return t[0]<=t[1]?t[0]<=r&&r<=t[1]:r<t[0]||t[1]<r}function Nh(t,r){t*=Gt,r*=Gt;var s=Lt(r);wl(s*Lt(t),s*Et(t),Et(r))}function wl(t,r,s){++jd,wm+=(t-wm)/jd,Em+=(r-Em)/jd,Sm+=(s-Sm)/jd}function Zf(){mo.point=gg}function gg(t,r){t*=Gt,r*=Gt;var s=Lt(r);Dr=s*Lt(t),Or=s*Et(t),Gr=Et(r),mo.point=vg,wl(Dr,Or,Gr)}function vg(t,r){t*=Gt,r*=Gt;var s=Lt(r),a=s*Lt(t);t=s*Et(t),r=Et(r);var u=Ir(Zn((u=Or*r-Gr*t)*u+(u=Gr*a-Dr*r)*u+(u=Dr*t-Or*a)*u),Dr*a+Or*t+Gr*r);Mm+=u,Tm+=u*(Dr+(Dr=a)),Am+=u*(Or+(Or=t)),Nm+=u*(Gr+(Gr=r)),wl(Dr,Or,Gr)}function $f(){mo.point=Nh}function yg(){mo.point=_g}function xg(){Qf(q0,X0),mo.point=Nh}function _g(t,r){q0=t,X0=r,t*=Gt,r*=Gt,mo.point=Qf;var s=Lt(r);Dr=s*Lt(t),Or=s*Et(t),Gr=Et(r),wl(Dr,Or,Gr)}function Qf(t,r){t*=Gt,r*=Gt;var s=Lt(r),a=s*Lt(t);t=s*Et(t),r=Et(r),s=Or*r-Gr*t;var u=Gr*a-Dr*r,d=Dr*t-Or*a,m=Zn(s*s+u*u+d*d),v=or(m);m=m&&-v/m,Bg+=m*s,Ug+=m*u,kg+=m*d,Mm+=v,Tm+=v*(Dr+(Dr=a)),Am+=v*(Or+(Or=t)),Nm+=v*(Gr+(Gr=r)),wl(Dr,Or,Gr)}function os(t){return function(){return t}}function Vc(t,r){function s(a,u){return a=t(a,u),r(a[0],a[1])}return t.invert&&r.invert&&(s.invert=function(a,u){return a=r.invert(a,u),a&&t.invert(a[0],a[1])}),s}function El(t,r){return[t>nn?t-Zr:t<-nn?t+Zr:t,r]}function Wc(t,r,s){return(t%=Zr)?r||s?Vc(Ki(t),Rh(r,s)):Ki(t):r||s?Rh(r,s):El}function Kf(t){return function(r,s){return r+=t,[r>nn?r-Zr:r<-nn?r+Zr:r,s]}}function Ki(t){var r=Kf(t);return r.invert=Kf(-t),r}function Rh(t,r){function s(v,y){var b=Lt(y),w=Lt(v)*b;return v=Et(v)*b,y=Et(y),b=y*a+w*u,[Ir(v*d-b*m,w*a-y*u),or(b*d+v*m)]}var a=Lt(t),u=Et(t),d=Lt(r),m=Et(r);return s.invert=function(v,y){var b=Lt(y),w=Lt(v)*b;return v=Et(v)*b,y=Et(y),b=y*d-v*m,[Ir(v*d+y*m,w*a+b*u),or(b*a-w*u)]},s}function ep(t){function r(s){return s=t(s[0]*Gt,s[1]*Gt),s[0]*=_n,s[1]*=_n,s}return t=Wc(t[0]*Gt,t[1]*Gt,2<t.length?t[2]*Gt:0),r.invert=function(s){return s=t.invert(s[0]*Gt,s[1]*Gt),s[0]*=_n,s[1]*=_n,s},r}function Lh(t,r,s,a,u,d){if(s){var m=Lt(r),v=Et(r);for(s*=a,u==null?(u=r+a*Zr,d=r-s/2):(u=Ph(m,u),d=Ph(m,d),(0<a?u<d:u>d)&&(u+=a*Zr));0<a?u>d:u<d;u-=s)r=kc([m,-v*Lt(u),-v*Et(u)]),t.point(r[0],r[1])}}function Ph(t,r){return r=is(r),r[0]-=t,Hc(r),t=er(-r[1]),((0>-r[2]?-t:t)+Zr-1e-6)%Zr}function Ro(){var t=[],r;return{point:function(s,a){r.push([s,a])},lineStart:function(){t.push(r=[])},lineEnd:Mn,rejoin:function(){1<t.length&&t.push(t.pop().concat(t.shift()))},result:function(){var s=t;return t=[],r=null,s}}}function jc(t,r){return 1e-6>rn(t[0]-r[0])&&1e-6>rn(t[1]-r[1])}function Yc(t,r,s,a){this.x=t,this.z=r,this.o=s,this.e=a,this.v=!1,this.n=this.p=null}function la(t,r,s,a,u){var d=[],m=[];if(t.forEach(function(A){if(!(0>=(E=A.length-1))){var E,P=A[0],C=A[E];if(jc(P,C)){for(u.lineStart(),v=0;v<E;++v)u.point((P=A[v])[0],P[1]);u.lineEnd()}else d.push(E=new Yc(P,A,null,!0)),m.push(E.o=new Yc(P,null,E,!1)),d.push(E=new Yc(C,A,null,!1)),m.push(E.o=new Yc(C,null,E,!0))}}),d.length){m.sort(r),Ch(d),Ch(m);var v=0;for(t=m.length;v<t;++v)m[v].e=s=!s;s=d[0];for(var y;;){for(var b=s,w=!0;b.v;)if((b=b.n)===s)return;r=b.z,u.lineStart();do{if(b.v=b.o.v=!0,b.e){if(w)for(v=0,t=r.length;v<t;++v)u.point((y=r[v])[0],y[1]);else a(b.x,b.n.x,1,u);b=b.n}else{if(w)for(r=b.p.z,v=r.length-1;0<=v;--v)u.point((y=r[v])[0],y[1]);else a(b.x,b.p.x,-1,u);b=b.p}b=b.o,r=b.z,w=!w}while(!b.v);u.lineEnd()}}}function Ch(t){if(r=t.length){for(var r,s=0,a=t[0],u;++s<r;)a.n=u=t[s],u.p=a,a=u;a.n=u=t[0],u.p=a}}function Ih(t,r){var s=r[0];r=r[1];var a=Et(r),u=[Et(s),-Lt(s),0],d=0,m=0;Fg.reset(),a===1?r=En+1e-6:a===-1&&(r=-En-1e-6),a=0;for(var v=t.length;a<v;++a)if(b=(y=t[a]).length){var y,b,w=y[b-1],A=w[0],E=w[1]/2+vm,P=Et(E),C=Lt(E);for(E=0;E<b;++E,A=ee,P=Y,C=ce,w=B){var B=y[E],ee=B[0];ce=B[1]/2+vm;var Y=Et(ce),ce=Lt(ce),ue=ee-A,pe=0<=ue?1:-1,Pe=pe*ue,Oe=Pe>nn;P*=Y,Fg.add(Ir(P*pe*Et(Pe),C*ce+P*Lt(Pe))),d+=Oe?ue+pe*Zr:ue,Oe^A>=s^ee>=s&&(w=aa(is(w),is(B)),Hc(w),A=aa(u,w),Hc(A),A=(Oe^0<=ue?-1:1)*or(A[2]),r>A||r===A&&(w[0]||w[1]))&&(m+=Oe^0<=ue?1:-1)}}return(-1e-6>d||1e-6>d&&-1e-6>Fg)^m&1}function tp(t,r,s,a){return function(u){function d(pe,Pe){t(pe,Pe)&&u.point(pe,Pe)}function m(pe,Pe){E.point(pe,Pe)}function v(){ue.point=m,E.lineStart()}function y(){ue.point=d,E.lineEnd()}function b(pe,Pe){ce.push([pe,Pe]),C.point(pe,Pe)}function w(){C.lineStart(),ce=[]}function A(){b(ce[0][0],ce[0][1]),C.lineEnd();var pe=C.clean(),Pe=P.result(),Oe=Pe.length,xe;if(ce.pop(),ee.push(ce),ce=null,Oe)if(pe&1){if(Oe=Pe[0],0<(Pe=Oe.length-1)){for(B||(u.polygonStart(),B=!0),u.lineStart(),pe=0;pe<Pe;++pe)u.point((xe=Oe[pe])[0],xe[1]);u.lineEnd()}}else 1<Oe&&pe&2&&Pe.push(Pe.pop().concat(Pe.shift())),Y.push(Pe.filter(Dh))}var E=r(u),P=Ro(),C=r(P),B=!1,ee,Y,ce,ue={point:d,lineStart:v,lineEnd:y,polygonStart:function(){ue.point=b,ue.lineStart=w,ue.lineEnd=A,Y=[],ee=[]},polygonEnd:function(){ue.point=d,ue.lineStart=v,ue.lineEnd=y,Y=me(Y);var pe=Ih(ee,a);Y.length?(B||(u.polygonStart(),B=!0),la(Y,bg,pe,s,u)):pe&&(B||(u.polygonStart(),B=!0),u.lineStart(),s(null,null,1,u),u.lineEnd()),B&&(u.polygonEnd(),B=!1),Y=ee=null},sphere:function(){u.polygonStart(),u.lineStart(),s(null,null,1,u),u.lineEnd(),u.polygonEnd()}};return ue}}function Dh(t){return 1<t.length}function bg(t,r){return(0>(t=t.x)[0]?t[1]-En-1e-6:En-t[1])-(0>(r=r.x)[0]?r[1]-En-1e-6:En-r[1])}function np(t){function r(y,b){return Lt(y)*Lt(b)>u}function s(y,b,w){var A=is(y),E=is(b),P=[1,0,0];E=aa(A,E);var C=Fc(E,E);A=E[0];var B=C-A*A;if(!B)return!w&&y;if(C=u*C/B,B=-u*A/B,A=aa(P,E),P=zc(P,C),E=zc(E,B),Th(P,E),E=Fc(P,A),C=Fc(A,A),B=E*E-C*(Fc(P,P)-1),!(0>B)){var ee=Zn(B);if(B=zc(A,(-E-ee)/C),Th(B,P),B=kc(B),!w)return B;w=y[0];var Y=b[0];if(y=y[1],b=b[1],Y<w){var ce=w;w=Y,Y=ce}var ue=Y-w,pe=1e-6>rn(ue-nn);if(!pe&&b<y&&(ce=y,y=b,b=ce),pe||1e-6>ue?pe?0<y+b^B[1]<(1e-6>rn(B[0]-w)?y:b):y<=B[1]&&B[1]<=b:ue>nn^(w<=B[0]&&B[0]<=Y))return b=zc(A,(-E+ee)/C),Th(b,P),[B,kc(b)]}}function a(y,b){var w=m?t:nn-t,A=0;return y<-w?A|=1:y>w&&(A|=2),b<-w?A|=4:b>w&&(A|=8),A}var u=Lt(t),d=6*Gt,m=0<u,v=1e-6<rn(u);return tp(r,function(y){var b,w,A,E,P;return{lineStart:function(){E=A=!1,P=1},point:function(C,B){var ee=[C,B],Y=r(C,B);if(B=m?Y?0:a(C,B):Y?a(C+(0>C?nn:-nn),B):0,!b&&(E=A=Y)&&y.lineStart(),Y!==A&&(C=s(b,ee),!C||jc(b,C)||jc(ee,C))&&(ee[0]+=1e-6,ee[1]+=1e-6,Y=r(ee[0],ee[1])),Y!==A)P=0,Y?(y.lineStart(),C=s(ee,b),y.point(C[0],C[1])):(C=s(b,ee),y.point(C[0],C[1]),y.lineEnd()),b=C;else if(v&&b&&m^Y){var ce;B&w||!(ce=s(ee,b,!0))||(P=0,m?(y.lineStart(),y.point(ce[0][0],ce[0][1]),y.point(ce[1][0],ce[1][1]),y.lineEnd()):(y.point(ce[1][0],ce[1][1]),y.lineEnd(),y.lineStart(),y.point(ce[0][0],ce[0][1])))}!Y||b&&jc(b,ee)||y.point(ee[0],ee[1]),b=ee,A=Y,w=B},lineEnd:function(){A&&y.lineEnd(),b=null},clean:function(){return P|(E&&A)<<1}}},function(y,b,w,A){Lh(A,t,d,w,y,b)},m?[0,-t]:[-nn,t-nn])}function Mg(t,r,s,a,u,d){var m=t[0],v=t[1],y=0,b=1,w=r[0]-m,A=r[1]-v;if(s-=m,w||!(0<s)){if(s/=w,0>w){if(s<y)return;s<b&&(b=s)}else if(0<w){if(s>b)return;s>y&&(y=s)}if(s=u-m,w||!(0>s)){if(s/=w,0>w){if(s>b)return;s>y&&(y=s)}else if(0<w){if(s<y)return;s<b&&(b=s)}if(s=a-v,A||!(0<s)){if(s/=A,0>A){if(s<y)return;s<b&&(b=s)}else if(0<A){if(s>b)return;s>y&&(y=s)}if(s=d-v,A||!(0>s)){if(s/=A,0>A){if(s>b)return;s>y&&(y=s)}else if(0<A){if(s<y)return;s<b&&(b=s)}return 0<y&&(t[0]=m+y*w,t[1]=v+y*A),1>b&&(r[0]=m+b*w,r[1]=v+b*A),!0}}}}}function Sl(t,r,s,a){function u(y,b,w,A){var E=0,P=0;if(y==null||(E=d(y,w))!==(P=d(b,w))||0>v(y,b)^0<w)do A.point(E===0||E===3?t:s,1<E?a:r);while((E=(E+w+4)%4)!==P);else A.point(b[0],b[1])}function d(y,b){return 1e-6>rn(y[0]-t)?0<b?0:3:1e-6>rn(y[0]-s)?0<b?2:1:1e-6>rn(y[1]-r)?0<b?1:0:0<b?3:2}function m(y,b){return v(y.x,b.x)}function v(y,b){var w=d(y,1),A=d(b,1);return w!==A?w-A:w===0?b[1]-y[1]:w===1?y[0]-b[0]:w===2?y[1]-b[1]:b[0]-y[0]}return function(y){function b(ye,be){t<=ye&&ye<=s&&r<=be&&be<=a&&A.point(ye,be)}function w(ye,be){var Z=t<=ye&&ye<=s&&r<=be&&be<=a;if(C&&B.push([ye,be]),Oe)ee=ye,Y=be,ce=Z,Oe=!1,Z&&(A.lineStart(),A.point(ye,be));else if(Z&&Pe)A.point(ye,be);else{var fe=[ue=Math.max(-1e9,Math.min(1e9,ue)),pe=Math.max(-1e9,Math.min(1e9,pe))],Ae=[ye=Math.max(-1e9,Math.min(1e9,ye)),be=Math.max(-1e9,Math.min(1e9,be))];Mg(fe,Ae,t,r,s,a)?(Pe||(A.lineStart(),A.point(fe[0],fe[1])),A.point(Ae[0],Ae[1]),Z||A.lineEnd(),xe=!1):Z&&(A.lineStart(),A.point(ye,be),xe=!1)}ue=ye,pe=be,Pe=Z}var A=y,E=Ro(),P,C,B,ee,Y,ce,ue,pe,Pe,Oe,xe,Ce={point:b,lineStart:function(){Ce.point=w,C&&C.push(B=[]),Oe=!0,Pe=!1,ue=pe=NaN},lineEnd:function(){P&&(w(ee,Y),ce&&Pe&&E.rejoin(),P.push(E.result())),Ce.point=b,Pe&&A.lineEnd()},polygonStart:function(){A=E,P=[],C=[],xe=!0},polygonEnd:function(){for(var ye,be=ye=0,Z=C.length;be<Z;++be){var fe=C[be],Ae=1,et=fe.length,mt=fe[0],ht=mt[0];for(mt=mt[1];Ae<et;++Ae){var It=ht,Ht=mt;mt=fe[Ae],ht=mt[0],mt=mt[1],Ht<=a?mt>a&&(ht-It)*(a-Ht)>(mt-Ht)*(t-It)&&++ye:mt<=a&&(ht-It)*(a-Ht)<(mt-Ht)*(t-It)&&--ye}}be=xe&&ye,Z=(P=me(P)).length,(be||Z)&&(y.polygonStart(),be&&(y.lineStart(),u(null,null,1,y),y.lineEnd()),Z&&la(P,m,ye,u,y),y.polygonEnd()),A=y,P=C=B=null}};return Ce}}function wg(){Bu.point=Bu.lineEnd=Mn}function rp(t,r){t*=Gt,r*=Gt,Vg=t,Rm=Et(r),Lm=Lt(r),Bu.point=ip}function ip(t,r){t*=Gt,r*=Gt;var s=Et(r);r=Lt(r);var a=rn(t-Vg),u=Lt(a);a=Et(a),a*=r;var d=Lm*s-Rm*r*u;u=Rm*s+Lm*r*u,Hg.add(Ir(Zn(a*a+d*d),u)),Vg=t,Rm=s,Lm=r}function op(t){return Hg.reset(),li(t,Bu),+Hg}function ca(t,r){return Wg[0]=t,Wg[1]=r,op(Fy)}function qc(t,r){return t&&Z0.hasOwnProperty(t.type)?Z0[t.type](t,r):!1}function sp(t,r){var s=ca(t[0],t[1]),a=ca(t[0],r);return t=ca(r,t[1]),a+t<=s+1e-6}function Oh(t,r){return!!Ih(t.map(ap),lp(r))}function ap(t){return t=t.map(lp),t.pop(),t}function lp(t){return[t[0]*Gt,t[1]*Gt]}function cp(t,r,s){var a=H(t,r-1e-6,s).concat(r);return function(u){return a.map(function(d){return[u,d]})}}function up(t,r,s){var a=H(t,r-1e-6,s).concat(r);return function(u){return a.map(function(d){return[d,u]})}}function hp(){function t(){return{type:"MultiLineString",coordinates:r()}}function r(){return H(ym(d/E)*E,u,E).map(ee).concat(H(ym(b/P)*P,y,P).map(Y)).concat(H(ym(a/w)*w,s,w).filter(function(ue){return 1e-6<rn(ue%E)}).map(C)).concat(H(ym(v/A)*A,m,A).filter(function(ue){return 1e-6<rn(ue%P)}).map(B))}var s,a,u,d,m,v,y,b,w=10,A=w,E=90,P=360,C,B,ee,Y,ce=2.5;return t.lines=function(){return r().map(function(ue){return{type:"LineString",coordinates:ue}})},t.outline=function(){return{type:"Polygon",coordinates:[ee(d).concat(Y(y).slice(1),ee(u).reverse().slice(1),Y(b).reverse().slice(1))]}},t.extent=function(ue){return arguments.length?t.extentMajor(ue).extentMinor(ue):t.extentMinor()},t.extentMajor=function(ue){return arguments.length?(d=+ue[0][0],u=+ue[1][0],b=+ue[0][1],y=+ue[1][1],d>u&&(ue=d,d=u,u=ue),b>y&&(ue=b,b=y,y=ue),t.precision(ce)):[[d,b],[u,y]]},t.extentMinor=function(ue){return arguments.length?(a=+ue[0][0],s=+ue[1][0],v=+ue[0][1],m=+ue[1][1],a>s&&(ue=a,a=s,s=ue),v>m&&(ue=v,v=m,m=ue),t.precision(ce)):[[a,v],[s,m]]},t.step=function(ue){return arguments.length?t.stepMajor(ue).stepMinor(ue):t.stepMinor()},t.stepMajor=function(ue){return arguments.length?(E=+ue[0],P=+ue[1],t):[E,P]},t.stepMinor=function(ue){return arguments.length?(w=+ue[0],A=+ue[1],t):[w,A]},t.precision=function(ue){return arguments.length?(ce=+ue,C=cp(v,m,90),B=up(a,s,ce),ee=cp(b,y,90),Y=up(d,u,ce),t):ce},t.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}function ss(t){return t}function dp(){Bs.point=Eg}function Eg(t,r){Bs.point=Tl,$0=qg=t,Q0=Xg=r}function Tl(t,r){Yg.add(Xg*t-qg*r),qg=t,Xg=r}function Xc(){Tl($0,Q0)}function Lo(t,r){Jg+=t,Zg+=r,++qd}function fp(){Hi.point=Sg}function Sg(t,r){Hi.point=pp,Lo(Wo=t,jo=r)}function pp(t,r){var s=t-Wo,a=r-jo;s=Zn(s*s+a*a),Dm+=s*(Wo+t)/2,Om+=s*(jo+r)/2,ku+=s,Lo(Wo=t,jo=r)}function Jc(){Hi.point=Lo}function as(){Hi.point=Gh}function Tg(){mp(K0,ev)}function Gh(t,r){Hi.point=mp,Lo(K0=Wo=t,ev=jo=r)}function mp(t,r){var s=t-Wo,a=r-jo;s=Zn(s*s+a*a),Dm+=s*(Wo+t)/2,Om+=s*(jo+r)/2,ku+=s,s=jo*t-Wo*r,$g+=s*(Wo+t),Qg+=s*(jo+r),Xd+=3*s,Lo(Wo=t,jo=r)}function gp(t){this._context=t}function sn(t,r){$d.point=Bh,tv=Jd=t,nv=Zd=r}function Bh(t,r){Jd-=t,Zd-=r,Kg.add(Zn(Jd*Jd+Zd*Zd)),Jd=t,Zd=r}function ua(){this._string=[]}function ha(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Po(t){return function(r){var s=new eo,a;for(a in t)s[a]=t[a];return s.stream=r,s}}function eo(){}function wn(t,r,s){var a=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),a!=null&&t.clipExtent(null),li(s,t.stream(Im)),r(Im.result()),a!=null&&t.clipExtent(a),t}function Rr(t,r,s){return wn(t,function(a){var u=r[1][0]-r[0][0],d=r[1][1]-r[0][1],m=Math.min(u/(a[1][0]-a[0][0]),d/(a[1][1]-a[0][1]));u=+r[0][0]+(u-m*(a[1][0]+a[0][0]))/2,a=+r[0][1]+(d-m*(a[1][1]+a[0][1]))/2,t.scale(150*m).translate([u,a])},s)}function da(t,r,s){return wn(t,function(a){var u=+r,d=u/(a[1][0]-a[0][0]);u=(u-d*(a[1][0]+a[0][0]))/2,a=-d*a[0][1],t.scale(150*d).translate([u,a])},s)}function Co(t,r,s){return wn(t,function(a){var u=+r,d=u/(a[1][1]-a[0][1]),m=-d*a[0][0];a=(u-d*(a[1][1]+a[0][1]))/2,t.scale(150*d).translate([m,a])},s)}function fa(t){return Po({point:function(r,s){r=t(r,s),this.stream.point(r[0],r[1])}})}function ls(t,r){function s(a,u,d,m,v,y,b,w,A,E,P,C,B,ee){var Y=b-a,ce=w-u,ue=Y*Y+ce*ce;if(ue>4*r&&B--){var pe=m+E,Pe=v+P,Oe=y+C,xe=Zn(pe*pe+Pe*Pe+Oe*Oe),Ce=or(Oe/=xe),ye=1e-6>rn(rn(Oe)-1)||1e-6>rn(d-A)?(d+A)/2:Ir(Pe,pe),be=t(ye,Ce);Ce=be[0],be=be[1];var Z=Ce-a,fe=be-u,Ae=ce*Z-Y*fe;(Ae*Ae/ue>r||.3<rn((Y*Z+ce*fe)/ue-.5)||m*E+v*P+y*C<zy)&&(s(a,u,d,m,v,y,Ce,be,ye,pe/=xe,Pe/=xe,Oe,B,ee),ee.point(Ce,be),s(Ce,be,ye,pe,Pe,Oe,b,w,A,E,P,C,B,ee))}}return function(a){function u(Ce,ye){Ce=t(Ce,ye),a.point(Ce[0],Ce[1])}function d(){ce=NaN,xe.point=m,a.lineStart()}function m(Ce,ye){var be=is([Ce,ye]);ye=t(Ce,ye),s(ce,ue,Y,pe,Pe,Oe,ce=ye[0],ue=ye[1],Y=Ce,pe=be[0],Pe=be[1],Oe=be[2],16,a),a.point(ce,ue)}function v(){xe.point=u,a.lineEnd()}function y(){d(),xe.point=b,xe.lineEnd=w}function b(Ce,ye){m(A=Ce,ye),E=ce,P=ue,C=pe,B=Pe,ee=Oe,xe.point=m}function w(){s(ce,ue,Y,pe,Pe,Oe,E,P,A,C,B,ee,16,a),xe.lineEnd=v,v()}var A,E,P,C,B,ee,Y,ce,ue,pe,Pe,Oe,xe={point:u,lineStart:d,lineEnd:v,polygonStart:function(){a.polygonStart(),xe.lineStart=y},polygonEnd:function(){a.polygonEnd(),xe.lineStart=d}};return xe}}function pa(t){return Po({point:function(r,s){return r=t(r,s),this.stream.point(r[0],r[1])}})}function ma(t,r,s){function a(u,d){return[r+t*u,s-t*d]}return a.invert=function(u,d){return[(u-r)/t,(s-d)/t]},a}function ga(t,r,s,a){function u(E,P){return[m*E-v*P+r,s-v*E-m*P]}var d=Lt(a);a=Et(a);var m=d*t,v=a*t,y=d/t,b=a/t,w=(a*s-d*r)/t,A=(a*r+d*s)/t;return u.invert=function(E,P){return[y*E-b*P+w,A-b*E-y*P]},u}function ci(t){return va(function(){return t})()}function va(t){function r(Ae){return be(Ae[0]*Gt,Ae[1]*Gt)}function s(Ae){return(Ae=be.invert(Ae[0],Ae[1]))&&[Ae[0]*_n,Ae[1]*_n]}function a(){var Ae=ga(m,0,0,B).apply(null,d(b,w));return Ae=(B?ga:ma)(m,v-Ae[0],y-Ae[1],B),C=Wc(A,E,P),ye=Vc(d,Ae),be=Vc(C,ye),Ae=ye,Ce=+xe?ls(Ae,xe):fa(Ae),u()}function u(){return Z=fe=null,r}var d,m=150,v=480,y=250,b=0,w=0,A=0,E=0,P=0,C,B=0,ee=null,Y=zg,ce=null,ue,pe,Pe,Oe=ss,xe=.5,Ce,ye,be,Z,fe;return r.stream=function(Ae){return Z&&fe===Ae?Z:Z=Hy(pa(C)(Y(Ce(Oe(fe=Ae)))))},r.preclip=function(Ae){return arguments.length?(Y=Ae,ee=void 0,u()):Y},r.postclip=function(Ae){return arguments.length?(Oe=Ae,ce=ue=pe=Pe=null,u()):Oe},r.clipAngle=function(Ae){return arguments.length?(Y=+Ae?np(ee=Ae*Gt):(ee=null,zg),u()):ee*_n},r.clipExtent=function(Ae){return arguments.length?(Oe=Ae==null?(ce=ue=pe=Pe=null,ss):Sl(ce=+Ae[0][0],ue=+Ae[0][1],pe=+Ae[1][0],Pe=+Ae[1][1]),u()):ce==null?null:[[ce,ue],[pe,Pe]]},r.scale=function(Ae){return arguments.length?(m=+Ae,a()):m},r.translate=function(Ae){return arguments.length?(v=+Ae[0],y=+Ae[1],a()):[v,y]},r.center=function(Ae){return arguments.length?(b=Ae[0]%360*Gt,w=Ae[1]%360*Gt,a()):[b*_n,w*_n]},r.rotate=function(Ae){return arguments.length?(A=Ae[0]%360*Gt,E=Ae[1]%360*Gt,P=2<Ae.length?Ae[2]%360*Gt:0,a()):[A*_n,E*_n,P*_n]},r.angle=function(Ae){return arguments.length?(B=Ae%360*Gt,a()):B*_n},r.precision=function(Ae){if(arguments.length){var et=ye,mt=xe=Ae*Ae;et=(Ce=+mt?ls(et,mt):fa(et),u())}else et=Zn(xe);return et},r.fitExtent=function(Ae,et){return Rr(r,Ae,et)},r.fitSize=function(Ae,et){return Rr(r,[[0,0],Ae],et)},r.fitWidth=function(Ae,et){return da(r,Ae,et)},r.fitHeight=function(Ae,et){return Co(r,Ae,et)},function(){return d=t.apply(this,arguments),r.invert=d.invert&&s,a()}}function cs(t){var r=0,s=nn/3,a=va(t);return t=a(r,s),t.parallels=function(u){return arguments.length?a(r=u[0]*Gt,s=u[1]*Gt):[r*_n,s*_n]},t}function Zc(t){function r(a,u){return[a*s,Et(u)/s]}var s=Lt(t);return r.invert=function(a,u){return[a/s,or(u*s)]},r}function Uh(t,r){function s(v,y){return y=Zn(d-2*u*Et(y))/u,[y*Et(v*=u),m-y*Lt(v)]}var a=Et(t),u=(a+Et(r))/2;if(1e-6>rn(u))return Zc(t);var d=1+a*(2*u-a),m=Zn(d)/u;return s.invert=function(v,y){return y=m-y,[Ir(v,rn(y))/u*Vd(y),or((d-(v*v+y*y)*u*u)/(2*u))]},s}function ya(){return cs(Uh).scale(155.424).center([0,33.6442])}function kh(){return ya().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function $c(t){var r=t.length;return{point:function(s,a){for(var u=-1;++u<r;)t[u].point(s,a)},sphere:function(){for(var s=-1;++s<r;)t[s].sphere()},lineStart:function(){for(var s=-1;++s<r;)t[s].lineStart()},lineEnd:function(){for(var s=-1;++s<r;)t[s].lineEnd()},polygonStart:function(){for(var s=-1;++s<r;)t[s].polygonStart()},polygonEnd:function(){for(var s=-1;++s<r;)t[s].polygonEnd()}}}function Al(t){return function(r,s){var a=Lt(r),u=Lt(s);return a=t(a*u),[a*u*Et(r),a*Et(s)]}}function Io(t){return function(r,s){var a=Zn(r*r+s*s),u=t(a),d=Et(u);return u=Lt(u),[Ir(r*d,a*u),or(a&&s*d/a)]}}function xa(t,r){return[t,xm(Ou((En+r)/2))]}function Fh(t){function r(){var A=nn*u(),E=s(ep(s.rotate()).invert([0,0]));return m(v==null?[[E[0]-A,E[1]-A],[E[0]+A,E[1]+A]]:t===xa?[[Math.max(E[0]-A,v),y],[Math.min(E[0]+A,b),w]]:[[v,Math.max(E[1]-A,y)],[b,Math.min(E[1]+A,w)]])}var s=ci(t),a=s.center,u=s.scale,d=s.translate,m=s.clipExtent,v=null,y,b,w;return s.scale=function(A){return arguments.length?(u(A),r()):u()},s.translate=function(A){return arguments.length?(d(A),r()):d()},s.center=function(A){return arguments.length?(a(A),r()):a()},s.clipExtent=function(A){return arguments.length?(A==null?v=y=b=w=null:(v=+A[0][0],y=+A[0][1],b=+A[1][0],w=+A[1][1]),r()):v==null?null:[[v,y],[b,w]]},r()}function zh(t,r){function s(m,v){return 0<d?v<-En+1e-6&&(v=-En+1e-6):v>En-1e-6&&(v=En-1e-6),v=d/Ig(Ou((En+v)/2),u),[v*Et(u*m),d-v*Lt(u*m)]}var a=Lt(t),u=t===r?Et(t):xm(a/Lt(r))/xm(Ou((En+r)/2)/Ou((En+t)/2)),d=a*Ig(Ou((En+t)/2),u)/u;return u?(s.invert=function(m,v){v=d-v;var y=Vd(u)*Zn(m*m+v*v);return[Ir(m,rn(v))/u*Vd(v),2*Du(Ig(d/y,1/u))-En]},s):xa}function _a(t,r){return[t,r]}function Hh(t,r){function s(m,v){return v=d-v,m*=u,[v*Et(m),d-v*Lt(m)]}var a=Lt(t),u=t===r?Et(t):(a-Lt(r))/(r-t),d=a/u+t;return 1e-6>rn(u)?_a:(s.invert=function(m,v){return v=d-v,[Ir(m,rn(v))/u*Vd(v),d-Vd(u)*Zn(m*m+v*v)]},s)}function Vh(t,r){r=or(Gm*Et(r));var s=r*r,a=s*s*s;return[t*Lt(r)/(Gm*(1.340264+3*-.081106*s+a*(7*893e-6+.034164*s))),r*(1.340264+-.081106*s+a*(893e-6+.003796*s))]}function Qc(t,r){var s=Lt(r),a=Lt(t)*s;return[s*Et(t)/a,Et(r)/a]}function us(t,r,s,a){return t===1&&r===1&&s===0&&a===0?ss:Po({point:function(u,d){this.stream.point(u*t+s,d*r+a)}})}function ba(t,r){var s=r*r,a=s*s;return[t*(.8707-.131979*s+a*(-.013791+a*(.003971*s-.001529*a))),r*(1.007226+s*(.015085+a*(-.044475+.028874*s-.005916*a)))]}function to(t,r){return[Lt(r)*Et(t),Et(r)]}function Kc(t,r){var s=Lt(r),a=1+Lt(t)*s;return[s*Et(t)/a,Et(r)/a]}function Wh(t,r){return[xm(Ou((En+r)/2)),-t]}function eu(t,r){return t.parent===r.parent?1:2}function hs(t,r){return t+r.x}function vp(t,r){return Math.max(t,r.y)}function yp(t){for(var r;r=t.children;)t=r[0];return t}function tu(t){for(var r;r=t.children;)t=r[r.length-1];return t}function Nl(t){var r=0,s=t.children,a=s&&s.length;if(a)for(;0<=--a;)r+=s[a].value;else r=1;t.value=r}function Rl(t,r){var s=new ds(t);t=+t.value&&(s.value=t.value);var a,u=[s],d,m,v,y;for(r==null&&(r=Yn);a=u.pop();)if(t&&(a.value=+a.data.value),(m=r(a.data))&&(y=m.length))for(a.children=Array(y),v=y-1;0<=v;--v)u.push(d=a.children[v]=new ds(m[v])),d.parent=a,d.depth=a.depth+1;return s.eachBefore(jh)}function Yn(t){return t.children}function xp(t){t.data=t.data.data}function jh(t){var r=0;do t.height=r;while((t=t.parent)&&t.height<++r)}function ds(t){this.data=t,this.depth=this.height=0,this.parent=null}function nu(t){var r=0;t=Vy.call(t);for(var s=t.length,a,u;s;)u=Math.random()*s--|0,a=t[s],t[s]=t[u],t[u]=a;s=t.length,a=[];for(var d;r<s;)if(u=t[r],d&&Ci(d,u))++r;else{e:if(r=a,ru(u,r))r=[u];else{for(a=0;a<r.length;++a)if(fs(u,r[a])&&ru(Ma(r[a],u),r)){r=[r[a],u];break e}for(a=0;a<r.length-1;++a)for(d=a+1;d<r.length;++d)if(fs(Ma(r[a],r[d]),u)&&fs(Ma(r[a],u),r[d])&&fs(Ma(r[d],u),r[a])&&ru(hr(r[a],r[d],u),r)){r=[r[a],r[d],u];break e}throw Error()}e:{switch(r=a=r,r.length){case 1:r=r[0],r={x:r.x,y:r.y,r:r.r};break e;case 2:r=Ma(r[0],r[1]);break e;case 3:r=hr(r[0],r[1],r[2]);break e}r=void 0}d=r,r=0}return d}function fs(t,r){var s=t.r-r.r,a=r.x-t.x;return t=r.y-t.y,0>s||s*s<a*a+t*t}function Ci(t,r){var s=t.r-r.r+1e-6,a=r.x-t.x;return t=r.y-t.y,0<s&&s*s>a*a+t*t}function ru(t,r){for(var s=0;s<r.length;++s)if(!Ci(t,r[s]))return!1;return!0}function Ma(t,r){var s=t.x,a=t.y;t=t.r;var u=r.x,d=r.y;r=r.r;var m=u-s,v=d-a,y=r-t,b=Math.sqrt(m*m+v*v);return{x:(s+u+m/b*y)/2,y:(a+d+v/b*y)/2,r:(b+t+r)/2}}function hr(t,r,s){var a=t.x,u=t.y;t=t.r;var d=r.x,m=r.y,v=r.r,y=s.x,b=s.y,w=s.r;s=a-d,r=a-y;var A=u-m,E=u-b,P=v-t,C=w-t,B=a*a+u*u-t*t;return m=B-d*d-m*m+v*v,b=B-y*y-b*b+w*w,y=r*A-s*E,d=(A*b-E*m)/(2*y)-a,A=(E*P-A*C)/y,E=(r*m-s*b)/(2*y)-u,s=(s*C-r*P)/y,r=A*A+s*s-1,P=2*(t+d*A+E*s),t=d*d+E*E-t*t,t=-(r?(P+Math.sqrt(P*P-4*r*t))/(2*r):t/P),{x:a+d+A*t,y:u+E+s*t,r:t}}function iu(t,r,s){var a=t.x-r.x,u=t.y-r.y,d=a*a+u*u;if(d){var m=r.r+s.r;m*=m;var v=t.r+s.r;if(v*=v,m>v){var y=(d+v-m)/(2*d);m=Math.sqrt(Math.max(0,v/d-y*y)),s.x=t.x-y*a-m*u,s.y=t.y-y*u+m*a}else y=(d+m-v)/(2*d),m=Math.sqrt(Math.max(0,m/d-y*y)),s.x=r.x+y*a-m*u,s.y=r.y+y*u+m*a}else s.x=r.x+s.r,s.y=r.y}function Do(t,r){var s=t.r+r.r-1e-6,a=r.x-t.x;return t=r.y-t.y,0<s&&s*s>a*a+t*t}function Yh(t){var r=t._,s=t.next._,a=r.r+s.r;return t=(r.x*s.r+s.x*r.r)/a,r=(r.y*s.r+s.y*r.r)/a,t*t+r*r}function wa(t){this._=t,this.previous=this.next=null}function Ll(t){if(!(s=t.length))return 0;var r,s,a=t[0];if(a.x=0,a.y=0,!(1<s))return a.r;var u=t[1];if(a.x=-u.r,u.x=a.r,u.y=0,!(2<s))return a.r+u.r;iu(u,a,r=t[2]),a=new wa(a),u=new wa(u),r=new wa(r),a.next=r.previous=u,u.next=a.previous=r,r.next=u.previous=a;var d=3;e:for(;d<s;++d){iu(a._,u._,r=t[d]),r=new wa(r);var m=u.next,v=a.previous,y=u._.r,b=a._.r;do if(y<=b){if(Do(m._,r._)){u=m,a.next=u,u.previous=a,--d;continue e}y+=m._.r,m=m.next}else{if(Do(v._,r._)){a=v,a.next=u,u.previous=a,--d;continue e}b+=v._.r,v=v.previous}while(m!==v.next);for(r.previous=a,r.next=u,a.next=u.previous=u=r,m=Yh(a);(r=r.next)!==u;)(v=Yh(r))<m&&(a=r,m=v);u=a.next}for(a=[u._],r=u;(r=r.next)!==u;)a.push(r._);for(r=nu(a),d=0;d<s;++d)a=t[d],a.x-=r.x,a.y-=r.y;return r.r}function ps(t){if(typeof t!="function")throw Error();return t}function ui(){return 0}function ms(t){return function(){return t}}function _p(t){return Math.sqrt(t.value)}function ou(t){return function(r){r.children||(r.r=Math.max(0,+t(r)||0))}}function su(t,r){return function(s){if(a=s.children){var a,u,d=a.length,m=t(s)*r||0;if(m)for(u=0;u<d;++u)a[u].r+=m;var v=Ll(a);if(m)for(u=0;u<d;++u)a[u].r-=m;s.r=v+m}}}function qh(t){return function(r){var s=r.parent;r.r*=t,s&&(r.x=s.x+t*r.x,r.y=s.y+t*r.y)}}function gs(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function qr(t,r,s,a,u){var d=t.children,m=-1,v=d.length;for(a=t.value&&(a-r)/t.value;++m<v;)t=d[m],t.y0=s,t.y1=u,t.x0=r,t.x1=r+=t.value*a}function Ea(t){return t.id}function Ii(t){return t.parentId}function Sa(t,r){return t.parent===r.parent?1:2}function Ta(t){var r=t.children;return r?r[0]:t.t}function Aa(t){var r=t.children;return r?r[r.length-1]:t.t}function Na(t,r){this._=t,this.A=this.children=this.parent=null,this.a=this,this.s=this.c=this.m=this.z=0,this.t=null,this.i=r}function au(t){t=new Na(t,0);for(var r,s=[t],a,u,d;r=s.pop();)if(u=r._.children)for(r.children=Array(a=u.length),d=a-1;0<=d;--d)s.push(a=r.children[d]=new Na(u[d],d)),a.parent=r;return(t.parent=new Na(null,0)).children=[t],t}function Ra(t,r,s,a,u){var d=t.children,m=-1,v=d.length;for(u=t.value&&(u-s)/t.value;++m<v;)t=d[m],t.x0=r,t.x1=a,t.y0=s,t.y1=s+=t.value*u}function vr(t,r,s,a,u,d){for(var m=[],v=r.children,y,b,w=y=0,A=v.length,E,P=r.value,C,B,ee,Y,ce,ue;y<A;){r=u-s,E=d-a;do C=v[w++].value;while(!C&&w<A);for(B=ee=C,ue=Math.max(E/r,r/E)/(P*t),Y=C*C*ue,ce=Math.max(ee/Y,Y/B);w<A;++w){if(C+=b=v[w].value,b<B&&(B=b),b>ee&&(ee=b),Y=C*C*ue,Y=Math.max(ee/Y,Y/B),Y>ce){C-=b;break}ce=Y}m.push(y={value:C,dice:r<E,children:v.slice(y,w)}),y.dice?qr(y,s,a,u,P?a+=E*C/P:d):Ra(y,s,a,P?s+=r*C/P:u,d),P-=C,y=w}return m}function Pl(t,r,s){return(r[0]-t[0])*(s[1]-t[1])-(r[1]-t[1])*(s[0]-t[0])}function Xh(t,r){return t[0]-r[0]||t[1]-r[1]}function lu(t){for(var r=t.length,s=[0,1],a=2,u=2;u<r;++u){for(;1<a&&0>=Pl(t[s[a-2]],t[s[a-1]],t[u]);)--a;s[a++]=u}return s.slice(0,a)}function no(){return Math.random()}function Cl(t){function r(d){var m=d+"",v=s.get(m);if(!v){if(u!==i0)return u;s.set(m,v=a.push(d))}return t[(v-1)%t.length]}var s=dt(),a=[],u=i0;return t=t==null?[]:el.call(t),r.domain=function(d){if(!arguments.length)return a.slice();a=[],s=dt();for(var m=-1,v=d.length,y,b;++m<v;)s.has(b=(y=d[m])+"")||s.set(b,a.push(y));return r},r.range=function(d){return arguments.length?(t=el.call(d),r):t.slice()},r.unknown=function(d){return arguments.length?(u=d,r):u},r.copy=function(){return Cl().domain(a).range(t).unknown(u)},r}function Il(){function t(){var A=s().length,E=u[1]<u[0],P=u[E-0],C=u[1-E];return d=(C-P)/Math.max(1,A-y+2*b),v&&(d=Math.floor(d)),P+=(C-P-d*(A-y))*w,m=d*(1-y),v&&(P=Math.round(P),m=Math.round(m)),A=H(A).map(function(B){return P+d*B}),a(E?A.reverse():A)}var r=Cl().unknown(void 0),s=r.domain,a=r.range,u=[0,1],d,m,v=!1,y=0,b=0,w=.5;return delete r.unknown,r.domain=function(A){return arguments.length?(s(A),t()):s()},r.range=function(A){return arguments.length?(u=[+A[0],+A[1]],t()):u.slice()},r.rangeRound=function(A){return u=[+A[0],+A[1]],v=!0,t()},r.bandwidth=function(){return m},r.step=function(){return d},r.round=function(A){return arguments.length?(v=!!A,t()):v},r.padding=function(A){return arguments.length?(y=b=Math.max(0,Math.min(1,A)),t()):y},r.paddingInner=function(A){return arguments.length?(y=Math.max(0,Math.min(1,A)),t()):y},r.paddingOuter=function(A){return arguments.length?(b=Math.max(0,Math.min(1,A)),t()):b},r.align=function(A){return arguments.length?(w=Math.max(0,Math.min(1,A)),t()):w},r.copy=function(){return Il().domain(s()).range(u).round(v).paddingInner(y).paddingOuter(b).align(w)},t()}function cu(t){var r=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return cu(r())},t}function Dl(t){return function(){return t}}function Jh(t){return+t}function vs(t,r){return(r-=t=+t)?function(s){return(s-t)/r}:Dl(r)}function Ol(t){return function(r,s){var a=t(r=+r,s=+s);return function(u){return u<=r?0:u>=s?1:a(u)}}}function uu(t){return function(r,s){var a=t(r=+r,s=+s);return function(u){return 0>=u?r:1<=u?s:a(u)}}}function Zh(t,r,s,a){var u=t[0];t=t[1];var d=r[0];return r=r[1],t<u?(u=s(t,u),d=a(r,d)):(u=s(u,t),d=a(d,r)),function(m){return d(u(m))}}function Gl(t,r,s,a){var u=Math.min(t.length,r.length)-1,d=Array(u),m=Array(u),v=-1;for(t[u]<t[0]&&(t=t.slice().reverse(),r=r.slice().reverse());++v<u;)d[v]=s(t[v],t[v+1]),m[v]=a(r[v],r[v+1]);return function(y){var b=p(t,y,1,u)-1;return m[b](d[b](y))}}function Bl(t,r){return r.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp())}function ys(t,r){function s(){return y=2<Math.min(u.length,d.length)?Gl:Zh,b=w=null,a}function a(A){return(b||(b=y(u,d,v?Ol(t):t,m)))(+A)}var u=cv,d=cv,m=Ri,v=!1,y,b,w;return a.invert=function(A){return(w||(w=y(d,u,vs,v?uu(r):r)))(+A)},a.domain=function(A){return arguments.length?(u=r0.call(A,Jh),s()):u.slice()},a.range=function(A){return arguments.length?(d=el.call(A),s()):d.slice()},a.rangeRound=function(A){return d=el.call(A),m=rh,s()},a.clamp=function(A){return arguments.length?(v=!!A,s()):v},a.interpolate=function(A){return arguments.length?(m=A,s()):m},s()}function ro(t){var r=t.domain;return t.ticks=function(s){var a=r();return k(a[0],a[a.length-1],s??10)},t.tickFormat=function(s,a){var u;e:{var d=r(),m=d[0];switch(d=d[d.length-1],s=X(m,d,s??10),a=sa(a??",f"),a.type){case"s":m=Math.max(Math.abs(m),Math.abs(d)),a.precision!=null||isNaN(u=wh(s,m))||(a.precision=u),u=R.formatPrefix(a,m);break e;case"":case"e":case"g":case"p":case"r":a.precision!=null||isNaN(u=Eh(s,Math.max(Math.abs(m),Math.abs(d))))||(a.precision=u-(a.type==="e"));break;case"f":case"%":a.precision!=null||isNaN(u=Mh(s))||(a.precision=u-2*(a.type==="%"))}u=R.format(a)}return u},t.nice=function(s){s==null&&(s=10);var a=r(),u=0,d=a.length-1,m=a[u],v=a[d];if(v<m){var y=m;m=v,v=y,y=u,u=d,d=y}return y=$(m,v,s),0<y?(m=Math.floor(m/y)*y,v=Math.ceil(v/y)*y,y=$(m,v,s)):0>y&&(m=Math.ceil(m*y)/y,v=Math.floor(v*y)/y,y=$(m,v,s)),0<y?(a[u]=Math.floor(m/y)*y,a[d]=Math.ceil(v/y)*y,r(a)):0>y&&(a[u]=Math.ceil(m*y)/y,a[d]=Math.floor(v*y)/y,r(a)),t},t}function Ul(){var t=ys(vs,bn);return t.copy=function(){return Bl(t,Ul())},ro(t)}function hu(){function t(s){return+s}var r=[0,1];return t.invert=t,t.domain=t.range=function(s){return arguments.length?(r=r0.call(s,Jh),t):r.slice()},t.copy=function(){return hu().domain(r)},ro(t)}function $h(t,r){t=t.slice();var s=0,a=t.length-1,u=t[s],d=t[a];if(d<u){var m=s;s=a,a=m,m=u,u=d,d=m}return t[s]=r.floor(u),t[a]=r.ceil(d),t}function kl(t,r){return(r=Math.log(r/t))?function(s){return Math.log(s/t)/r}:Dl(r)}function Di(t,r){return 0>t?function(s){return-Math.pow(-r,s)*Math.pow(-t,1-s)}:function(s){return Math.pow(r,s)*Math.pow(t,1-s)}}function Ag(t){return isFinite(t)?+("1e"+t):0>t?0:t}function Qh(t){return t===10?Ag:t===Math.E?Math.exp:function(r){return Math.pow(t,r)}}function io(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),function(r){return Math.log(r)/t})}function La(t){return function(r){return-t(-r)}}function bp(){function t(){return u=io(a),d=Qh(a),0>s()[0]&&(u=La(u),d=La(d)),r}var r=ys(kl,Di).domain([1,10]),s=r.domain,a=10,u=io(10),d=Qh(10);return r.base=function(m){return arguments.length?(a=+m,t()):a},r.domain=function(m){return arguments.length?(s(m),t()):s()},r.ticks=function(m){var v=s(),y=v[0];v=v[v.length-1];var b;(b=v<y)&&(w=y,y=v,v=w);var w=u(y),A=u(v),E=m==null?10:+m;if(m=[],!(a%1)&&A-w<E){if(w=Math.round(w)-1,A=Math.round(A)+1,0<y)for(;w<A;++w){var P=1;for(E=d(w);P<a;++P){var C=E*P;if(!(C<y)){if(C>v)break;m.push(C)}}}else for(;w<A;++w)for(P=a-1,E=d(w);1<=P;--P)if(C=E*P,!(C<y)){if(C>v)break;m.push(C)}}else m=k(w,A,Math.min(A-w,E)).map(d);return b?m.reverse():m},r.tickFormat=function(m,v){if(v==null&&(v=a===10?".0e":","),typeof v!="function"&&(v=R.format(v)),m===1/0)return v;m==null&&(m=10);var y=Math.max(1,a*m/r.ticks().length);return function(b){var w=b/d(Math.round(u(b)));return w*a<a-.5&&(w*=a),w<=y?v(b):""}},r.nice=function(){return s($h(s(),{floor:function(m){return d(Math.floor(u(m)))},ceil:function(m){return d(Math.ceil(u(m)))}}))},r.copy=function(){return Bl(r,bp().base(a))},r}function Pa(t,r){return 0>t?-Math.pow(-t,r):Math.pow(t,r)}function Kh(){var t=1,r=ys(function(a,u){return(u=Pa(u,t)-(a=Pa(a,t)))?function(d){return(Pa(d,t)-a)/u}:Dl(u)},function(a,u){return u=Pa(u,t)-(a=Pa(a,t)),function(d){return Pa(a+u*d,1/t)}}),s=r.domain;return r.exponent=function(a){return arguments.length?(t=+a,s(s())):t},r.copy=function(){return Bl(r,Kh().exponent(t))},ro(r)}function Mp(){function t(){var d=0,m=Math.max(1,a.length);for(u=Array(m-1);++d<m;)u[d-1]=j(s,d/m);return r}function r(d){if(!isNaN(d=+d))return a[p(u,d)]}var s=[],a=[],u=[];return r.invertExtent=function(d){return d=a.indexOf(d),0>d?[NaN,NaN]:[0<d?u[d-1]:s[0],d<u.length?u[d]:s[s.length-1]]},r.domain=function(d){if(!arguments.length)return s.slice();s=[];for(var m=0,v=d.length,y;m<v;++m)y=d[m],y==null||isNaN(y=+y)||s.push(y);return s.sort(G),t()},r.range=function(d){return arguments.length?(a=el.call(d),t()):a.slice()},r.quantiles=function(){return u.slice()},r.copy=function(){return Mp().domain(s).range(a)},r}function wp(){function t(v){if(v<=v)return m[p(d,v,0,u)]}function r(){var v=-1;for(d=Array(u);++v<u;)d[v]=((v+1)*a-(v-u)*s)/(u+1);return t}var s=0,a=1,u=1,d=[.5],m=[0,1];return t.domain=function(v){return arguments.length?(s=+v[0],a=+v[1],r()):[s,a]},t.range=function(v){return arguments.length?(u=(m=el.call(v)).length-1,r()):m.slice()},t.invertExtent=function(v){return v=m.indexOf(v),0>v?[NaN,NaN]:1>v?[s,d[0]]:v>=u?[d[u-1],a]:[d[v-1],d[v]]},t.copy=function(){return wp().domain([s,a]).range(m)},ro(t)}function Ep(){function t(u){if(u<=u)return s[p(r,u,0,a)]}var r=[.5],s=[0,1],a=1;return t.domain=function(u){return arguments.length?(r=el.call(u),a=Math.min(r.length,s.length-1),t):r.slice()},t.range=function(u){return arguments.length?(s=el.call(u),a=Math.min(r.length,s.length-1),t):s.slice()},t.invertExtent=function(u){return u=s.indexOf(u),[r[u-1],r[u]]},t.copy=function(){return Ep().domain(r).range(s)},t}function Un(t,r,s,a){function u(d){return t(d=new Date(+d)),d}return u.floor=u,u.ceil=function(d){return t(d=new Date(d-1)),r(d,1),t(d),d},u.round=function(d){var m=u(d),v=u.ceil(d);return d-m<v-d?m:v},u.offset=function(d,m){return r(d=new Date(+d),m==null?1:Math.floor(m)),d},u.range=function(d,m,v){var y=[],b;if(d=u.ceil(d),v=v==null?1:Math.floor(v),!(d<m&&0<v))return y;do y.push(b=new Date(+d)),r(d,v),t(d);while(b<d&&d<m);return y},u.filter=function(d){return Un(function(m){if(m>=m)for(;t(m),!d(m);)m.setTime(m-1)},function(m,v){if(m>=m)if(0>v)for(;0>=++v;)for(;r(m,-1),!d(m););else for(;0<=--v;)for(;r(m,1),!d(m););})},s&&(u.count=function(d,m){return o0.setTime(+d),s0.setTime(+m),t(o0),t(s0),Math.floor(s(o0,s0))},u.every=function(d){return d=Math.floor(d),isFinite(d)&&0<d?1<d?u.filter(a?function(m){return a(m)%d===0}:function(m){return u.count(0,m)%d===0}):u:null}),u}function oo(t){return Un(function(r){r.setDate(r.getDate()-(r.getDay()+7-t)%7),r.setHours(0,0,0,0)},function(r,s){r.setDate(r.getDate()+7*s)},function(r,s){return(s-r-6e4*(s.getTimezoneOffset()-r.getTimezoneOffset()))/6048e5})}function xs(t){return Un(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-t)%7),r.setUTCHours(0,0,0,0)},function(r,s){r.setUTCDate(r.getUTCDate()+7*s)},function(r,s){return(s-r)/6048e5})}function Ca(t){if(0<=t.y&&100>t.y){var r=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return r.setFullYear(t.y),r}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function du(t){if(0<=t.y&&100>t.y){var r=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return r.setUTCFullYear(t.y),r}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function fn(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function Fl(t){function r(ye,be){return function(Z){var fe=[],Ae=-1,et=0,mt=ye.length,ht,It;for(Z instanceof Date||(Z=new Date(+Z));++Ae<mt;)ye.charCodeAt(Ae)===37&&(fe.push(ye.slice(et,Ae)),(et=Mv[ht=ye.charAt(++Ae)])!=null?ht=ye.charAt(++Ae):et=ht==="e"?" ":"0",(It=be[ht])&&(ht=It(Z,et)),fe.push(ht),et=Ae+1);return fe.push(ye.slice(et,Ae)),fe.join("")}}function s(ye,be){return function(Z){var fe=fn(1900);if(a(fe,ye,Z+="",0)!=Z.length)return null;if("Q"in fe)return new Date(fe.Q);if("p"in fe&&(fe.H=fe.H%12+12*fe.p),"V"in fe){if(1>fe.V||53<fe.V)return null;if("w"in fe||(fe.w=1),"Z"in fe){Z=du(fn(fe.y));var Ae=Z.getUTCDay();Z=4<Ae||Ae===0?sf.ceil(Z):sf(Z),Z=rf.offset(Z,7*(fe.V-1)),fe.y=Z.getUTCFullYear(),fe.m=Z.getUTCMonth(),fe.d=Z.getUTCDate()+(fe.w+6)%7}else Z=be(fn(fe.y)),Ae=Z.getDay(),Z=4<Ae||Ae===0?tf.ceil(Z):tf(Z),Z=Kd.offset(Z,7*(fe.V-1)),fe.y=Z.getFullYear(),fe.m=Z.getMonth(),fe.d=Z.getDate()+(fe.w+6)%7}else("W"in fe||"U"in fe)&&("w"in fe||(fe.w="u"in fe?fe.u%7:"W"in fe?1:0),Ae="Z"in fe?du(fn(fe.y)).getUTCDay():be(fn(fe.y)).getDay(),fe.m=0,fe.d="W"in fe?(fe.w+6)%7+7*fe.W-(Ae+5)%7:fe.w+7*fe.U-(Ae+6)%7);return"Z"in fe?(fe.H+=fe.Z/100|0,fe.M+=fe.Z%100,du(fe)):be(fe)}}function a(ye,be,Z,fe){for(var Ae=0,et=be.length,mt=Z.length,ht;Ae<et;){if(fe>=mt)return-1;if(ht=be.charCodeAt(Ae++),ht===37){if(ht=be.charAt(Ae++),ht=Ce[ht in Mv?be.charAt(Ae++):ht],!ht||0>(fe=ht(ye,Z,fe)))return-1}else if(ht!=Z.charCodeAt(fe++))return-1}return fe}var u=t.dateTime,d=t.date,m=t.time,v=t.periods,y=t.days,b=t.shortDays,w=t.months,A=t.shortMonths,E=Oo(v),P=so(v),C=Oo(y),B=so(y),ee=Oo(b),Y=so(b),ce=Oo(w),ue=so(w),pe=Oo(A),Pe=so(A),Oe={a:function(ye){return b[ye.getDay()]},A:function(ye){return y[ye.getDay()]},b:function(ye){return A[ye.getMonth()]},B:function(ye){return w[ye.getMonth()]},c:null,d:pu,e:pu,f:nd,H:Rp,I:Lp,j:td,L:Hl,m:rd,M:id,p:function(ye){return v[+(12<=ye.getHours())]},Q:fd,s:pd,S:od,u:sd,U:ad,V:ld,w:Rg,W:gn,x:null,X:null,y:ao,Y:Pp,Z:cd,"%":za},xe={a:function(ye){return b[ye.getUTCDay()]},A:function(ye){return y[ye.getUTCDay()]},b:function(ye){return A[ye.getUTCMonth()]},B:function(ye){return w[ye.getUTCMonth()]},c:null,d:ud,e:ud,f:Cp,H:hi,I:ws,j:hd,L:ka,m:Fa,M:Es,p:function(ye){return v[+(12<=ye.getUTCHours())]},Q:fd,s:pd,S:Vl,u:Wl,U:Lg,V:Ss,w:dd,W:Ip,x:null,X:null,y:dr,Y:lo,Z:Bi,"%":za},Ce={a:function(ye,be,Z){return(be=ee.exec(be.slice(Z)))?(ye.w=Y[be[0].toLowerCase()],Z+be[0].length):-1},A:function(ye,be,Z){return(be=C.exec(be.slice(Z)))?(ye.w=B[be[0].toLowerCase()],Z+be[0].length):-1},b:function(ye,be,Z){return(be=pe.exec(be.slice(Z)))?(ye.m=Pe[be[0].toLowerCase()],Z+be[0].length):-1},B:function(ye,be,Z){return(be=ce.exec(be.slice(Z)))?(ye.m=ue[be[0].toLowerCase()],Z+be[0].length):-1},c:function(ye,be,Z){return a(ye,u,be,Z)},d:_s,e:_s,f:Oa,H:Go,I:Go,j:Ia,L:Ms,m:Ng,M:Da,p:function(ye,be,Z){return(be=E.exec(be.slice(Z)))?(ye.p=P[be[0].toLowerCase()],Z+be[0].length):-1},Q:Ba,s:Ua,S:bs,u:Tp,U:zl,V:ed,w:Sp,W:Oi,x:function(ye,be,Z){return a(ye,d,be,Z)},X:function(ye,be,Z){return a(ye,m,be,Z)},y:Np,Y:Ap,Z:Gi,"%":Ga};return Oe.x=r(d,Oe),Oe.X=r(m,Oe),Oe.c=r(u,Oe),xe.x=r(d,xe),xe.X=r(m,xe),xe.c=r(u,xe),{format:function(ye){var be=r(ye+="",Oe);return be.toString=function(){return ye},be},parse:function(ye){var be=s(ye+="",Ca);return be.toString=function(){return ye},be},utcFormat:function(ye){var be=r(ye+="",xe);return be.toString=function(){return ye},be},utcParse:function(ye){var be=s(ye,du);return be.toString=function(){return ye},be}}}function an(t,r,s){var a=0>t?"-":"";t=(a?-t:t)+"";var u=t.length;return a+(u<s?Array(s-u+1).join(r)+t:t)}function fu(t){return t.replace(x1,"\\$&")}function Oo(t){return new RegExp("^(?:"+t.map(fu).join("|")+")","i")}function so(t){for(var r={},s=-1,a=t.length;++s<a;)r[t[s].toLowerCase()]=s;return r}function Sp(t,r,s){return(r=fr.exec(r.slice(s,s+1)))?(t.w=+r[0],s+r[0].length):-1}function Tp(t,r,s){return(r=fr.exec(r.slice(s,s+1)))?(t.u=+r[0],s+r[0].length):-1}function zl(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.U=+r[0],s+r[0].length):-1}function ed(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.V=+r[0],s+r[0].length):-1}function Oi(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.W=+r[0],s+r[0].length):-1}function Ap(t,r,s){return(r=fr.exec(r.slice(s,s+4)))?(t.y=+r[0],s+r[0].length):-1}function Np(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.y=+r[0]+(68<+r[0]?1900:2e3),s+r[0].length):-1}function Gi(t,r,s){return(r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(s,s+6)))?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),s+r[0].length):-1}function Ng(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.m=r[0]-1,s+r[0].length):-1}function _s(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.d=+r[0],s+r[0].length):-1}function Ia(t,r,s){return(r=fr.exec(r.slice(s,s+3)))?(t.m=0,t.d=+r[0],s+r[0].length):-1}function Go(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.H=+r[0],s+r[0].length):-1}function Da(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.M=+r[0],s+r[0].length):-1}function bs(t,r,s){return(r=fr.exec(r.slice(s,s+2)))?(t.S=+r[0],s+r[0].length):-1}function Ms(t,r,s){return(r=fr.exec(r.slice(s,s+3)))?(t.L=+r[0],s+r[0].length):-1}function Oa(t,r,s){return(r=fr.exec(r.slice(s,s+6)))?(t.L=Math.floor(r[0]/1e3),s+r[0].length):-1}function Ga(t,r,s){return(t=y1.exec(r.slice(s,s+1)))?s+t[0].length:-1}function Ba(t,r,s){return(r=fr.exec(r.slice(s)))?(t.Q=+r[0],s+r[0].length):-1}function Ua(t,r,s){return(r=fr.exec(r.slice(s)))?(t.Q=1e3*+r[0],s+r[0].length):-1}function pu(t,r){return an(t.getDate(),r,2)}function Rp(t,r){return an(t.getHours(),r,2)}function Lp(t,r){return an(t.getHours()%12||12,r,2)}function td(t,r){return an(1+Kd.count(Us(t),t),r,3)}function Hl(t,r){return an(t.getMilliseconds(),r,3)}function nd(t,r){return Hl(t,r)+"000"}function rd(t,r){return an(t.getMonth()+1,r,2)}function id(t,r){return an(t.getMinutes(),r,2)}function od(t,r){return an(t.getSeconds(),r,2)}function sd(t){return t=t.getDay(),t===0?7:t}function ad(t,r){return an(ef.count(Us(t),t),r,2)}function ld(t,r){var s=t.getDay();return t=4<=s||s===0?nf(t):nf.ceil(t),an(nf.count(Us(t),t)+(Us(t).getDay()===4),r,2)}function Rg(t){return t.getDay()}function gn(t,r){return an(tf.count(Us(t),t),r,2)}function ao(t,r){return an(t.getFullYear()%100,r,2)}function Pp(t,r){return an(t.getFullYear()%1e4,r,4)}function cd(t){return t=t.getTimezoneOffset(),(0<t?"-":(t*=-1,"+"))+an(t/60|0,"0",2)+an(t%60,"0",2)}function ud(t,r){return an(t.getUTCDate(),r,2)}function hi(t,r){return an(t.getUTCHours(),r,2)}function ws(t,r){return an(t.getUTCHours()%12||12,r,2)}function hd(t,r){return an(1+rf.count(ks(t),t),r,3)}function ka(t,r){return an(t.getUTCMilliseconds(),r,3)}function Cp(t,r){return ka(t,r)+"000"}function Fa(t,r){return an(t.getUTCMonth()+1,r,2)}function Es(t,r){return an(t.getUTCMinutes(),r,2)}function Vl(t,r){return an(t.getUTCSeconds(),r,2)}function Wl(t){return t=t.getUTCDay(),t===0?7:t}function Lg(t,r){return an(of.count(ks(t),t),r,2)}function Ss(t,r){var s=t.getUTCDay();return t=4<=s||s===0?af(t):af.ceil(t),an(af.count(ks(t),t)+(ks(t).getUTCDay()===4),r,2)}function dd(t){return t.getUTCDay()}function Ip(t,r){return an(sf.count(ks(t),t),r,2)}function dr(t,r){return an(t.getUTCFullYear()%100,r,2)}function lo(t,r){return an(t.getUTCFullYear()%1e4,r,4)}function Bi(){return"+0000"}function za(){return"%"}function fd(t){return+t}function pd(t){return Math.floor(+t/1e3)}function md(t){return Fu=Fl(t),R.timeFormat=Fu.format,R.timeParse=Fu.parse,R.utcFormat=Fu.utcFormat,R.utcParse=Fu.utcParse,Fu}function di(t){return t.toISOString()}function gd(t){return t=new Date(t),isNaN(t)?null:t}function Dp(t){return new Date(t)}function Op(t){return t instanceof Date?+t:+new Date(+t)}function mu(t,r,s,a,u,d,m,v,y){function b(xe){return(m(xe)<xe?C:d(xe)<xe?B:u(xe)<xe?ee:a(xe)<xe?Y:r(xe)<xe?s(xe)<xe?ce:ue:t(xe)<xe?pe:Pe)(xe)}function w(xe,Ce,ye,be){if(xe==null&&(xe=10),typeof xe=="number"){be=Math.abs(ye-Ce)/xe;var Z=ae(function(fe){return fe[2]}).right(Oe,be);Z===Oe.length?(be=X(Ce/31536e6,ye/31536e6,xe),xe=t):Z?(Z=Oe[be/Oe[Z-1][2]<Oe[Z][2]/be?Z-1:Z],be=Z[1],xe=Z[0]):(be=Math.max(X(Ce,ye,xe),1),xe=v)}return be==null?xe:xe.every(be)}var A=ys(vs,bn),E=A.invert,P=A.domain,C=y(".%L"),B=y(":%S"),ee=y("%I:%M"),Y=y("%I %p"),ce=y("%a %d"),ue=y("%b %d"),pe=y("%B"),Pe=y("%Y"),Oe=[[m,1,1e3],[m,5,5e3],[m,15,15e3],[m,30,3e4],[d,1,6e4],[d,5,3e5],[d,15,9e5],[d,30,18e5],[u,1,36e5],[u,3,108e5],[u,6,216e5],[u,12,432e5],[a,1,864e5],[a,2,1728e5],[s,1,6048e5],[r,1,2592e6],[r,3,7776e6],[t,1,31536e6]];return A.invert=function(xe){return new Date(E(xe))},A.domain=function(xe){return arguments.length?P(r0.call(xe,Op)):P().map(Dp)},A.ticks=function(xe,Ce){var ye=P(),be=ye[0];ye=ye[ye.length-1];var Z=ye<be;if(Z){var fe=be;be=ye,ye=fe}return fe=(fe=w(xe,be,ye,Ce))?fe.range(be,ye+1):[],Z?fe.reverse():fe},A.tickFormat=function(xe,Ce){return Ce==null?b:y(Ce)},A.nice=function(xe,Ce){var ye=P();return(xe=w(xe,ye[0],ye[ye.length-1],Ce))?P($h(ye,xe)):A},A.copy=function(){return Bl(A,mu(t,r,s,a,u,d,m,v,y))},A}function gu(t){function r(m){return m=(m-s)*u,t(d?Math.max(0,Math.min(1,m)):m)}var s=0,a=1,u=1,d=!1;return r.domain=function(m){return arguments.length?(s=+m[0],a=+m[1],u=s===a?0:1/(a-s),r):[s,a]},r.clamp=function(m){return arguments.length?(d=!!m,r):d},r.interpolator=function(m){return arguments.length?(t=m,r):t},r.copy=function(){return gu(t).domain([s,a]).clamp(d)},ro(r)}function vd(t){function r(y){var b=.5+((y=+y)-a)*(y<a?d:m);return t(v?Math.max(0,Math.min(1,b)):b)}var s=0,a=.5,u=1,d=1,m=1,v=!1;return r.domain=function(y){return arguments.length?(s=+y[0],a=+y[1],u=+y[2],d=s===a?0:.5/(a-s),m=a===u?0:.5/(u-a),r):[s,a,u]},r.clamp=function(y){return arguments.length?(v=!!y,r):v},r.interpolator=function(y){return arguments.length?(t=y,r):t},r.copy=function(){return vd(t).domain([s,a,u]).clamp(v)},ro(r)}function Ft(t){for(var r=t.length/6|0,s=Array(r),a=0;a<r;)s[a]="#"+t.slice(6*a,6*++a);return s}function un(t){return ot(t[t.length-1])}function Bo(t){var r=t.length;return function(s){return t[Math.max(0,Math.min(r-1,Math.floor(s*r)))]}}function jt(t){return function(){return t}}function yd(t){return 1<=t?km:-1>=t?-km:Math.asin(t)}function xd(t){return t.innerRadius}function Gp(t){return t.outerRadius}function _d(t){return t.startAngle}function bd(t){return t.endAngle}function Md(t){return t&&t.padAngle}function Ha(t,r,s,a,u,d,m){var v=t-s,y=r-a;m=(m?d:-d)/zu(v*v+y*y),y*=m,v*=-m;var b=t+y,w=r+v,A=s+y,E=a+v;s=(b+A)/2,a=(w+E)/2,r=A-b,t=E-w,m=r*r+t*t,d=u-d,E=b*E-A*w;var P=(0>t?-1:1)*zu(gx(0,d*d*m-E*E));return b=(E*t-r*P)/m,w=(-E*r-t*P)/m,A=(E*t+r*P)/m,r=(-E*r+t*P)/m,t=b-s,m=w-a,s=A-s,a=r-a,t*t+m*m>s*s+a*a&&(b=A,w=r),{cx:b,cy:w,x01:-y,y01:-v,x11:b*(u/d-1),y11:w*(u/d-1)}}function Va(t){this._context=t}function jl(t){return new Va(t)}function Wa(t){return t[0]}function Yl(t){return t[1]}function vu(){function t(v){var y,b=v.length,w,A=!1,E;for(u==null&&(m=d(E=Ar())),y=0;y<=b;++y)!(y<b&&a(w=v[y],y,v))===A&&((A=!A)?m.lineStart():m.lineEnd()),A&&m.point(+r(w,y,v),+s(w,y,v));if(E)return m=null,E+""||null}var r=Wa,s=Yl,a=jt(!0),u=null,d=jl,m=null;return t.x=function(v){return arguments.length?(r=typeof v=="function"?v:jt(+v),t):r},t.y=function(v){return arguments.length?(s=typeof v=="function"?v:jt(+v),t):s},t.defined=function(v){return arguments.length?(a=typeof v=="function"?v:jt(!!v),t):a},t.curve=function(v){return arguments.length?(d=v,u!=null&&(m=d(u)),t):d},t.context=function(v){return arguments.length?(v==null?u=m=null:m=d(u=v),t):u},t}function Bp(){function t(w){var A,E,P=w.length,C,B=!1,ee,Y=Array(P),ce=Array(P);for(v==null&&(b=y(ee=Ar())),A=0;A<=P;++A){if(!(A<P&&m(C=w[A],A,w))===B)if(B=!B){var ue=A;b.areaStart(),b.lineStart()}else{for(b.lineEnd(),b.lineStart(),E=A-1;E>=ue;--E)b.point(Y[E],ce[E]);b.lineEnd(),b.areaEnd()}B&&(Y[A]=+s(C,A,w),ce[A]=+u(C,A,w),b.point(a?+a(C,A,w):Y[A],d?+d(C,A,w):ce[A]))}if(ee)return b=null,ee+""||null}function r(){return vu().defined(m).curve(y).context(v)}var s=Wa,a=null,u=jt(0),d=Yl,m=jt(!0),v=null,y=jl,b=null;return t.x=function(w){return arguments.length?(s=typeof w=="function"?w:jt(+w),a=null,t):s},t.x0=function(w){return arguments.length?(s=typeof w=="function"?w:jt(+w),t):s},t.x1=function(w){return arguments.length?(a=w==null?null:typeof w=="function"?w:jt(+w),t):a},t.y=function(w){return arguments.length?(u=typeof w=="function"?w:jt(+w),d=null,t):u},t.y0=function(w){return arguments.length?(u=typeof w=="function"?w:jt(+w),t):u},t.y1=function(w){return arguments.length?(d=w==null?null:typeof w=="function"?w:jt(+w),t):d},t.lineX0=t.lineY0=function(){return r().x(s).y(u)},t.lineY1=function(){return r().x(s).y(d)},t.lineX1=function(){return r().x(a).y(u)},t.defined=function(w){return arguments.length?(m=typeof w=="function"?w:jt(!!w),t):m},t.curve=function(w){return arguments.length?(y=w,v!=null&&(b=y(v)),t):y},t.context=function(w){return arguments.length?(w==null?v=b=null:b=y(v=w),t):v},t}function Up(t,r){return r<t?-1:r>t?1:r>=t?0:NaN}function kp(t){return t}function wd(t){this._curve=t}function ja(t){function r(s){return new wd(t(s))}return r._curve=t,r}function Ts(t){var r=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(s){return arguments.length?r(ja(s)):r()._curve},t}function Ed(){return Ts(vu().curve($v))}function Sd(){var t=Bp().curve($v),r=t.curve,s=t.lineX0,a=t.lineX1,u=t.lineY0,d=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return Ts(s())},delete t.lineX0,t.lineEndAngle=function(){return Ts(a())},delete t.lineX1,t.lineInnerRadius=function(){return Ts(u())},delete t.lineY0,t.lineOuterRadius=function(){return Ts(d())},delete t.lineY1,t.curve=function(m){return arguments.length?r(ja(m)):r()._curve},t}function Ya(t,r){return[(r=+r)*Math.cos(t-=Math.PI/2),r*Math.sin(t)]}function Fp(t){return t.source}function zp(t){return t.target}function yu(t){function r(){var v,y=p0.call(arguments),b=s.apply(this,y),w=a.apply(this,y);if(m||(m=v=Ar()),t(m,+u.apply(this,(y[0]=b,y)),+d.apply(this,y),+u.apply(this,(y[0]=w,y)),+d.apply(this,y)),v)return m=null,v+""||null}var s=Fp,a=zp,u=Wa,d=Yl,m=null;return r.source=function(v){return arguments.length?(s=v,r):s},r.target=function(v){return arguments.length?(a=v,r):a},r.x=function(v){return arguments.length?(u=typeof v=="function"?v:jt(+v),r):u},r.y=function(v){return arguments.length?(d=typeof v=="function"?v:jt(+v),r):d},r.context=function(v){return arguments.length?(m=v??null,r):m},r}function Hp(t,r,s,a,u){t.moveTo(r,s),t.bezierCurveTo(r=(r+a)/2,s,r,u,a,u)}function As(t,r,s,a,u){t.moveTo(r,s),t.bezierCurveTo(r,s=(s+u)/2,a,s,a,u)}function Vp(t,r,s,a,u){var d=Ya(r,s);r=Ya(r,s=(s+u)/2),s=Ya(a,s),a=Ya(a,u),t.moveTo(d[0],d[1]),t.bezierCurveTo(r[0],r[1],s[0],s[1],a[0],a[1])}function Uo(){}function Ui(t,r,s){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+r)/6,(t._y0+4*t._y1+s)/6)}function qa(t){this._context=t}function ko(t){this._context=t}function Td(t){this._context=t}function Wp(t,r){this._basis=new qa(t),this._beta=r}function ki(t,r,s){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-r),t._y2+t._k*(t._y1-s),t._x2,t._y2)}function xu(t,r){this._context=t,this._k=(1-r)/6}function _u(t,r){this._context=t,this._k=(1-r)/6}function Ad(t,r){this._context=t,this._k=(1-r)/6}function Nd(t,r,s){var a=t._x1,u=t._y1,d=t._x2,m=t._y2;if(1e-12<t._l01_a){var v=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,y=3*t._l01_a*(t._l01_a+t._l12_a);a=(a*v-t._x0*t._l12_2a+t._x2*t._l01_2a)/y,u=(u*v-t._y0*t._l12_2a+t._y2*t._l01_2a)/y}1e-12<t._l23_a&&(v=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,y=3*t._l23_a*(t._l23_a+t._l12_a),d=(d*v+t._x1*t._l23_2a-r*t._l12_2a)/y,m=(m*v+t._y1*t._l23_2a-s*t._l12_2a)/y),t._context.bezierCurveTo(a,u,d,m,t._x2,t._y2)}function bu(t,r){this._context=t,this._alpha=r}function jp(t,r){this._context=t,this._alpha=r}function Yp(t,r){this._context=t,this._alpha=r}function qp(t){this._context=t}function Xp(t,r,s){var a=t._x1-t._x0;r-=t._x1;var u=(t._y1-t._y0)/(a||0>r&&-0);return t=(s-t._y1)/(r||0>a&&-0),((0>u?-1:1)+(0>t?-1:1))*Math.min(Math.abs(u),Math.abs(t),.5*Math.abs((u*r+t*a)/(a+r)))||0}function Jp(t,r){var s=t._x1-t._x0;return s?(3*(t._y1-t._y0)/s-r)/2:r}function Rd(t,r,s){var a=t._x0,u=t._x1,d=t._y1,m=(u-a)/3;t._context.bezierCurveTo(a+m,t._y0+m*r,u-m,d-m*s,u,d)}function Mu(t){this._context=t}function Kt(t){this._context=new Ld(t)}function Ld(t){this._context=t}function Zp(t){this._context=t}function Pd(t){var r,s=t.length-1,a=Array(s),u=Array(s),d=Array(s);for(a[0]=0,u[0]=2,d[0]=t[0]+2*t[1],r=1;r<s-1;++r)a[r]=1,u[r]=4,d[r]=4*t[r]+2*t[r+1];for(a[s-1]=2,u[s-1]=7,d[s-1]=8*t[s-1]+t[s],r=1;r<s;++r){var m=a[r]/u[r-1];u[r]-=m,d[r]-=m*d[r-1]}for(a[s-1]=d[s-1]/u[s-1],r=s-2;0<=r;--r)a[r]=(d[r]-a[r+1])/u[r];for(u[s-1]=(t[s]+a[s-1])/2,r=0;r<s-1;++r)u[r]=2*t[r+1]-a[r+1];return[a,u]}function Ns(t,r){this._context=t,this._t=r}function Rs(t,r){if(1<(m=t.length))for(var s=1,a,u,d=t[r[0]],m,v=d.length;s<m;++s)for(u=d,d=t[r[s]],a=0;a<v;++a)d[a][1]+=d[a][0]=isNaN(u[a][1])?u[a][0]:u[a][1]}function Ls(t){t=t.length;for(var r=Array(t);0<=--t;)r[t]=t;return r}function $p(t,r){return t[r]}function wu(t){var r=t.map(Cd);return Ls(t).sort(function(s,a){return r[s]-r[a]})}function Cd(t){for(var r=0,s=-1,a=t.length,u;++s<a;)(u=+t[s][1])&&(r+=u);return r}function Ps(t){return function(){return t}}function Qp(t){return t[0]}function Eu(t){return t[1]}function ql(){this._=null}function Xl(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Xr(t,r){var s=r.R,a=r.U;a?a.L===r?a.L=s:a.R=s:t._=s,s.U=a,r.U=s,r.R=s.L,r.R&&(r.R.U=r),s.L=r}function Fo(t,r){var s=r.L,a=r.U;a?a.L===r?a.L=s:a.R=s:t._=s,s.U=a,r.U=s,r.L=s.R,r.L&&(r.L.U=r),s.R=r}function Su(t){for(;t.L;)t=t.L;return t}function Xa(t,r,s,a){var u=[null,null],d=_r.push(u)-1;return u.left=t,u.right=r,s&&Tu(u,t,r,s),a&&Tu(u,r,t,a),xi[t.index].halfedges.push(d),xi[r.index].halfedges.push(d),u}function Ja(t,r,s){return r=[r,s],r.left=t,r}function Tu(t,r,s,a){t[0]||t[1]?t.left===s?t[1]=a:t[0]=a:(t[0]=a,t.left=r,t.right=s)}function Kp(t,r,s,a,u){var d=t[0],m=t[1],v=d[0];d=d[1];var y=0,b=1,w=m[0]-v;if(m=m[1]-d,r-=v,w||!(0<r)){if(r/=w,0>w){if(r<y)return;r<b&&(b=r)}else if(0<w){if(r>b)return;r>y&&(y=r)}if(r=a-v,w||!(0>r)){if(r/=w,0>w){if(r>b)return;r>y&&(y=r)}else if(0<w){if(r<y)return;r<b&&(b=r)}if(r=s-d,m||!(0<r)){if(r/=m,0>m){if(r<y)return;r<b&&(b=r)}else if(0<m){if(r>b)return;r>y&&(y=r)}if(r=u-d,m||!(0>r)){if(r/=m,0>m){if(r>b)return;r>y&&(y=r)}else if(0<m){if(r<y)return;r<b&&(b=r)}return(0<y||1>b)&&(0<y&&(t[0]=[v+y*w,d+y*m]),1>b&&(t[1]=[v+b*w,d+b*m])),!0}}}}}function em(t,r,s,a,u){var d=t[1];if(d)return!0;var m=t[0],v=t.left,y=t.right;d=v[0],v=v[1];var b=y[0];y=y[1];var w=(d+b)/2;if(y===v){if(w<r||w>=a)return;if(d>b){if(!m)m=[w,s];else if(m[1]>=u)return;d=[w,u]}else{if(!m)m=[w,u];else if(m[1]<s)return;d=[w,s]}}else{var A=(d-b)/(y-v);if(w=(v+y)/2-A*w,-1>A||1<A)if(d>b){if(!m)m=[(s-w)/A,s];else if(m[1]>=u)return;d=[(u-w)/A,u]}else{if(!m)m=[(u-w)/A,u];else if(m[1]<s)return;d=[(s-w)/A,s]}else if(v<y){if(!m)m=[r,A*r+w];else if(m[0]>=a)return;d=[a,A*a+w]}else{if(!m)m=[a,A*a+w];else if(m[0]<r)return;d=[r,A*r+w]}}return t[0]=m,t[1]=d,!0}function tm(t,r){t=t.site;var s=r.left,a=r.right;return t===a&&(a=s,s=t),a?Math.atan2(a[1]-s[1],a[0]-s[0]):(t===s?(s=r[1],a=r[0]):(s=r[0],a=r[1]),Math.atan2(s[0]-a[0],a[1]-s[1]))}function Id(t,r){return r[+(r.left!==t.site)]}function Au(){for(var t=0,r=xi.length,s,a,u,d;t<r;++t)if((s=xi[t])&&(d=(a=s.halfedges).length)){var m=Array(d),v=Array(d);for(u=0;u<d;++u)m[u]=u,v[u]=tm(s,_r[a[u]]);for(m.sort(function(y,b){return v[b]-v[y]}),u=0;u<d;++u)v[u]=a[m[u]];for(u=0;u<d;++u)a[u]=v[u]}}function nm(){Xl(this),this.x=this.y=this.arc=this.site=this.cy=null}function co(t){var r=t.P,s=t.N;if(r&&s){var a=r.site;r=t.site;var u=s.site;if(a!==u){s=r[0];var d=r[1],m=a[0]-s,v=a[1]-d;a=u[0]-s;var y=u[1]-d;if(u=2*(m*y-v*a),!(u>=-Rx)){var b=m*m+v*v,w=a*a+y*y;for(v=(y*b-v*w)/u,a=(m*w-a*b)/u,m=sy.pop()||new nm,m.arc=t,m.site=r,m.x=v+s,m.y=(m.cy=a+d)+Math.sqrt(v*v+a*a),t.circle=m,t=null,r=lf._;r;)if(m.y<r.y||m.y===r.y&&m.x<=r.x)if(r.L)r=r.L;else{t=r.P;break}else if(r.R)r=r.R;else{t=r;break}lf.insert(t,m),t||(y0=m)}}}}function pn(t){var r=t.circle;r&&(r.P||(y0=r.N),lf.remove(r),sy.push(r),Xl(r),t.circle=null)}function Nn(){Xl(this),this.edge=this.site=this.circle=null}function Jl(t){var r=ay.pop()||new Nn;return r.site=t,r}function Nu(t){pn(t),Hu.remove(t),ay.push(t),Xl(t)}function Dd(t,r){var s=t.site,a=s[0],u=s[1],d=u-r;if(!d)return a;if(t=t.P,!t)return-1/0;if(s=t.site,t=s[0],s=s[1],r=s-r,!r)return t;var m=t-a,v=1/d-1/r,y=m/r;return v?(-y+Math.sqrt(y*y-2*v*(m*m/(-2*r)-s+r/2+u-d/2)))/v+a:(a+t)/2}function Ru(t,r){return r[1]-t[1]||r[0]-t[0]}function Zl(t,r){var s=t.sort(Ru).pop(),a;for(_r=[],xi=Array(t.length),Hu=new ql,lf=new ql;;){var u=y0;if(s&&(!u||s[1]<u.y||s[1]===u.y&&s[0]<u.x)){if(s[0]!==a||s[1]!==d){var d=a=void 0;u=s;for(var m=u[0],v=u[1],y=Hu._;y;){var b=Dd(y,v)-m;if(b>mn)y=y.L;else{var w=y,A=v,E=w.N;if(E?A=Dd(E,A):(w=w.site,A=w[1]===A?w[0]:1/0),A=m-A,A>mn){if(!y.R){d=y;break}y=y.R}else{b>-mn?(d=y.P,a=y):A>-mn?(d=y,a=y.N):d=a=y;break}}}if(xi[u.index]={site:u,halfedges:[]},b=Jl(u),Hu.insert(d,b),d||a)if(d===a)pn(d),a=Jl(d.site),Hu.insert(b,a),b.edge=a.edge=Xa(d.site,b.site),co(d),co(a);else if(a){pn(d),pn(a),m=d.site,y=m[0],A=m[1],w=u[0]-y,E=u[1]-A,v=a.site;var P=v[0]-y,C=v[1]-A,B=2*(w*C-E*P),ee=w*w+E*E,Y=P*P+C*C;y=[(C*ee-E*Y)/B+y,(w*Y-P*ee)/B+A],Tu(a.edge,m,v,y),b.edge=Xa(m,u,null,y),a.edge=Xa(u,v,null,y),co(d),co(a)}else b.edge=Xa(d.site,b.site);a=s[0],d=s[1]}s=t.pop()}else if(u){for(v=u.arc,u=v.circle,m=u.x,y=u.cy,u=[m,y],w=v.P,A=v.N,b=[v],Nu(v),v=w;v.circle&&Math.abs(m-v.circle.x)<mn&&Math.abs(y-v.circle.cy)<mn;)w=v.P,b.unshift(v),Nu(v),v=w;for(b.unshift(v),pn(v),w=A;w.circle&&Math.abs(m-w.circle.x)<mn&&Math.abs(y-w.circle.cy)<mn;)A=w.N,b.push(w),Nu(w),w=A;for(b.push(w),pn(w),y=b.length,m=1;m<y;++m)w=b[m],v=b[m-1],Tu(w.edge,v.site,w.site,u);v=b[0],w=b[y-1],w.edge=Xa(v.site,w.site,null,u),co(v),co(w)}else break}if(Au(),r){a=+r[0][0],t=+r[0][1],s=+r[1][0],r=+r[1][1],d=_r.length;for(var ce;d--;)em(ce=_r[d],a,t,s,r)&&Kp(ce,a,t,s,r)&&(Math.abs(ce[0][0]-ce[1][0])>mn||Math.abs(ce[0][1]-ce[1][1])>mn)||delete _r[d];for(ce=xi.length,d=!0,u=0;u<ce;++u)if(b=xi[u]){var ue=b.site;for(v=b.halfedges,m=v.length;m--;)_r[v[m]]||v.splice(m,1);for(m=0,y=v.length;m<y;)A=_r[v[m]],w=A[+(A.left===b.site)],E=w[0],P=w[1],C=Id(b,_r[v[++m%y]]),A=C[0],C=C[1],(Math.abs(E-A)>mn||Math.abs(P-C)>mn)&&(v.splice(m,0,_r.push(Ja(ue,w,Math.abs(E-a)<mn&&r-P>mn?[a,Math.abs(A-a)<mn?C:r]:Math.abs(P-r)<mn&&s-E>mn?[Math.abs(C-r)<mn?A:s,r]:Math.abs(E-s)<mn&&P-t>mn?[s,Math.abs(A-s)<mn?C:t]:Math.abs(P-t)<mn&&E-a>mn?[Math.abs(C-t)<mn?A:a,t]:null))-1),++y);y&&(d=!1)}if(d){for(m=1/0,u=0,d=null;u<ce;++u)(b=xi[u])&&(ue=b.site,v=ue[0]-a,y=ue[1]-t,v=v*v+y*y,v<m&&(m=v,d=b));d&&(u=[a,t],a=[a,r],r=[s,r],t=[s,t],d.halfedges.push(_r.push(Ja(ue=d.site,u,a))-1,_r.push(Ja(ue,a,r))-1,_r.push(Ja(ue,r,t))-1,_r.push(Ja(ue,t,u))-1))}for(u=0;u<ce;++u)(b=xi[u])&&(b.halfedges.length||delete xi[u])}this.edges=_r,this.cells=xi,Hu=lf=_r=xi=null}function $l(t){return function(){return t}}function rm(t,r,s){this.target=t,this.type=r,this.transform=s}function uo(t,r,s){this.k=t,this.x=r,this.y=s}function im(t){return t.__zoom||Fm}function c(){R.event.preventDefault(),R.event.stopImmediatePropagation()}function e(){return!R.event.button}function n(){var t=this;if(t instanceof SVGElement){t=t.ownerSVGElement||t;var r=t.width.baseVal.value;t=t.height.baseVal.value}else r=t.clientWidth,t=t.clientHeight;return[[0,0],[r,t]]}function i(){return this.__zoom||Fm}function o(){return-R.event.deltaY*(R.event.deltaMode?120:1)/500}function l(){return"ontouchstart"in this}function h(t,r,s){var a=t.invertX(r[0][0])-s[0][0],u=t.invertX(r[1][0])-s[1][0],d=t.invertY(r[0][1])-s[0][1];return r=t.invertY(r[1][1])-s[1][1],t.translate(u>a?(a+u)/2:Math.min(0,a)||Math.max(0,u),r>d?(d+r)/2:Math.min(0,d)||Math.max(0,r))}var f=ae(G),p=f.right,g=f.left,x=Array.prototype,_=x.slice,M=x.map,T=Math.sqrt(50),N=Math.sqrt(10),I=Math.sqrt(2),D=Array.prototype.slice,L={value:function(){}};He.prototype=ke.prototype={constructor:He,on:function(t,r){var s=this._,a=Qe(t+"",s),u,d=-1,m=a.length;if(2>arguments.length)for(;++d<m;){var v;if(v=u=(t=a[d]).type){e:{v=s[u];for(var y=0,b=v.length;y<b;++y)if((u=v[y]).name===t.name){u=u.value;break e}u=void 0}v=u}if(v)return u}else{if(r!=null&&typeof r!="function")throw Error("invalid callback: "+r);for(;++d<m;)if(u=(t=a[d]).type)s[u]=gt(s[u],t.name,r);else if(r==null)for(u in s)s[u]=gt(s[u],t.name,null);return this}},copy:function(){var t={},r=this._,s;for(s in r)t[s]=r[s].slice();return new He(t)},call:function(t,r){if(0<(u=arguments.length-2))for(var s=Array(u),a=0,u,d;a<u;++a)s[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw Error("unknown type: "+t);for(d=this._[t],a=0,u=d.length;a<u;++a)d[a].value.apply(r,s)},apply:function(t,r,s){if(!this._.hasOwnProperty(t))throw Error("unknown type: "+t);t=this._[t];for(var a=0,u=t.length;a<u;++a)t[a].value.apply(r,s)}};var F={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};if(typeof document<"u"){var U=document.documentElement;if(!U.matches){var V=U.webkitMatchesSelector||U.msMatchesSelector||U.mozMatchesSelector||U.oMatchesSelector;S=function(t){return function(){return V.call(this,t)}}}}var K=S;sl.prototype={constructor:sl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,r){return this._parent.insertBefore(t,r)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},Wn.prototype={add:function(t){0>this._names.indexOf(t)&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){t=this._names.indexOf(t),0<=t&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return 0<=this._names.indexOf(t)}};var re={};R.event=null,typeof document<"u"&&("onmouseenter"in document.documentElement||(re={mouseenter:"mouseover",mouseleave:"mouseout"}));var ve=[null];J.prototype=ji.prototype={constructor:J,select:function(t){typeof t!="function"&&(t=$n(t));for(var r=this._groups,s=r.length,a=Array(s),u=0;u<s;++u)for(var d=r[u],m=d.length,v=a[u]=Array(m),y,b,w=0;w<m;++w)(y=d[w])&&(b=t.call(y,y.__data__,w,d))&&("__data__"in y&&(b.__data__=y.__data__),v[w]=b);return new J(a,this._parents)},selectAll:function(t){typeof t!="function"&&(t=ac(t));for(var r=this._groups,s=r.length,a=[],u=[],d=0;d<s;++d)for(var m=r[d],v=m.length,y,b=0;b<v;++b)(y=m[b])&&(a.push(t.call(y,y.__data__,b,m)),u.push(y));return new J(a,u)},filter:function(t){typeof t!="function"&&(t=K(t));for(var r=this._groups,s=r.length,a=Array(s),u=0;u<s;++u)for(var d=r[u],m=d.length,v=a[u]=[],y,b=0;b<m;++b)(y=d[b])&&t.call(y,y.__data__,b,d)&&v.push(y);return new J(a,this._parents)},data:function(t,r){if(!t)return P=Array(this.size()),b=-1,this.each(function(ce){P[++b]=ce}),P;var s=r?Ye:cc,a=this._parents,u=this._groups;typeof t!="function"&&(t=lc(t));for(var d=u.length,m=Array(d),v=Array(d),y=Array(d),b=0;b<d;++b){var w=a[b],A=u[b],E=A.length,P=t.call(w,w&&w.__data__,b,a),C=P.length,B=v[b]=Array(C),ee=m[b]=Array(C);E=y[b]=Array(E),s(w,A,B,ee,E,P,r),A=w=0;for(var Y;w<C;++w)if(E=B[w]){for(w>=A&&(A=w+1);!(Y=ee[A])&&++A<C;);E._next=Y||null}}return m=new J(m,a),m._enter=v,m._exit=y,m},enter:function(){return new J(this._enter||this._groups.map(Yu),this._parents)},exit:function(){return new J(this._exit||this._groups.map(Yu),this._parents)},merge:function(t){var r=this._groups;t=t._groups;for(var s=r.length,a=Math.min(s,t.length),u=Array(s),d=0;d<a;++d)for(var m=r[d],v=t[d],y=m.length,b=u[d]=Array(y),w,A=0;A<y;++A)(w=m[A]||v[A])&&(b[A]=w);for(;d<s;++d)u[d]=r[d];return new J(u,this._parents)},order:function(){for(var t=this._groups,r=-1,s=t.length;++r<s;)for(var a=t[r],u=a.length-1,d=a[u],m;0<=--u;)(m=a[u])&&(d&&d!==m.nextSibling&&d.parentNode.insertBefore(m,d),d=m);return this},sort:function(t){function r(A,E){return A&&E?t(A.__data__,E.__data__):!A-!E}t||(t=it);for(var s=this._groups,a=s.length,u=Array(a),d=0;d<a;++d){for(var m=s[d],v=m.length,y=u[d]=Array(v),b,w=0;w<v;++w)(b=m[w])&&(y[w]=b);y.sort(r)}return new J(u,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=Array(this.size()),r=-1;return this.each(function(){t[++r]=this}),t},node:function(){for(var t=this._groups,r=0,s=t.length;r<s;++r)for(var a=t[r],u=0,d=a.length;u<d;++u){var m=a[u];if(m)return m}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var r=this._groups,s=0,a=r.length;s<a;++s)for(var u=r[s],d=0,m=u.length,v;d<m;++d)(v=u[d])&&t.call(v,v.__data__,d,u);return this},attr:function(t,r){var s=bt(t);if(2>arguments.length){var a=this.node();return s.local?a.getAttributeNS(s.space,s.local):a.getAttribute(s)}return this.each((r==null?s.local?St:st:typeof r=="function"?s.local?br:yn:s.local?dn:Qt)(s,r))},style:function(t,r,s){return 1<arguments.length?this.each((r==null?Mr:typeof r=="function"?Hs:ar)(t,r,s??"")):zr(this.node(),t)},property:function(t,r){return 1<arguments.length?this.each((r==null?Qr:typeof r=="function"?qo:uc)(t,r)):this.node()[t]},classed:function(t,r){var s=(t+"").trim().split(/^|\s+/);if(2>arguments.length){for(var a=Xo(this.node()),u=-1,d=s.length;++u<d;)if(!a.contains(s[u]))return!1;return!0}return this.each((typeof r=="function"?ll:r?Qn:qu)(s,r))},text:function(t){return arguments.length?this.each(t==null?Xu:(typeof t=="function"?bf:_f)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(t==null?Mf:(typeof t=="function"?In:Ke)(t)):this.node().innerHTML},raise:function(){return this.each(wf)},lower:function(){return this.each(Zm)},append:function(t){var r=typeof t=="function"?t:Vt(t);return this.select(function(){return this.appendChild(r.apply(this,arguments))})},insert:function(t,r){var s=typeof t=="function"?t:Vt(t),a=r==null?Vs:typeof r=="function"?r:$n(r);return this.select(function(){return this.insertBefore(s.apply(this,arguments),a.apply(this,arguments)||null)})},remove:function(){return this.each(hc)},clone:function(t){return this.select(t?Ws:Ef)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,r,s){var a=Dn(t+""),u=a.length,d;if(2>arguments.length){var m=this.node().__on;if(m)for(var v=0,y=m.length,b;v<y;++v){var w=0;for(b=m[v];w<u;++w)if((d=a[w]).type===b.type&&d.name===b.name)return b.value}}else{for(m=r?on:Ju,s==null&&(s=!1),w=0;w<u;++w)this.each(m(a[w],r,s));return this}},dispatch:function(t,r){return this.each((typeof r=="function"?Kn:$u)(t,r))}};var _e=0;Kr.prototype=gr.prototype={constructor:Kr,get:function(t){for(var r=this._;!(r in t);)if(!(t=t.parentNode))return;return t[r]},set:function(t,r){return t[this._]=r},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}},$o.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Te=1/.7,Ee=/^#([0-9a-f]{3})$/,Ne=/^#([0-9a-f]{6})$/,ct=RegExp("^rgb\\(\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*\\)$"),Je=RegExp("^rgb\\(\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*\\)$"),De=RegExp("^rgba\\(\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*\\)$"),Ze=RegExp("^rgba\\(\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*\\)$"),vt=RegExp("^hsl\\(\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*\\)$"),xt=RegExp("^hsla\\(\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*,\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*\\)$"),Tt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ys(Mi,wi,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),Ys(xn,Xi,qs(Mi,{brighter:function(t){return t=t==null?Te:Math.pow(Te,t),new xn(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?.7:Math.pow(.7,t),new xn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&255>=this.r&&0<=this.g&&255>=this.g&&0<=this.b&&255>=this.b&&0<=this.opacity&&1>=this.opacity},hex:function(){return"#"+ul(this.r)+ul(this.g)+ul(this.b)},toString:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}})),Ys(Mt,ri,qs(Mi,{brighter:function(t){return t=t==null?Te:Math.pow(Te,t),new Mt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?.7:Math.pow(.7,t),new Mt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(0>this.h),r=isNaN(t)||isNaN(this.s)?0:this.s,s=this.l;return r=s+(.5>s?s:1-s)*r,s=2*s-r,new xn(yo(240<=t?t-240:t+120,s,r),yo(t,s,r),yo(120>t?t+240:t-120,s,r),this.opacity)},displayable:function(){return(0<=this.s&&1>=this.s||isNaN(this.s))&&0<=this.l&&1>=this.l&&0<=this.opacity&&1>=this.opacity}}));var Pt=Math.PI/180,Ct=180/Math.PI,nt=4/29,ie=6/29,he=3*ie*ie,Ue=ie*ie*ie;Ys(ii,pc,qs(Mi,{brighter:function(t){return new ii(this.l+18*(t??1),this.a,this.b,this.opacity)},darker:function(t){return new ii(this.l-18*(t??1),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,r=isNaN(this.a)?t:t+this.a/500,s=isNaN(this.b)?t:t-this.b/200;return r=.96422*Xs(r),t=1*Xs(t),s=.82521*Xs(s),new xn(ur(3.1338561*r-1.6168667*t-.4906146*s),ur(-.9787684*r+1.9161415*t+.033454*s),ur(.0719453*r-.2289914*t+1.4052427*s),this.opacity)}})),Ys(Hr,Ti,qs(Mi,{brighter:function(t){return new Hr(this.h,this.c,this.l+18*(t??1),this.opacity)},darker:function(t){return new Hr(this.h,this.c,this.l-18*(t??1),this.opacity)},rgb:function(){return Er(this).rgb()}}));var Be=1.78277*-.29227-.1347134789;Ys(xo,oi,qs(Mi,{brighter:function(t){return t=t==null?Te:Math.pow(Te,t),new xo(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?.7:Math.pow(.7,t),new xo(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Pt,r=+this.l,s=isNaN(this.s)?0:this.s*r*(1-r),a=Math.cos(t);return t=Math.sin(t),new xn(255*(r+s*(-.14861*a+1.78277*t)),255*(r+s*(-.29227*a+-.90649*t)),255*(r+1.97294*s*a),this.opacity)}}));var we=function t(r){function s(u,d){var m=a((u=Xi(u)).r,(d=Xi(d)).r),v=a(u.g,d.g),y=a(u.b,d.b),b=On(u.opacity,d.opacity);return function(w){return u.r=m(w),u.g=v(w),u.b=y(w),u.opacity=b(w),u+""}}var a=Af(r);return s.gamma=t,s}(1),ot=Nf(Ai),ut=Nf(dl),Le=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,te=new RegExp(Le.source,"g"),Se=180/Math.PI,Ve={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},qe,Fe,_t,Nt,wt=vc(function(t){return t==="none"?Ve:(qe||(qe=document.createElement("DIV"),Fe=document.documentElement,_t=document.defaultView),qe.style.transform=t,t=_t.getComputedStyle(Fe.appendChild(qe),null).getPropertyValue("transform"),Fe.removeChild(qe),t=t.slice(7,-1).split(","),gc(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),zt=vc(function(t){return t==null||(Nt||(Nt=document.createElementNS("http://www.w3.org/2000/svg","g")),Nt.setAttribute("transform",t),!(t=Nt.transform.baseVal.consolidate()))?Ve:(t=t.matrix,gc(t.a,t.b,t.c,t.d,t.e,t.f))},", ",")",")"),Ot=Math.SQRT2,qn=Rf(fl),ln=Rf(On),Xn=Gn(fl),Lr=Gn(On),Cs=ih(fl),Fi=ih(On),Jr=0,sr=0,fi=0,pt,Za,Ql=0,kn=0,Kl=0,$a=typeof performance=="object"&&performance.now?performance:Date,Od=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};es.prototype=Js.prototype={constructor:es,restart:function(t,r,s){if(typeof t!="function")throw new TypeError("callback is not a function");s=(s==null?tr():+s)+(r==null?0:+r),this._next||Za===this||(Za?Za._next=this:pt=this,Za=this),this._call=t,this._time=s,cn()},stop:function(){this._call&&(this._call=null,this._time=1/0,cn())}};var Gd=ke("start","end","interrupt"),om=[],sm=ji.prototype.constructor,zo=0,Is=ji.prototype;Tr.prototype=Rc.prototype={constructor:Tr,select:function(t){var r=this._name,s=this._id;typeof t!="function"&&(t=$n(t));for(var a=this._groups,u=a.length,d=Array(u),m=0;m<u;++m)for(var v=a[m],y=v.length,b=d[m]=Array(y),w,A,E=0;E<y;++E)(w=v[E])&&(A=t.call(w,w.__data__,E,v))&&("__data__"in w&&(A.__data__=w.__data__),b[E]=A,Jt(b[E],r,s,E,b,Vr(w,s)));return new Tr(d,this._parents,r,s)},selectAll:function(t){var r=this._name,s=this._id;typeof t!="function"&&(t=ac(t));for(var a=this._groups,u=a.length,d=[],m=[],v=0;v<u;++v)for(var y=a[v],b=y.length,w,A=0;A<b;++A)if(w=y[A]){for(var E=t.call(w,w.__data__,A,y),P,C=Vr(w,s),B=0,ee=E.length;B<ee;++B)(P=E[B])&&Jt(P,r,s,B,E,C);d.push(E),m.push(w)}return new Tr(d,m,r,s)},filter:function(t){typeof t!="function"&&(t=K(t));for(var r=this._groups,s=r.length,a=Array(s),u=0;u<s;++u)for(var d=r[u],m=d.length,v=a[u]=[],y,b=0;b<m;++b)(y=d[b])&&t.call(y,y.__data__,b,d)&&v.push(y);return new Tr(a,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw Error();var r=this._groups;t=t._groups;for(var s=r.length,a=Math.min(s,t.length),u=Array(s),d=0;d<a;++d)for(var m=r[d],v=t[d],y=m.length,b=u[d]=Array(y),w,A=0;A<y;++A)(w=m[A]||v[A])&&(b[A]=w);for(;d<s;++d)u[d]=r[d];return new Tr(u,this._parents,this._name,this._id)},selection:function(){return new sm(this._groups,this._parents)},transition:function(){for(var t=this._name,r=this._id,s=++zo,a=this._groups,u=a.length,d=0;d<u;++d)for(var m=a[d],v=m.length,y,b=0;b<v;++b)if(y=m[b]){var w=Vr(y,r);Jt(y,t,s,b,m,{time:w.time+w.delay+w.duration,delay:0,duration:w.duration,ease:w.ease})}return new Tr(a,this._parents,t,s)},call:Is.call,nodes:Is.nodes,node:Is.node,size:Is.size,empty:Is.empty,each:Is.each,on:function(t,r){var s=this._id;return 2>arguments.length?Vr(this.node(),s).on.on(t):this.each(So(s,t,r))},attr:function(t,r){var s=bt(t),a=s==="transform"?zt:At;return this.attrTween(t,typeof r=="function"?(s.local?Sr:$s)(s,a,wc(this,"attr."+t,r)):r==null?(s.local?Qm:Cf)(s):(s.local?oh:Wr)(s,a,r+""))},attrTween:function(t,r){var s="attr."+t;if(2>arguments.length)return(s=this.tween(s))&&s._value;if(r==null)return this.tween(s,null);if(typeof r!="function")throw Error();var a=bt(t);return this.tween(s,(a.local?pl:jn)(a,r))},style:function(t,r,s){var a=(t+="")=="transform"?wt:At;return r==null?this.styleTween(t,lh(t,a)).on("end.style."+t,ch(t)):this.styleTween(t,typeof r=="function"?Sc(t,a,wc(this,"style."+t,r)):Ec(t,a,r+""),s)},styleTween:function(t,r,s){var a="style."+(t+="");if(2>arguments.length)return(a=this.tween(a))&&a._value;if(r==null)return this.tween(a,null);if(typeof r!="function")throw Error();return this.tween(a,Tc(t,r,s??""))},text:function(t){return this.tween("text",typeof t=="function"?Nc(wc(this,"text",t)):Ac(t==null?"":t+""))},remove:function(){return this.on("end.remove",ah(this._id))},tween:function(t,r){var s=this._id;if(t+="",2>arguments.length){s=Vr(this.node(),s).tween;for(var a=0,u=s.length,d;a<u;++a)if((d=s[a]).name===t)return d.value;return null}return this.each((r==null?Pf:Mc)(s,t,r))},delay:function(t){var r=this._id;return arguments.length?this.each((typeof t=="function"?Dt:If)(r,t)):Vr(this.node(),r).delay},duration:function(t){var r=this._id;return arguments.length?this.each((typeof t=="function"?Qs:sh)(r,t)):Vr(this.node(),r).duration},ease:function(t){var r=this._id;return arguments.length?this.each(wo(r,t)):Vr(this.node(),r).ease}};var am=function t(r){function s(a){return Math.pow(a,r)}return r=+r,s.exponent=t,s}(3),Lu=function t(r){function s(a){return 1-Math.pow(1-a,r)}return r=+r,s.exponent=t,s}(3),lm=function t(r){function s(a){return(1>=(a*=2)?Math.pow(a,r):2-Math.pow(2-a,r))/2}return r=+r,s.exponent=t,s}(3),Pu=Math.PI,Bd=Pu/2,de=4/11,We=6/11,$e=8/11,at=9/11,lt=10/11,kt=21/22,Rt=1/de/de,qt=function t(r){function s(a){return a*a*((r+1)*a-r)}return r=+r,s.overshoot=t,s}(1.70158),en=function t(r){function s(a){return--a*a*((r+1)*a+r)+1}return r=+r,s.overshoot=t,s}(1.70158),vn=function t(r){function s(a){return(1>(a*=2)?a*a*((r+1)*a-r):(a-=2)*a*((r+1)*a+r)+2)/2}return r=+r,s.overshoot=t,s}(1.70158),Zt=2*Math.PI,$t=function t(r,s){function a(d){return r*Math.pow(2,10*--d)*Math.sin((u-d)/s)}var u=Math.asin(1/(r=Math.max(1,r)))*(s/=Zt);return a.amplitude=function(d){return t(d,s*Zt)},a.period=function(d){return t(r,d)},a}(1,.3),Fn=function t(r,s){function a(d){return 1-r*Math.pow(2,-10*(d=+d))*Math.sin((d+u)/s)}var u=Math.asin(1/(r=Math.max(1,r)))*(s/=Zt);return a.amplitude=function(d){return t(d,s*Zt)},a.period=function(d){return t(r,d)},a}(1,.3),ec=function t(r,s){function a(d){return(0>(d=2*d-1)?r*Math.pow(2,10*d)*Math.sin((u-d)/s):2-r*Math.pow(2,-10*d)*Math.sin((u+d)/s))/2}var u=Math.asin(1/(r=Math.max(1,r)))*(s/=Zt);return a.amplitude=function(d){return t(d,s*Zt)},a.period=function(d){return t(r,d)},a}(1,.3),yr={time:null,delay:0,duration:250,ease:Tn};ji.prototype.interrupt=function(t){return this.each(function(){Li(this,t)})},ji.prototype.transition=function(t){var r;if(t instanceof Tr){var s=t._id;t=t._name}else s=++zo,(r=yr).time=tr(),t=t==null?null:t+"";for(var a=this._groups,u=a.length,d=0;d<u;++d)for(var m=a[d],v=m.length,y,b=0;b<v;++b)if(y=m[b]){var w=y,A=t,E=s,P=b,C=m,B;if(!(B=r))e:{B=void 0;for(var ee=s;!(B=y.__transition)||!(B=B[ee]);)if(!(y=y.parentNode)){B=(yr.time=tr(),yr);break e}}Jt(w,A,E,P,C,B)}return new Tr(a,this._parents,t,s)};var Ud=[null],ho={name:"drag"},kd={name:"space"},fo={name:"handle"},Qa={name:"center"},Ds={name:"x",handles:["e","w"].map(An),input:function(t,r){return t&&[[t[0],r[0][1]],[t[1],r[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Ln={name:"y",handles:["n","s"].map(An),input:function(t,r){return t&&[[r[0][0],t[0]],[r[1][0],t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},tc={name:"xy",handles:"n e s w nw ne se sw".split(" ").map(An),input:function(t){return t},output:function(t){return t}},zn={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Yt={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},Hn={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Fd={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Pg={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1},cm=Math.cos,um=Math.sin,hm=Math.PI,Cu=hm/2,dm=2*hm,fm=Math.max,Cg=Array.prototype.slice,hn=Math.PI,zd=2*hn,po=zd-1e-6;jr.prototype=Ar.prototype={constructor:jr,moveTo:function(t,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+r)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,r){this._+="L"+(this._x1=+t)+","+(this._y1=+r)},quadraticCurveTo:function(t,r,s,a){this._+="Q"+ +t+","+ +r+","+(this._x1=+s)+","+(this._y1=+a)},bezierCurveTo:function(t,r,s,a,u,d){this._+="C"+ +t+","+ +r+","+ +s+","+ +a+","+(this._x1=+u)+","+(this._y1=+d)},arcTo:function(t,r,s,a,u){t=+t,r=+r,s=+s,a=+a,u=+u;var d=this._x1,m=this._y1,v=s-t,y=a-r,b=d-t,w=m-r,A=b*b+w*w;if(0>u)throw Error("negative radius: "+u);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=r);else if(1e-6<A)if(1e-6<Math.abs(w*v-y*b)&&u){s-=d,a-=m;var E=v*v+y*y;m=Math.sqrt(E),d=Math.sqrt(A),A=u*Math.tan((hn-Math.acos((E+A-(s*s+a*a))/(2*m*d)))/2),d=A/d,A/=m,1e-6<Math.abs(d-1)&&(this._+="L"+(t+d*b)+","+(r+d*w)),this._+="A"+u+","+u+",0,0,"+ +(w*s>b*a)+","+(this._x1=t+A*v)+","+(this._y1=r+A*y)}else this._+="L"+(this._x1=t)+","+(this._y1=r)},arc:function(t,r,s,a,u,d){t=+t,r=+r,s=+s;var m=s*Math.cos(a),v=s*Math.sin(a),y=t+m,b=r+v,w=1^d;if(a=d?a-u:u-a,0>s)throw Error("negative radius: "+s);this._x1===null?this._+="M"+y+","+b:(1e-6<Math.abs(this._x1-y)||1e-6<Math.abs(this._y1-b))&&(this._+="L"+y+","+b),s&&(0>a&&(a=a%zd+zd),a>po?this._+="A"+s+","+s+",0,1,"+w+","+(t-m)+","+(r-v)+"A"+s+","+s+",0,1,"+w+","+(this._x1=y)+","+(this._y1=b):1e-6<a&&(this._+="A"+s+","+s+",0,"+ +(a>=hn)+","+w+","+(this._x1=t+s*Math.cos(u))+","+(this._y1=r+s*Math.sin(u))))},rect:function(t,r,s,a){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+r)+"h"+ +s+"v"+ +a+"h"+-s+"Z"},toString:function(){return this._}},Wt.prototype=dt.prototype={constructor:Wt,has:function(t){return" "+t in this},get:function(t){return this[" "+t]},set:function(t,r){return this[" "+t]=r,this},remove:function(t){return t=" "+t,t in this&&delete this[t]},clear:function(){for(var t in this)t[0]===" "&&delete this[t]},keys:function(){var t=[],r;for(r in this)r[0]===" "&&t.push(r.slice(1));return t},values:function(){var t=[],r;for(r in this)r[0]===" "&&t.push(this[r]);return t},entries:function(){var t=[],r;for(r in this)r[0]===" "&&t.push({key:r.slice(1),value:this[r]});return t},size:function(){var t=0,r;for(r in this)r[0]===" "&&++t;return t},empty:function(){for(var t in this)if(t[0]===" ")return!1;return!0},each:function(t){for(var r in this)r[0]===" "&&t(this[r],r.slice(1),this)}};var pi=dt.prototype;Cc.prototype=Bf.prototype={constructor:Cc,has:pi.has,add:function(t){return t+="",this[" "+t]=t,this},remove:pi.remove,clear:pi.clear,values:pi.keys,size:pi.size,empty:pi.empty,each:pi.each};var Hd=Array.prototype.slice,Pr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]],Iu={},Jn={},Ho=xl(","),mi=Ho.parse,gi=Ho.parseRows,vi=Ho.format,Cy=Ho.formatRows,pm=xl("	"),G0=pm.parse,Iy=pm.parseRows,Dy=pm.format,Oy=pm.formatRows,Gy=ph(mi),By=ph(G0),Cr=ia.prototype=gh.prototype;Cr.copy=function(){var t=new gh(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root,s,a;if(!r)return t;if(!r.length)return t._root=Ff(r),t;for(s=[{source:r,target:t._root=Array(4)}];r=s.pop();)for(var u=0;4>u;++u)(a=r.source[u])&&(a.length?s.push({source:a,target:r.target[u]=Array(4)}):r.target[u]=Ff(a));return t},Cr.add=function(t){var r=+this._x.call(null,t),s=+this._y.call(null,t);return _l(this.cover(r,s),r,s,t)},Cr.addAll=function(t){var r,s,a=t.length,u,d,m=Array(a),v=Array(a),y=1/0,b=1/0,w=-1/0,A=-1/0;for(s=0;s<a;++s)isNaN(u=+this._x.call(null,r=t[s]))||isNaN(d=+this._y.call(null,r))||(m[s]=u,v[s]=d,u<y&&(y=u),u>w&&(w=u),d<b&&(b=d),d>A&&(A=d));for(w<y&&(y=this._x0,w=this._x1),A<b&&(b=this._y0,A=this._y1),this.cover(y,b).cover(w,A),s=0;s<a;++s)_l(this,m[s],v[s],t[s]);return this},Cr.cover=function(t,r){if(isNaN(t=+t)||isNaN(r=+r))return this;var s=this._x0,a=this._y0,u=this._x1,d=this._y1;if(isNaN(s))u=(s=Math.floor(t))+1,d=(a=Math.floor(r))+1;else if(s>t||t>u||a>r||r>d){var m=u-s,v=this._root,y;switch(y=(r<(a+d)/2)<<1|t<(s+u)/2){case 0:do{var b=Array(4);b[y]=v,v=b}while(m*=2,u=s+m,d=a+m,t>u||r>d);break;case 1:do b=Array(4),b[y]=v,v=b;while(m*=2,s=u-m,d=a+m,s>t||r>d);break;case 2:do b=Array(4),b[y]=v,v=b;while(m*=2,u=s+m,a=d-m,t>u||a>r);break;case 3:do b=Array(4),b[y]=v,v=b;while(m*=2,s=u-m,a=d-m,s>t||a>r)}this._root&&this._root.length&&(this._root=v)}else return this;return this._x0=s,this._y0=a,this._x1=u,this._y1=d,this},Cr.data=function(){var t=[];return this.visit(function(r){if(!r.length)do t.push(r.data);while(r=r.next)}),t},Cr.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Cr.find=function(t,r,s){var a=this._x0,u=this._y0,d,m,v,y,b=this._x1,w=this._y1,A=[],E=this._root,P;for(E&&A.push(new nr(E,a,u,b,w)),s==null?s=1/0:(a=t-s,u=r-s,b=t+s,w=r+s,s*=s);P=A.pop();)if(!(!(E=P.node)||(d=P.x0)>b||(m=P.y0)>w||(v=P.x1)<a||(y=P.y1)<u)){if(E.length){P=(d+v)/2;var C=(m+y)/2;A.push(new nr(E[3],P,C,v,y),new nr(E[2],d,C,P,y),new nr(E[1],P,m,v,C),new nr(E[0],d,m,P,C)),(E=(r>=C)<<1|t>=P)&&(P=A[A.length-1],A[A.length-1]=A[A.length-1-E],A[A.length-1-E]=P)}else if(P=t-+this._x.call(null,E.data),C=r-+this._y.call(null,E.data),P=P*P+C*C,P<s){var B=Math.sqrt(s=P);a=t-B,u=r-B,b=t+B,w=r+B,B=E.data}}return B},Cr.remove=function(t){if(isNaN(y=+this._x.call(null,t))||isNaN(b=+this._y.call(null,t)))return this;var r,s=this._root,a,u=this._x0,d=this._y0,m=this._x1,v=this._y1,y,b,w,A,E,P,C;if(!s)return this;if(s.length)for(;;){if((E=y>=(w=(u+m)/2))?u=w:m=w,(P=b>=(A=(d+v)/2))?d=A:v=A,r=s,!(s=s[C=P<<1|E]))return this;if(!s.length)break;if(r[C+1&3]||r[C+2&3]||r[C+3&3])var B=r,ee=C}for(;s.data!==t;)if(a=s,!(s=s.next))return this;return(t=s.next)&&delete s.next,a?(t?a.next=t:delete a.next,this):r?(t?r[C]=t:delete r[C],(s=r[0]||r[1]||r[2]||r[3])&&s===(r[3]||r[2]||r[1]||r[0])&&!s.length&&(B?B[ee]=s:this._root=s),this):(this._root=t,this)},Cr.removeAll=function(t){for(var r=0,s=t.length;r<s;++r)this.remove(t[r]);return this},Cr.root=function(){return this._root},Cr.size=function(){var t=0;return this.visit(function(r){if(!r.length)do++t;while(r=r.next)}),t},Cr.visit=function(t){var r=[],s,a=this._root,u,d,m,v,y;for(a&&r.push(new nr(a,this._x0,this._y0,this._x1,this._y1));s=r.pop();)if(!t(a=s.node,d=s.x0,m=s.y0,v=s.x1,y=s.y1)&&a.length){s=(d+v)/2;var b=(m+y)/2;(u=a[3])&&r.push(new nr(u,s,b,v,y)),(u=a[2])&&r.push(new nr(u,d,b,s,y)),(u=a[1])&&r.push(new nr(u,s,m,v,b)),(u=a[0])&&r.push(new nr(u,d,m,s,b))}return this},Cr.visitAfter=function(t){var r=[],s=[],a;for(this._root&&r.push(new nr(this._root,this._x0,this._y0,this._x1,this._y1));a=r.pop();){var u=a.node;if(u.length){var d,m=a.x0,v=a.y0,y=a.x1,b=a.y1,w=(m+y)/2,A=(v+b)/2;(d=u[0])&&r.push(new nr(d,m,v,w,A)),(d=u[1])&&r.push(new nr(d,w,v,y,A)),(d=u[2])&&r.push(new nr(d,m,A,w,b)),(d=u[3])&&r.push(new nr(d,w,A,y,b))}s.push(a)}for(;a=s.pop();)t(a.node,a.x0,a.y0,a.x1,a.y1);return this},Cr.x=function(t){return arguments.length?(this._x=t,this):this._x},Cr.y=function(t){return arguments.length?(this._y=t,this):this._y};var Uy=Math.PI*(3-Math.sqrt(5)),ky=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;sa.prototype=yh.prototype,yh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};var B0,U0={"%":function(t,r){return(100*t).toFixed(r)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,r){return t.toExponential(r)},f:function(t,r){return t.toFixed(r)},g:function(t,r){return t.toPrecision(r)},o:function(t){return Math.round(t).toString(8)},p:function(t,r){return zf(100*t,r)},r:zf,s:function(t,r){var s=Ml(t,r);if(!s)return t+"";var a=s[0];s=s[1],s=s-(B0=3*Math.max(-8,Math.min(8,Math.floor(s/3))))+1;var u=a.length;return s===u?a:s>u?a+Array(s-u+1).join("0"):0<s?a.slice(0,s)+"."+a.slice(s):"0."+Array(1-s).join("0")+Ml(t,Math.max(0,r+s-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},k0="y z a f p n \xB5 m  k M G T P E Z Y".split(" "),mm;bh({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),rr.prototype={constructor:rr,reset:function(){this.s=this.t=0},add:function(t){ir(gm,t,this.t),ir(this,gm.s,this.s),this.s?this.t+=gm.t:this.s=gm.t},valueOf:function(){return this.s}};var gm=new rr,nn=Math.PI,En=nn/2,vm=nn/4,Zr=2*nn,_n=180/nn,Gt=nn/180,rn=Math.abs,Du=Math.atan,Ir=Math.atan2,Lt=Math.cos,ym=Math.ceil,F0=Math.exp,xm=Math.log,Ig=Math.pow,Et=Math.sin,Vd=Math.sign||function(t){return 0<t?1:0>t?-1:0},Zn=Math.sqrt,Ou=Math.tan,z0={Feature:function(t,r){Uc(t.geometry,r)},FeatureCollection:function(t,r){t=t.features;for(var s=-1,a=t.length;++s<a;)Uc(t[s].geometry,r)}},H0={Sphere:function(t,r){r.sphere()},Point:function(t,r){t=t.coordinates,r.point(t[0],t[1],t[2])},MultiPoint:function(t,r){for(var s=t.coordinates,a=-1,u=s.length;++a<u;)t=s[a],r.point(t[0],t[1],t[2])},LineString:function(t,r){Sh(t.coordinates,r,0)},MultiLineString:function(t,r){t=t.coordinates;for(var s=-1,a=t.length;++s<a;)Sh(t[s],r,0)},Polygon:function(t,r){Vf(t.coordinates,r)},MultiPolygon:function(t,r){t=t.coordinates;for(var s=-1,a=t.length;++s<a;)Vf(t[s],r)},GeometryCollection:function(t,r){t=t.geometries;for(var s=-1,a=t.length;++s<a;)Uc(t[s],r)}},_m=new rr,bm=new rr,V0,W0,Dg,Og,Gg,Vo={point:Mn,lineStart:Mn,lineEnd:Mn,polygonStart:function(){_m.reset(),Vo.lineStart=ug,Vo.lineEnd=hg},polygonEnd:function(){var t=+_m;bm.add(0>t?Zr+t:t),this.lineStart=this.lineEnd=this.point=Mn},sphere:function(){bm.add(Zr)}},Pn,yi,Vn,zi,nc,j0,Y0,Gu,Wd=new rr,Ka,Os,Gs={point:Ah,lineStart:Yf,lineEnd:qf,polygonStart:function(){Gs.point=Xf,Gs.lineStart=fg,Gs.lineEnd=pg,Wd.reset(),Vo.polygonStart()},polygonEnd:function(){Vo.polygonEnd(),Gs.point=Ah,Gs.lineStart=Yf,Gs.lineEnd=qf,0>_m?(Pn=-(Vn=180),yi=-(zi=90)):1e-6<Wd?zi=90:-1e-6>Wd&&(yi=-90),Os[0]=Pn,Os[1]=Vn}},jd,Mm,wm,Em,Sm,Tm,Am,Nm,Bg,Ug,kg,q0,X0,Dr,Or,Gr,mo={sphere:Mn,point:Nh,lineStart:Zf,lineEnd:$f,polygonStart:function(){mo.lineStart=yg,mo.lineEnd=xg},polygonEnd:function(){mo.lineStart=Zf,mo.lineEnd=$f}};El.invert=El;var Fg=new rr,zg=tp(function(){return!0},function(t){var r=NaN,s=NaN,a=NaN,u;return{lineStart:function(){t.lineStart(),u=1},point:function(d,m){var v=0<d?nn:-nn,y=rn(d-r);if(1e-6>rn(y-nn))t.point(r,s=0<(s+m)/2?En:-En),t.point(a,s),t.lineEnd(),t.lineStart(),t.point(v,s),t.point(d,s),u=0;else if(a!==v&&y>=nn){1e-6>rn(r-a)&&(r-=1e-6*a),1e-6>rn(d-v)&&(d-=1e-6*v),y=r;var b=s,w=d,A,E,P=Et(y-w);s=1e-6<rn(P)?Du((Et(b)*(E=Lt(m))*Et(w)-Et(m)*(A=Lt(b))*Et(y))/(A*E*P)):(b+m)/2,t.point(a,s),t.lineEnd(),t.lineStart(),t.point(v,s),u=0}t.point(r=d,s=m),a=v},lineEnd:function(){t.lineEnd(),r=s=NaN},clean:function(){return 2-u}}},function(t,r,s,a){t==null?(s*=En,a.point(-nn,s),a.point(0,s),a.point(nn,s),a.point(nn,0),a.point(nn,-s),a.point(0,-s),a.point(-nn,-s),a.point(-nn,0),a.point(-nn,s)):1e-6<rn(t[0]-r[0])?(t=t[0]<r[0]?nn:-nn,s=s*t/2,a.point(-t,s),a.point(0,s),a.point(t,s)):a.point(r[0],r[1])},[-nn,-En]),Hg=new rr,Vg,Rm,Lm,Bu={sphere:Mn,point:Mn,lineStart:function(){Bu.point=rp,Bu.lineEnd=wg},lineEnd:Mn,polygonStart:Mn,polygonEnd:Mn},Wg=[null,null],Fy={type:"LineString",coordinates:Wg},J0={Feature:function(t,r){return qc(t.geometry,r)},FeatureCollection:function(t,r){t=t.features;for(var s=-1,a=t.length;++s<a;)if(qc(t[s].geometry,r))return!0;return!1}},Z0={Sphere:function(){return!0},Point:function(t,r){return ca(t.coordinates,r)===0},MultiPoint:function(t,r){t=t.coordinates;for(var s=-1,a=t.length;++s<a;)if(ca(t[s],r)===0)return!0;return!1},LineString:function(t,r){return sp(t.coordinates,r)},MultiLineString:function(t,r){t=t.coordinates;for(var s=-1,a=t.length;++s<a;)if(sp(t[s],r))return!0;return!1},Polygon:function(t,r){return Oh(t.coordinates,r)},MultiPolygon:function(t,r){t=t.coordinates;for(var s=-1,a=t.length;++s<a;)if(Oh(t[s],r))return!0;return!1},GeometryCollection:function(t,r){t=t.geometries;for(var s=-1,a=t.length;++s<a;)if(qc(t[s],r))return!0;return!1}},jg=new rr,Yg=new rr,$0,Q0,qg,Xg,Bs={point:Mn,lineStart:Mn,lineEnd:Mn,polygonStart:function(){Bs.lineStart=dp,Bs.lineEnd=Xc},polygonEnd:function(){Bs.lineStart=Bs.lineEnd=Bs.point=Mn,jg.add(rn(Yg)),Yg.reset()},result:function(){var t=jg/2;return jg.reset(),t}},Uu=1/0,Pm=Uu,Yd=-Uu,Cm=Yd,Im={point:function(t,r){t<Uu&&(Uu=t),t>Yd&&(Yd=t),r<Pm&&(Pm=r),r>Cm&&(Cm=r)},lineStart:Mn,lineEnd:Mn,polygonStart:Mn,polygonEnd:Mn,result:function(){var t=[[Uu,Pm],[Yd,Cm]];return Yd=Cm=-(Pm=Uu=1/0),t}},Jg=0,Zg=0,qd=0,Dm=0,Om=0,ku=0,$g=0,Qg=0,Xd=0,K0,ev,Wo,jo,Hi={point:Lo,lineStart:fp,lineEnd:Jc,polygonStart:function(){Hi.lineStart=as,Hi.lineEnd=Tg},polygonEnd:function(){Hi.point=Lo,Hi.lineStart=fp,Hi.lineEnd=Jc},result:function(){var t=Xd?[$g/Xd,Qg/Xd]:ku?[Dm/ku,Om/ku]:qd?[Jg/qd,Zg/qd]:[NaN,NaN];return Jg=Zg=qd=Dm=Om=ku=$g=Qg=Xd=0,t}};gp.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,r){switch(this._point){case 0:this._context.moveTo(t,r),this._point=1;break;case 1:this._context.lineTo(t,r);break;default:this._context.moveTo(t+this._radius,r),this._context.arc(t,r,this._radius,0,Zr)}},result:Mn};var Kg=new rr,e0,tv,nv,Jd,Zd,$d={point:Mn,lineStart:function(){$d.point=sn},lineEnd:function(){e0&&Bh(tv,nv),$d.point=Mn},polygonStart:function(){e0=!0},polygonEnd:function(){e0=null},result:function(){var t=+Kg;return Kg.reset(),t}};ua.prototype={_radius:4.5,_circle:ha(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(t,r){switch(this._point){case 0:this._string.push("M",t,",",r),this._point=1;break;case 1:this._string.push("L",t,",",r);break;default:this._circle==null&&(this._circle=ha(this._radius)),this._string.push("M",t,",",r,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},eo.prototype={constructor:eo,point:function(t,r){this.stream.point(t,r)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var zy=Lt(30*Gt),Hy=Po({point:function(t,r){this.stream.point(t*Gt,r*Gt)}}),t0=Al(function(t){return Zn(2/(1+t))});t0.invert=Io(function(t){return 2*or(t/2)});var n0=Al(function(t){return(t=er(t))&&t/Et(t)});n0.invert=Io(function(t){return t}),xa.invert=function(t,r){return[t,2*Du(F0(r))-En]},_a.invert=_a;var Gm=Zn(3)/2;Vh.invert=function(t,r){for(var s=r,a=s*s,u=a*a*a,d=0,m;12>d&&(m=s*(1.340264+-.081106*a+u*(893e-6+.003796*a))-r,a=1.340264+3*-.081106*a+u*(7*893e-6+.034164*a),s-=m/=a,a=s*s,u=a*a*a,!(1e-12>rn(m)));++d);return[Gm*t*(1.340264+3*-.081106*a+u*(7*893e-6+.034164*a))/Lt(s),or(Et(s)/Gm)]},Qc.invert=Io(Du),ba.invert=function(t,r){var s=r,a=25;do{var u=s*s,d=u*u;s-=d=(s*(1.007226+u*(.015085+d*(-.044475+.028874*u-.005916*d)))-r)/(1.007226+u*(.045255+d*(-.311325+.259866*u-.005916*11*d)))}while(1e-6<rn(d)&&0<--a);return[t/(.8707+(u=s*s)*(-.131979+u*(-.013791+u*u*u*(.003971-.001529*u)))),s]},to.invert=Io(or),Kc.invert=Io(function(t){return 2*Du(t)}),Wh.invert=function(t,r){return[-r,2*Du(F0(t))-En]},ds.prototype=Rl.prototype={constructor:ds,count:function(){return this.eachAfter(Nl)},each:function(t){var r,s=[this],a;do{var u=s.reverse();for(s=[];r=u.pop();)if(t(r),r=r.children){var d=0;for(a=r.length;d<a;++d)s.push(r[d])}}while(s.length);return this},eachAfter:function(t){for(var r,s=[this],a=[],u,d;r=s.pop();)if(a.push(r),r=r.children)for(u=0,d=r.length;u<d;++u)s.push(r[u]);for(;r=a.pop();)t(r);return this},eachBefore:function(t){for(var r,s=[this],a;r=s.pop();)if(t(r),r=r.children)for(a=r.length-1;0<=a;--a)s.push(r[a]);return this},sum:function(t){return this.eachAfter(function(r){for(var s=+t(r.data)||0,a=r.children,u=a&&a.length;0<=--u;)s+=a[u].value;r.value=s})},sort:function(t){return this.eachBefore(function(r){r.children&&r.children.sort(t)})},path:function(t){var r=this,s=r,a=t;if(s!==a){var u=s.ancestors(),d=a.ancestors(),m=null;for(s=u.pop(),a=d.pop();s===a;)m=s,s=u.pop(),a=d.pop();s=m}for(a=[r];r!==s;)r=r.parent,a.push(r);for(r=a.length;t!==s;)a.splice(r,0,t),t=t.parent;return a},ancestors:function(){for(var t=this,r=[t];t=t.parent;)r.push(t);return r},descendants:function(){var t=[];return this.each(function(r){t.push(r)}),t},leaves:function(){var t=[];return this.eachBefore(function(r){r.children||t.push(r)}),t},links:function(){var t=this,r=[];return t.each(function(s){s!==t&&r.push({source:s.parent,target:s})}),r},copy:function(){return Rl(this).eachBefore(xp)}};var Vy=Array.prototype.slice,Wy={depth:-1},rv={};Na.prototype=Object.create(ds.prototype);var iv=(1+Math.sqrt(5))/2,ov=function t(r){function s(a,u,d,m,v){vr(r,a,u,d,m,v)}return s.ratio=function(a){return t(1<(a=+a)?a:1)},s}(iv),jy=function t(r){function s(a,u,d,m,v){if((y=a._squarify)&&y.ratio===r)for(var y,b,w,A=-1,E,P=y.length,C=a.value;++A<P;){for(a=y[A],b=a.children,w=a.value=0,E=b.length;w<E;++w)a.value+=b[w].value;a.dice?qr(a,u,d,m,d+=(v-d)*a.value/C):Ra(a,u,d,u+=(m-u)*a.value/C,v),C-=a.value}else a._squarify=y=vr(r,a,u,d,m,v),y.ratio=r}return s.ratio=function(a){return t(1<(a=+a)?a:1)},s}(iv),Yy=function t(r){function s(a,u){return a=a==null?0:+a,u=u==null?1:+u,arguments.length===1?(u=a,a=0):u-=a,function(){return r()*u+a}}return s.source=t,s}(no),sv=function t(r){function s(a,u){var d,m;return a=a==null?0:+a,u=u==null?1:+u,function(){if(d!=null){var v=d;d=null}else do d=2*r()-1,v=2*r()-1,m=d*d+v*v;while(!m||1<m);return a+u*v*Math.sqrt(-2*Math.log(m)/m)}}return s.source=t,s}(no),qy=function t(r){function s(){var a=sv.source(r).apply(this,arguments);return function(){return Math.exp(a())}}return s.source=t,s}(no),av=function t(r){function s(a){return function(){for(var u=0,d=0;d<a;++d)u+=r();return u}}return s.source=t,s}(no),Xy=function t(r){function s(a){var u=av.source(r)(a);return function(){return u()/a}}return s.source=t,s}(no),Jy=function t(r){function s(a){return function(){return-Math.log(1-r())/a}}return s.source=t,s}(no),lv=Array.prototype,r0=lv.map,el=lv.slice,i0={name:"implicit"},cv=[0,1],o0=new Date,s0=new Date,rc=Un(function(){},function(t,r){t.setTime(+t+r)},function(t,r){return r-t});rc.every=function(t){return t=Math.floor(t),isFinite(t)&&0<t?1<t?Un(function(r){r.setTime(Math.floor(r/t)*t)},function(r,s){r.setTime(+r+s*t)},function(r,s){return(s-r)/t}):rc:null};var uv=rc.range,Qd=Un(function(t){t.setTime(1e3*Math.floor(t/1e3))},function(t,r){t.setTime(+t+1e3*r)},function(t,r){return(r-t)/1e3},function(t){return t.getUTCSeconds()}),hv=Qd.range,a0=Un(function(t){t.setTime(6e4*Math.floor(t/6e4))},function(t,r){t.setTime(+t+6e4*r)},function(t,r){return(r-t)/6e4},function(t){return t.getMinutes()}),Zy=a0.range,l0=Un(function(t){var r=6e4*t.getTimezoneOffset()%36e5;0>r&&(r+=36e5),t.setTime(36e5*Math.floor((+t-r)/36e5)+r)},function(t,r){t.setTime(+t+36e5*r)},function(t,r){return(r-t)/36e5},function(t){return t.getHours()}),$y=l0.range,Kd=Un(function(t){t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r)},function(t,r){return(r-t-6e4*(r.getTimezoneOffset()-t.getTimezoneOffset()))/864e5},function(t){return t.getDate()-1}),Qy=Kd.range,ef=oo(0),tf=oo(1),dv=oo(2),fv=oo(3),nf=oo(4),pv=oo(5),mv=oo(6),gv=ef.range,Ky=tf.range,e1=dv.range,t1=fv.range,n1=nf.range,r1=pv.range,i1=mv.range,c0=Un(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,r){t.setMonth(t.getMonth()+r)},function(t,r){return r.getMonth()-t.getMonth()+12*(r.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),o1=c0.range,Us=Un(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r)},function(t,r){return r.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});Us.every=function(t){return isFinite(t=Math.floor(t))&&0<t?Un(function(r){r.setFullYear(Math.floor(r.getFullYear()/t)*t),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,s){r.setFullYear(r.getFullYear()+s*t)}):null};var s1=Us.range,u0=Un(function(t){t.setUTCSeconds(0,0)},function(t,r){t.setTime(+t+6e4*r)},function(t,r){return(r-t)/6e4},function(t){return t.getUTCMinutes()}),a1=u0.range,h0=Un(function(t){t.setUTCMinutes(0,0,0)},function(t,r){t.setTime(+t+36e5*r)},function(t,r){return(r-t)/36e5},function(t){return t.getUTCHours()}),l1=h0.range,rf=Un(function(t){t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r)},function(t,r){return(r-t)/864e5},function(t){return t.getUTCDate()-1}),c1=rf.range,of=xs(0),sf=xs(1),vv=xs(2),yv=xs(3),af=xs(4),xv=xs(5),_v=xs(6),bv=of.range,u1=sf.range,h1=vv.range,d1=yv.range,f1=af.range,p1=xv.range,m1=_v.range,d0=Un(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCMonth(t.getUTCMonth()+r)},function(t,r){return r.getUTCMonth()-t.getUTCMonth()+12*(r.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),g1=d0.range,ks=Un(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r)},function(t,r){return r.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});ks.every=function(t){return isFinite(t=Math.floor(t))&&0<t?Un(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/t)*t),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,s){r.setUTCFullYear(r.getUTCFullYear()+s*t)}):null};var v1=ks.range,Mv={"-":"",_:" ",0:"0"},fr=/^\s*\d+/,y1=/^%/,x1=/[\\^$*+?|[\]().{}]/g,Fu;md({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),shortDays:"Sun Mon Tue Wed Thu Fri Sat".split(" "),months:"January February March April May June July August September October November December".split(" "),shortMonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")});var _1=Date.prototype.toISOString?di:R.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ"),b1=+new Date("2000-01-01T00:00:00.000Z")?gd:R.utcParse("%Y-%m-%dT%H:%M:%S.%LZ"),M1=Ft("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),w1=Ft("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),E1=Ft("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),S1=Ft("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),T1=Ft("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),A1=Ft("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),N1=Ft("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),R1=Ft("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),L1=Ft("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),P1=Ft("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),C1=Ft("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),I1=Ft("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),wv=Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Ft),D1=un(wv),Ev=Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Ft),O1=un(Ev),Sv=Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Ft),G1=un(Sv),Tv=Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Ft),B1=un(Tv),Av=Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Ft),U1=un(Av),Nv=Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Ft),k1=un(Nv),Rv=Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Ft),F1=un(Rv),Lv=Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Ft),z1=un(Lv),Pv=Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Ft),H1=un(Pv),Cv=Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Ft),V1=un(Cv),Iv=Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Ft),W1=un(Iv),Dv=Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Ft),j1=un(Dv),Ov=Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ft),Y1=un(Ov),Gv=Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Ft),q1=un(Gv),Bv=Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Ft),X1=un(Bv),Uv=Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Ft),J1=un(Uv),kv=Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Ft),Z1=un(kv),Fv=Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ft),$1=un(Fv),zv=Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ft),Q1=un(zv),Hv=Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Ft),K1=un(Hv),Vv=Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ft),ex=un(Vv),Wv=Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ft),tx=un(Wv),jv=Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ft),nx=un(jv),Yv=Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Ft),rx=un(Yv),qv=Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ft),ix=un(qv),Xv=Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ft),ox=un(Xv),Jv=Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ft),sx=un(Jv),ax=Fi(oi(300,.5,0),oi(-240,.5,1)),lx=Fi(oi(-100,.75,.35),oi(80,1.5,.8)),cx=Fi(oi(260,.75,.35),oi(80,1.5,.8)),Bm=oi(),Um=Xi(),ux=Math.PI/3,hx=2*Math.PI/3,dx=Bo(Ft("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),fx=Bo(Ft("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),px=Bo(Ft("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),mx=Bo(Ft("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),Zv=Math.abs,xr=Math.atan2,ic=Math.cos,gx=Math.max,f0=Math.min,Yo=Math.sin,zu=Math.sqrt,tl=Math.PI,km=tl/2,nl=2*tl;Va.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;default:this._context.lineTo(t,r)}}};var $v=ja(jl);wd.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,r){this._curve.point(r*Math.sin(t),r*-Math.cos(t))}};var p0=Array.prototype.slice,m0={draw:function(t,r){r=Math.sqrt(r/tl),t.moveTo(r,0),t.arc(0,0,r,0,nl)}},Qv={draw:function(t,r){r=Math.sqrt(r/5)/2,t.moveTo(-3*r,-r),t.lineTo(-r,-r),t.lineTo(-r,-3*r),t.lineTo(r,-3*r),t.lineTo(r,-r),t.lineTo(3*r,-r),t.lineTo(3*r,r),t.lineTo(r,r),t.lineTo(r,3*r),t.lineTo(-r,3*r),t.lineTo(-r,r),t.lineTo(-3*r,r),t.closePath()}},Kv=Math.sqrt(1/3),vx=2*Kv,ey={draw:function(t,r){r=Math.sqrt(r/vx);var s=r*Kv;t.moveTo(0,-r),t.lineTo(s,0),t.lineTo(0,r),t.lineTo(-s,0),t.closePath()}},ty=Math.sin(tl/10)/Math.sin(7*tl/10),yx=Math.sin(nl/10)*ty,xx=-Math.cos(nl/10)*ty,ny={draw:function(t,r){r=Math.sqrt(.8908130915292852*r);var s=yx*r,a=xx*r;t.moveTo(0,-r),t.lineTo(s,a);for(var u=1;5>u;++u){var d=nl*u/5,m=Math.cos(d);d=Math.sin(d),t.lineTo(d*r,-m*r),t.lineTo(m*s-d*a,d*s+m*a)}t.closePath()}},ry={draw:function(t,r){r=Math.sqrt(r);var s=-r/2;t.rect(s,s,r,r)}},g0=Math.sqrt(3),iy={draw:function(t,r){r=-Math.sqrt(r/(3*g0)),t.moveTo(0,2*r),t.lineTo(-g0*r,-r),t.lineTo(g0*r,-r),t.closePath()}},Vi=Math.sqrt(3)/2,v0=1/Math.sqrt(12),_x=3*(v0/2+1),oy={draw:function(t,r){var s=Math.sqrt(r/_x);r=s/2;var a=s*v0;s=s*v0+s;var u=-r;t.moveTo(r,a),t.lineTo(r,s),t.lineTo(u,s),t.lineTo(-.5*r-Vi*a,Vi*r+-.5*a),t.lineTo(-.5*r-Vi*s,Vi*r+-.5*s),t.lineTo(-.5*u-Vi*s,Vi*u+-.5*s),t.lineTo(-.5*r+Vi*a,-.5*a-Vi*r),t.lineTo(-.5*r+Vi*s,-.5*s-Vi*r),t.lineTo(-.5*u+Vi*s,-.5*s-Vi*u),t.closePath()}},bx=[m0,Qv,ey,ry,ny,iy,oy];qa.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ui(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ui(this,t,r)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r}},ko.prototype={areaStart:Uo,areaEnd:Uo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._x2=t,this._y2=r;break;case 1:this._point=2,this._x3=t,this._y3=r;break;case 2:this._point=3,this._x4=t,this._y4=r,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+r)/6);break;default:Ui(this,t,r)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r}},Td.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var s=(this._x0+4*this._x1+t)/6,a=(this._y0+4*this._y1+r)/6;this._line?this._context.lineTo(s,a):this._context.moveTo(s,a);break;case 3:this._point=4;default:Ui(this,t,r)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r}},Wp.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,r=this._y,s=t.length-1;if(0<s)for(var a=t[0],u=r[0],d=t[s]-a,m=r[s]-u,v=-1,y;++v<=s;)y=v/s,this._basis.point(this._beta*t[v]+(1-this._beta)*(a+y*d),this._beta*r[v]+(1-this._beta)*(u+y*m));this._x=this._y=null,this._basis.lineEnd()},point:function(t,r){this._x.push(+t),this._y.push(+r)}};var Mx=function t(r){function s(a){return r===1?new qa(a):new Wp(a,r)}return s.beta=function(a){return t(+a)},s}(.85);xu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ki(this,this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2,this._x1=t,this._y1=r;break;case 2:this._point=3;default:ki(this,t,r)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=r}};var wx=function t(r){function s(a){return new xu(a,r)}return s.tension=function(a){return t(+a)},s}(0);_u.prototype={areaStart:Uo,areaEnd:Uo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._x3=t,this._y3=r;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=r);break;case 2:this._point=3,this._x5=t,this._y5=r;break;default:ki(this,t,r)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=r}};var Ex=function t(r){function s(a){return new _u(a,r)}return s.tension=function(a){return t(+a)},s}(0);Ad.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ki(this,t,r)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=r}};var Sx=function t(r){function s(a){return new Ad(a,r)}return s.tension=function(a){return t(+a)},s}(0);bu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){if(t=+t,r=+r,this._point){var s=this._x2-t,a=this._y2-r;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(s*s+a*a,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;break;case 2:this._point=3;default:Nd(this,t,r)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=r}};var Tx=function t(r){function s(a){return r?new bu(a,r):new xu(a,0)}return s.alpha=function(a){return t(+a)},s}(.5);jp.prototype={areaStart:Uo,areaEnd:Uo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,r){if(t=+t,r=+r,this._point){var s=this._x2-t,a=this._y2-r;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(s*s+a*a,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=r;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=r);break;case 2:this._point=3,this._x5=t,this._y5=r;break;default:Nd(this,t,r)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=r}};var Ax=function t(r){function s(a){return r?new jp(a,r):new _u(a,0)}return s.alpha=function(a){return t(+a)},s}(.5);Yp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){if(t=+t,r=+r,this._point){var s=this._x2-t,a=this._y2-r;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(s*s+a*a,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Nd(this,t,r)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=r}};var Nx=function t(r){function s(a){return r?new Yp(a,r):new Ad(a,0)}return s.alpha=function(a){return t(+a)},s}(.5);qp.prototype={areaStart:Uo,areaEnd:Uo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,r){t=+t,r=+r,this._point?this._context.lineTo(t,r):(this._point=1,this._context.moveTo(t,r))}},Mu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Rd(this,this._t0,Jp(this,this._t0))}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){var s=NaN;if(t=+t,r=+r,t!==this._x1||r!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;break;case 2:this._point=3,Rd(this,Jp(this,s=Xp(this,t,r)),s);break;default:Rd(this,this._t0,s=Xp(this,t,r))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r,this._t0=s}}},(Kt.prototype=Object.create(Mu.prototype)).point=function(t,r){Mu.prototype.point.call(this,r,t)},Ld.prototype={moveTo:function(t,r){this._context.moveTo(r,t)},closePath:function(){this._context.closePath()},lineTo:function(t,r){this._context.lineTo(r,t)},bezierCurveTo:function(t,r,s,a,u,d){this._context.bezierCurveTo(r,t,a,s,d,u)}},Zp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,r=this._y,s=t.length;if(s)if(this._line?this._context.lineTo(t[0],r[0]):this._context.moveTo(t[0],r[0]),s===2)this._context.lineTo(t[1],r[1]);else for(var a=Pd(t),u=Pd(r),d=0,m=1;m<s;++d,++m)this._context.bezierCurveTo(a[0][d],u[0][d],a[1][d],u[1][d],t[m],r[m]);(this._line||this._line!==0&&s===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,r){this._x.push(+t),this._y.push(+r)}},Ns.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&1>this._t&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),0<=this._line&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;default:if(0>=this._t)this._context.lineTo(this._x,r),this._context.lineTo(t,r);else{var s=this._x*(1-this._t)+t*this._t;this._context.lineTo(s,this._y),this._context.lineTo(s,r)}}this._x=t,this._y=r}},ql.prototype={constructor:ql,insert:function(t,r){var s;if(t){if(r.P=t,(r.N=t.N)&&(t.N.P=r),t.N=r,t.R){for(t=t.R;t.L;)t=t.L;t.L=r}else t.R=r;var a=t}else this._?(t=Su(this._),r.P=null,r.N=t,t.P=t.L=r,a=t):(r.P=r.N=null,this._=r,a=null);for(r.L=r.R=null,r.U=a,r.C=!0,t=r;a&&a.C;)r=a.U,a===r.L?(s=r.R)&&s.C?(a.C=s.C=!1,r.C=!0,t=r):(t===a.R&&(Xr(this,a),t=a,a=t.U),a.C=!1,r.C=!0,Fo(this,r)):(s=r.L)&&s.C?(a.C=s.C=!1,r.C=!0,t=r):(t===a.L&&(Fo(this,a),t=a,a=t.U),a.C=!1,r.C=!0,Xr(this,r)),a=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var r=t.U,s=t.L,a=t.R,u=s?a?Su(a):s:a;if(r?r.L===t?r.L=u:r.R=u:this._=u,s&&a){var d=u.C;u.C=t.C,u.L=s,s.U=u,u!==a?(r=u.U,u.U=t.U,t=u.R,r.L=t,u.R=a,a.U=u):(u.U=r,r=u,t=u.R)}else d=t.C,t=u;if(t&&(t.U=r),!d)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,Xr(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Fo(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,Xr(this,r),t=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,Fo(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Xr(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,Fo(this,r),t=this._;break}t.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}};var sy=[],y0,ay=[],mn=1e-6,Rx=1e-12,Hu,xi,lf,_r;Zl.prototype={constructor:Zl,polygons:function(){var t=this.edges;return this.cells.map(function(r){var s=r.halfedges.map(function(a){return Id(r,t[a])});return s.data=r.site.data,s})},triangles:function(){var t=[],r=this.edges;return this.cells.forEach(function(s,a){if(m=(u=s.halfedges).length){s=s.site;var u,d=-1,m,v=r[u[m-1]];for(v=v.left===s?v.right:v.left;++d<m;){var y=v;v=r[u[d]],v=v.left===s?v.right:v.left,y&&v&&a<y.index&&a<v.index&&0>(s[0]-v[0])*(y[1]-s[1])-(s[0]-y[0])*(v[1]-s[1])&&t.push([s.data,y.data,v.data])}}}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,r,s){for(var a=this,u=a._found||0,d=a.cells.length,m;!(m=a.cells[u]);)if(++u>=d)return null;d=t-m.site[0];var v=r-m.site[1],y=d*d+v*v;do m=a.cells[d=u],u=null,m.halfedges.forEach(function(b){var w=a.edges[b];if(b=w.left,b!==m.site&&b||(b=w.right)){w=t-b[0];var A=r-b[1];w=w*w+A*A,w<y&&(y=w,u=b.index)}});while(u!==null);return a._found=d,s==null||y<=s*s?m.site:null}},uo.prototype={constructor:uo,scale:function(t){return t===1?this:new uo(this.k*t,this.x,this.y)},translate:function(t,r){return t===0&r===0?this:new uo(this.k,this.x+this.k*t,this.y+this.k*r)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Fm=new uo(1,0,0);im.prototype=uo.prototype,R.version="5.7.0",R.bisect=p,R.bisectRight=p,R.bisectLeft=g,R.ascending=G,R.bisector=ae,R.cross=function(t,r,s){var a=t.length,u=r.length,d=Array(a*u),m,v,y;for(s==null&&(s=q),m=y=0;m<a;++m){var b=t[m];for(v=0;v<u;++v,++y)d[y]=s(b,r[v])}return d},R.descending=function(t,r){return r<t?-1:r>t?1:r>=t?0:NaN},R.deviation=se,R.extent=le,R.histogram=function(){function t(u){var d,m=u.length,v=Array(m);for(d=0;d<m;++d)v[d]=r(u[d],d,u);d=s(v);var y=d[0],b=d[1],w=a(v,y,b);Array.isArray(w)||(w=X(y,b,w),w=H(Math.ceil(y/w)*w,b,w));for(var A=w.length;w[0]<=y;)w.shift(),--A;for(;w[A-1]>b;)w.pop(),--A;var E=Array(A+1);for(d=0;d<=A;++d){var P=E[d]=[];P.x0=0<d?w[d-1]:y,P.x1=d<A?w[d]:b}for(d=0;d<m;++d)P=v[d],y<=P&&P<=b&&E[p(w,P,0,A)].push(u[d]);return E}var r=W,s=le,a=ne;return t.value=function(u){return arguments.length?(r=typeof u=="function"?u:Q(u),t):r},t.domain=function(u){return arguments.length?(s=typeof u=="function"?u:Q([u[0],u[1]]),t):s},t.thresholds=function(u){return arguments.length?(a=typeof u=="function"?u:Array.isArray(u)?Q(_.call(u)):Q(u),t):a},t},R.thresholdFreedmanDiaconis=function(t,r,s){return t=M.call(t,ge).sort(G),Math.ceil((s-r)/(2*(j(t,.75)-j(t,.25))*Math.pow(t.length,-1/3)))},R.thresholdScott=function(t,r,s){return Math.ceil((s-r)/(3.5*se(t)*Math.pow(t.length,-1/3)))},R.thresholdSturges=ne,R.max=z,R.mean=function(t,r){var s=t.length,a=s,u=-1,d,m=0;if(r==null)for(;++u<s;)isNaN(d=ge(t[u]))?--a:m+=d;else for(;++u<s;)isNaN(d=ge(r(t[u],u,t)))?--a:m+=d;if(a)return m/a},R.median=function(t,r){var s=t.length,a=-1,u,d=[];if(r==null)for(;++a<s;)isNaN(u=ge(t[a]))||d.push(u);else for(;++a<s;)isNaN(u=ge(r(t[a],a,t)))||d.push(u);return j(d.sort(G),.5)},R.merge=me,R.min=Re,R.pairs=function(t,r){r==null&&(r=q);for(var s=0,a=t.length-1,u=t[0],d=Array(0>a?0:a);s<a;)d[s]=r(u,u=t[++s]);return d},R.permute=function(t,r){for(var s=r.length,a=Array(s);s--;)a[s]=t[r[s]];return a},R.quantile=j,R.range=H,R.scan=function(t,r){if(s=t.length){var s,a=0,u=0,d,m=t[u];for(r==null&&(r=G);++a<s;)(0>r(d=t[a],m)||r(m,m)!==0)&&(m=d,u=a);if(r(m,m)===0)return u}},R.shuffle=function(t,r,s){s=(s??t.length)-(r=r==null?0:+r);for(var a,u;s;)u=Math.random()*s--|0,a=t[s+r],t[s+r]=t[u+r],t[u+r]=a;return t},R.sum=function(t,r){var s=t.length,a=-1,u,d=0;if(r==null)for(;++a<s;)(u=+t[a])&&(d+=u);else for(;++a<s;)(u=+r(t[a],a,t))&&(d+=u);return d},R.ticks=k,R.tickIncrement=$,R.tickStep=X,R.transpose=Xe,R.variance=oe,R.zip=function(){return Xe(arguments)},R.axisTop=function(t){return Ie(1,t)},R.axisRight=function(t){return Ie(2,t)},R.axisBottom=function(t){return Ie(3,t)},R.axisLeft=function(t){return Ie(4,t)},R.brush=function(){return vl(tc)},R.brushX=function(){return vl(Ds)},R.brushY=function(){return vl(Ln)},R.brushSelection=function(t){return(t=t.__brush)?t.dim.output(t.selection):null},R.chord=function(){function t(d){var m=d.length,v=[],y=H(m),b=[],w=[],A=w.groups=Array(m),E=Array(m*m),P,C,B=0;for(P=-1;++P<m;){var ee=0;for(C=-1;++C<m;)ee+=d[P][C];v.push(ee),b.push(H(m)),B+=ee}s&&y.sort(function(Ce,ye){return s(v[Ce],v[ye])}),a&&b.forEach(function(Ce,ye){Ce.sort(function(be,Z){return a(d[ye][be],d[ye][Z])})});var Y=(B=fm(0,dm-r*m)/B)?r:dm/m;for(ee=0,P=-1;++P<m;){var ce=ee;for(C=-1;++C<m;){var ue=y[P],pe=b[ue][C],Pe=d[ue][pe],Oe=ee,xe=ee+=Pe*B;E[pe*m+ue]={index:ue,subindex:pe,startAngle:Oe,endAngle:xe,value:Pe}}A[ue]={index:ue,startAngle:ce,endAngle:ee,value:v[ue]},ee+=Y}for(P=-1;++P<m;)for(C=P-1;++C<m;)y=E[C*m+P],b=E[P*m+C],(y.value||b.value)&&w.push(y.value<b.value?{source:b,target:y}:{source:y,target:b});return u?w.sort(u):w}var r=0,s=null,a=null,u=null;return t.padAngle=function(d){return arguments.length?(r=fm(0,d),t):r},t.sortGroups=function(d){return arguments.length?(s=d,t):s},t.sortSubgroups=function(d){return arguments.length?(a=d,t):a},t.sortChords=function(d){return arguments.length?(d==null?u=null:(u=Km(d))._=d,t):u&&u._},t},R.ribbon=function(){function t(){var v,y=Cg.call(arguments),b=r.apply(this,y),w=s.apply(this,y);b=+a.apply(this,(y[0]=b,y));var A=u.apply(this,y)-Cu,E=d.apply(this,y)-Cu,P=b*cm(A),C=b*um(A);w=+a.apply(this,(y[0]=w,y));var B=u.apply(this,y)-Cu;if(y=d.apply(this,y)-Cu,m||(m=v=Ar()),m.moveTo(P,C),m.arc(0,0,b,A,E),(A!==B||E!==y)&&(m.quadraticCurveTo(0,0,w*cm(B),w*um(B)),m.arc(0,0,w,B,y)),m.quadraticCurveTo(0,0,P,C),m.closePath(),v)return m=null,v+""||null}var r=Pc,s=yl,a=Df,u=eg,d=ns,m=null;return t.radius=function(v){return arguments.length?(a=typeof v=="function"?v:hh(+v),t):a},t.startAngle=function(v){return arguments.length?(u=typeof v=="function"?v:hh(+v),t):u},t.endAngle=function(v){return arguments.length?(d=typeof v=="function"?v:hh(+v),t):d},t.source=function(v){return arguments.length?(r=v,t):r},t.target=function(v){return arguments.length?(s=v,t):s},t.context=function(v){return arguments.length?(m=v??null,t):m},t},R.nest=function(){function t(v,y,b,w){if(y>=s.length)return u!=null&&v.sort(u),d!=null?d(v):v;for(var A=-1,E=v.length,P=s[y++],C,B,ee=dt(),Y,ce=b();++A<E;)(Y=ee.get(C=P(B=v[A])+""))?Y.push(B):ee.set(C,[B]);return ee.each(function(ue,pe){w(ce,pe,t(ue,y,b,w))}),ce}function r(v,y){if(++y>s.length)return v;var b=a[y-1];if(d!=null&&y>=s.length)var w=v.entries();else w=[],v.each(function(A,E){w.push({key:E,values:r(A,y)})});return b!=null?w.sort(function(A,E){return b(A.key,E.key)}):w}var s=[],a=[],u,d,m;return m={object:function(v){return t(v,0,si,tg)},map:function(v){return t(v,0,Of,Gf)},entries:function(v){return r(t(v,0,Of,Gf),0)},key:function(v){return s.push(v),m},sortKeys:function(v){return a[s.length-1]=v,m},sortValues:function(v){return u=v,m},rollup:function(v){return d=v,m}}},R.set=Bf,R.map=dt,R.keys=function(t){var r=[],s;for(s in t)r.push(s);return r},R.values=function(t){var r=[],s;for(s in t)r.push(t[s]);return r},R.entries=function(t){var r=[],s;for(s in t)r.push({key:s,value:t[s]});return r},R.color=wi,R.rgb=Xi,R.hsl=ri,R.lab=pc,R.hcl=Ti,R.lch=function(t,r,s,a){return arguments.length===1?eh(t):new Hr(s,r,t,a??1)},R.gray=function(t,r){return new ii(t,0,0,r??1)},R.cubehelix=oi,R.contours=ai,R.contourDensity=function(){function t(Y){var ce=new Float32Array(C*B),ue=new Float32Array(C*B);return Y.forEach(function(pe,Pe,Oe){var xe=+m(pe,Pe,Oe)+P>>E,Ce=+v(pe,Pe,Oe)+P>>E;pe=+y(pe,Pe,Oe),0<=xe&&xe<C&&0<=Ce&&Ce<B&&(ce[xe+Ce*C]+=pe)}),Ic({width:C,height:B,data:ce},{width:C,height:B,data:ue},A>>E),Dc({width:C,height:B,data:ue},{width:C,height:B,data:ce},A>>E),Ic({width:C,height:B,data:ce},{width:C,height:B,data:ue},A>>E),Dc({width:C,height:B,data:ue},{width:C,height:B,data:ce},A>>E),Ic({width:C,height:B,data:ce},{width:C,height:B,data:ue},A>>E),Dc({width:C,height:B,data:ue},{width:C,height:B,data:ce},A>>E),Y=ee(ce),Array.isArray(Y)||(ue=z(ce),Y=X(0,ue,Y),Y=H(0,Math.floor(ue/Y)*Y,Y),Y.shift()),ai().thresholds(Y).size([C,B])(ce).map(r)}function r(Y){return Y.value*=Math.pow(2,-2*E),Y.coordinates.forEach(s),Y}function s(Y){Y.forEach(a)}function a(Y){Y.forEach(u)}function u(Y){Y[0]=Y[0]*Math.pow(2,E)-P,Y[1]=Y[1]*Math.pow(2,E)-P}function d(){return P=3*A,C=b+2*P>>E,B=w+2*P>>E,t}var m=Oc,v=No,y=dh,b=960,w=500,A=20,E=2,P=3*A,C=b+2*P>>E,B=w+2*P>>E,ee=Yr(20);return t.x=function(Y){return arguments.length?(m=typeof Y=="function"?Y:Yr(+Y),t):m},t.y=function(Y){return arguments.length?(v=typeof Y=="function"?Y:Yr(+Y),t):v},t.weight=function(Y){return arguments.length?(y=typeof Y=="function"?Y:Yr(+Y),t):y},t.size=function(Y){if(!arguments.length)return[b,w];var ce=Math.ceil(Y[0]),ue=Math.ceil(Y[1]);if(!(0<=ce||0<=ce))throw Error("invalid size");return b=ce,w=ue,d()},t.cellSize=function(Y){if(!arguments.length)return 1<<E;if(!(1<=(Y=+Y)))throw Error("invalid cell size");return E=Math.floor(Math.log(Y)/Math.LN2),d()},t.thresholds=function(Y){return arguments.length?(ee=typeof Y=="function"?Y:Array.isArray(Y)?Yr(Hd.call(Y)):Yr(Y),t):ee},t.bandwidth=function(Y){if(!arguments.length)return Math.sqrt(A*(A+1));if(!(0<=(Y=+Y)))throw Error("invalid bandwidth");return A=Math.round((Math.sqrt(4*Y*Y+1)-1)/2),d()},t},R.dispatch=ke,R.drag=function(){function t(pe){pe.on("mousedown.drag",r).filter(A).on("touchstart.drag",u).on("touchmove.drag",d).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function r(){if(!ce&&y.apply(this,arguments)){var pe=v("mouse",b.apply(this,arguments),wr,this,arguments);pe&&(cr(R.event.view).on("mousemove.drag",s,!0).on("mouseup.drag",a,!0),ti(R.event.view),R.event.stopImmediatePropagation(),Y=!1,B=R.event.clientX,ee=R.event.clientY,pe("start"))}}function s(){if(ei(),!Y){var pe=R.event.clientX-B,Pe=R.event.clientY-ee;Y=pe*pe+Pe*Pe>ue}E.mouse("drag")}function a(){cr(R.event.view).on("mousemove.drag mouseup.drag",null),ni(R.event.view,Y),ei(),E.mouse("end")}function u(){if(y.apply(this,arguments)){var pe=R.event.changedTouches,Pe=b.apply(this,arguments),Oe=pe.length,xe,Ce;for(xe=0;xe<Oe;++xe)(Ce=v(pe[xe].identifier,Pe,Yi,this,arguments))&&(R.event.stopImmediatePropagation(),Ce("start"))}}function d(){var pe=R.event.changedTouches,Pe=pe.length,Oe,xe;for(Oe=0;Oe<Pe;++Oe)(xe=E[pe[Oe].identifier])&&(ei(),xe("drag"))}function m(){var pe=R.event.changedTouches,Pe=pe.length,Oe,xe;for(ce&&clearTimeout(ce),ce=setTimeout(function(){ce=null},500),Oe=0;Oe<Pe;++Oe)(xe=E[pe[Oe].identifier])&&(R.event.stopImmediatePropagation(),xe("end"))}function v(pe,Pe,Oe,xe,Ce){var ye=Oe(Pe,pe),be,Z,fe,Ae=P.copy();if(lr(new $o(t,"beforestart",be,pe,C,ye[0],ye[1],0,0,Ae),function(){return(R.event.subject=be=w.apply(xe,Ce))==null?!1:(Z=be.x-ye[0]||0,fe=be.y-ye[1]||0,!0)}))return function et(mt){var ht=ye;switch(mt){case"start":E[pe]=et;var It=C++;break;case"end":delete E[pe],--C;case"drag":ye=Oe(Pe,pe),It=C}lr(new $o(t,mt,be,pe,It,ye[0]+Z,ye[1]+fe,ye[0]-ht[0],ye[1]-ht[1],Ae),Ae.apply,Ae,[mt,xe,Ce])}}var y=dc,b=fc,w=Qo,A=Qu,E={},P=ke("start","drag","end"),C=0,B,ee,Y,ce,ue=0;return t.filter=function(pe){return arguments.length?(y=typeof pe=="function"?pe:bi(!!pe),t):y},t.container=function(pe){return arguments.length?(b=typeof pe=="function"?pe:bi(pe),t):b},t.subject=function(pe){return arguments.length?(w=typeof pe=="function"?pe:bi(pe),t):w},t.touchable=function(pe){return arguments.length?(A=typeof pe=="function"?pe:bi(!!pe),t):A},t.on=function(){var pe=P.on.apply(P,arguments);return pe===P?t:pe},t.clickDistance=function(pe){return arguments.length?(ue=(pe=+pe)*pe,t):Math.sqrt(ue)},t},R.dragDisable=ti,R.dragEnable=ni,R.dsvFormat=xl,R.csvParse=mi,R.csvParseRows=gi,R.csvFormat=vi,R.csvFormatRows=Cy,R.tsvParse=G0,R.tsvParseRows=Iy,R.tsvFormat=Dy,R.tsvFormatRows=Oy,R.easeLinear=function(t){return+t},R.easeQuad=ml,R.easeQuadIn=function(t){return t*t},R.easeQuadOut=function(t){return t*(2-t)},R.easeQuadInOut=ml,R.easeCubic=Tn,R.easeCubicIn=function(t){return t*t*t},R.easeCubicOut=function(t){return--t*t*t+1},R.easeCubicInOut=Tn,R.easePoly=lm,R.easePolyIn=am,R.easePolyOut=Lu,R.easePolyInOut=lm,R.easeSin=gl,R.easeSinIn=function(t){return 1-Math.cos(t*Bd)},R.easeSinOut=function(t){return Math.sin(t*Bd)},R.easeSinInOut=gl,R.easeExp=Pi,R.easeExpIn=function(t){return Math.pow(2,10*t-10)},R.easeExpOut=function(t){return 1-Math.pow(2,-10*t)},R.easeExpInOut=Pi,R.easeCircle=ts,R.easeCircleIn=function(t){return 1-Math.sqrt(1-t*t)},R.easeCircleOut=function(t){return Math.sqrt(1- --t*t)},R.easeCircleInOut=ts,R.easeBounce=Rn,R.easeBounceIn=function(t){return 1-Rn(1-t)},R.easeBounceOut=Rn,R.easeBounceInOut=function(t){return(1>=(t*=2)?1-Rn(1-t):Rn(t-1)+1)/2},R.easeBack=vn,R.easeBackIn=qt,R.easeBackOut=en,R.easeBackInOut=vn,R.easeElastic=Fn,R.easeElasticIn=$t,R.easeElasticOut=Fn,R.easeElasticInOut=ec,R.blob=function(t,r){return fetch(t,r).then(fh)},R.buffer=function(t,r){return fetch(t,r).then(rs)},R.dsv=function(t,r,s,a){arguments.length===3&&typeof s=="function"&&(a=s,s=void 0);var u=xl(t);return Bc(r,s).then(function(d){return u.parse(d,a)})},R.csv=Gy,R.tsv=By,R.json=function(t,r){return fetch(t,r).then(rg)},R.text=Bc,R.forceCenter=function(t,r){function s(){var u,d=a.length,m=0,v=0;for(u=0;u<d;++u){var y=a[u];m+=y.x,v+=y.y}for(m=m/d-t,v=v/d-r,u=0;u<d;++u)y=a[u],y.x-=m,y.y-=v}var a;return t==null&&(t=0),r==null&&(r=0),s.initialize=function(u){a=u},s.x=function(u){return arguments.length?(t=+u,s):t},s.y=function(u){return arguments.length?(r=+u,s):r},s},R.forceCollide=function(t){function r(){function y(ce,ue,pe,Pe,Oe){var xe=ce.data;ce=ce.r;var Ce=B+ce;if(xe)xe.index>E.index&&(ue=P-xe.x-xe.vx,pe=C-xe.y-xe.vy,Pe=ue*ue+pe*pe,Pe<Ce*Ce&&(ue===0&&(ue=Qi(),Pe+=ue*ue),pe===0&&(pe=Qi(),Pe+=pe*pe),Pe=(Ce-(Pe=Math.sqrt(Pe)))/Pe*m,E.vx+=(ue*=Pe)*(Ce=(ce*=ce)/(ee+ce)),E.vy+=(pe*=Pe)*Ce,xe.vx-=ue*(Ce=1-Ce),xe.vy-=pe*Ce));else return ue>P+Ce||Pe<P-Ce||pe>C+Ce||Oe<C-Ce}for(var b,w=u.length,A,E,P,C,B,ee,Y=0;Y<v;++Y)for(A=ia(u,ig,og).visitAfter(s),b=0;b<w;++b)E=u[b],B=d[E.index],ee=B*B,P=E.x+E.vx,C=E.y+E.vy,A.visit(y)}function s(y){if(y.data)return y.r=d[y.data.index];for(var b=y.r=0;4>b;++b)y[b]&&y[b].r>y.r&&(y.r=y[b].r)}function a(){if(u){var y,b=u.length;for(d=Array(b),y=0;y<b;++y){var w=u[y];d[w.index]=+t(w,y,u)}}}var u,d,m=1,v=1;return typeof t!="function"&&(t=Bn(t==null?1:+t)),r.initialize=function(y){u=y,a()},r.iterations=function(y){return arguments.length?(v=+y,r):v},r.strength=function(y){return arguments.length?(m=+y,r):m},r.radius=function(y){return arguments.length?(t=typeof y=="function"?y:Bn(+y),a(),r):t},r},R.forceLink=function(t){function r(C){return 1/Math.min(A[C.source.index],A[C.target.index])}function s(C){for(var B=0,ee=t.length;B<P;++B)for(var Y=0,ce,ue,pe,Pe,Oe;Y<ee;++Y)ce=t[Y],ue=ce.source,ce=ce.target,pe=ce.x+ce.vx-ue.x-ue.vx||Qi(),Pe=ce.y+ce.vy-ue.y-ue.vy||Qi(),Oe=Math.sqrt(pe*pe+Pe*Pe),Oe=(Oe-b[Y])/Oe*C*v[Y],pe*=Oe,Pe*=Oe,ce.vx-=pe*(Oe=E[Y]),ce.vy-=Pe*Oe,ue.vx+=pe*(Oe=1-Oe),ue.vy+=Pe*Oe}function a(){if(w){var C=w.length,B=t.length,ee=dt(w,m),Y=0;for(A=Array(C);Y<B;++Y)C=t[Y],C.index=Y,typeof C.source!="object"&&(C.source=bl(ee,C.source)),typeof C.target!="object"&&(C.target=bl(ee,C.target)),A[C.source.index]=(A[C.source.index]||0)+1,A[C.target.index]=(A[C.target.index]||0)+1;for(Y=0,E=Array(B);Y<B;++Y)C=t[Y],E[Y]=A[C.source.index]/(A[C.source.index]+A[C.target.index]);v=Array(B),u(),b=Array(B),d()}}function u(){if(w)for(var C=0,B=t.length;C<B;++C)v[C]=+r(t[C],C,t)}function d(){if(w)for(var C=0,B=t.length;C<B;++C)b[C]=+y(t[C],C,t)}var m=sg,v,y=Bn(30),b,w,A,E,P=1;return t==null&&(t=[]),s.initialize=function(C){w=C,a()},s.links=function(C){return arguments.length?(t=C,a(),s):t},s.id=function(C){return arguments.length?(m=C,s):m},s.iterations=function(C){return arguments.length?(P=+C,s):P},s.strength=function(C){return arguments.length?(r=typeof C=="function"?C:Bn(+C),u(),s):r},s.distance=function(C){return arguments.length?(y=typeof C=="function"?C:Bn(+C),d(),s):y},s},R.forceManyBody=function(){function t(E){var P,C=u.length,B=ia(u,ag,lg).visitAfter(s);for(m=E,P=0;P<C;++P)d=u[P],B.visit(a)}function r(){if(u){var E,P=u.length;for(y=Array(P),E=0;E<P;++E){var C=u[E];y[C.index]=+v(C,E,u)}}}function s(E){var P=0,C,B,ee=0,Y,ce,ue;if(E.length){for(Y=ce=ue=0;4>ue;++ue)(C=E[ue])&&(B=Math.abs(C.value))&&(P+=C.value,ee+=B,Y+=B*C.x,ce+=B*C.y);E.x=Y/ee,E.y=ce/ee}else{C=E,C.x=C.data.x,C.y=C.data.y;do P+=y[C.data.index];while(C=C.next)}E.value=P}function a(E,P,C,B){if(!E.value)return!0;var ee=E.x-d.x,Y=E.y-d.y;if(P=B-P,B=ee*ee+Y*Y,P*P/A<B)return B<w&&(ee===0&&(ee=Qi(),B+=ee*ee),Y===0&&(Y=Qi(),B+=Y*Y),B<b&&(B=Math.sqrt(b*B)),d.vx+=ee*E.value*m/B,d.vy+=Y*E.value*m/B),!0;if(!(E.length||B>=w)){(E.data!==d||E.next)&&(ee===0&&(ee=Qi(),B+=ee*ee),Y===0&&(Y=Qi(),B+=Y*Y),B<b&&(B=Math.sqrt(b*B)));do E.data!==d&&(P=y[E.data.index]*m/B,d.vx+=ee*P,d.vy+=Y*P);while(E=E.next)}}var u,d,m,v=Bn(-30),y,b=1,w=1/0,A=.81;return t.initialize=function(E){u=E,r()},t.strength=function(E){return arguments.length?(v=typeof E=="function"?E:Bn(+E),r(),t):v},t.distanceMin=function(E){return arguments.length?(b=E*E,t):Math.sqrt(b)},t.distanceMax=function(E){return arguments.length?(w=E*E,t):Math.sqrt(w)},t.theta=function(E){return arguments.length?(A=E*E,t):Math.sqrt(A)},t},R.forceRadial=function(t,r,s){function a(b){for(var w=0,A=d.length;w<A;++w){var E=d[w],P=E.x-r||1e-6,C=E.y-s||1e-6,B=Math.sqrt(P*P+C*C);B=(y[w]-B)*v[w]*b/B,E.vx+=P*B,E.vy+=C*B}}function u(){if(d){var b,w=d.length;for(v=Array(w),y=Array(w),b=0;b<w;++b)y[b]=+t(d[b],b,d),v[b]=isNaN(y[b])?0:+m(d[b],b,d)}}var d,m=Bn(.1),v,y;return typeof t!="function"&&(t=Bn(+t)),r==null&&(r=0),s==null&&(s=0),a.initialize=function(b){d=b,u()},a.strength=function(b){return arguments.length?(m=typeof b=="function"?b:Bn(+b),u(),a):m},a.radius=function(b){return arguments.length?(t=typeof b=="function"?b:Bn(+b),u(),a):t},a.x=function(b){return arguments.length?(r=+b,a):r},a.y=function(b){return arguments.length?(s=+b,a):s},a},R.forceSimulation=function(t){function r(){s(),P.call("tick",d),m<v&&(E.stop(),P.call("end",d))}function s(){var C,B=t.length;for(m+=(b-m)*y,A.each(function(Y){Y(m)}),C=0;C<B;++C){var ee=t[C];ee.fx==null?ee.x+=ee.vx*=w:(ee.x=ee.fx,ee.vx=0),ee.fy==null?ee.y+=ee.vy*=w:(ee.y=ee.fy,ee.vy=0)}}function a(){for(var C=0,B=t.length,ee;C<B;++C){if(ee=t[C],ee.index=C,isNaN(ee.x)||isNaN(ee.y)){var Y=10*Math.sqrt(C),ce=C*Uy;ee.x=Y*Math.cos(ce),ee.y=Y*Math.sin(ce)}(isNaN(ee.vx)||isNaN(ee.vy))&&(ee.vx=ee.vy=0)}}function u(C){return C.initialize&&C.initialize(t),C}var d,m=1,v=.001,y=1-Math.pow(v,1/300),b=0,w=.6,A=dt(),E=Js(r),P=ke("tick","end");return t==null&&(t=[]),a(),d={tick:s,restart:function(){return E.restart(r),d},stop:function(){return E.stop(),d},nodes:function(C){return arguments.length?(t=C,a(),A.each(u),d):t},alpha:function(C){return arguments.length?(m=+C,d):m},alphaMin:function(C){return arguments.length?(v=+C,d):v},alphaDecay:function(C){return arguments.length?(y=+C,d):+y},alphaTarget:function(C){return arguments.length?(b=+C,d):b},velocityDecay:function(C){return arguments.length?(w=1-C,d):1-w},force:function(C,B){return 1<arguments.length?(B==null?A.remove(C):A.set(C,u(B)),d):A.get(C)},find:function(C,B,ee){var Y,ce=t.length;for(ee=ee==null?1/0:ee*ee,Y=0;Y<ce;++Y){var ue=t[Y],pe=C-ue.x,Pe=B-ue.y;if(pe=pe*pe+Pe*Pe,pe<ee){var Oe=ue;ee=pe}}return Oe},on:function(C,B){return 1<arguments.length?(P.on(C,B),d):P.on(C)}}},R.forceX=function(t){function r(v){for(var y=0,b=u.length,w;y<b;++y)w=u[y],w.vx+=(m[y]-w.x)*d[y]*v}function s(){if(u){var v,y=u.length;for(d=Array(y),m=Array(y),v=0;v<y;++v)d[v]=isNaN(m[v]=+t(u[v],v,u))?0:+a(u[v],v,u)}}var a=Bn(.1),u,d,m;return typeof t!="function"&&(t=Bn(t==null?0:+t)),r.initialize=function(v){u=v,s()},r.strength=function(v){return arguments.length?(a=typeof v=="function"?v:Bn(+v),s(),r):a},r.x=function(v){return arguments.length?(t=typeof v=="function"?v:Bn(+v),s(),r):t},r},R.forceY=function(t){function r(v){for(var y=0,b=u.length,w;y<b;++y)w=u[y],w.vy+=(m[y]-w.y)*d[y]*v}function s(){if(u){var v,y=u.length;for(d=Array(y),m=Array(y),v=0;v<y;++v)d[v]=isNaN(m[v]=+t(u[v],v,u))?0:+a(u[v],v,u)}}var a=Bn(.1),u,d,m;return typeof t!="function"&&(t=Bn(t==null?0:+t)),r.initialize=function(v){u=v,s()},r.strength=function(v){return arguments.length?(a=typeof v=="function"?v:Bn(+v),s(),r):a},r.y=function(v){return arguments.length?(t=typeof v=="function"?v:Bn(+v),s(),r):t},r},R.formatDefaultLocale=bh,R.formatLocale=_h,R.formatSpecifier=sa,R.precisionFixed=Mh,R.precisionPrefix=wh,R.precisionRound=Eh,R.geoArea=function(t){return bm.reset(),li(t,Vo),2*bm},R.geoBounds=function(t){var r,s,a;if(zi=Vn=-(Pn=yi=1/0),Ka=[],li(t,Gs),r=Ka.length){Ka.sort(mg),t=1;var u=Ka[0];for(s=[u];t<r;++t){var d=Ka[t];Jf(u,d[0])||Jf(u,d[1])?(Nr(u[0],d[1])>Nr(u[0],u[1])&&(u[1]=d[1]),Nr(d[0],u[1])>Nr(u[0],u[1])&&(u[0]=d[0])):s.push(u=d)}var m=-1/0;for(r=s.length-1,t=0,u=s[r];t<=r;u=d,++t)d=s[t],(a=Nr(u[1],d[0]))>m&&(m=a,Pn=d[0],Vn=u[1])}return Ka=Os=null,Pn===1/0||yi===1/0?[[NaN,NaN],[NaN,NaN]]:[[Pn,yi],[Vn,zi]]},R.geoCentroid=function(t){jd=Mm=wm=Em=Sm=Tm=Am=Nm=Bg=Ug=kg=0,li(t,mo),t=Bg;var r=Ug,s=kg,a=t*t+r*r+s*s;return 1e-12>a&&(t=Tm,r=Am,s=Nm,1e-6>Mm&&(t=wm,r=Em,s=Sm),a=t*t+r*r+s*s,1e-12>a)?[NaN,NaN]:[Ir(r,t)*_n,or(s/Zn(a))*_n]},R.geoCircle=function(){function t(){var v=r.apply(this,arguments),y=s.apply(this,arguments)*Gt,b=a.apply(this,arguments)*Gt;return u=[],d=Wc(-v[0]*Gt,-v[1]*Gt,0).invert,Lh(m,y,b,1),v={type:"Polygon",coordinates:[u]},u=d=null,v}var r=os([0,0]),s=os(90),a=os(6),u,d,m={point:function(v,y){u.push(v=d(v,y)),v[0]*=_n,v[1]*=_n}};return t.center=function(v){return arguments.length?(r=typeof v=="function"?v:os([+v[0],+v[1]]),t):r},t.radius=function(v){return arguments.length?(s=typeof v=="function"?v:os(+v),t):s},t.precision=function(v){return arguments.length?(a=typeof v=="function"?v:os(+v),t):a},t},R.geoClipAntimeridian=zg,R.geoClipCircle=np,R.geoClipExtent=function(){var t=0,r=0,s=960,a=500,u,d,m;return m={stream:function(v){return u&&d===v?u:u=Sl(t,r,s,a)(d=v)},extent:function(v){return arguments.length?(t=+v[0][0],r=+v[0][1],s=+v[1][0],a=+v[1][1],u=d=null,m):[[t,r],[s,a]]}}},R.geoClipRectangle=Sl,R.geoContains=function(t,r){return(t&&J0.hasOwnProperty(t.type)?J0[t.type]:qc)(t,r)},R.geoDistance=ca,R.geoGraticule=hp,R.geoGraticule10=function(){return hp()()},R.geoInterpolate=function(t,r){var s=t[0]*Gt,a=t[1]*Gt;t=r[0]*Gt,r=r[1]*Gt;var u=Lt(a),d=Et(a),m=Lt(r),v=Et(r),y=u*Lt(s),b=u*Et(s),w=m*Lt(t),A=m*Et(t),E=2*or(Zn(Hf(r-a)+u*m*Hf(t-s))),P=Et(E);return t=E?function(C){var B=Et(C*=E)/P,ee=Et(E-C)/P;C=ee*y+B*w;var Y=ee*b+B*A;return B=ee*d+B*v,[Ir(Y,C)*_n,Ir(B,Zn(C*C+Y*Y))*_n]}:function(){return[s*_n,a*_n]},t.distance=E,t},R.geoLength=op,R.geoPath=function(t,r){function s(m){return m&&(typeof a=="function"&&d.pointRadius(+a.apply(this,arguments)),li(m,u(d))),d.result()}var a=4.5,u,d;return s.area=function(m){return li(m,u(Bs)),Bs.result()},s.measure=function(m){return li(m,u($d)),$d.result()},s.bounds=function(m){return li(m,u(Im)),Im.result()},s.centroid=function(m){return li(m,u(Hi)),Hi.result()},s.projection=function(m){return arguments.length?(u=m==null?(t=null,ss):(t=m).stream,s):t},s.context=function(m){return arguments.length?(d=m==null?(r=null,new ua):new gp(r=m),typeof a!="function"&&d.pointRadius(a),s):r},s.pointRadius=function(m){return arguments.length?(a=typeof m=="function"?m:(d.pointRadius(+m),+m),s):a},s.projection(t).context(r)},R.geoAlbers=kh,R.geoAlbersUsa=function(){function t(E){var P=E[0];return E=E[1],w=null,d.point(P,E),w||(v.point(P,E),w)||(b.point(P,E),w)}function r(){return s=a=null,t}var s,a,u=kh(),d,m=ya().rotate([154,0]).center([-2,58.5]).parallels([55,65]),v,y=ya().rotate([157,0]).center([-3,19.9]).parallels([8,18]),b,w,A={point:function(E,P){w=[E,P]}};return t.invert=function(E){var P=u.scale(),C=u.translate(),B=(E[0]-C[0])/P;return P=(E[1]-C[1])/P,(.12<=P&&.234>P&&-.425<=B&&-.214>B?m:.166<=P&&.234>P&&-.214<=B&&-.115>B?y:u).invert(E)},t.stream=function(E){return s&&a===E?s:s=$c([u.stream(a=E),m.stream(E),y.stream(E)])},t.precision=function(E){return arguments.length?(u.precision(E),m.precision(E),y.precision(E),r()):u.precision()},t.scale=function(E){return arguments.length?(u.scale(E),m.scale(.35*E),y.scale(E),t.translate(u.translate())):u.scale()},t.translate=function(E){if(!arguments.length)return u.translate();var P=u.scale(),C=+E[0],B=+E[1];return d=u.translate(E).clipExtent([[C-.455*P,B-.238*P],[C+.455*P,B+.238*P]]).stream(A),v=m.translate([C-.307*P,B+.201*P]).clipExtent([[C-.425*P+1e-6,B+.12*P+1e-6],[C-.214*P-1e-6,B+.234*P-1e-6]]).stream(A),b=y.translate([C-.205*P,B+.212*P]).clipExtent([[C-.214*P+1e-6,B+.166*P+1e-6],[C-.115*P-1e-6,B+.234*P-1e-6]]).stream(A),r()},t.fitExtent=function(E,P){return Rr(t,E,P)},t.fitSize=function(E,P){return Rr(t,[[0,0],E],P)},t.fitWidth=function(E,P){return da(t,E,P)},t.fitHeight=function(E,P){return Co(t,E,P)},t.scale(1070)},R.geoAzimuthalEqualArea=function(){return ci(t0).scale(124.75).clipAngle(179.999)},R.geoAzimuthalEqualAreaRaw=t0,R.geoAzimuthalEquidistant=function(){return ci(n0).scale(79.4188).clipAngle(179.999)},R.geoAzimuthalEquidistantRaw=n0,R.geoConicConformal=function(){return cs(zh).scale(109.5).parallels([30,30])},R.geoConicConformalRaw=zh,R.geoConicEqualArea=ya,R.geoConicEqualAreaRaw=Uh,R.geoConicEquidistant=function(){return cs(Hh).scale(131.154).center([0,13.9389])},R.geoConicEquidistantRaw=Hh,R.geoEqualEarth=function(){return ci(Vh).scale(177.158)},R.geoEqualEarthRaw=Vh,R.geoEquirectangular=function(){return ci(_a).scale(152.63)},R.geoEquirectangularRaw=_a,R.geoGnomonic=function(){return ci(Qc).scale(144.049).clipAngle(60)},R.geoGnomonicRaw=Qc,R.geoIdentity=function(){function t(){return E=P=null,C}var r=1,s=0,a=0,u=1,d=1,m=ss,v=null,y,b,w,A=ss,E,P,C;return C={stream:function(B){return E&&P===B?E:E=m(A(P=B))},postclip:function(B){return arguments.length?(A=B,v=y=b=w=null,t()):A},clipExtent:function(B){return arguments.length?(A=B==null?(v=y=b=w=null,ss):Sl(v=+B[0][0],y=+B[0][1],b=+B[1][0],w=+B[1][1]),t()):v==null?null:[[v,y],[b,w]]},scale:function(B){return arguments.length?(m=us((r=+B)*u,r*d,s,a),t()):r},translate:function(B){return arguments.length?(m=us(r*u,r*d,s=+B[0],a=+B[1]),t()):[s,a]},reflectX:function(B){return arguments.length?(m=us(r*(u=B?-1:1),r*d,s,a),t()):0>u},reflectY:function(B){return arguments.length?(m=us(r*u,r*(d=B?-1:1),s,a),t()):0>d},fitExtent:function(B,ee){return Rr(C,B,ee)},fitSize:function(B,ee){return Rr(C,[[0,0],B],ee)},fitWidth:function(B,ee){return da(C,B,ee)},fitHeight:function(B,ee){return Co(C,B,ee)}}},R.geoProjection=ci,R.geoProjectionMutator=va,R.geoMercator=function(){return Fh(xa).scale(961/Zr)},R.geoMercatorRaw=xa,R.geoNaturalEarth1=function(){return ci(ba).scale(175.295)},R.geoNaturalEarth1Raw=ba,R.geoOrthographic=function(){return ci(to).scale(249.5).clipAngle(90.000001)},R.geoOrthographicRaw=to,R.geoStereographic=function(){return ci(Kc).scale(250).clipAngle(142)},R.geoStereographicRaw=Kc,R.geoTransverseMercator=function(){var t=Fh(Wh),r=t.center,s=t.rotate;return t.center=function(a){return arguments.length?r([-a[1],a[0]]):(a=r(),[a[1],-a[0]])},t.rotate=function(a){return arguments.length?s([a[0],a[1],2<a.length?a[2]+90:90]):(a=s(),[a[0],a[1],a[2]-90])},s([0,0,90]).scale(159.155)},R.geoTransverseMercatorRaw=Wh,R.geoRotation=ep,R.geoStream=li,R.geoTransform=function(t){return{stream:Po(t)}},R.cluster=function(){function t(d){var m,v=0;d.eachAfter(function(E){var P=E.children;if(P){var C=P.reduce(hs,0)/P.length;E.x=C,E.y=1+P.reduce(vp,0)}else E.x=m?v+=r(E,m):0,E.y=0,m=E});var y=yp(d),b=tu(d),w=y.x-r(y,b)/2,A=b.x+r(b,y)/2;return d.eachAfter(u?function(E){E.x=(E.x-d.x)*s,E.y=(d.y-E.y)*a}:function(E){E.x=(E.x-w)/(A-w)*s,E.y=(1-(d.y?E.y/d.y:1))*a})}var r=eu,s=1,a=1,u=!1;return t.separation=function(d){return arguments.length?(r=d,t):r},t.size=function(d){return arguments.length?(u=!1,s=+d[0],a=+d[1],t):u?null:[s,a]},t.nodeSize=function(d){return arguments.length?(u=!0,s=+d[0],a=+d[1],t):u?[s,a]:null},t},R.hierarchy=Rl,R.pack=function(){function t(d){return d.x=s/2,d.y=a/2,r?d.eachBefore(ou(r)).eachAfter(su(u,.5)).eachBefore(qh(1)):d.eachBefore(ou(_p)).eachAfter(su(ui,1)).eachAfter(su(u,d.r/Math.min(s,a))).eachBefore(qh(Math.min(s,a)/(2*d.r))),d}var r=null,s=1,a=1,u=ui;return t.radius=function(d){return arguments.length?(r=d==null?null:ps(d),t):r},t.size=function(d){return arguments.length?(s=+d[0],a=+d[1],t):[s,a]},t.padding=function(d){return arguments.length?(u=typeof d=="function"?d:ms(+d),t):u},t},R.packSiblings=function(t){return Ll(t),t},R.packEnclose=nu,R.partition=function(){function t(m){var v=m.height+1;return m.x0=m.y0=u,m.x1=s,m.y1=a/v,m.eachBefore(r(a,v)),d&&m.eachBefore(gs),m}function r(m,v){return function(y){y.children&&qr(y,y.x0,m*(y.depth+1)/v,y.x1,m*(y.depth+2)/v);var b=y.x0,w=y.y0,A=y.x1-u,E=y.y1-u;A<b&&(b=A=(b+A)/2),E<w&&(w=E=(w+E)/2),y.x0=b,y.y0=w,y.x1=A,y.y1=E}}var s=1,a=1,u=0,d=!1;return t.round=function(m){return arguments.length?(d=!!m,t):d},t.size=function(m){return arguments.length?(s=+m[0],a=+m[1],t):[s,a]},t.padding=function(m){return arguments.length?(u=+m,t):u},t},R.stratify=function(){function t(a){var u,d=a.length,m=Array(d),v,y={};for(u=0;u<d;++u){var b=a[u],w=m[u]=new ds(b);(v=r(b,u,a))!=null&&(v+="")&&(b="$"+(w.id=v),y[b]=b in y?rv:w)}for(u=0;u<d;++u)if(w=m[u],v=s(a[u],u,a),v!=null&&(v+="")){if(b=y["$"+v],!b)throw Error("missing: "+v);if(b===rv)throw Error("ambiguous: "+v);b.children?b.children.push(w):b.children=[w],w.parent=b}else{if(A)throw Error("multiple roots");var A=w}if(!A)throw Error("no root");if(A.parent=Wy,A.eachBefore(function(E){E.depth=E.parent.depth+1,--d}).eachBefore(jh),A.parent=null,0<d)throw Error("cycle");return A}var r=Ea,s=Ii;return t.id=function(a){return arguments.length?(r=ps(a),t):r},t.parentId=function(a){return arguments.length?(s=ps(a),t):s},t},R.tree=function(){function t(y){var b=au(y);if(b.eachAfter(r),b.parent.m=-b.z,b.eachBefore(s),v)y.eachBefore(a);else{var w=y,A=y,E=y;y.eachBefore(function(ee){ee.x<w.x&&(w=ee),ee.x>A.x&&(A=ee),ee.depth>E.depth&&(E=ee)}),b=w===A?1:u(w,A)/2;var P=b-w.x,C=d/(A.x+b+P),B=m/(E.depth||1);y.eachBefore(function(ee){ee.x=(ee.x+P)*C,ee.y=ee.depth*B})}return y}function r(y){var b=y.children,w=y.parent.children,A=y.i?w[y.i-1]:null;if(b){for(var E=0,P=0,C=y.children,B=C.length,ee;0<=--B;)ee=C[B],ee.z+=E,ee.m+=E,E+=ee.s+(P+=ee.c);b=(b[0].z+b[b.length-1].z)/2,A?(y.z=A.z+u(y._,A._),y.m=y.z-b):y.z=b}else A&&(y.z=A.z+u(y._,A._));if(b=y.parent,w=y.parent.A||w[0],A){P=E=y,C=E.parent.children[0],B=E.m,ee=P.m;for(var Y=A.m,ce=C.m,ue;A=Aa(A),E=Ta(E),A&&E;){if(C=Ta(C),P=Aa(P),P.a=y,ue=A.z+Y-E.z-B+u(A._,E._),0<ue){var pe=A.a.parent===y.parent?A.a:w,Pe=y,Oe=ue,xe=Oe/(Pe.i-pe.i);Pe.c-=xe,Pe.s+=Oe,pe.c+=xe,Pe.z+=Oe,Pe.m+=Oe,B+=ue,ee+=ue}Y+=A.m,B+=E.m,ce+=C.m,ee+=P.m}A&&!Aa(P)&&(P.t=A,P.m+=Y-ee),E&&!Ta(C)&&(C.t=E,C.m+=B-ce,w=y)}b.A=w}function s(y){y._.x=y.z+y.parent.m,y.m+=y.parent.m}function a(y){y.x*=d,y.y=y.depth*m}var u=Sa,d=1,m=1,v=null;return t.separation=function(y){return arguments.length?(u=y,t):u},t.size=function(y){return arguments.length?(v=!1,d=+y[0],m=+y[1],t):v?null:[d,m]},t.nodeSize=function(y){return arguments.length?(v=!0,d=+y[0],m=+y[1],t):v?[d,m]:null},t},R.treemap=function(){function t(E){return E.x0=E.y0=0,E.x1=u,E.y1=d,E.eachBefore(r),m=[0],a&&E.eachBefore(gs),E}function r(E){var P=m[E.depth],C=E.x0+P,B=E.y0+P,ee=E.x1-P,Y=E.y1-P;ee<C&&(C=ee=(C+ee)/2),Y<B&&(B=Y=(B+Y)/2),E.x0=C,E.y0=B,E.x1=ee,E.y1=Y,E.children&&(P=m[E.depth+1]=v(E)/2,C+=A(E)-P,B+=y(E)-P,ee-=b(E)-P,Y-=w(E)-P,ee<C&&(C=ee=(C+ee)/2),Y<B&&(B=Y=(B+Y)/2),s(E,C,B,ee,Y))}var s=ov,a=!1,u=1,d=1,m=[0],v=ui,y=ui,b=ui,w=ui,A=ui;return t.round=function(E){return arguments.length?(a=!!E,t):a},t.size=function(E){return arguments.length?(u=+E[0],d=+E[1],t):[u,d]},t.tile=function(E){return arguments.length?(s=ps(E),t):s},t.padding=function(E){return arguments.length?t.paddingInner(E).paddingOuter(E):t.paddingInner()},t.paddingInner=function(E){return arguments.length?(v=typeof E=="function"?E:ms(+E),t):v},t.paddingOuter=function(E){return arguments.length?t.paddingTop(E).paddingRight(E).paddingBottom(E).paddingLeft(E):t.paddingTop()},t.paddingTop=function(E){return arguments.length?(y=typeof E=="function"?E:ms(+E),t):y},t.paddingRight=function(E){return arguments.length?(b=typeof E=="function"?E:ms(+E),t):b},t.paddingBottom=function(E){return arguments.length?(w=typeof E=="function"?E:ms(+E),t):w},t.paddingLeft=function(E){return arguments.length?(A=typeof E=="function"?E:ms(+E),t):A},t},R.treemapBinary=function(t,r,s,a,u){function d(A,E,P,C,B,ee,Y){if(A>=E-1)A=m[A],A.x0=C,A.y0=B,A.x1=ee,A.y1=Y;else{for(var ce=w[A],ue=P/2+ce,pe=A+1,Pe=E-1;pe<Pe;){var Oe=pe+Pe>>>1;w[Oe]<ue?pe=Oe+1:Pe=Oe}ue-w[pe-1]<w[pe]-ue&&A+1<pe&&--pe,ce=w[pe]-ce,ue=P-ce,ee-C>Y-B?(P=(C*ue+ee*ce)/P,d(A,pe,ce,C,B,P,Y),d(pe,E,ue,P,B,ee,Y)):(P=(B*ue+Y*ce)/P,d(A,pe,ce,C,B,ee,P),d(pe,E,ue,C,P,ee,Y))}}var m=t.children,v,y=m.length,b,w=Array(y+1);for(w[0]=b=v=0;v<y;++v)w[v+1]=b+=m[v].value;d(0,y,t.value,r,s,a,u)},R.treemapDice=qr,R.treemapSlice=Ra,R.treemapSliceDice=function(t,r,s,a,u){(t.depth&1?Ra:qr)(t,r,s,a,u)},R.treemapSquarify=ov,R.treemapResquarify=jy,R.interpolate=Ri,R.interpolateArray=th,R.interpolateBasis=Ai,R.interpolateBasisClosed=dl,R.interpolateDate=Xt,R.interpolateDiscrete=function(t){var r=t.length;return function(s){return t[Math.max(0,Math.min(r-1,Math.floor(s*r)))]}},R.interpolateHue=function(t,r){var s=fl(+t,+r);return function(a){return a=s(a),a-360*Math.floor(a/360)}},R.interpolateNumber=bn,R.interpolateObject=Ni,R.interpolateRound=rh,R.interpolateString=bo,R.interpolateTransformCss=wt,R.interpolateTransformSvg=zt,R.interpolateZoom=Sn,R.interpolateRgb=we,R.interpolateRgbBasis=ot,R.interpolateRgbBasisClosed=ut,R.interpolateHsl=qn,R.interpolateHslLong=ln,R.interpolateLab=function(t,r){var s=On((t=pc(t)).l,(r=pc(r)).l),a=On(t.a,r.a),u=On(t.b,r.b),d=On(t.opacity,r.opacity);return function(m){return t.l=s(m),t.a=a(m),t.b=u(m),t.opacity=d(m),t+""}},R.interpolateHcl=Xn,R.interpolateHclLong=Lr,R.interpolateCubehelix=Cs,R.interpolateCubehelixLong=Fi,R.piecewise=function(t,r){for(var s=0,a=r.length-1,u=r[0],d=Array(0>a?0:a);s<a;)d[s]=t(u,u=r[++s]);return function(m){var v=Math.max(0,Math.min(a-1,Math.floor(m*=a)));return d[v](m-v)}},R.quantize=function(t,r){for(var s=Array(r),a=0;a<r;++a)s[a]=t(a/(r-1));return s},R.path=Ar,R.polygonArea=function(t){for(var r=-1,s=t.length,a,u=t[s-1],d=0;++r<s;)a=u,u=t[r],d+=a[1]*u[0]-a[0]*u[1];return d/2},R.polygonCentroid=function(t){for(var r=-1,s=t.length,a=0,u=0,d,m=t[s-1],v,y=0;++r<s;)d=m,m=t[r],y+=v=d[0]*m[1]-m[0]*d[1],a+=(d[0]+m[0])*v,u+=(d[1]+m[1])*v;return y*=3,[a/y,u/y]},R.polygonHull=function(t){if(3>(s=t.length))return null;var r,s,a=Array(s),u=Array(s);for(r=0;r<s;++r)a[r]=[+t[r][0],+t[r][1],r];for(a.sort(Xh),r=0;r<s;++r)u[r]=[a[r][0],-a[r][1]];s=lu(a),u=lu(u);var d=u[0]===s[0],m=u[u.length-1]===s[s.length-1],v=[];for(r=s.length-1;0<=r;--r)v.push(t[a[s[r]][2]]);for(r=+d;r<u.length-m;++r)v.push(t[a[u[r]][2]]);return v},R.polygonContains=function(t,r){var s=t.length,a=t[s-1],u=r[0];r=r[1];for(var d=a[0],m=a[1],v,y=!1,b=0;b<s;++b)a=t[b],v=a[0],a=a[1],a>r!=m>r&&u<(d-v)*(r-a)/(m-a)+v&&(y=!y),d=v,m=a;return y},R.polygonLength=function(t){var r=-1,s=t.length,a=t[s-1],u=a[0];a=a[1];for(var d=0;++r<s;){var m=u,v=a;a=t[r],u=a[0],a=a[1],m-=u,v-=a,d+=Math.sqrt(m*m+v*v)}return d},R.quadtree=ia,R.randomUniform=Yy,R.randomNormal=sv,R.randomLogNormal=qy,R.randomBates=Xy,R.randomIrwinHall=av,R.randomExponential=Jy,R.scaleBand=Il,R.scalePoint=function(){return cu(Il().paddingInner(1))},R.scaleIdentity=hu,R.scaleLinear=Ul,R.scaleLog=bp,R.scaleOrdinal=Cl,R.scaleImplicit=i0,R.scalePow=Kh,R.scaleSqrt=function(){return Kh().exponent(.5)},R.scaleQuantile=Mp,R.scaleQuantize=wp,R.scaleThreshold=Ep,R.scaleTime=function(){return mu(Us,c0,ef,Kd,l0,a0,Qd,rc,R.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])},R.scaleUtc=function(){return mu(ks,d0,of,rf,h0,u0,Qd,rc,R.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])},R.scaleSequential=gu,R.scaleDiverging=vd,R.schemeCategory10=M1,R.schemeCategory20b=w1,R.schemeCategory20c=E1,R.schemeCategory20=S1,R.schemeAccent=T1,R.schemeDark2=A1,R.schemePaired=N1,R.schemePastel1=R1,R.schemePastel2=L1,R.schemeSet1=P1,R.schemeSet2=C1,R.schemeSet3=I1,R.interpolateBrBG=D1,R.schemeBrBG=wv,R.interpolatePRGn=O1,R.schemePRGn=Ev,R.interpolatePiYG=G1,R.schemePiYG=Sv,R.interpolatePuOr=B1,R.schemePuOr=Tv,R.interpolateRdBu=U1,R.schemeRdBu=Av,R.interpolateRdGy=k1,R.schemeRdGy=Nv,R.interpolateRdYlBu=F1,R.schemeRdYlBu=Rv,R.interpolateRdYlGn=z1,R.schemeRdYlGn=Lv,R.interpolateSpectral=H1,R.schemeSpectral=Pv,R.interpolateBuGn=V1,R.schemeBuGn=Cv,R.interpolateBuPu=W1,R.schemeBuPu=Iv,R.interpolateGnBu=j1,R.schemeGnBu=Dv,R.interpolateOrRd=Y1,R.schemeOrRd=Ov,R.interpolatePuBuGn=q1,R.schemePuBuGn=Gv,R.interpolatePuBu=X1,R.schemePuBu=Bv,R.interpolatePuRd=J1,R.schemePuRd=Uv,R.interpolateRdPu=Z1,R.schemeRdPu=kv,R.interpolateYlGnBu=$1,R.schemeYlGnBu=Fv,R.interpolateYlGn=Q1,R.schemeYlGn=zv,R.interpolateYlOrBr=K1,R.schemeYlOrBr=Hv,R.interpolateYlOrRd=ex,R.schemeYlOrRd=Vv,R.interpolateBlues=tx,R.schemeBlues=Wv,R.interpolateGreens=nx,R.schemeGreens=jv,R.interpolateGreys=rx,R.schemeGreys=Yv,R.interpolatePurples=ix,R.schemePurples=qv,R.interpolateReds=ox,R.schemeReds=Xv,R.interpolateOranges=sx,R.schemeOranges=Jv,R.interpolateCubehelixDefault=ax,R.interpolateRainbow=function(t){(0>t||1<t)&&(t-=Math.floor(t));var r=Math.abs(t-.5);return Bm.h=360*t-100,Bm.s=1.5-1.5*r,Bm.l=.8-.9*r,Bm+""},R.interpolateWarm=lx,R.interpolateCool=cx,R.interpolateSinebow=function(t){var r;return t=(.5-t)*Math.PI,Um.r=255*(r=Math.sin(t))*r,Um.g=255*(r=Math.sin(t+ux))*r,Um.b=255*(r=Math.sin(t+hx))*r,Um+""},R.interpolateViridis=dx,R.interpolateMagma=fx,R.interpolateInferno=px,R.interpolatePlasma=mx,R.create=function(t){return cr(Vt(t).call(document.documentElement))},R.creator=Vt,R.local=gr,R.matcher=K,R.mouse=wr,R.namespace=bt,R.namespaces=F,R.clientPoint=js,R.select=cr,R.selectAll=function(t){return typeof t=="string"?new J([document.querySelectorAll(t)],[document.documentElement]):new J([t??[]],ve)},R.selection=ji,R.selector=$n,R.selectorAll=ac,R.style=zr,R.touch=Yi,R.touches=function(t,r){r==null&&(r=Zo().touches);for(var s=0,a=r?r.length:0,u=Array(a);s<a;++s)u[s]=js(t,r[s]);return u},R.window=al,R.customEvent=lr,R.arc=function(){function t(){var b,w=+r.apply(this,arguments),A=+s.apply(this,arguments),E=d.apply(this,arguments)-km,P=m.apply(this,arguments)-km,C=Zv(P-E),B=P>E;if(y||(y=b=Ar()),A<w){var ee=A;A=w,w=ee}if(1e-12<A)if(C>nl-1e-12)y.moveTo(A*ic(E),A*Yo(E)),y.arc(0,0,A,E,P,!B),1e-12<w&&(y.moveTo(w*ic(P),w*Yo(P)),y.arc(0,0,w,P,E,B));else{var Y=E,ce=P;ee=E;var ue=P,pe=C,Pe=C,Oe=v.apply(this,arguments)/2,xe=1e-12<Oe&&(u?+u.apply(this,arguments):zu(w*w+A*A)),Ce=f0(Zv(A-w)/2,+a.apply(this,arguments)),ye=Ce,be=Ce;if(1e-12<xe){var Z=yd(xe/w*Yo(Oe));Oe=yd(xe/A*Yo(Oe)),1e-12<(pe-=2*Z)?(Z*=B?1:-1,ee+=Z,ue-=Z):(pe=0,ee=ue=(E+P)/2),1e-12<(Pe-=2*Oe)?(Oe*=B?1:-1,Y+=Oe,ce-=Oe):(Pe=0,Y=ce=(E+P)/2)}if(E=A*ic(Y),P=A*Yo(Y),Z=w*ic(ue),Oe=w*Yo(ue),1e-12<Ce){var fe=A*ic(ce),Ae=A*Yo(ce),et=w*ic(ee),mt=w*Yo(ee);if(C<tl){1e-12<pe?(ye=et-E,be=mt-P,C=Z-fe,xe=Oe-Ae,C=(C*(P-Ae)-xe*(E-fe))/(xe*ye-C*be),ye=[E+C*ye,P+C*be]):ye=[Z,Oe],be=E-ye[0],C=P-ye[1],xe=fe-ye[0];var ht=Ae-ye[1];be=(be*xe+C*ht)/(zu(be*be+C*C)*zu(xe*xe+ht*ht)),be=1/Yo((1<be?0:-1>be?tl:Math.acos(be))/2),C=zu(ye[0]*ye[0]+ye[1]*ye[1]),ye=f0(Ce,(w-C)/(be-1)),be=f0(Ce,(A-C)/(be+1))}}1e-12<Pe?1e-12<be?(Y=Ha(et,mt,E,P,A,be,B),ce=Ha(fe,Ae,Z,Oe,A,be,B),y.moveTo(Y.cx+Y.x01,Y.cy+Y.y01),be<Ce?y.arc(Y.cx,Y.cy,be,xr(Y.y01,Y.x01),xr(ce.y01,ce.x01),!B):(y.arc(Y.cx,Y.cy,be,xr(Y.y01,Y.x01),xr(Y.y11,Y.x11),!B),y.arc(0,0,A,xr(Y.cy+Y.y11,Y.cx+Y.x11),xr(ce.cy+ce.y11,ce.cx+ce.x11),!B),y.arc(ce.cx,ce.cy,be,xr(ce.y11,ce.x11),xr(ce.y01,ce.x01),!B))):(y.moveTo(E,P),y.arc(0,0,A,Y,ce,!B)):y.moveTo(E,P),1e-12<w&&1e-12<pe?1e-12<ye?(Y=Ha(Z,Oe,fe,Ae,w,-ye,B),ce=Ha(E,P,et,mt,w,-ye,B),y.lineTo(Y.cx+Y.x01,Y.cy+Y.y01),ye<Ce?y.arc(Y.cx,Y.cy,ye,xr(Y.y01,Y.x01),xr(ce.y01,ce.x01),!B):(y.arc(Y.cx,Y.cy,ye,xr(Y.y01,Y.x01),xr(Y.y11,Y.x11),!B),y.arc(0,0,w,xr(Y.cy+Y.y11,Y.cx+Y.x11),xr(ce.cy+ce.y11,ce.cx+ce.x11),B),y.arc(ce.cx,ce.cy,ye,xr(ce.y11,ce.x11),xr(ce.y01,ce.x01),!B))):y.arc(0,0,w,ue,ee,B):y.lineTo(Z,Oe)}else y.moveTo(0,0);if(y.closePath(),b)return y=null,b+""||null}var r=xd,s=Gp,a=jt(0),u=null,d=_d,m=bd,v=Md,y=null;return t.centroid=function(){var b=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2,w=(+d.apply(this,arguments)+ +m.apply(this,arguments))/2-tl/2;return[ic(w)*b,Yo(w)*b]},t.innerRadius=function(b){return arguments.length?(r=typeof b=="function"?b:jt(+b),t):r},t.outerRadius=function(b){return arguments.length?(s=typeof b=="function"?b:jt(+b),t):s},t.cornerRadius=function(b){return arguments.length?(a=typeof b=="function"?b:jt(+b),t):a},t.padRadius=function(b){return arguments.length?(u=b==null?null:typeof b=="function"?b:jt(+b),t):u},t.startAngle=function(b){return arguments.length?(d=typeof b=="function"?b:jt(+b),t):d},t.endAngle=function(b){return arguments.length?(m=typeof b=="function"?b:jt(+b),t):m},t.padAngle=function(b){return arguments.length?(v=typeof b=="function"?b:jt(+b),t):v},t.context=function(b){return arguments.length?(y=b??null,t):y},t},R.area=Bp,R.line=vu,R.pie=function(){function t(v){var y,b=v.length,w=0,A=Array(b),E=Array(b),P=+u.apply(this,arguments),C=Math.min(nl,Math.max(-nl,d.apply(this,arguments)-P)),B=Math.min(Math.abs(C)/b,m.apply(this,arguments)),ee=B*(0>C?-1:1),Y;for(y=0;y<b;++y)0<(Y=E[A[y]=y]=+r(v[y],y,v))&&(w+=Y);for(s!=null?A.sort(function(ue,pe){return s(E[ue],E[pe])}):a!=null&&A.sort(function(ue,pe){return a(v[ue],v[pe])}),y=0,C=w?(C-b*ee)/w:0;y<b;++y,P=ce){w=A[y],Y=E[w];var ce=P+(0<Y?Y*C:0)+ee;E[w]={data:v[w],index:y,value:Y,startAngle:P,endAngle:ce,padAngle:B}}return E}var r=kp,s=Up,a=null,u=jt(0),d=jt(nl),m=jt(0);return t.value=function(v){return arguments.length?(r=typeof v=="function"?v:jt(+v),t):r},t.sortValues=function(v){return arguments.length?(s=v,a=null,t):s},t.sort=function(v){return arguments.length?(a=v,s=null,t):a},t.startAngle=function(v){return arguments.length?(u=typeof v=="function"?v:jt(+v),t):u},t.endAngle=function(v){return arguments.length?(d=typeof v=="function"?v:jt(+v),t):d},t.padAngle=function(v){return arguments.length?(m=typeof v=="function"?v:jt(+v),t):m},t},R.areaRadial=Sd,R.radialArea=Sd,R.lineRadial=Ed,R.radialLine=Ed,R.pointRadial=Ya,R.linkHorizontal=function(){return yu(Hp)},R.linkVertical=function(){return yu(As)},R.linkRadial=function(){var t=yu(Vp);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t},R.symbol=function(){function t(){var u;if(a||(a=u=Ar()),r.apply(this,arguments).draw(a,+s.apply(this,arguments)),u)return a=null,u+""||null}var r=jt(m0),s=jt(64),a=null;return t.type=function(u){return arguments.length?(r=typeof u=="function"?u:jt(u),t):r},t.size=function(u){return arguments.length?(s=typeof u=="function"?u:jt(+u),t):s},t.context=function(u){return arguments.length?(a=u??null,t):a},t},R.symbols=bx,R.symbolCircle=m0,R.symbolCross=Qv,R.symbolDiamond=ey,R.symbolSquare=ry,R.symbolStar=ny,R.symbolTriangle=iy,R.symbolWye=oy,R.curveBasisClosed=function(t){return new ko(t)},R.curveBasisOpen=function(t){return new Td(t)},R.curveBasis=function(t){return new qa(t)},R.curveBundle=Mx,R.curveCardinalClosed=Ex,R.curveCardinalOpen=Sx,R.curveCardinal=wx,R.curveCatmullRomClosed=Ax,R.curveCatmullRomOpen=Nx,R.curveCatmullRom=Tx,R.curveLinearClosed=function(t){return new qp(t)},R.curveLinear=jl,R.curveMonotoneX=function(t){return new Mu(t)},R.curveMonotoneY=function(t){return new Kt(t)},R.curveNatural=function(t){return new Zp(t)},R.curveStep=function(t){return new Ns(t,.5)},R.curveStepAfter=function(t){return new Ns(t,1)},R.curveStepBefore=function(t){return new Ns(t,0)},R.stack=function(){function t(d){var m=r.apply(this,arguments),v,y=d.length,b=m.length,w=Array(b);for(v=0;v<b;++v){for(var A=m[v],E=w[v]=Array(y),P=0,C;P<y;++P)E[P]=C=[0,+u(d[P],A,P,d)],C.data=d[P];E.key=A}for(v=0,m=s(w);v<b;++v)w[m[v]].index=v;return a(w,m),w}var r=jt([]),s=Ls,a=Rs,u=$p;return t.keys=function(d){return arguments.length?(r=typeof d=="function"?d:jt(p0.call(d)),t):r},t.value=function(d){return arguments.length?(u=typeof d=="function"?d:jt(+d),t):u},t.order=function(d){return arguments.length?(s=d==null?Ls:typeof d=="function"?d:jt(p0.call(d)),t):s},t.offset=function(d){return arguments.length?(a=d??Rs,t):a},t},R.stackOffsetExpand=function(t,r){if(0<(a=t.length)){for(var s,a,u=0,d=t[0].length,m;u<d;++u){for(m=s=0;s<a;++s)m+=t[s][u][1]||0;if(m)for(s=0;s<a;++s)t[s][u][1]/=m}Rs(t,r)}},R.stackOffsetDiverging=function(t,r){if(1<(y=t.length))for(var s,a=0,u,d,m,v,y,b=t[r[0]].length;a<b;++a)for(s=m=v=0;s<y;++s)0<=(d=(u=t[r[s]][a])[1]-u[0])?(u[0]=m,u[1]=m+=d):0>d?(u[1]=v,u[0]=v+=d):u[0]=m},R.stackOffsetNone=Rs,R.stackOffsetSilhouette=function(t,r){if(0<(u=t.length)){for(var s=0,a=t[r[0]],u,d=a.length;s<d;++s){for(var m=0,v=0;m<u;++m)v+=t[m][s][1]||0;a[s][1]+=a[s][0]=-v/2}Rs(t,r)}},R.stackOffsetWiggle=function(t,r){if(0<(m=t.length)&&0<(d=(u=t[r[0]]).length)){for(var s=0,a=1,u,d,m;a<d;++a){for(var v=0,y=0,b=0;v<m;++v){var w=t[r[v]],A=w[a][1]||0;w=(A-(w[a-1][1]||0))/2;for(var E=0;E<v;++E){var P=t[r[E]];w+=(P[a][1]||0)-(P[a-1][1]||0)}y+=A,b+=w*A}u[a-1][1]+=u[a-1][0]=s,y&&(s-=b/y)}u[a-1][1]+=u[a-1][0]=s,Rs(t,r)}},R.stackOrderAscending=wu,R.stackOrderDescending=function(t){return wu(t).reverse()},R.stackOrderInsideOut=function(t){var r=t.length,s=t.map(Cd),a=Ls(t).sort(function(b,w){return s[w]-s[b]}),u=0,d=0,m=[],v=[];for(t=0;t<r;++t){var y=a[t];u<d?(u+=s[y],m.push(y)):(d+=s[y],v.push(y))}return v.reverse().concat(m)},R.stackOrderNone=Ls,R.stackOrderReverse=function(t){return Ls(t).reverse()},R.timeInterval=Un,R.timeMillisecond=rc,R.timeMilliseconds=uv,R.utcMillisecond=rc,R.utcMilliseconds=uv,R.timeSecond=Qd,R.timeSeconds=hv,R.utcSecond=Qd,R.utcSeconds=hv,R.timeMinute=a0,R.timeMinutes=Zy,R.timeHour=l0,R.timeHours=$y,R.timeDay=Kd,R.timeDays=Qy,R.timeWeek=ef,R.timeWeeks=gv,R.timeSunday=ef,R.timeSundays=gv,R.timeMonday=tf,R.timeMondays=Ky,R.timeTuesday=dv,R.timeTuesdays=e1,R.timeWednesday=fv,R.timeWednesdays=t1,R.timeThursday=nf,R.timeThursdays=n1,R.timeFriday=pv,R.timeFridays=r1,R.timeSaturday=mv,R.timeSaturdays=i1,R.timeMonth=c0,R.timeMonths=o1,R.timeYear=Us,R.timeYears=s1,R.utcMinute=u0,R.utcMinutes=a1,R.utcHour=h0,R.utcHours=l1,R.utcDay=rf,R.utcDays=c1,R.utcWeek=of,R.utcWeeks=bv,R.utcSunday=of,R.utcSundays=bv,R.utcMonday=sf,R.utcMondays=u1,R.utcTuesday=vv,R.utcTuesdays=h1,R.utcWednesday=yv,R.utcWednesdays=d1,R.utcThursday=af,R.utcThursdays=f1,R.utcFriday=xv,R.utcFridays=p1,R.utcSaturday=_v,R.utcSaturdays=m1,R.utcMonth=d0,R.utcMonths=g1,R.utcYear=ks,R.utcYears=v1,R.timeFormatDefaultLocale=md,R.timeFormatLocale=Fl,R.isoFormat=_1,R.isoParse=b1,R.now=tr,R.timer=Js,R.timerFlush=_c,R.timeout=Zs,R.interval=function(t,r,s){var a=new es,u=r;return r==null?(a.restart(t,r,s),a):(r=+r,s=s==null?tr():+s,a.restart(function d(m){m+=u,a.restart(d,u+=r,s),t(m)},r,s),a)},R.transition=Rc,R.active=function(t,r){var s=t.__transition,a,u;if(s){for(u in r=r==null?null:r+"",s)if(1<(a=s[u]).state&&a.name===r)return new Tr([[t]],Ud,r,+u)}return null},R.interrupt=Li,R.voronoi=function(){function t(u){return new Zl(u.map(function(d,m){var v=[Math.round(r(d,m,u)/mn)*mn,Math.round(s(d,m,u)/mn)*mn];return v.index=m,v.data=d,v}),a)}var r=Qp,s=Eu,a=null;return t.polygons=function(u){return t(u).polygons()},t.links=function(u){return t(u).links()},t.triangles=function(u){return t(u).triangles()},t.x=function(u){return arguments.length?(r=typeof u=="function"?u:Ps(+u),t):r},t.y=function(u){return arguments.length?(s=typeof u=="function"?u:Ps(+u),t):s},t.extent=function(u){return arguments.length?(a=u==null?null:[[+u[0][0],+u[0][1]],[+u[1][0],+u[1][1]]],t):a&&[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},t.size=function(u){return arguments.length?(a=u==null?null:[[0,0],[+u[0],+u[1]]],t):a&&[a[1][0]-a[0][0],a[1][1]-a[0][1]]},t},R.zoom=function(){function t(Z){Z.property("__zoom",i).on("wheel.zoom",v).on("mousedown.zoom",y).on("dblclick.zoom",b).filter(Y).on("touchstart.zoom",w).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function r(Z,fe){return fe=Math.max(ce[0],Math.min(ce[1],fe)),fe===Z.k?Z:new uo(fe,Z.x,Z.y)}function s(Z,fe,Ae){var et=fe[0]-Ae[0]*Z.k;return fe=fe[1]-Ae[1]*Z.k,et===Z.x&&fe===Z.y?Z:new uo(Z.k,et,fe)}function a(Z){return[(+Z[0][0]+ +Z[1][0])/2,(+Z[0][1]+ +Z[1][1])/2]}function u(Z,fe,Ae){Z.on("start.zoom",function(){d(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){d(this,arguments).end()}).tween("zoom",function(){var et=arguments,mt=d(this,et),ht=C.apply(this,et),It=Ae||a(ht),Ht=Math.max(ht[1][0]-ht[0][0],ht[1][1]-ht[0][1]);ht=this.__zoom;var Vu=typeof fe=="function"?fe.apply(this,et):fe,Wu=Pe(ht.invert(It).concat(Ht/ht.k),Vu.invert(It).concat(Ht/Vu.k));return function($r){if($r===1)$r=Vu;else{$r=Wu($r);var rl=Ht/$r[2];$r=new uo(rl,It[0]-$r[0]*rl,It[1]-$r[1]*rl)}mt.zoom(null,$r)}})}function d(Z,fe){for(var Ae=0,et=Oe.length,mt;Ae<et;++Ae)if((mt=Oe[Ae]).that===Z)return mt;return new m(Z,fe)}function m(Z,fe){this.that=Z,this.args=fe,this.index=-1,this.active=0,this.extent=C.apply(Z,fe)}function v(){if(P.apply(this,arguments)){var Z=d(this,arguments),fe=this.__zoom,Ae=Math.max(ce[0],Math.min(ce[1],fe.k*Math.pow(2,ee.apply(this,arguments)))),et=wr(this);if(Z.wheel)(Z.mouse[0][0]!==et[0]||Z.mouse[0][1]!==et[1])&&(Z.mouse[1]=fe.invert(Z.mouse[0]=et)),clearTimeout(Z.wheel);else{if(fe.k===Ae)return;Z.mouse=[et,fe.invert(et)],Li(this),Z.start()}c(),Z.wheel=setTimeout(function(){Z.wheel=null,Z.end()},150),Z.zoom("mouse",B(s(r(fe,Ae),Z.mouse[0],Z.mouse[1]),Z.extent,ue))}}function y(){if(!ye&&P.apply(this,arguments)){var Z=d(this,arguments),fe=cr(R.event.view).on("mousemove.zoom",function(){if(c(),!Z.moved){var ht=R.event.clientX-et,It=R.event.clientY-mt;Z.moved=ht*ht+It*It>be}Z.zoom("mouse",B(s(Z.that.__zoom,Z.mouse[0]=wr(Z.that),Z.mouse[1]),Z.extent,ue))},!0).on("mouseup.zoom",function(){fe.on("mousemove.zoom mouseup.zoom",null),ni(R.event.view,Z.moved),c(),Z.end()},!0),Ae=wr(this),et=R.event.clientX,mt=R.event.clientY;ti(R.event.view),R.event.stopImmediatePropagation(),Z.mouse=[Ae,this.__zoom.invert(Ae)],Li(this),Z.start()}}function b(){if(P.apply(this,arguments)){var Z=this.__zoom,fe=wr(this),Ae=Z.invert(fe);Z=B(s(r(Z,Z.k*(R.event.shiftKey?.5:2)),fe,Ae),C.apply(this,arguments),ue),c(),0<pe?cr(this).transition().duration(pe).call(u,Z,fe):cr(this).call(t.transform,Z)}}function w(){if(P.apply(this,arguments)){var Z=d(this,arguments),fe=R.event.changedTouches,Ae=fe.length,et;for(R.event.stopImmediatePropagation(),et=0;et<Ae;++et){var mt=fe[et],ht=Yi(this,fe,mt.identifier);if(ht=[ht,this.__zoom.invert(ht),mt.identifier],Z.touch0)Z.touch1||(Z.touch1=ht);else{Z.touch0=ht;var It=!0}}if(Ce&&(Ce=clearTimeout(Ce),!Z.touch1)){Z.end(),(ht=cr(this).on("dblclick.zoom"))&&ht.apply(this,arguments);return}It&&(Ce=setTimeout(function(){Ce=null},500),Li(this),Z.start())}}function A(){var Z=d(this,arguments),fe=R.event.changedTouches,Ae=fe.length,et;for(c(),Ce&&(Ce=clearTimeout(Ce)),et=0;et<Ae;++et){var mt=fe[et],ht=Yi(this,fe,mt.identifier);Z.touch0&&Z.touch0[2]===mt.identifier?Z.touch0[0]=ht:Z.touch1&&Z.touch1[2]===mt.identifier&&(Z.touch1[0]=ht)}if(mt=Z.that.__zoom,Z.touch1){ht=Z.touch0[0],fe=Z.touch0[1],et=Z.touch1[0],Ae=Z.touch1[1];var It=(It=et[0]-ht[0])*It+(It=et[1]-ht[1])*It,Ht=(Ht=Ae[0]-fe[0])*Ht+(Ht=Ae[1]-fe[1])*Ht;mt=r(mt,Math.sqrt(It/Ht)),ht=[(ht[0]+et[0])/2,(ht[1]+et[1])/2],It=[(fe[0]+Ae[0])/2,(fe[1]+Ae[1])/2]}else if(Z.touch0)ht=Z.touch0[0],It=Z.touch0[1];else return;Z.zoom("touch",B(s(mt,ht,It),Z.extent,ue))}function E(){var Z=d(this,arguments),fe=R.event.changedTouches,Ae=fe.length,et;for(R.event.stopImmediatePropagation(),ye&&clearTimeout(ye),ye=setTimeout(function(){ye=null},500),et=0;et<Ae;++et){var mt=fe[et];Z.touch0&&Z.touch0[2]===mt.identifier?delete Z.touch0:Z.touch1&&Z.touch1[2]===mt.identifier&&delete Z.touch1}Z.touch1&&!Z.touch0&&(Z.touch0=Z.touch1,delete Z.touch1),Z.touch0?Z.touch0[1]=this.__zoom.invert(Z.touch0[0]):Z.end()}var P=e,C=n,B=h,ee=o,Y=l,ce=[0,1/0],ue=[[-1/0,-1/0],[1/0,1/0]],pe=250,Pe=Sn,Oe=[],xe=ke("start","zoom","end"),Ce,ye,be=0;return t.transform=function(Z,fe){var Ae=Z.selection?Z.selection():Z;Ae.property("__zoom",i),Z!==Ae?u(Z,fe):Ae.interrupt().each(function(){d(this,arguments).start().zoom(null,typeof fe=="function"?fe.apply(this,arguments):fe).end()})},t.scaleBy=function(Z,fe){t.scaleTo(Z,function(){var Ae=this.__zoom.k,et=typeof fe=="function"?fe.apply(this,arguments):fe;return Ae*et})},t.scaleTo=function(Z,fe){t.transform(Z,function(){var Ae=C.apply(this,arguments),et=this.__zoom,mt=a(Ae),ht=et.invert(mt),It=typeof fe=="function"?fe.apply(this,arguments):fe;return B(s(r(et,It),mt,ht),Ae,ue)})},t.translateBy=function(Z,fe,Ae){t.transform(Z,function(){return B(this.__zoom.translate(typeof fe=="function"?fe.apply(this,arguments):fe,typeof Ae=="function"?Ae.apply(this,arguments):Ae),C.apply(this,arguments),ue)})},t.translateTo=function(Z,fe,Ae){t.transform(Z,function(){var et=C.apply(this,arguments),mt=this.__zoom,ht=a(et);return B(Fm.translate(ht[0],ht[1]).scale(mt.k).translate(typeof fe=="function"?-fe.apply(this,arguments):-fe,typeof Ae=="function"?-Ae.apply(this,arguments):-Ae),et,ue)})},m.prototype={start:function(){return++this.active===1&&(this.index=Oe.push(this)-1,this.emit("start")),this},zoom:function(Z,fe){return this.mouse&&Z!=="mouse"&&(this.mouse[1]=fe.invert(this.mouse[0])),this.touch0&&Z!=="touch"&&(this.touch0[1]=fe.invert(this.touch0[0])),this.touch1&&Z!=="touch"&&(this.touch1[1]=fe.invert(this.touch1[0])),this.that.__zoom=fe,this.emit("zoom"),this},end:function(){return--this.active===0&&(Oe.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(Z){lr(new rm(t,Z,this.that.__zoom),xe.apply,xe,[Z,this.that,this.args])}},t.wheelDelta=function(Z){return arguments.length?(ee=typeof Z=="function"?Z:$l(+Z),t):ee},t.filter=function(Z){return arguments.length?(P=typeof Z=="function"?Z:$l(!!Z),t):P},t.touchable=function(Z){return arguments.length?(Y=typeof Z=="function"?Z:$l(!!Z),t):Y},t.extent=function(Z){return arguments.length?(C=typeof Z=="function"?Z:$l([[+Z[0][0],+Z[0][1]],[+Z[1][0],+Z[1][1]]]),t):C},t.scaleExtent=function(Z){return arguments.length?(ce[0]=+Z[0],ce[1]=+Z[1],t):[ce[0],ce[1]]},t.translateExtent=function(Z){return arguments.length?(ue[0][0]=+Z[0][0],ue[1][0]=+Z[1][0],ue[0][1]=+Z[0][1],ue[1][1]=+Z[1][1],t):[[ue[0][0],ue[0][1]],[ue[1][0],ue[1][1]]]},t.constrain=function(Z){return arguments.length?(B=Z,t):B},t.duration=function(Z){return arguments.length?(pe=+Z,t):pe},t.interpolate=function(Z){return arguments.length?(Pe=Z,t):Pe},t.on=function(){var Z=xe.on.apply(xe,arguments);return Z===xe?t:Z},t.clickDistance=function(Z){return arguments.length?(be=(Z=+Z)*Z,t):Math.sqrt(be)},t},R.zoomTransform=im,R.zoomIdentity=Fm,F.svg=F.svg,F.xhtml=F.xhtml,F.xlink=F.xlink,F.xml=F.xml,F.xmlns=F.xmlns,globalThis.d3=R})()});var _0=4,cy=4,oc=9,uy=16,hy=200,b0=12,dy=14,fy=6,py=6,my=9,gy=1e3;var M0=25;var vy=.1;var ju="Node data provider: ",Wi=10;var Hm="__value",w0="__tensor_tag",Fs=20;var Vm=14;var Vx=new OffscreenCanvas(300,300),yy={},H_=typeof navigator<"u"&&/Macintosh/.test(navigator.userAgent);function pr(S){return S?.nodeType===0}function tn(S){return S?.nodeType===1}function E0(S){let G=[];for(let[ae,O]of Object.entries(S))switch(ae){case"Op node id":O.selected&&G.push("id");break;default:break}return G}function S0(S){let G=[];for(let[ae,O]of Object.entries(S))switch(ae){case"Layer node children count":O.selected&&G.push("#children");break;case"Layer node descendants count":O.selected&&G.push("#descendants");break;default:break}return G}function T0(S,G){if(pr(S))switch(G.toLowerCase()){case"id":return S.id;case"namespace":return xy(S);default:break}else if(tn(S))switch(G.toLowerCase()){case"namespace":return xy(S);case"#children":return String((S.nsChildrenIds||[]).length);case"#descendants":return String((S.descendantsNodeIds||[]).length);default:break}return""}function xy(S){return S.fullNamespace||S.namespace||"<root>"}function il(S,G,ae,O=!1){let q=[];S==null?q=G.rootNodes.map(ge=>ge.id):q=S.nsChildrenIds||[];for(let ge of q){let oe=G.nodesById[ge];if(oe&&tn(oe)&&(O||!O&&oe.expanded)){let se=oe.nsChildrenIds||[];(O?se.filter(Q=>tn(G.nodesById[Q])).length===0:se.filter(Q=>tn(G.nodesById[Q])).every(Q=>!G.nodesById[Q].expanded))&&ae.push(oe.id),il(oe,G,ae,O)}}}function _y(S,G,ae,O,q){let ge=[];if(S.length===2)ge=S;else if(S.length===3&&q&&S[0].x===S[1].x&&S[1].x===S[2].x||!q&&S[0].y===S[1].y&&S[1].y===S[2].y)ge=S;else{let oe=!0,se=0;for(let Q=0;Q<S.length-1;Q++){let W=S[Q],H=S[Q+1],k=(q?H.y:H.x)>(q?W.y:W.x)?1:-1;if(se!==0&&se!==k){oe=!1;break}se=k}let le=O.Vector3;if(oe){let W=G().x($=>$.x).y($=>$.y).curve(ae)(S).split(/M|C/).filter($=>$!=="").map($=>$.split(",").map(X=>Number(X))),H=new le(W[0][0],W[0][1],0),k=new O.CurvePath;for(let $=1;$<W.length;$++){let X=W[$];if(X.length===6){let ne=H,j=new le(X[0],X[1]),z=new le(X[2],X[3]),me=new le(X[4],X[5]);H=me;let Re=new O.CubicBezierCurve3(ne,j,z,me);k.add(Re)}}ge=k.getPoints(M0)}else{let Q=S.map(H=>new le(H.x,H.y,0));ge=new O.CatmullRomCurve3(Q,!1,"catmullrom",vy).getPoints(M0)}}return ge}function zs(S,G,ae,O=!0){let q=`${S}___${G}___${ae}`,ge=yy[q];if(ge==null){let oe=Vx.getContext("2d");oe.font=`${G}px "Google Sans Text", Arial, Helvetica, sans-serif`,ae&&(oe.font=`bold ${oe.font}`);let le=oe.measureText(S).width;O&&(yy[q]=le),ge=le}return ge}function Wx(S,G,ae){let O=ae[w0];return O?`Input${S}:${O} (${G.label})`:`Input${S} (${G.label})`}function jx(S,G,ae){let O=`Output${S}`;if(ae.label==="GraphInputs"){let q=G.tensor_name;q!=null&&(O=`${O} (${q})`)}else{let q=G[w0];q&&(O=`Output${S}:${q}`)}return O}function by(S){let G=((S||{}).shape||"").replace(/ /g,"").replace(//g,"x");return G===""&&(G="?"),G}function A0(S,G=""){let ae=S.attrs||{},O=[],q=new RegExp(G,"i");for(let ge of Object.keys(ae)){let oe=ge,se=ae[ge];if(typeof se=="string"){let le=[`${oe}:${se}`,`${oe}=${se}`];if(G.trim()===""||le.some(Q=>q.test(Q))){let Q=se;oe===Hm?Q=se.replace(/\s/gm,""):Q=se.replace(/(\r\n|\n|\r)/gm," "),O.push({key:oe,value:Q})}}}return O}function N0(S,G,ae=""){let O=G.groupNodeAttributes?.[S.id.replace("___group___","")]||{},q=[],ge=new RegExp(ae,"i");for(let oe of Object.keys(O)){let se=oe,le=O[oe],Q=[`${se}:${le}`,`${se}=${le}`];if(ae.trim()===""||Q.some(W=>ge.test(W))){let W=le.replace(/(\r\n|\n|\r)/gm," ");q.push({key:se,value:W})}}return q}function My(S,G){let ae=S.incomingEdges||[],O=[];for(let q=0;q<Math.min(Wi,ae.length);q++){let ge=ae[q],oe=ge.sourceNodeId,se=G.nodesById[oe],le=by((se.outputsMetadata||{})[ge.sourceNodeOutputId]),Q=(S.inputsMetadata||{})[ge.targetNodeInputId]||{};O.push({key:Wx(q,se,Q),value:le})}if(ae.length>Wi){let q=ae.length-Wi;O.push({key:`(${q} more input${q===1?"":"s"} omitted)`,value:"..."})}return O}function wy(S){let G=[],ae=S.outputsMetadata||{},O=Object.values(ae);for(let q=0;q<Math.min(Wi,O.length);q++){let ge=O[q],oe=by(ge);G.push({key:jx(q,ge,S),value:oe})}if(O.length>Wi){let q=O.length-Wi;G.push({key:`(${q} more output${q===1?"":"s"} omitted)`,value:"..."})}return G}function Ey(S,G,ae,O,q){let ge=[],oe=Object.keys(ae).filter(le=>ae[le].selected).filter(le=>le.startsWith(ju)).map(le=>le.replace(ju,"")),se=Object.values(O).filter(le=>oe.includes(Wm(le,{id:G})));for(let le of se){let Q=((le.results||{})?.[G]||{})[S.id];if(q?.hideEmptyNodeDataEntries&&!Q)continue;let W=Q?.strValue||"-";ge.push({key:Wm(le,{id:G}),value:W})}return ge}function Sy(S,G){let ae=S.split("/"),O=G.split("/"),q="";for(let ge=Math.min(ae.length,O.length);ge>0;ge--){let oe=ae.slice(0,ge).join("/"),se=O.slice(0,ge).join("/");if(oe===se){q=se;break}}return q}function R0(S,G){if(S===G)return"";let ae=S.split("/").filter(q=>q!==""),O=G.split("/").filter(q=>q!=="");return O.length===0?"":O[ae.length]}function ff(S){return S.split(`
`).map(G=>G.trim()).filter(G=>G!=="")}function jm(S){return(ff(S).length-1)*Vm}function Wm(S,G){return S.nodeDataProviderData?.[G?.id||""]?.name??S.runName}function L0(S,G,ae){let O={},q=S?.descendantsOpNodeIds||G.nodes.map(ge=>ge.id);for(let ge of q){let oe=G.nodesById[ge],se=ae[oe.id]?.bgColor||"";se&&(O[se]?O[se].count++:O[se]={label:`${ae[ge]?.value||""}`,bgColor:se,count:1})}return Object.values(O).sort((ge,oe)=>ge.bgColor.localeCompare(oe.bgColor))}function P0(S,G){let ae=G.replace("___group___","");for(let O of S.groupNodeConfigs||[])try{if(new RegExp(O.namespaceRegex).test(ae))return O.layoutDirection??0}catch(q){console.warn("Invalid regex in groupNodeConfigs",O.namespaceRegex,q)}return 0}var C0=36,Ay=16,Ty=26,Yx=50,qx=24,Xx=80,Jx=8,_i=class{constructor(G,ae,O,q,ge,oe=!1,se){this.modelGraph=G;this.dagre=ae;this.showOnNodeItemTypes=O;this.nodeDataProviderRuns=q;this.selectedNodeDataProviderRunId=ge;this.testMode=oe;this.config=se;this.dagreGraph=new this.dagre.graphlib.Graph}dagreGraph;layout(G){let ae,O=[];G==null?O=this.modelGraph.rootNodes:(ae=this.modelGraph.nodesById[G],O=(ae.nsChildrenIds||[]).map(z=>this.modelGraph.nodesById[z])),this.configLayout(this.dagreGraph,G);let q=D0(ae?.id||"",O,this.modelGraph,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,!1,this.config);for(let z of Object.keys(q.nodes)){let me=q.nodes[z];me.config?.pinToGroupTop||this.dagreGraph.setNode(z,me)}for(let z of Object.keys(q.outgoingEdges))for(let me of q.outgoingEdges[z])this.dagreGraph.setEdge(z,me);this.dagre.layout(this.dagreGraph);let ge=Number.MAX_VALUE,oe=Number.MAX_VALUE,se=Number.NEGATIVE_INFINITY,le=Number.NEGATIVE_INFINITY;for(let z of O){let me=q.nodes[z.id];if(!me){console.warn(`Node "${z.id}" is not in the dagre layout result`);continue}z.x=(me.x||0)-me.width/2,z.y=(me.y||0)-me.height/2,z.width=me.width,z.height=me.height,z.localOffsetX=0,z.localOffsetY=0,me.config?.pinToGroupTop||(ge=Math.min(ge,z.x),oe=Math.min(oe,z.y),se=Math.max(se,z.x+z.width),le=Math.max(le,z.y+z.height))}let Q=Number.MAX_VALUE,W=Number.MAX_VALUE,H=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY,$=this.dagreGraph.edges(),X=[],ne=P0(this.modelGraph,G??"");for(let z of $){let me=this.dagreGraph.edge(z).points,Re=globalThis.d3,Xe=globalThis.THREE,ze=typeof Xe>"u"?[]:_y(me,Re.line,Re[ne===0?"curveMonotoneY":"curveMonotoneX"],Xe,ne===0),Ge=this.modelGraph.nodesById[z.v],tt=this.modelGraph.nodesById[z.w];if(Ge==null){console.warn(`Edge from node not found: "${z.v}"`);continue}if(tt==null){console.warn(`Edge to node not found: "${z.w}"`);continue}let ft=`${Ge.id}|${tt.id}`;X.push({id:ft,fromNodeId:Ge.id,toNodeId:tt.id,points:me,curvePoints:ze});for(let je of me)Q=Math.min(Q,je.x),W=Math.min(W,je.y),H=Math.max(H,je.x),k=Math.max(k,je.y)}if(this.modelGraph.edgesByGroupNodeIds[G||""]=X,Q<ge)for(let z of O)z.localOffsetX=Math.max(0,ge-Q);ge=Math.min(Q,ge),se=Math.max(H,se);let j=se-ge+Fs*2;if(ae){let z=mf(ae,this.modelGraph,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config);if(ae.pinToTopOpNode){let me=mf(ae.pinToTopOpNode,this.modelGraph,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config)+Fs*2;z=Math.max(z,me)}if(j<z){let me=(z-j)/2;for(let Re of O)Re.localOffsetX||(Re.localOffsetX=0),Re.localOffsetX+=me;j=z}}if(O.length===1&&pr(O[0])&&O[0].config?.pinToGroupTop&&(ge=0,oe=0,le=-15),ae&&tn(ae)){let z=Ny(ae,this.modelGraph,this.showOnNodeItemTypes);if(z>0){let me=z*b0+16;for(let Re of O)Re.localOffsetY=me;le+=me}}return{x:ge,y:oe,width:j-Fs*2,height:le-oe}}configLayout(G,ae){let O=P0(this.modelGraph,ae??""),q="";switch(O){case 0:q="TB";break;case 1:q="LR";break;default:q="TB"}G.setGraph({rankdir:q,nodesep:this.modelGraph.layoutConfigs?.nodeSep??20,ranksep:this.modelGraph.layoutConfigs?.rankSep??50,edgesep:this.modelGraph.layoutConfigs?.edgeSep??20,marginx:Fs,marginy:C0}),G.setDefaultEdgeLabel(()=>({}))}};function mf(S,G,ae,O,q,ge=!1,oe){if(ge)return Yx;let se=S.label,le=ff(se),Q=0;for(let X of le)Q=Math.max(zs(X,11,tn(S))+qx,Q);tn(S)&&(Q+=28);let W=0,H=0,k=0;if(pr(S)){let X=E0(ae);for(let z of X){let me=zs(`${z}:`,oc,!0),Re=T0(S,z),Xe=zs(Re,oc,!1);W=Math.max(W,me),H=Math.max(H,Xe)}if(ae["Op node attributes"]?.selected){let z=A0(S,ae["Op node attributes"]?.filterRegex||""),me=pf(z);W=Math.max(W,me.maxAttrLabelWidth),H=Math.max(H,me.maxAttrValueWidth)}if(ae["Op node inputs"]?.selected){let z=My(S,G),me=pf(z);W=Math.max(W,me.maxAttrLabelWidth),H=Math.max(H,me.maxAttrValueWidth)}if(ae["Op node outputs"]?.selected){let z=wy(S),me=pf(z);W=Math.max(W,me.maxAttrLabelWidth),H=Math.max(H,me.maxAttrValueWidth)}let ne=Ey(S,G.id,ae,O,oe),j=pf(ne);W=Math.max(W,j.maxAttrLabelWidth),H=Math.max(H,j.maxAttrValueWidth)}else if(tn(S)){let X=S0(ae);for(let ne of X){let j=zs(`${ne}:`,oc,!0),z=T0(S,ne),me=zs(z,oc,!1);W=Math.max(W,j),H=Math.max(H,me)}if(ae["Layer node attributes"]?.selected){let ne=N0(S,G,ae["Layer node attributes"]?.filterRegex||""),j=pf(ne);W=Math.max(W,j.maxAttrLabelWidth),H=Math.max(H,j.maxAttrValueWidth)}if(tn(S)&&!S.expanded&&q&&O[q]){let ne=O[q];if((ne.nodeDataProviderData??{})[G.id]?.showExpandedSummaryOnGroupNode??!1){let z=L0(S,G,(ne.results??{})[G.id]);for(let me of z){let Re=zs(`${me.label} 100% (${me.count})`,my,!1)+30;k=Math.max(k,Re)}}}}H=Math.min(H,hy);let $=W+H+cy*2+_0;return $!==_0&&($+=Jx*2),Math.max(Math.max(Xx,Math.max(Q,$)),k)}function I0(S,G,ae,O,q,ge=!1,oe=!1,se){if(ge)return Ty;if(S.height!=null&&!oe)return S.height;let le=jm(S.label),Q=0;pr(S)?Q=Zx(ae,S,O,G,se):tn(S)&&(Q=Ny(S,G,ae));let W=0;if(tn(S)&&!S.expanded&&q&&O[q]){let H=O[q];((H.nodeDataProviderData??{})[G.id]?.showExpandedSummaryOnGroupNode??!1)&&(W=L0(S,G,(H.results??{})[G.id]).length)}return Ty+le+Q*b0+(Q>0?uy-4:0)+W*dy+(W>0?fy+py:0)}function D0(S,G,ae,O,q,ge,oe=!1,se=!1,le){let Q={nodes:{},incomingEdges:{},outgoingEdges:{}};for(let H of G){if(pr(H)&&H.hideInLayout)continue;let k={id:H.id,width:H.width||(se?10:mf(H,ae,O,q,ge,oe,le)),height:se?10:I0(H,ae,O,q,ge,oe,!1,le),config:pr(H)?H.config:void 0};Q.nodes[H.id]=k}let W=ae.layoutGraphEdges[S]||{};for(let[H,k]of Object.entries(W))for(let $ of Object.keys(k)){let X=ae.nodesById[H],ne=ae.nodesById[$];X&&pr(X)&&X.config?.pinToGroupTop||ne&&pr(ne)&&ne.config?.pinToGroupTop||$x(Q,H,$)}return Q}function Zx(S,G,ae,O,q){let ge=E0(S),oe=S["Op node attributes"]?.selected?A0(G,S["Op node attributes"]?.filterRegex||"").length:0,se=S["Op node inputs"]?.selected?Object.keys(G.incomingEdges||[]).length:0;se>Wi&&(se=Wi+1);let le=S["Op node outputs"]?.selected?Object.keys(G.outputsMetadata||{}).length:0;le>Wi&&(le=Wi+1);let Q=Object.keys(S).filter(W=>S[W].selected).filter(W=>W.startsWith(ju)&&Object.values(ae).some(H=>{let k=((H.results||{})?.[O.id]||{})[G.id];return q?.hideEmptyNodeDataEntries&&!k?!1:Wm(H,O)===W.replace(ju,"")})).length;return ge.length+oe+se+le+Q}function Ny(S,G,ae){let O=S0(ae),q=ae["Layer node attributes"]?.selected?N0(S,G,ae["Layer node attributes"]?.filterRegex||"").length:0;return O.length+q}function $x(S,G,ae){S.outgoingEdges[G]==null&&(S.outgoingEdges[G]=[]),S.outgoingEdges[G].push(ae),S.incomingEdges[ae]==null&&(S.incomingEdges[ae]=[]),S.incomingEdges[ae].push(G)}function pf(S){let G=0,ae=0;for(let{key:O,value:q}of S){let ge=zs(O,oc,!0);G=Math.max(G,ge);let oe=zs(q,oc,!1);ae=Math.max(ae,oe)}return{maxAttrLabelWidth:G,maxAttrValueWidth:ae}}var sc=class{constructor(G,ae,O,q,ge,oe=!1,se){this.modelGraph=G;this.dagre=ae;this.showOnNodeItemTypes=O;this.nodeDataProviderRuns=q;this.selectedNodeDataProviderRunId=ge;this.testMode=oe;this.config=se}dagreGraphs=[];expandGroupNode(G){let ae=this.modelGraph.nodesById[G];if(ae&&tn(ae)){if(ae.expanded)return;ae.expanded=!0}let O=G;for(;O!=null;){let ge=this.modelGraph.nodesById[O];if(!ge)break;ge.expanded=!0;let oe=new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config),se=oe.layout(O);this.testMode&&this.dagreGraphs.push(oe.dagreGraph);let le=se.width+Fs*2,Q=this.getTargetGroupNodeHeight(se,ge);ge.width=le,ge.height=Q,O=ge.nsParentId}let q=new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config);q.layout(),this.testMode&&this.dagreGraphs.push(q.dagreGraph);for(let ge of this.modelGraph.rootNodes)tn(ge)&&this.updateNodeOffset(ge)}expandFromDeepestGroupNodes(G){let ae=new Set,O=[...G];for(;O.length>0;){let oe=O.shift();if(ae.has(oe)||!this.modelGraph.nodesById[oe])continue;ae.add(oe);let le=this.modelGraph.nodesById[oe]?.nsParentId;le&&O.push(le)}let q=Array.from(ae).sort((oe,se)=>{let le=this.modelGraph.nodesById[oe];return this.modelGraph.nodesById[se].level-le.level});for(let oe of q){let se=this.modelGraph.nodesById[oe];se.expanded=!0;let le=new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config),Q=le.layout(oe);this.testMode&&this.dagreGraphs.push(le.dagreGraph);let W=Q.width+Fs*2,H=this.getTargetGroupNodeHeight(Q,se);se.width=W,se.height=H}let ge=new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config);ge.layout(),this.testMode&&this.dagreGraphs.push(ge.dagreGraph);for(let oe of this.modelGraph.rootNodes)tn(oe)&&this.updateNodeOffset(oe)}expandToRevealNode(G){let ae=this.modelGraph.nodesById[G],O=[],q=ae;for(;;){let oe=this.modelGraph.nodesById[q.nsParentId||""];if(!oe)break;O.unshift(oe),q=oe}for(let oe of O)this.expandGroupNode(oe.id);let ge=[];return il(void 0,this.modelGraph,ge),ge}collapseGroupNode(G){let ae=this.modelGraph.nodesById[G];if(!ae)return[];ae.expanded=!1,delete this.modelGraph.edgesByGroupNodeIds[G],ae.width=mf(ae,this.modelGraph,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId),ae.height=I0(ae,this.modelGraph,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,!0,this.config);let O=ae.nsParentId;for(;O!=null;){let oe=this.modelGraph.nodesById[O];if(!oe)break;let se=new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config),le=se.layout(O);this.testMode&&this.dagreGraphs.push(se.dagreGraph);let Q=le.width+Fs*2,W=this.getTargetGroupNodeHeight(le,oe);oe.width=Q,oe.height=W,O=oe.nsParentId}let q=new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config);q.layout(),this.testMode&&this.dagreGraphs.push(q.dagreGraph);for(let oe of this.modelGraph.rootNodes)tn(oe)&&this.updateNodeOffset(oe);let ge=[];return il(void 0,this.modelGraph,ge),ge}reLayoutGraph(G,ae){let O=G;if(O)ae&&this.clearLayoutData(void 0,!0);else{let q=[];this.clearLayoutData(void 0),il(void 0,this.modelGraph,q),O=q}return O.length>0?this.expandFromDeepestGroupNodes(O):new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config).layout(),O}expandAllGroups(){this.clearLayoutData(void 0,!0);let G=this.modelGraph.nodes.filter(ae=>tn(ae)&&(ae.nsChildrenIds||[]).filter(O=>tn(this.modelGraph.nodesById[O])).length===0).map(ae=>ae.id);return G.length>0&&this.expandFromDeepestGroupNodes(G),G}collapseAllGroup(){this.clearLayoutData(void 0,!0),new _i(this.modelGraph,this.dagre,this.showOnNodeItemTypes,this.nodeDataProviderRuns,this.selectedNodeDataProviderRunId,this.testMode,this.config).layout();for(let ae of this.modelGraph.rootNodes)tn(ae)&&this.updateNodeOffset(ae);return[]}updateNodeOffset(G){for(let ae of G.nsChildrenIds||[]){let O=this.modelGraph.nodesById[ae];if(O.x!=null&&O.y!=null){O.globalX=(G.x||0)+(G.globalX||0)+(O.localOffsetX||0),O.globalY=(G.y||0)+(G.globalY||0)+(O.localOffsetY||0);let q=(ff(G.label).length-1)*Vm;q>0&&(O.globalY+=q),G.pinToTopOpNode&&O.id!==G.pinToTopOpNode.id&&(O.globalY+=this.getPinToTopNodeVerticalSpace(G.pinToTopOpNode)),G.pinToTopOpNode?.id===O.id&&(O.globalX=(G.x||0)+(G.globalX||0)+(G.width||0)/2,O.globalY=(G.y||0)+(G.globalY||0)+(O.localOffsetY||0)+this.getPinToTopNodeVerticalSpace(O)-(O.height||0)/2+10)}tn(O)&&this.updateNodeOffset(O)}}clearLayoutData(G,ae){let O=[];G==null?O=this.modelGraph.rootNodes.map(q=>q.id):O=G.nsChildrenIds||[],ae&&G!=null&&(G.expanded=!1,delete this.modelGraph.edgesByGroupNodeIds[G.id]);for(let q of O){let ge=this.modelGraph.nodesById[q];ge&&(ge.width=void 0,ge.height=void 0,tn(ge)&&ge.expanded&&this.clearLayoutData(ge,ae))}}getPinToTopNodeVerticalSpace(G){return(G.height||0)+20}getTargetGroupNodeHeight(G,ae){let O=jm(ae.label),q=G.height+C0+Ay+O;return ae.pinToTopOpNode&&(q+=this.getPinToTopNodeVerticalSpace(ae.pinToTopOpNode)),q}};function ol(S,G,ae){let O={eventType:8,paneId:S,label:G,error:ae};postMessage(O)}var e_=/dense<([^>]*)>/,Ym=class{constructor(G,ae,O,q={},ge={},oe=gy,se=!1,le=!1,Q=!1){this.paneId=G;this.graph=ae;this.config=O;this.showOnNodeItemTypes=q;this.nodeDataProviderRuns=ge;this.groupNodeChildrenCountThreshold=oe;this.testMode=se;this.flattenLayers=le;this.keepLayersWithASingleChild=Q;this.nodeLabelsToHide=new Set((this.config?.nodeLabelsToHide||[]).map(W=>W.toLowerCase()))}nodeLabelsToHide;process(){let G=this.createEmptyModelGraph();return this.processNodes(G),this.processEdgeRelationships(G),ol(this.paneId,"Processing nodes and edges"),this.processNamespaceRelationships(G),ol(this.paneId,"Processing layer namespaces"),this.generateLayoutGraphConnections(G),ol(this.paneId,"Processing layout data"),this.splitLargeGroupNodes(G),ol(this.paneId,"Splitting large layers (if any)"),this.populateDescendantsAndCounts(G),G}processNodes(G){let ae=new Set;for(let O of this.graph.nodes){let ge=O.namespace.split(";").filter(se=>se!=="");ge.length>1&&(O.namespace=ge[ge.length-1]);let oe={nodeType:0,id:O.id,namespace:this.flattenLayers?"":O.namespace,savedNamespace:O.namespace,fullNamespace:O.namespace,label:O.label,level:this.getNonEmptyNamespaceComponents(O.namespace).length};if(O.subgraphIds&&O.subgraphIds.length>0&&(oe.subgraphIds=O.subgraphIds),this.nodeLabelsToHide.has(O.label.toLowerCase())&&(oe.hideInLayout=!0),this.config?.nodeAttrsToHide){let se=[];O.attrs!=null&&se.push(...O.attrs),se.push({key:"id",value:O.id}),se.push({key:"name",value:O.label}),se.push({key:"namespace",value:O.namespace});for(let[le,Q]of Object.entries(this.config.nodeAttrsToHide)){let W=se.find(H=>H.key===le)?.value;if(W&&typeof W=="string"&&W.match(Q)){oe.hideInLayout=!0;break}}}if(O.attrs){let se={};for(let le of O.attrs)se[le.key]=this.processAttrValue(le.key,le.value);oe.attrs=se}if(O.inputsMetadata&&(oe.inputsMetadata=this.processMetadataList(O.inputsMetadata)),O.outputsMetadata&&(oe.outputsMetadata=this.processMetadataList(O.outputsMetadata)),O.style&&(oe.style=O.style),O.config&&(oe.config=O.config),G.nodes.push(oe),G.nodesById[oe.id]=oe,!oe.hideInLayout&&!this.flattenLayers){let se=this.getAncestorNamespaces(oe.namespace);for(let le of se){if(ae.has(le))continue;ae.add(le);let Q=le.split("/"),W=Q.splice(-1)[0],H=Q.join("/"),k={nodeType:1,id:this.getGroupNodeIdFromNamespace(le),namespace:H,label:W,level:Q.length,expanded:!1};G.nodes.push(k),G.nodesById[k.id]=k}}}}processEdgeRelationships(G){for(let ae of this.graph.nodes){let O=G.nodesById[ae.id];if(O)for(let q of ae.incomingEdges||[]){let ge=q.sourceNodeId,oe=G.nodesById[ge];oe&&(O.incomingEdges==null&&(O.incomingEdges=[]),O.incomingEdges.find(se=>se.sourceNodeId===ge&&se.sourceNodeOutputId===q.sourceNodeOutputId&&se.targetNodeInputId===q.targetNodeInputId)==null&&O.incomingEdges.push({...q}),oe.outgoingEdges==null&&(oe.outgoingEdges=[]),oe.outgoingEdges.find(se=>se.targetNodeId===O.id&&se.sourceNodeOutputId===q.sourceNodeOutputId&&se.targetNodeInputId===q.targetNodeInputId)==null&&oe.outgoingEdges.push({targetNodeId:O.id,sourceNodeOutputId:q.sourceNodeOutputId,targetNodeInputId:q.targetNodeInputId}))}}}processNamespaceRelationships(G){for(let ae of G.nodes){if(pr(ae)&&ae.hideInLayout)continue;let O=ae.namespace;if(O===""){G.rootNodes.push(ae);continue}let q=this.getGroupNodeIdFromNamespace(O),ge=G.nodesById[q];ge?ae.nsParentId=ge.id:console.warn(`Failed to find the NS parent of node "${ae.id}": "${q}"`),ge&&(ge.nsChildrenIds==null&&(ge.nsChildrenIds=[]),ge.nsChildrenIds.includes(ae.id)||(ge.nsChildrenIds.push(ae.id),pr(ae)&&ae.config?.pinToGroupTop&&(ge.pinToTopOpNode=ae)))}if(!this.keepLayersWithASingleChild)for(;;){let ae=0;for(let O of G.nodes)if(tn(O)&&O.nsChildrenIds!=null&&O.nsChildrenIds.length===1){let q=G.nodesById[O.nsChildrenIds[0]];if(pr(q)){ae++;let ge=G.nodes.indexOf(O);ge>=0&&G.nodes.splice(ge,1),delete G.nodesById[O.id];let oe=q.namespace,se=this.getNonEmptyNamespaceComponents(oe);se.pop(),q.namespace=se.join("/"),q.savedNamespace=q.namespace,q.level=se.length,q.nsParentId=O.nsParentId;let le=G.rootNodes.indexOf(O);if(le>=0&&(G.rootNodes.splice(le,1),G.rootNodes.push(q)),O.nsParentId){let Q=G.nodesById[O.nsParentId],W=Q.nsChildrenIds.indexOf(O.id);Q.nsChildrenIds.splice(W,1),Q.nsChildrenIds.push(q.id)}}}if(ae===0)break}}generateLayoutGraphConnections(G){G.layoutGraphEdges={};let ae=[],O=[];for(let oe of G.nodes){if(!pr(oe)||oe.hideInLayout)continue;O.push(oe),(oe.incomingEdges||[]).filter(le=>!G.nodesById[le.sourceNodeId].hideInLayout).length===0&&ae.push(oe)}ae.length===0&&O.length>0&&(ae=O);let q=[...ae],ge=new Set;for(;q.length>0;){let oe=q.shift();if(oe==null||oe.hideInLayout||ge.has(oe.id))continue;ge.add(oe.id);let se=oe.outgoingEdges||[];for(let le of se){let Q=G.nodesById[le.targetNodeId];if(Q.hideInLayout)continue;let W=Sy(oe.namespace,Q.namespace),H=R0(W,oe.namespace),k=H===""?oe.id:`${W}${W===""?"":"/"}${H}___group___`,$=R0(W,Q.namespace),X=$===""?Q.id:`${W}${W===""?"":"/"}${$}___group___`,ne=W===""?"":`${W}___group___`;G.layoutGraphEdges[ne]==null&&(G.layoutGraphEdges[ne]={}),G.layoutGraphEdges[ne][k]==null&&(G.layoutGraphEdges[ne][k]={}),G.layoutGraphEdges[ne][k][X]=!0}for(let le of se){let Q=G.nodesById[le.targetNodeId];q.push(Q)}}}splitLargeGroupNodes(G){let ae=[void 0],O=!1;for(;ae.length>0;){let q=ae.shift(),ge=q==null?G.rootNodes:(q.nsChildrenIds||[]).map(oe=>G.nodesById[oe]);if(ge.length>this.groupNodeChildrenCountThreshold){O=!0;let oe=D0(q?.id||"",ge,G,this.showOnNodeItemTypes,this.nodeDataProviderRuns,void 0,this.testMode,!0,this.config),se=[];for(let $ of Object.keys(oe.nodes))oe.incomingEdges[$]==null&&se.push(G.nodesById[$]);let le=[],Q=[],W=new Set,H=$=>{if(W.has($))return;W.add($);let X=G.nodesById[$];Q.push(X),Q.length===this.groupNodeChildrenCountThreshold&&(le.push(Q),Q=[]);for(let ne of oe.outgoingEdges[X.id]||[])H(ne)};for(let $ of se)H($.id);Q.length<this.groupNodeChildrenCountThreshold&&Q.length>0&&le.push(Q);let k=[];for(let $=0;$<le.length;$++){let X=le[$],ne=q==null?"":`${q.namespace}/${q.label}`,j=`section_${$+1}_of_${le.length}`,z=q==null?`${j}___group___`:`${ne}/${j}___group___`,me={nodeType:1,id:z,label:j,namespace:ne,level:ne.split("/").filter(ze=>ze!=="").length,nsParentId:q?.id,nsChildrenIds:X.map(ze=>ze.id),expanded:!1,sectionContainer:!0};k.push(me),G.nodes.push(me),G.nodesById[me.id]=me,G.artificialGroupNodeIds==null&&(G.artificialGroupNodeIds=[]),G.artificialGroupNodeIds.push(me.id);for(let ze of X)ze.nsParentId=me.id;let Re=z.replace("___group___",""),Xe=ze=>{if(ze.namespace===""?ze.namespace=Re:q==null?ze.namespace=`${Re}/${ze.namespace}`:ze.namespace=(ze.nsParentId||"").replace("___group___",""),ze.level=ze.namespace.split("/").filter(tt=>tt!=="").length,tn(ze)){let tt=ze.id;if(delete G.nodesById[ze.id],ze.id=`${ze.namespace}/${ze.label}___group___`,G.nodesById[ze.id]=ze,ze.nsParentId){let ft=G.nodesById[ze.nsParentId],je=(ft.nsChildrenIds||[]).indexOf(tt);je>=0&&((ft.nsChildrenIds||[])[je]=ze.id)}for(let ft of ze.nsChildrenIds||[]){let je=G.nodesById[ft];je!=null&&(je.nsParentId=ze.id,Xe(je))}}};for(let ze of X)Xe(ze);if(q==null){for(let ze of X){let Ge=G.rootNodes.indexOf(ze);Ge>=0&&G.rootNodes.splice(Ge,1)}me.namespace===""&&G.rootNodes.push(me)}ge=k}q!=null&&(q.nsChildrenIds=k.map($=>$.id))}for(let oe of ge)tn(oe)&&ae.push(oe)}O&&this.generateLayoutGraphConnections(G)}populateDescendantsAndCounts(G){let ae=Number.MAX_VALUE,O=Number.NEGATIVE_INFINITY;for(let q of G.nodes)if(tn(q)){let ge=[];this.gatherDescendants(G,q,ge),q.descendantsNodeIds=ge.map(se=>se.id),q.descendantsOpNodeIds=ge.filter(se=>se.nodeType===0).map(se=>se.id);let oe=(q.descendantsOpNodeIds||[]).length;ae=Math.min(oe,ae),O=Math.max(oe,O)}G.minDescendantOpNodeCount=ae,G.maxDescendantOpNodeCount=O}createEmptyModelGraph(){let G={id:this.graph.id,collectionLabel:this.graph.collectionLabel||"",nodes:[],nodesById:{},rootNodes:[],edgesByGroupNodeIds:{},layoutGraphEdges:{},minDescendantOpNodeCount:-1,maxDescendantOpNodeCount:-1};return this.graph.groupNodeAttributes&&(G.groupNodeAttributes=this.graph.groupNodeAttributes),this.graph.groupNodeConfigs&&(G.groupNodeConfigs=this.graph.groupNodeConfigs),this.graph.layoutConfigs&&(G.layoutConfigs=this.graph.layoutConfigs),G}getAncestorNamespaces(G){let ae=this.getNonEmptyNamespaceComponents(G),O=[];for(;ae.length>0;)O.push(ae.join("/")),ae.pop();return O}getNonEmptyNamespaceComponents(G){return G.split("/").filter(ae=>ae!=="")}getGroupNodeIdFromNamespace(G){return`${G}___group___`}gatherDescendants(G,ae,O){for(let q of ae.nsChildrenIds||[]){let ge=G.nodesById[q];(tn(ge)||pr(ge)&&!ge.hideInLayout)&&O.push(ge),tn(ge)&&this.gatherDescendants(G,ge,O)}}processAttrValue(G,ae){if(typeof ae=="string"){if(ae.startsWith("dense<")){let O=ae.match(e_);if(O!=null&&O.length>1){let q=O[1];return Ry(q)}}else if(G===Hm)return Ry(ae);return ae.replaceAll('"',"")||"<empty>"}else return ae}processMetadataList(G){let ae={};for(let O of G){let q={};for(let ge of O.attrs){let oe=ge.key,se=ge.value;oe==="tensor_shape"&&(oe="shape",se=se.replace("tensor<","").replace(">","").replace("*","\u2217").split("x").join(" x ")),q[oe]=se}ae[O.id]=q}return ae}};function Ry(S){try{return JSON.stringify(JSON.parse(S),null,2).replaceAll("\\n",`
`).trim()}catch{return S}}var qm=10000019,Xm=class{constructor(G){this.modelGraph=G}markIdenticalGroups(){let G={};for(let O of this.modelGraph.nodes){if(!tn(O))continue;let q=0,ge=(O.descendantsOpNodeIds||[]).map(se=>this.modelGraph.nodesById[se]).filter(se=>!se.hideInLayout),oe=new Set(ge.map(se=>se.id));for(let se of ge)q=(q+this.getNodeHash(se,oe))%qm;for(let se of ge)for(let le of se.outgoingEdges||[]){let Q=le.targetNodeId;if(!oe.has(Q))continue;let W=this.modelGraph.nodesById[Q];q=(q+this.getEdgeHash(se,W))%qm}G[q]||(G[q]=[]),G[q].push(O)}let ae=0;for(let O of Object.values(G))if(!(O.length<=1)&&!(O.length===2&&(O[0].nsParentId===O[1].id||O[1].nsParentId===O[0].id))){for(let q of O)q.identicalGroupIndex=ae;ae++}}getNodeHash(G,ae){let O=0;O=this.addToHash(O,G.label);let q=0;for(let oe of G.incomingEdges||[]){let se=oe.sourceNodeId;if(ae.has(se)){let le=this.modelGraph.nodesById[se];O=this.addToHash(O,`in ${le.label}`),q++}}let ge=0;for(let oe of G.outgoingEdges||[]){let se=oe.targetNodeInputId;if(ae.has(se)){let le=this.modelGraph.nodesById[se];O=this.addToHash(O,`out ${le.label}`),ge++}}return O=this.addToHash(O,`${q}`),O=this.addToHash(O,`${ge}`),O}getEdgeHash(G,ae){return this.genHash(G.label+ae.label)%qm}genHash(G){let ae=5381;G=G||"";for(let O=0,q=G.length;O<q;O++)ae+=(ae<<5)+G.charCodeAt(O);return ae&2147483647}addToHash(G,ae){return(G+this.genHash(ae))%qm}};var rM=Ux(Ly());var O0={};self.addEventListener("message",S=>{let G=S.data;switch(G.eventType){case 0:{let ae=t_(G.paneId,G.graph,G.showOnNodeItemTypes,G.nodeDataProviderRuns,G.config,G.groupNodeChildrenCountThreshold,G.flattenLayers,G.keepLayersWithASingleChild,G.initialLayout);vf(ae,G.paneId);let O={eventType:1,modelGraph:ae,paneId:G.paneId};postMessage(O);break}case 9:{let ae=yf(G.modelGraphId,G.paneId),O=JSON.parse(JSON.stringify(ae));vf(O,G.rendererId);let q={eventType:10,modelGraph:ae,paneId:G.paneId,rendererId:G.rendererId,groupNodeId:G.groupNodeId,initialPosition:G.initialPosition};postMessage(q);break}case 2:{let ae=yf(G.modelGraphId,G.rendererId),O=[];G.expand?O=n_(ae,G.groupNodeId,G.showOnNodeItemTypes,G.nodeDataProviderRuns,G.selectedNodeDataProviderRunId,G.all===!0,G.config):O=r_(ae,G.groupNodeId,G.showOnNodeItemTypes,G.nodeDataProviderRuns,G.selectedNodeDataProviderRunId,G.all===!0,G.config),vf(ae,G.rendererId);let q={eventType:3,modelGraph:ae,expanded:G.expand,groupNodeId:G.groupNodeId,rendererId:G.rendererId,deepestExpandedGroupNodeIds:O};postMessage(q);break}case 4:{let ae=yf(G.modelGraphId,G.rendererId);i_(ae,G.showOnNodeItemTypes,G.nodeDataProviderRuns,G.selectedNodeDataProviderRunId,G.targetDeepestGroupNodeIdsToExpand,G.clearAllExpandStates,G.config),vf(ae,G.rendererId);let O={eventType:5,modelGraph:ae,selectedNodeId:G.selectedNodeId,rendererId:G.rendererId,forRestoringUiState:G.forRestoringUiState,rectToZoomFit:G.rectToZoomFit,forRestoringSnapshotAfterTogglingFlattenLayers:G.forRestoringSnapshotAfterTogglingFlattenLayers,targetDeepestGroupNodeIdsToExpand:G.targetDeepestGroupNodeIdsToExpand,triggerNavigationSync:G.triggerNavigationSync};postMessage(O);break}case 6:{let ae=yf(G.modelGraphId,G.rendererId),O=o_(ae,G.showOnNodeItemTypes,G.nodeDataProviderRuns,G.selectedNodeDataProviderRunId,G.nodeId,G.config);vf(ae,G.rendererId);let q={eventType:7,modelGraph:ae,nodeId:G.nodeId,rendererId:G.rendererId,deepestExpandedGroupNodeIds:O,noNodeShake:G.noNodeShake,select:G.select};postMessage(q);break}case 11:{O0={};break}case 12:{let ae=yf(G.modelGraphId,G.paneId);if(ae){let O=ae.nodesById[G.nodeId];O&&pr(O)&&(O.attrs={...O.attrs,...G.attrs})}break}default:break}});function t_(S,G,ae,O,q,ge,oe,se,le){let Q,H=new Ym(S,G,q,ae,{},ge,!1,oe,se).process();if(H.nodesById[""]!=null&&(Q="Some nodes have empty strings as ids which will cause layout failures. See console for details.",console.warn("Nodes with empty ids",H.nodesById[""])),!Q&&le){let $=new _i(H,dagre,ae,O,void 0);try{$.layout()}catch(X){Q=`Failed to layout graph: ${X}`}}return ol(S,"Laying out root layer",Q),new Xm(H).markIdenticalGroups(),ol(S,"Finding identical layers"),H}function n_(S,G,ae,O,q,ge,oe){let se=new sc(S,dagre,ae,O,q,!1,oe);if(G!=null){let le,Q=S.nodesById[G];if(Q&&tn(Q)){Q.expanded=!0;let H=Q;for(;;){let $=H.nsChildrenIds||[];if($.length===1){let X=S.nodesById[$[0]];if(X&&tn(X))X.expanded=!0,H=X;else break}else break}let k=[];il(H,S,k),le=k.length===0?[H.id]:k;for(let $ of H.descendantsNodeIds||[]){let X=S.nodesById[$];X.width=void 0,X.height=void 0}}if(ge){for(let H of Q.descendantsNodeIds||[]){let k=S.nodesById[H];tn(k)&&(k.expanded=!0)}le=void 0}se.reLayoutGraph(le);let W=[];return il(void 0,S,W),W}else return se.expandAllGroups()}function r_(S,G,ae,O,q,ge,oe){let se=new sc(S,dagre,ae,O,q,!1,oe);if(G!=null){if(ge){let le=S.nodesById[G];for(let Q of le.descendantsNodeIds||[]){let W=S.nodesById[Q];tn(W)&&(W.expanded=!1,W.width=void 0,W.height=void 0,delete S.edgesByGroupNodeIds[W.id])}}return se.collapseGroupNode(G)}else return se.collapseAllGroup()}function i_(S,G,ae,O,q,ge,oe){new sc(S,dagre,G,ae,O,!1,oe).reLayoutGraph(q,ge)}function o_(S,G,ae,O,q,ge){return new sc(S,dagre,G,ae,O,!1,ge).expandToRevealNode(q)}function vf(S,G){O0[Py(S.id,G)]=S}function yf(S,G){let ae=O0[Py(S,G)];if(ae==null)throw new Error(`ModelGraph with id "${S}" not found for rendererId "${G}"`);return ae}function Py(S,G){return`${S}___${G}`}
